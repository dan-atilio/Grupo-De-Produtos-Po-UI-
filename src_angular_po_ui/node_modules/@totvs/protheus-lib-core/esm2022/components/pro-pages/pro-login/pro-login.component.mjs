import { Component, Input, } from '@angular/core';
import { SubSink } from 'subsink';
import { environment } from '../../../environments/environment';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../../../services/pro-authorization/services/pro-auth/pro-auth.service";
import * as i3 from "./../../../services/pro-messages/services/pro-message.service";
import * as i4 from "@po-ui/ng-components";
import * as i5 from "../../../services/pro-language/services/pro-language.service";
import * as i6 from "../../../services/pro-brand/services/pro-brand.service";
import * as i7 from "@po-ui/ng-templates";
export class ProLoginComponent {
    set nextRoute(value) {
        this._nextRoute = value;
    }
    get nextRoute() {
        return this._nextRoute ? this._nextRoute : '/session-settings';
    }
    constructor(router, route, authService, messageService, poI18nService, elRef, proLanguageService, proBrandService) {
        this.router = router;
        this.route = route;
        this.authService = authService;
        this.messageService = messageService;
        this.poI18nService = poI18nService;
        this.elRef = elRef;
        this.proLanguageService = proLanguageService;
        this.proBrandService = proBrandService;
        this.subs = new SubSink();
        this.languages = [];
        this.logo = '';
        this.productName = '';
        this.updateLangs();
        const language = poI18nService.getShortLanguage();
        poI18nService
            .getLiterals({ language, context: 'login' })
            .subscribe((literals) => {
            this.updLiterals(literals);
            this.updateBrand();
        });
        this.messageService.changeLanguage(language);
    }
    ngOnInit() {
        this.authService.logout();
        this.isLoading = false;
        this.subs.add(this.subscribeToResolver());
    }
    ngAfterViewInit() {
        this.setFocusToInput(this.inputFocus);
    }
    setFocusToInput(name) {
        const input = this.elRef.nativeElement.querySelector('input[name="' + name + '"]');
        if (input) {
            setTimeout(() => input.focus(), 100);
        }
    }
    subscribeToResolver() {
        return this.route.data.subscribe((resultOfResolver) => {
            this.validateResolverData(resultOfResolver);
        });
    }
    subscribeToLogin(user) {
        return this.authService.login(user).subscribe(() => {
            const redirect = this.authService.redirectUrl
                ? this.authService.redirectUrl
                : this.nextRoute;
            this.resetLoading(this.router.navigate([redirect]));
        }, (error) => {
            this.isLoading = false;
            this.messageService.showOneMessage(this.parseErrorMessage(error));
            this.router.navigate(['/login']);
        });
    }
    resetLoading(navigatePromise) {
        if (navigatePromise) {
            navigatePromise
                .then(() => {
                this.isLoading = false;
            })
                .catch((error) => {
                console.error(error);
                this.isLoading = false;
            });
        }
    }
    validateResolverData(resolveData) {
        if (resolveData.defaultsLogin) {
            this.userDefaults = resolveData.defaultsLogin;
            this.hideRememberUser =
                !resolveData.defaultsLogin.showBindUserToSO ||
                    resolveData.defaultsLogin.singleSignOnRequired;
            this.loginValue = resolveData.defaultsLogin.cGetUser;
            this.inputFocus = resolveData.defaultsLogin.setFocus;
        }
    }
    set userDefaults(defaults) {
        this._ProUserDefaults = defaults;
    }
    get userDefaults() {
        return this._ProUserDefaults;
    }
    onLoginSubmit(formData) {
        const user = {
            username: formData.login,
            password: formData.password,
            remember_user: formData.rememberUser || this.userDefaults.singleSignOnRequired,
        };
        this.login(user);
    }
    /**
     * @description metodo chamado na mudança do combox de idioma da tela de login
     * @param language opção de idioma escolhido pelo usuário
     * @returns void
     */
    onLanguageChange({ language }) {
        this.poI18nService.setLanguage(language, false);
        this.poI18nService
            .getLiterals({ language, context: 'login' })
            .subscribe((literals) => {
            this.updLiterals(literals);
            this.updateProductName();
        });
        this.messageService.changeLanguage(language);
    }
    updLiterals(literals) {
        this.literals = {
            str0001: literals.str0001,
            str0002: literals.str0002,
            str0003: literals.str0003,
            str0004: literals.str0004,
            loginLabel: literals.str0005,
            loginPlaceholder: literals.str0006,
            passwordLabel: literals.str0007,
            loginHint: literals.str0008,
            rememberUserHint: literals.str0009,
            passwordPlaceholder: '',
        };
    }
    onLoginChange(login) {
        this.loginValue = login;
    }
    callRecoverPassword() {
        this.authService.passwordRecovery(this.loginValue);
    }
    /**
     * @description Método para obter o link de suporte
     * @returns Retorna uma string contendo o link de suporte do ERP
     */
    supportLink(language = this.poI18nService.getShortLanguage()) {
        let supportLink = 'http://suporte.totvs.com/';
        if (this.brand == 'MA3') {
            supportLink =
                language === 'en'
                    ? 'https://www.national-platform.com/'
                    : 'https://www.national-platform.ru/';
        }
        else {
            if (language === 'es') {
                supportLink = 'https://totvscst.zendesk.com/hc/es#home';
            }
            else if (language === 'en') {
                supportLink = 'https://totvscst.zendesk.com/hc/en-us#home';
            }
        }
        return supportLink;
    }
    login(user) {
        if (this.isLoading) {
            return;
        }
        this.isLoading = true;
        this.subs.add(this.subscribeToLogin(user));
    }
    parseErrorMessage(error) {
        switch (error.status) {
            case 401:
                return this.literals.str0002; // 'Usuário ou senha inválida.'
            case 0:
                return this.literals.str0003; // 'Não foi possível estabelecer conexão com o servidor.';
            default:
                if (error.error && error.error.errorMessage) {
                    return this.literals.str0004 + ': ' + error.error.errorMessage; // 'Ocorreu um problema na tentativa de Login';
                }
                else {
                    return this.literals.str0004 + '.'; // 'Ocorreu um problema na tentativa de Login';
                }
        }
    }
    /**
     * @description Atualiza os idiomas disponíveis
     */
    updateLangs() {
        this.proLanguageService.setChannelAsHTTP(environment.useHTTP);
        this.proLanguageService.getListOfLanguages().subscribe({
            next: (langs) => {
                this.languages = langs;
            },
            error: (error) => {
                console.error(error);
            },
        });
    }
    /**
     * @description Atualiza as variaveis a partir da marca
     * ma3 na russia e protheus nas demais
     * @returns void
     */
    updateResourceByBrand() {
        if (this.brand == 'MA3') {
            this.logo = './assets/images/nationalplatform/nationalplatform.svg';
            this.productName = 'Ma-3 Line';
        }
        else {
            this.logo = './assets/images/totvs/totvs.svg';
            this.productName = this.literals.str0001;
        }
    }
    /**
     * @description atualiza a variavel productName.
     * quando não for MA3 precisa atualziar com a literals cada vez que muda o idioma
     * @returns void
     */
    updateProductName() {
        if (this.brand != 'MA3') {
            this.productName = this.literals.str0001;
        }
    }
    /**
     * @description atualiza a variavel de marca
     * @returns void
     */
    updateBrand() {
        this.proBrandService.setChannelAsHTTP(environment.useHTTP);
        this.proBrandService.getERPBrand().subscribe({
            next: (brand) => {
                this.brand = brand;
                this.updateResourceByBrand();
            },
            error: (error) => {
                this.brand = 'TOTVS';
                this.updateResourceByBrand();
            },
        });
    }
    ngOnDestroy() {
        this.subs.unsubscribe();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.9", ngImport: i0, type: ProLoginComponent, deps: [{ token: i1.Router }, { token: i1.ActivatedRoute }, { token: i2.ProAuthService }, { token: i3.ProMessageService }, { token: i4.PoI18nService }, { token: i0.ElementRef }, { token: i5.ProLanguageService }, { token: i6.ProBrandService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.3.9", type: ProLoginComponent, selector: "pro-login", inputs: { nextRoute: ["pro-next-route", "nextRoute"] }, ngImport: i0, template: "<po-page-login\r\n  [p-hide-remember-user]=\"hideRememberUser\"\r\n  (p-login-submit)=\"onLoginSubmit($event)\"\r\n  (p-login-change)=\"onLoginChange($event)\"\r\n  [p-languages]=\"languages\"\r\n  (p-language-change)=\"onLanguageChange($event)\"\r\n  [p-login]=\"loginValue\"\r\n  [p-loading]=\"isLoading\"\r\n  [p-literals]=\"literals\"\r\n  [p-product-name]=\"productName\"\r\n  [p-recovery]=\"this.callRecoverPassword.bind(this)\"\r\n  [p-support]=\"supportLink()\"\r\n  [p-logo]=\"logo\"\r\n  [p-secondary-logo]=\"logo\">\r\n  <!-- Linha Protheus -->\r\n</po-page-login>\r\n", styles: [""], dependencies: [{ kind: "component", type: i7.PoPageLoginComponent, selector: "po-page-login" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.9", ngImport: i0, type: ProLoginComponent, decorators: [{
            type: Component,
            args: [{ selector: 'pro-login', template: "<po-page-login\r\n  [p-hide-remember-user]=\"hideRememberUser\"\r\n  (p-login-submit)=\"onLoginSubmit($event)\"\r\n  (p-login-change)=\"onLoginChange($event)\"\r\n  [p-languages]=\"languages\"\r\n  (p-language-change)=\"onLanguageChange($event)\"\r\n  [p-login]=\"loginValue\"\r\n  [p-loading]=\"isLoading\"\r\n  [p-literals]=\"literals\"\r\n  [p-product-name]=\"productName\"\r\n  [p-recovery]=\"this.callRecoverPassword.bind(this)\"\r\n  [p-support]=\"supportLink()\"\r\n  [p-logo]=\"logo\"\r\n  [p-secondary-logo]=\"logo\">\r\n  <!-- Linha Protheus -->\r\n</po-page-login>\r\n" }]
        }], ctorParameters: () => [{ type: i1.Router }, { type: i1.ActivatedRoute }, { type: i2.ProAuthService }, { type: i3.ProMessageService }, { type: i4.PoI18nService }, { type: i0.ElementRef }, { type: i5.ProLanguageService }, { type: i6.ProBrandService }], propDecorators: { nextRoute: [{
                type: Input,
                args: ['pro-next-route']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvLWxvZ2luLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3Byb3RoZXVzLWxpYi1jb3JlL3NyYy9jb21wb25lbnRzL3Byby1wYWdlcy9wcm8tbG9naW4vcHJvLWxvZ2luLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3Byb3RoZXVzLWxpYi1jb3JlL3NyYy9jb21wb25lbnRzL3Byby1wYWdlcy9wcm8tbG9naW4vcHJvLWxvZ2luLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBRVQsS0FBSyxHQUdOLE1BQU0sZUFBZSxDQUFDO0FBS3ZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFbEMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1DQUFtQyxDQUFDOzs7Ozs7Ozs7QUFhaEUsTUFBTSxPQUFPLGlCQUFpQjtJQWlCNUIsSUFBNkIsU0FBUyxDQUFDLEtBQWE7UUFDbEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQUVELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsbUJBQW1CLENBQUM7SUFDakUsQ0FBQztJQUVELFlBQ1UsTUFBYyxFQUNkLEtBQXFCLEVBQ3JCLFdBQTJCLEVBQzNCLGNBQWlDLEVBQ2pDLGFBQTRCLEVBQzVCLEtBQWlCLEVBQ2pCLGtCQUFzQyxFQUN0QyxlQUFnQztRQVBoQyxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsVUFBSyxHQUFMLEtBQUssQ0FBZ0I7UUFDckIsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQzNCLG1CQUFjLEdBQWQsY0FBYyxDQUFtQjtRQUNqQyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixVQUFL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Z0IsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDM0MsSUFBSSxFQUFFLENBQUMsS0FBYSxFQUFFLEVBQUU7Z0JBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO2dCQUNuQixJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUMvQixDQUFDO1lBQ0QsS0FBSyxFQUFFLENBQUMsS0FBVSxFQUFFLEVBQUU7Z0JBQ3BCLElBQUksQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDO2dCQUNyQixJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUMvQixDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzFCLENBQUM7OEdBdFJVLGlCQUFpQjtrR0FBakIsaUJBQWlCLHlHQzNCOUIscWtCQWdCQTs7MkZEV2EsaUJBQWlCO2tCQUw3QixTQUFTOytCQUNFLFdBQVc7eVJBcUJRLFNBQVM7c0JBQXJDLEtBQUs7dUJBQUMsZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBBZnRlclZpZXdJbml0LFxyXG4gIENvbXBvbmVudCxcclxuICBFbGVtZW50UmVmLFxyXG4gIElucHV0LFxyXG4gIE9uRGVzdHJveSxcclxuICBPbkluaXQsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBEYXRhLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBQb0kxOG5TZXJ2aWNlLCBQb0xhbmd1YWdlIH0gZnJvbSAnQHBvLXVpL25nLWNvbXBvbmVudHMnO1xyXG5pbXBvcnQgeyBQb1BhZ2VMb2dpbiwgUG9QYWdlTG9naW5MaXRlcmFscyB9IGZyb20gJ0Bwby11aS9uZy10ZW1wbGF0ZXMnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgU3ViU2luayB9IGZyb20gJ3N1YnNpbmsnO1xyXG5cclxuaW1wb3J0IHsgZW52aXJvbm1lbnQgfSBmcm9tICcuLi8uLi8uLi9lbnZpcm9ubWVudHMvZW52aXJvbm1lbnQnO1xyXG5pbXBvcnQgeyBQcm9BdXRoU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3Byby1hdXRob3JpemF0aW9uL3NlcnZpY2VzL3Byby1hdXRoL3Byby1hdXRoLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQcm9CcmFuZFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wcm8tYnJhbmQvc2VydmljZXMvcHJvLWJyYW5kLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBQcm9MYW5ndWFnZUxpc3QgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wcm8tbGFuZ3VhZ2UvbW9kZWxzL3Byby1sYW5ndWFnZS5saXN0JztcclxuaW1wb3J0IHsgUHJvTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvcHJvLWxhbmd1YWdlL3NlcnZpY2VzL3Byby1sYW5ndWFnZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUHJvVXNlciB9IGZyb20gJy4vLi4vLi4vLi4vc2VydmljZXMvcHJvLWF1dGhvcml6YXRpb24vbW9kZWxzL3Byby11c2VyJztcclxuaW1wb3J0IHsgUHJvTWVzc2FnZVNlcnZpY2UgfSBmcm9tICcuLy4uLy4uLy4uL3NlcnZpY2VzL3Byby1tZXNzYWdlcy9zZXJ2aWNlcy9wcm8tbWVzc2FnZS5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncHJvLWxvZ2luJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcHJvLWxvZ2luLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9wcm8tbG9naW4uY29tcG9uZW50LmNzcyddLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgUHJvTG9naW5Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgcHJpdmF0ZSBfbmV4dFJvdXRlOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBfUHJvVXNlckRlZmF1bHRzOiBQcm9Vc2VyO1xyXG4gIHByaXZhdGUgc3VicyA9IG5ldyBTdWJTaW5rKCk7XHJcblxyXG4gIGlzTG9hZGluZzogYm9vbGVhbjtcclxuICBsaXRlcmFsczogYW55O1xyXG4gIHByb2R1Y3RMaW5lOiBzdHJpbmc7XHJcbiAgYnJhbmQ6IHN0cmluZztcclxuICBjdXN0b21MaXRlcmFsczogUG9QYWdlTG9naW5MaXRlcmFscztcclxuICBoaWRlUmVtZW1iZXJVc2VyOiBib29sZWFuO1xyXG4gIGxvZ2luVmFsdWU6IHN0cmluZztcclxuICBpbnB1dEZvY3VzOiBzdHJpbmc7XHJcbiAgbGFuZ3VhZ2VzOiBBcnJheTxQb0xhbmd1YWdlPiA9IFtdO1xyXG4gIGxvZ28gPSAnJztcclxuICBwcm9kdWN0TmFtZSA9ICcnO1xyXG5cclxuICBASW5wdXQoJ3Byby1uZXh0LXJvdXRlJykgc2V0IG5leHRSb3V0ZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLl9uZXh0Um91dGUgPSB2YWx1ZTtcclxuICB9XHJcblxyXG4gIGdldCBuZXh0Um91dGUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fbmV4dFJvdXRlID8gdGhpcy5fbmV4dFJvdXRlIDogJy9zZXNzaW9uLXNldHRpbmdzJztcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcclxuICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlLFxyXG4gICAgcHJpdmF0ZSBhdXRoU2VydmljZTogUHJvQXV0aFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIG1lc3NhZ2VTZXJ2aWNlOiBQcm9NZXNzYWdlU2VydmljZSxcclxuICAgIHByaXZhdGUgcG9JMThuU2VydmljZTogUG9JMThuU2VydmljZSxcclxuICAgIHByaXZhdGUgZWxSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICBwcml2YXRlIHByb0xhbmd1YWdlU2VydmljZTogUHJvTGFuZ3VhZ2VTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBwcm9CcmFuZFNlcnZpY2U6IFByb0JyYW5kU2VydmljZVxyXG4gICkge1xyXG4gICAgdGhpcy51cGRhdGVMYW5ncygpO1xyXG4gICAgY29uc3QgbGFuZ3VhZ2UgPSBwb0kxOG5TZXJ2aWNlLmdldFNob3J0TGFuZ3VhZ2UoKTtcclxuICAgIHBvSTE4blNlcnZpY2VcclxuICAgICAgLmdldExpdGVyYWxzKHsgbGFuZ3VhZ2UsIGNvbnRleHQ6ICdsb2dpbicgfSlcclxuICAgICAgLnN1YnNjcmliZSgobGl0ZXJhbHMpID0+IHtcclxuICAgICAgICB0aGlzLnVwZExpdGVyYWxzKGxpdGVyYWxzKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZUJyYW5kKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgdGhpcy5tZXNzYWdlU2VydmljZS5jaGFuZ2VMYW5ndWFnZShsYW5ndWFnZSk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuYXV0aFNlcnZpY2UubG9nb3V0KCk7XHJcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5zdWJzLmFkZCh0aGlzLnN1YnNjcmliZVRvUmVzb2x2ZXIoKSk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICB0aGlzLnNldEZvY3VzVG9JbnB1dCh0aGlzLmlucHV0Rm9jdXMpO1xyXG4gIH1cclxuXHJcbiAgc2V0Rm9jdXNUb0lucHV0KG5hbWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3QgaW5wdXQgPSB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgJ2lucHV0W25hbWU9XCInICsgbmFtZSArICdcIl0nXHJcbiAgICApO1xyXG4gICAgaWYgKGlucHV0KSB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gaW5wdXQuZm9jdXMoKSwgMTAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3Vic2NyaWJlVG9SZXNvbHZlcigpOiBTdWJzY3JpcHRpb24ge1xyXG4gICAgcmV0dXJuIHRoaXMucm91dGUuZGF0YS5zdWJzY3JpYmUoKHJlc3VsdE9mUmVzb2x2ZXIpID0+IHtcclxuICAgICAgdGhpcy52YWxpZGF0ZVJlc29sdmVyRGF0YShyZXN1bHRPZlJlc29sdmVyKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3Vic2NyaWJlVG9Mb2dpbih1c2VyKTogU3Vic2NyaXB0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLmF1dGhTZXJ2aWNlLmxvZ2luKHVzZXIpLnN1YnNjcmliZShcclxuICAgICAgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlZGlyZWN0ID0gdGhpcy5hdXRoU2VydmljZS5yZWRpcmVjdFVybFxyXG4gICAgICAgICAgPyB0aGlzLmF1dGhTZXJ2aWNlLnJlZGlyZWN0VXJsXHJcbiAgICAgICAgICA6IHRoaXMubmV4dFJvdXRlO1xyXG4gICAgICAgIHRoaXMucmVzZXRMb2FkaW5nKHRoaXMucm91dGVyLm5hdmlnYXRlKFtyZWRpcmVjdF0pKTtcclxuICAgICAgfSxcclxuICAgICAgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VTZXJ2aWNlLnNob3dPbmVNZXNzYWdlKHRoaXMucGFyc2VFcnJvck1lc3NhZ2UoZXJyb3IpKTtcclxuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy9sb2dpbiddKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHJlc2V0TG9hZGluZyhuYXZpZ2F0ZVByb21pc2UpIHtcclxuICAgIGlmIChuYXZpZ2F0ZVByb21pc2UpIHtcclxuICAgICAgbmF2aWdhdGVQcm9taXNlXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHZhbGlkYXRlUmVzb2x2ZXJEYXRhKHJlc29sdmVEYXRhOiBEYXRhKSB7XHJcbiAgICBpZiAocmVzb2x2ZURhdGEuZGVmYXVsdHNMb2dpbikge1xyXG4gICAgICB0aGlzLnVzZXJEZWZhdWx0cyA9IHJlc29sdmVEYXRhLmRlZmF1bHRzTG9naW47XHJcbiAgICAgIHRoaXMuaGlkZVJlbWVtYmVyVXNlciA9XHJcbiAgICAgICAgIXJlc29sdmVEYXRhLmRlZmF1bHRzTG9naW4uc2hvd0JpbmRVc2VyVG9TTyB8fFxyXG4gICAgICAgIHJlc29sdmVEYXRhLmRlZmF1bHRzTG9naW4uc2luZ2xlU2lnbk9uUmVxdWlyZWQ7XHJcbiAgICAgIHRoaXMubG9naW5WYWx1ZSA9IHJlc29sdmVEYXRhLmRlZmF1bHRzTG9naW4uY0dldFVzZXI7XHJcbiAgICAgIHRoaXMuaW5wdXRGb2N1cyA9IHJlc29sdmVEYXRhLmRlZmF1bHRzTG9naW4uc2V0Rm9jdXM7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXQgdXNlckRlZmF1bHRzKGRlZmF1bHRzOiBQcm9Vc2VyKSB7XHJcbiAgICB0aGlzLl9Qcm9Vc2VyRGVmYXVsdHMgPSBkZWZhdWx0cztcclxuICB9XHJcblxyXG4gIGdldCB1c2VyRGVmYXVsdHMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fUHJvVXNlckRlZmF1bHRzO1xyXG4gIH1cclxuXHJcbiAgb25Mb2dpblN1Ym1pdChmb3JtRGF0YTogUG9QYWdlTG9naW4pOiB2b2lkIHtcclxuICAgIGNvbnN0IHVzZXI6IFByb1VzZXIgPSB7XHJcbiAgICAgIHVzZXJuYW1lOiBmb3JtRGF0YS5sb2dpbixcclxuICAgICAgcGFzc3dvcmQ6IGZvcm1EYXRhLnBhc3N3b3JkLFxyXG4gICAgICByZW1lbWJlcl91c2VyOlxyXG4gICAgICAgIGZvcm1EYXRhLnJlbWVtYmVyVXNlciB8fCB0aGlzLnVzZXJEZWZhdWx0cy5zaW5nbGVTaWduT25SZXF1aXJlZCxcclxuICAgIH07XHJcbiAgICB0aGlzLmxvZ2luKHVzZXIpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIG1ldG9kbyBjaGFtYWRvIG5hIG11ZGFuw6dhIGRvIGNvbWJveCBkZSBpZGlvbWEgZGEgdGVsYSBkZSBsb2dpblxyXG4gICAqIEBwYXJhbSBsYW5ndWFnZSBvcMOnw6NvIGRlIGlkaW9tYSBlc2NvbGhpZG8gcGVsbyB1c3XDoXJpb1xyXG4gICAqIEByZXR1cm5zIHZvaWRcclxuICAgKi9cclxuICBvbkxhbmd1YWdlQ2hhbmdlKHsgbGFuZ3VhZ2UgfSk6IHZvaWQge1xyXG4gICAgdGhpcy5wb0kxOG5TZXJ2aWNlLnNldExhbmd1YWdlKGxhbmd1YWdlLCBmYWxzZSk7XHJcbiAgICB0aGlzLnBvSTE4blNlcnZpY2VcclxuICAgICAgLmdldExpdGVyYWxzKHsgbGFuZ3VhZ2UsIGNvbnRleHQ6ICdsb2dpbicgfSlcclxuICAgICAgLnN1YnNjcmliZSgobGl0ZXJhbHMpID0+IHtcclxuICAgICAgICB0aGlzLnVwZExpdGVyYWxzKGxpdGVyYWxzKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVByb2R1Y3ROYW1lKCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMubWVzc2FnZVNlcnZpY2UuY2hhbmdlTGFuZ3VhZ2UobGFuZ3VhZ2UpO1xyXG4gIH1cclxuXHJcbiAgdXBkTGl0ZXJhbHMobGl0ZXJhbHM6IGFueSkge1xyXG4gICAgdGhpcy5saXRlcmFscyA9IHtcclxuICAgICAgc3RyMDAwMTogbGl0ZXJhbHMuc3RyMDAwMSxcclxuICAgICAgc3RyMDAwMjogbGl0ZXJhbHMuc3RyMDAwMixcclxuICAgICAgc3RyMDAwMzogbGl0ZXJhbHMuc3RyMDAwMyxcclxuICAgICAgc3RyMDAwNDogbGl0ZXJhbHMuc3RyMDAwNCxcclxuICAgICAgbG9naW5MYWJlbDogbGl0ZXJhbHMuc3RyMDAwNSxcclxuICAgICAgbG9naW5QbGFjZWhvbGRlcjogbGl0ZXJhbHMuc3RyMDAwNixcclxuICAgICAgcGFzc3dvcmRMYWJlbDogbGl0ZXJhbHMuc3RyMDAwNyxcclxuICAgICAgbG9naW5IaW50OiBsaXRlcmFscy5zdHIwMDA4LFxyXG4gICAgICByZW1lbWJlclVzZXJIaW50OiBsaXRlcmFscy5zdHIwMDA5LFxyXG4gICAgICBwYXNzd29yZFBsYWNlaG9sZGVyOiAnJyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBvbkxvZ2luQ2hhbmdlKGxvZ2luOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMubG9naW5WYWx1ZSA9IGxvZ2luO1xyXG4gIH1cclxuXHJcbiAgY2FsbFJlY292ZXJQYXNzd29yZCgpOiB2b2lkIHtcclxuICAgIHRoaXMuYXV0aFNlcnZpY2UucGFzc3dvcmRSZWNvdmVyeSh0aGlzLmxvZ2luVmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlc2NyaXB0aW9uIE3DqXRvZG8gcGFyYSBvYnRlciBvIGxpbmsgZGUgc3Vwb3J0ZVxyXG4gICAqIEByZXR1cm5zIFJldG9ybmEgdW1hIHN0cmluZyBjb250ZW5kbyBvIGxpbmsgZGUgc3Vwb3J0ZSBkbyBFUlBcclxuICAgKi9cclxuICBzdXBwb3J0TGluayhsYW5ndWFnZSA9IHRoaXMucG9JMThuU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCkpIHtcclxuICAgIGxldCBzdXBwb3J0TGluayA9ICdodHRwOi8vc3Vwb3J0ZS50b3R2cy5jb20vJztcclxuXHJcbiAgICBpZiAodGhpcy5icmFuZCA9PSAnTUEzJykge1xyXG4gICAgICBzdXBwb3J0TGluayA9XHJcbiAgICAgICAgbGFuZ3VhZ2UgPT09ICdlbidcclxuICAgICAgICAgID8gJ2h0dHBzOi8vd3d3Lm5hdGlvbmFsLXBsYXRmb3JtLmNvbS8nXHJcbiAgICAgICAgICA6ICdodHRwczovL3d3dy5uYXRpb25hbC1wbGF0Zm9ybS5ydS8nO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKGxhbmd1YWdlID09PSAnZXMnKSB7XHJcbiAgICAgICAgc3VwcG9ydExpbmsgPSAnaHR0cHM6Ly90b3R2c2NzdC56ZW5kZXNrLmNvbS9oYy9lcyNob21lJztcclxuICAgICAgfSBlbHNlIGlmIChsYW5ndWFnZSA9PT0gJ2VuJykge1xyXG4gICAgICAgIHN1cHBvcnRMaW5rID0gJ2h0dHBzOi8vdG90dnNjc3QuemVuZGVzay5jb20vaGMvZW4tdXMjaG9tZSc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gc3VwcG9ydExpbms7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGxvZ2luKHVzZXI6IFByb1VzZXIpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmlzTG9hZGluZykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xyXG5cclxuICAgIHRoaXMuc3Vicy5hZGQodGhpcy5zdWJzY3JpYmVUb0xvZ2luKHVzZXIpKTtcclxuICB9XHJcblxyXG4gIHBhcnNlRXJyb3JNZXNzYWdlKGVycm9yKTogc3RyaW5nIHtcclxuICAgIHN3aXRjaCAoZXJyb3Iuc3RhdHVzKSB7XHJcbiAgICAgIGNhc2UgNDAxOlxyXG4gICAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnN0cjAwMDI7IC8vICdVc3XDoXJpbyBvdSBzZW5oYSBpbnbDoWxpZGEuJ1xyXG4gICAgICBjYXNlIDA6XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubGl0ZXJhbHMuc3RyMDAwMzsgLy8gJ07Do28gZm9pIHBvc3PDrXZlbCBlc3RhYmVsZWNlciBjb25leMOjbyBjb20gbyBzZXJ2aWRvci4nO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIGlmIChlcnJvci5lcnJvciAmJiBlcnJvci5lcnJvci5lcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnN0cjAwMDQgKyAnOiAnICsgZXJyb3IuZXJyb3IuZXJyb3JNZXNzYWdlOyAvLyAnT2NvcnJldSB1bSBwcm9ibGVtYSBuYSB0ZW50YXRpdmEgZGUgTG9naW4nO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5saXRlcmFscy5zdHIwMDA0ICsgJy4nOyAvLyAnT2NvcnJldSB1bSBwcm9ibGVtYSBuYSB0ZW50YXRpdmEgZGUgTG9naW4nO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXNjcmlwdGlvbiBBdHVhbGl6YSBvcyBpZGlvbWFzIGRpc3BvbsOtdmVpc1xyXG4gICAqL1xyXG4gIHVwZGF0ZUxhbmdzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5wcm9MYW5ndWFnZVNlcnZpY2Uuc2V0Q2hhbm5lbEFzSFRUUChlbnZpcm9ubWVudC51c2VIVFRQKTtcclxuICAgIHRoaXMucHJvTGFuZ3VhZ2VTZXJ2aWNlLmdldExpc3RPZkxhbmd1YWdlcygpLnN1YnNjcmliZSh7XHJcbiAgICAgIG5leHQ6IChsYW5nczogUHJvTGFuZ3VhZ2VMaXN0KSA9PiB7XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZXMgPSBsYW5ncztcclxuICAgICAgfSxcclxuICAgICAgZXJyb3I6IChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXNjcmlwdGlvbiBBdHVhbGl6YSBhcyB2YXJpYXZlaXMgYSBwYXJ0aXIgZGEgbWFyY2FcclxuICAgKiBtYTMgbmEgcnVzc2lhIGUgcHJvdGhldXMgbmFzIGRlbWFpc1xyXG4gICAqIEByZXR1cm5zIHZvaWRcclxuICAgKi9cclxuICB1cGRhdGVSZXNvdXJjZUJ5QnJhbmQoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5icmFuZCA9PSAnTUEzJykge1xyXG4gICAgICB0aGlzLmxvZ28gPSAnLi9hc3NldHMvaW1hZ2VzL25hdGlvbmFscGxhdGZvcm0vbmF0aW9uYWxwbGF0Zm9ybS5zdmcnO1xyXG4gICAgICB0aGlzLnByb2R1Y3ROYW1lID0gJ01hLTMgTGluZSc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmxvZ28gPSAnLi9hc3NldHMvaW1hZ2VzL3RvdHZzL3RvdHZzLnN2Zyc7XHJcbiAgICAgIHRoaXMucHJvZHVjdE5hbWUgPSB0aGlzLmxpdGVyYWxzLnN0cjAwMDE7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVzY3JpcHRpb24gYXR1YWxpemEgYSB2YXJpYXZlbCBwcm9kdWN0TmFtZS5cclxuICAgKiBxdWFuZG8gbsOjbyBmb3IgTUEzIHByZWNpc2EgYXR1YWx6aWFyIGNvbSBhIGxpdGVyYWxzIGNhZGEgdmV6IHF1ZSBtdWRhIG8gaWRpb21hXHJcbiAgICogQHJldHVybnMgdm9pZFxyXG4gICAqL1xyXG4gIHVwZGF0ZVByb2R1Y3ROYW1lKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuYnJhbmQgIT0gJ01BMycpIHtcclxuICAgICAgdGhpcy5wcm9kdWN0TmFtZSA9IHRoaXMubGl0ZXJhbHMuc3RyMDAwMTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXNjcmlwdGlvbiBhdHVhbGl6YSBhIHZhcmlhdmVsIGRlIG1hcmNhXHJcbiAgICogQHJldHVybnMgdm9pZFxyXG4gICAqL1xyXG4gIHVwZGF0ZUJyYW5kKCk6IHZvaWQge1xyXG4gICAgdGhpcy5wcm9CcmFuZFNlcnZpY2Uuc2V0Q2hhbm5lbEFzSFRUUChlbnZpcm9ubWVudC51c2VIVFRQKTtcclxuICAgIHRoaXMucHJvQnJhbmRTZXJ2aWNlLmdldEVSUEJyYW5kKCkuc3Vic2NyaWJlKHtcclxuICAgICAgbmV4dDogKGJyYW5kOiBzdHJpbmcpID0+IHtcclxuICAgICAgICB0aGlzLmJyYW5kID0gYnJhbmQ7XHJcbiAgICAgICAgdGhpcy51cGRhdGVSZXNvdXJjZUJ5QnJhbmQoKTtcclxuICAgICAgfSxcclxuICAgICAgZXJyb3I6IChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgdGhpcy5icmFuZCA9ICdUT1RWUyc7XHJcbiAgICAgICAgdGhpcy51cGRhdGVSZXNvdXJjZUJ5QnJhbmQoKTtcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLnN1YnMudW5zdWJzY3JpYmUoKTtcclxuICB9XHJcbn1cclxuIiwiPHBvLXBhZ2UtbG9naW5cclxuICBbcC1oaWRlLXJlbWVtYmVyLXVzZXJdPVwiaGlkZVJlbWVtYmVyVXNlclwiXHJcbiAgKHAtbG9naW4tc3VibWl0KT1cIm9uTG9naW5TdWJtaXQoJGV2ZW50KVwiXHJcbiAgKHAtbG9naW4tY2hhbmdlKT1cIm9uTG9naW5DaGFuZ2UoJGV2ZW50KVwiXHJcbiAgW3AtbGFuZ3VhZ2VzXT1cImxhbmd1YWdlc1wiXHJcbiAgKHAtbGFuZ3VhZ2UtY2hhbmdlKT1cIm9uTGFuZ3VhZ2VDaGFuZ2UoJGV2ZW50KVwiXHJcbiAgW3AtbG9naW5dPVwibG9naW5WYWx1ZVwiXHJcbiAgW3AtbG9hZGluZ109XCJpc0xvYWRpbmdcIlxyXG4gIFtwLWxpdGVyYWxzXT1cImxpdGVyYWxzXCJcclxuICBbcC1wcm9kdWN0LW5hbWVdPVwicHJvZHVjdE5hbWVcIlxyXG4gIFtwLXJlY292ZXJ5XT1cInRoaXMuY2FsbFJlY292ZXJQYXNzd29yZC5iaW5kKHRoaXMpXCJcclxuICBbcC1zdXBwb3J0XT1cInN1cHBvcnRMaW5rKClcIlxyXG4gIFtwLWxvZ29dPVwibG9nb1wiXHJcbiAgW3Atc2Vjb25kYXJ5LWxvZ29dPVwibG9nb1wiPlxyXG4gIDwhLS0gTGluaGEgUHJvdGhldXMgLS0+XHJcbjwvcG8tcGFnZS1sb2dpbj5cclxuIl19