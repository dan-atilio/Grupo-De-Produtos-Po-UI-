import { HttpHeaders, HttpParams } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { catchError, Observable, of, switchMap } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@po-ui/ng-components";
export class ProUserProfileService {
    constructor(http, poI18nService) {
        this.http = http;
        this.poI18nService = poI18nService;
        this.URL_PROFILE = "/api/framework/v1/profileService/";
        this.programName = "";
        this.task = "";
        this.type = "";
        this.isReady = false;
        const language = this.poI18nService.getShortLanguage();
        poI18nService.getLiterals({ language, context: 'general' })
            .subscribe(literals => {
            this.literals = literals;
        });
    }
    /**
     * Metodo para definir o profile a ser utilizado
     * antes de utilizar qualquer metodo de CRUD é necessário definir o profile por esse metodo.
     * @param programName Nome do programa a ser usado no profile
     * @param task Nome da tarefa a ser utilizado no profile
     * @param type Tipo a ser utilizado no profile
     */
    setProfile(programName, task, type) {
        this.programName = programName;
        this.task = task;
        this.type = type;
        this.isReady = true;
    }
    /**
     * Cria um novo registro no profile
     * (profile a ser gravado definido pelo metodo setProfile)
     * @param value Valor a ser gravado no profile
     * @returns Observable com o retorno da api
     */
    create(value) {
        const profileBody = this.getRequisitionBody(value);
        if (this.isReady) {
            return this.http.post(this.URL_PROFILE, profileBody);
        }
        else {
            return this.profileNotReady();
        }
    }
    /**
     * Busca o valor de uma chave salva no profile
     * (profile a ser gravado definido pelo metodo setProfile)
     * @param defaultValue Valor padrão a ser retornado caso não exista o profile na base
     * @param respType tipo a ser retornado, podendo ser apenas json ou text
     * @returns Observable com o retorno da api
     */
    read(defaultValue = "", respType = "json") {
        if (this.isReady) {
            let acceptHeader = "application/json";
            if (respType != "json") {
                respType = "text";
                acceptHeader = "text/plain";
            }
            const params = new HttpParams().set('defaultValue', defaultValue);
            const headers = new HttpHeaders().set('Accept', acceptHeader);
            return this.http.get(this.getUrlApi(), { responseType: respType, params, headers });
        }
        else {
            return this.profileNotReady();
        }
    }
    /**
     * Atualiza um registro no profile
     * (profile a ser gravado definido pelo metodo setProfile)
     * @param value Valor a ser gravado no profile
     * @returns Observable com o retorno da api
     */
    update(value) {
        const profileBody = this.getRequisitionBody(value);
        if (this.isReady) {
            return this.http.put(this.getUrlApi(), profileBody);
        }
        else {
            return this.profileNotReady();
        }
    }
    /**
     * Deleta um registro no profile
     * @returns Observable com o retorno da api
     */
    delete() {
        if (this.isReady) {
            return this.http.delete(this.getUrlApi());
        }
        else {
            return this.profileNotReady();
        }
    }
    /**
     * Deleta e cria um registro no profile
     * esse metodo pode substituir o uso do metodo create e update em alguns casos
     * (profile a ser gravado definido pelo metodo setProfile)
     * @param value Valor a ser gravado no profile
     * @returns Observable com o retorno da api
     */
    deleteThenCreate(value) {
        if (this.isReady) {
            return this.http.delete(this.getUrlApi()).pipe(catchError(() => {
                // erro no delete deve ser pelo fato do profile não existir ainda
                // retorna o post do profile
                return of(this.http.post(this.URL_PROFILE, this.getRequisitionBody(value)));
            }), switchMap(() => this.http.post(this.URL_PROFILE, this.getRequisitionBody(value))));
        }
        else {
            return this.profileNotReady();
        }
    }
    /**
     * Observable para apresentar um erro para o usuário caso utilize algum metodo de CRUD
     * sem utilizar o setProfile antes
     * @returns Observable com erro
     */
    profileNotReady() {
        return new Observable(subscriber => {
            subscriber.error({
                status: 400,
                message: this.literals.str0001 // 'Para utilizar esse serviço é preciso definir o profile a ser utilizado pelo método setProfile'
            });
            subscriber.complete();
        });
    }
    /**
     * retorna a composição da url da api, com os path param necessários
     * @returns url completa da api
     */
    getUrlApi() {
        return `${this.URL_PROFILE}${this.programName}/${this.task}/${this.type}`;
    }
    /**
     * body para ser utilizado no post e update da api de profile
     * @param value Valor a ser gravado no profile
     * @returns o body a ser utilizado
     */
    getRequisitionBody(value) {
        const profileBody = {
            programName: this.programName,
            task: this.task,
            type: this.type,
            value: value
        };
        return profileBody;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.9", ngImport: i0, type: ProUserProfileService, deps: [{ token: i1.HttpClient }, { token: i2.PoI18nService }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.9", ngImport: i0, type: ProUserProfileService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.9", ngImport: i0, type: ProUserProfileService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: () => [{ type: i1.HttpClient }, { type: i2.PoI18nService }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvLXVzZXItcHJvZmlsZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcHJvdGhldXMtbGliLWNvcmUvc3JjL3NlcnZpY2VzL3Byby11c2VyLXByb2ZpbGUvcHJvLXVzZXItcHJvZmlsZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBYyxXQUFXLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDM0UsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7O0FBTzdELE1BQU0sT0FBTyxxQkFBcUI7SUFRaEMsWUFDVSxJQUFnQixFQUNoQixhQUE0QjtRQUQ1QixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBVHJCLGdCQUFXLEdBQVcsbUNBQW1DLENBQUM7UUFDM0UsZ0JBQVcsR0FBVyxFQUFFLENBQUM7UUFDekIsU0FBSSxHQUFXLEVBQUUsQ0FBQztRQUNsQixTQUFJLEdBQVcsRUFBRSxDQUFDO1FBQ2xCLFlBQU8sR0FBWSxLQUFLLENBQUM7UUFPdkIsTUFBTSxRQUFRLEdBQVcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQy9ELGFBQWEsQ0FBQyxXQUFXLENBQUMsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxDQUFDO2FBQ3hELFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNwQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSSxVQUFVLENBQUMsV0FBbUIsRUFBRSxJQUFZLEVBQUUsSUFBWTtRQUMvRCxJQUFJLENB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QUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUNsRixDQUFDO1NBQ0g7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQy9CO0lBQ0gsQ0FBQztJQUVEOzs7O09BSUc7SUFDSyxlQUFlO1FBQ3JCLE9BQU8sSUFBSSxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUU7WUFDakMsVUFBVSxDQUFDLEtBQUssQ0FBQztnQkFDZixNQUFNLEVBQUUsR0FBRztnQkFDWCxPQUFPLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsa0dBQWtHO2FBQ2xJLENBQUMsQ0FBQztZQUNILFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7O09BR0c7SUFDSCxTQUFTO1FBQ1AsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM1RSxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGtCQUFrQixDQUFDLEtBQWE7UUFDOUIsTUFBTSxXQUFXLEdBQW1DO1lBQ2xELFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVztZQUM3QixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixLQUFLLEVBQUUsS0FBSztTQUNiLENBQUM7UUFDRixPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDOzhHQTNKVSxxQkFBcUI7a0hBQXJCLHFCQUFxQixjQUZwQixNQUFNOzsyRkFFUCxxQkFBcUI7a0JBSGpDLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMsIEh0dHBQYXJhbXMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUG9JMThuU2VydmljZSB9IGZyb20gJ0Bwby11aS9uZy1jb21wb25lbnRzJztcclxuaW1wb3J0IHsgY2F0Y2hFcnJvciwgT2JzZXJ2YWJsZSwgb2YsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgUHJvVXNlclByb2ZpbGVSZXF1ZXN0SW50ZXJmYWNlIH0gZnJvbSAnLi9tb2RlbHMvcHJvLXVzZXItcHJvZmlsZS1yZXF1ZXN0LmludGVyZmFjZSc7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQcm9Vc2VyUHJvZmlsZVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgVVJMX1BST0ZJTEU6IHN0cmluZyA9IFwiL2FwaS9mcmFtZXdvcmsvdjEvcHJvZmlsZVNlcnZpY2UvXCI7XHJcbiAgcHJvZ3JhbU5hbWU6IHN0cmluZyA9IFwiXCI7XHJcbiAgdGFzazogc3RyaW5nID0gXCJcIjtcclxuICB0eXBlOiBzdHJpbmcgPSBcIlwiO1xyXG4gIGlzUmVhZHk6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBsaXRlcmFsczogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcclxuICAgIHByaXZhdGUgcG9JMThuU2VydmljZTogUG9JMThuU2VydmljZSxcclxuICApIHtcclxuICAgIGNvbnN0IGxhbmd1YWdlOiBzdHJpbmcgPSB0aGlzLnBvSTE4blNlcnZpY2UuZ2V0U2hvcnRMYW5ndWFnZSgpO1xyXG4gICAgcG9JMThuU2VydmljZS5nZXRMaXRlcmFscyh7IGxhbmd1YWdlLCBjb250ZXh0OiAnZ2VuZXJhbCcgfSlcclxuICAgICAgLnN1YnNjcmliZShsaXRlcmFscyA9PiB7XHJcbiAgICAgICAgdGhpcy5saXRlcmFscyA9IGxpdGVyYWxzO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1ldG9kbyBwYXJhIGRlZmluaXIgbyBwcm9maWxlIGEgc2VyIHV0aWxpemFkb1xyXG4gICAqIGFudGVzIGRlIHV0aWxpemFyIHF1YWxxdWVyIG1ldG9kbyBkZSBDUlVEIMOpIG5lY2Vzc8OhcmlvIGRlZmluaXIgbyBwcm9maWxlIHBvciBlc3NlIG1ldG9kby5cclxuICAgKiBAcGFyYW0gcHJvZ3JhbU5hbWUgTm9tZSBkbyBwcm9ncmFtYSBhIHNlciB1c2FkbyBubyBwcm9maWxlXHJcbiAgICogQHBhcmFtIHRhc2sgTm9tZSBkYSB0YXJlZmEgYSBzZXIgdXRpbGl6YWRvIG5vIHByb2ZpbGVcclxuICAgKiBAcGFyYW0gdHlwZSBUaXBvIGEgc2VyIHV0aWxpemFkbyBubyBwcm9maWxlXHJcbiAgICovXHJcbiAgcHVibGljIHNldFByb2ZpbGUocHJvZ3JhbU5hbWU6IHN0cmluZywgdGFzazogc3RyaW5nLCB0eXBlOiBzdHJpbmcpIHtcclxuICAgIHRoaXMucHJvZ3JhbU5hbWUgPSBwcm9ncmFtTmFtZTtcclxuICAgIHRoaXMudGFzayA9IHRhc2s7XHJcbiAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgdGhpcy5pc1JlYWR5ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyaWEgdW0gbm92byByZWdpc3RybyBubyBwcm9maWxlXHJcbiAgICogKHByb2ZpbGUgYSBzZXIgZ3JhdmFkbyBkZWZpbmlkbyBwZWxvIG1ldG9kbyBzZXRQcm9maWxlKVxyXG4gICAqIEBwYXJhbSB2YWx1ZSBWYWxvciBhIHNlciBncmF2YWRvIG5vIHByb2ZpbGVcclxuICAgKiBAcmV0dXJucyBPYnNlcnZhYmxlIGNvbSBvIHJldG9ybm8gZGEgYXBpXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZSh2YWx1ZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHByb2ZpbGVCb2R5OiBQcm9Vc2VyUHJvZmlsZVJlcXVlc3RJbnRlcmZhY2UgPSB0aGlzLmdldFJlcXVpc2l0aW9uQm9keSh2YWx1ZSk7XHJcbiAgICBpZiAodGhpcy5pc1JlYWR5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmh0dHAucG9zdCh0aGlzLlVSTF9QUk9GSUxFLCBwcm9maWxlQm9keSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5wcm9maWxlTm90UmVhZHkoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJ1c2NhIG8gdmFsb3IgZGUgdW1hIGNoYXZlIHNhbHZhIG5vIHByb2ZpbGVcclxuICAgKiAocHJvZmlsZSBhIHNlciBncmF2YWRvIGRlZmluaWRvIHBlbG8gbWV0b2RvIHNldFByb2ZpbGUpXHJcbiAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZSBWYWxvciBwYWRyw6NvIGEgc2VyIHJldG9ybmFkbyBjYXNvIG7Do28gZXhpc3RhIG8gcHJvZmlsZSBuYSBiYXNlXHJcbiAgICogQHBhcmFtIHJlc3BUeXBlIHRpcG8gYSBzZXIgcmV0b3JuYWRvLCBwb2RlbmRvIHNlciBhcGVuYXMganNvbiBvdSB0ZXh0XHJcbiAgICogQHJldHVybnMgT2JzZXJ2YWJsZSBjb20gbyByZXRvcm5vIGRhIGFwaVxyXG4gICAqL1xyXG4gIHB1YmxpYyByZWFkKGRlZmF1bHRWYWx1ZTogc3RyaW5nID0gXCJcIiwgcmVzcFR5cGU6IGFueSA9IFwianNvblwiKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGlmICh0aGlzLmlzUmVhZHkpIHtcclxuICAgICAgbGV0IGFjY2VwdEhlYWRlcjogc3RyaW5nID0gXCJhcHBsaWNhdGlvbi9qc29uXCI7XHJcbiAgICAgIGlmIChyZXNwVHlwZSAhPSBcImpzb25cIikge1xyXG4gICAgICAgIHJlc3BUeXBlID0gXCJ0ZXh0XCI7XHJcbiAgICAgICAgYWNjZXB0SGVhZGVyID0gXCJ0ZXh0L3BsYWluXCI7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKS5zZXQoJ2RlZmF1bHRWYWx1ZScsIGRlZmF1bHRWYWx1ZSk7XHJcbiAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoKS5zZXQoJ0FjY2VwdCcsIGFjY2VwdEhlYWRlcik7XHJcbiAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHRoaXMuZ2V0VXJsQXBpKCksIHsgcmVzcG9uc2VUeXBlOiByZXNwVHlwZSwgcGFyYW1zLCBoZWFkZXJzIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMucHJvZmlsZU5vdFJlYWR5KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBdHVhbGl6YSB1bSByZWdpc3RybyBubyBwcm9maWxlXHJcbiAgICogKHByb2ZpbGUgYSBzZXIgZ3JhdmFkbyBkZWZpbmlkbyBwZWxvIG1ldG9kbyBzZXRQcm9maWxlKVxyXG4gICAqIEBwYXJhbSB2YWx1ZSBWYWxvciBhIHNlciBncmF2YWRvIG5vIHByb2ZpbGVcclxuICAgKiBAcmV0dXJucyBPYnNlcnZhYmxlIGNvbSBvIHJldG9ybm8gZGEgYXBpXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZSh2YWx1ZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHByb2ZpbGVCb2R5OiBQcm9Vc2VyUHJvZmlsZVJlcXVlc3RJbnRlcmZhY2UgPSB0aGlzLmdldFJlcXVpc2l0aW9uQm9keSh2YWx1ZSk7XHJcbiAgICBpZiAodGhpcy5pc1JlYWR5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmh0dHAucHV0KHRoaXMuZ2V0VXJsQXBpKCksIHByb2ZpbGVCb2R5KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnByb2ZpbGVOb3RSZWFkeSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVsZXRhIHVtIHJlZ2lzdHJvIG5vIHByb2ZpbGVcclxuICAgKiBAcmV0dXJucyBPYnNlcnZhYmxlIGNvbSBvIHJldG9ybm8gZGEgYXBpXHJcbiAgICovXHJcbiAgcHVibGljIGRlbGV0ZSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgaWYgKHRoaXMuaXNSZWFkeSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5odHRwLmRlbGV0ZSh0aGlzLmdldFVybEFwaSgpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnByb2ZpbGVOb3RSZWFkeSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVsZXRhIGUgY3JpYSB1bSByZWdpc3RybyBubyBwcm9maWxlXHJcbiAgICogZXNzZSBtZXRvZG8gcG9kZSBzdWJzdGl0dWlyIG8gdXNvIGRvIG1ldG9kbyBjcmVhdGUgZSB1cGRhdGUgZW0gYWxndW5zIGNhc29zXHJcbiAgICogKHByb2ZpbGUgYSBzZXIgZ3JhdmFkbyBkZWZpbmlkbyBwZWxvIG1ldG9kbyBzZXRQcm9maWxlKVxyXG4gICAqIEBwYXJhbSB2YWx1ZSBWYWxvciBhIHNlciBncmF2YWRvIG5vIHByb2ZpbGVcclxuICAgKiBAcmV0dXJucyBPYnNlcnZhYmxlIGNvbSBvIHJldG9ybm8gZGEgYXBpXHJcbiAgICovXHJcbiAgcHVibGljIGRlbGV0ZVRoZW5DcmVhdGUodmFsdWU6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBpZiAodGhpcy5pc1JlYWR5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmh0dHAuZGVsZXRlKHRoaXMuZ2V0VXJsQXBpKCkpLnBpcGUoXHJcbiAgICAgICAgY2F0Y2hFcnJvcigoKSA9PiB7XHJcbiAgICAgICAgICAvLyBlcnJvIG5vIGRlbGV0ZSBkZXZlIHNlciBwZWxvIGZhdG8gZG8gcHJvZmlsZSBuw6NvIGV4aXN0aXIgYWluZGFcclxuICAgICAgICAgIC8vIHJldG9ybmEgbyBwb3N0IGRvIHByb2ZpbGVcclxuICAgICAgICAgIHJldHVybiBvZih0aGlzLmh0dHAucG9zdCh0aGlzLlVSTF9QUk9GSUxFLCB0aGlzLmdldFJlcXVpc2l0aW9uQm9keSh2YWx1ZSkpKTtcclxuICAgICAgICB9KSxcclxuICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5odHRwLnBvc3QodGhpcy5VUkxfUFJPRklMRSwgdGhpcy5nZXRSZXF1aXNpdGlvbkJvZHkodmFsdWUpKSlcclxuICAgICAgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnByb2ZpbGVOb3RSZWFkeSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogT2JzZXJ2YWJsZSBwYXJhIGFwcmVzZW50YXIgdW0gZXJybyBwYXJhIG8gdXN1w6FyaW8gY2FzbyB1dGlsaXplIGFsZ3VtIG1ldG9kbyBkZSBDUlVEXHJcbiAgICogc2VtIHV0aWxpemFyIG8gc2V0UHJvZmlsZSBhbnRlc1xyXG4gICAqIEByZXR1cm5zIE9ic2VydmFibGUgY29tIGVycm9cclxuICAgKi9cclxuICBwcml2YXRlIHByb2ZpbGVOb3RSZWFkeTxUPigpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShzdWJzY3JpYmVyID0+IHtcclxuICAgICAgc3Vic2NyaWJlci5lcnJvcih7XHJcbiAgICAgICAgc3RhdHVzOiA0MDAsXHJcbiAgICAgICAgbWVzc2FnZTogdGhpcy5saXRlcmFscy5zdHIwMDAxIC8vICdQYXJhIHV0aWxpemFyIGVzc2Ugc2VydmnDp28gw6kgcHJlY2lzbyBkZWZpbmlyIG8gcHJvZmlsZSBhIHNlciB1dGlsaXphZG8gcGVsbyBtw6l0b2RvIHNldFByb2ZpbGUnXHJcbiAgICAgIH0pO1xyXG4gICAgICBzdWJzY3JpYmVyLmNvbXBsZXRlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHJldG9ybmEgYSBjb21wb3Npw6fDo28gZGEgdXJsIGRhIGFwaSwgY29tIG9zIHBhdGggcGFyYW0gbmVjZXNzw6FyaW9zXHJcbiAgICogQHJldHVybnMgdXJsIGNvbXBsZXRhIGRhIGFwaVxyXG4gICAqL1xyXG4gIGdldFVybEFwaSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGAke3RoaXMuVVJMX1BST0ZJTEV9JHt0aGlzLnByb2dyYW1OYW1lfS8ke3RoaXMudGFza30vJHt0aGlzLnR5cGV9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGJvZHkgcGFyYSBzZXIgdXRpbGl6YWRvIG5vIHBvc3QgZSB1cGRhdGUgZGEgYXBpIGRlIHByb2ZpbGVcclxuICAgKiBAcGFyYW0gdmFsdWUgVmFsb3IgYSBzZXIgZ3JhdmFkbyBubyBwcm9maWxlXHJcbiAgICogQHJldHVybnMgbyBib2R5IGEgc2VyIHV0aWxpemFkb1xyXG4gICAqL1xyXG4gIGdldFJlcXVpc2l0aW9uQm9keSh2YWx1ZTogc3RyaW5nKTogUHJvVXNlclByb2ZpbGVSZXF1ZXN0SW50ZXJmYWNlIHtcclxuICAgIGNvbnN0IHByb2ZpbGVCb2R5OiBQcm9Vc2VyUHJvZmlsZVJlcXVlc3RJbnRlcmZhY2UgPSB7XHJcbiAgICAgIHByb2dyYW1OYW1lOiB0aGlzLnByb2dyYW1OYW1lLFxyXG4gICAgICB0YXNrOiB0aGlzLnRhc2ssXHJcbiAgICAgIHR5cGU6IHRoaXMudHlwZSxcclxuICAgICAgdmFsdWU6IHZhbHVlXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHByb2ZpbGVCb2R5O1xyXG4gIH1cclxufVxyXG4iXX0=