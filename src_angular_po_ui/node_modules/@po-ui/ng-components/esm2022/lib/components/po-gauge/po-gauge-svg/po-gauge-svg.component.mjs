import { Component, Input } from '@angular/core';
import { PoGaugePointerEnd, PoGaugeThickness, poGaugeTotalValueDefault } from '../po-gauge-default-values.constant';
import { PoDefaultColors } from '../../../services/po-color/po-colors.constant';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./po-gauge-path/po-gauge-path.component";
import * as i3 from "./po-gauge-pointer/po-gauge-pointer.component";
function PoGaugeSvgComponent__svg_svg_0__svg_g_2_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelement(0, "g", 4);
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext(2);
    i0.ɵɵproperty("p-coordinates", ctx_r1.pointerCoordinates);
} }
function PoGaugeSvgComponent__svg_svg_0_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "svg", 1);
    i0.ɵɵelement(1, "g", 2);
    i0.ɵɵtemplate(2, PoGaugeSvgComponent__svg_svg_0__svg_g_2_Template, 1, 1, "g", 3);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵattribute("viewBox", ctx_r0.viewBox)("height", ctx_r0.container == null ? null : ctx_r0.container.height);
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-base-coordinates", ctx_r0.baseCoordinates)("p-ranges-coordinates", ctx_r0.coordinates);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngIf", ctx_r0.hasRanges);
} }
export const poGaugeStartAngle = -Math.PI;
export class PoGaugeSvgComponent {
    container;
    ranges;
    value;
    addSvgElement = false;
    baseCoordinates;
    coordinates;
    pointerCoordinates;
    viewBox;
    get hasRanges() {
        return this.ranges.length > 0;
    }
    ngOnChanges(changes) {
        if ((this.container && changes.value) || (this.container && changes.ranges) || this.container) {
            this.setCoordinates(this.value, this.ranges, this.container);
        }
    }
    setCoordinates(value, ranges, container) {
        const { height } = container;
        // Adiciona elemento svg somente após calcular a altura do container pois o svg tem altura default de 150px.
        this.addSvgElement = true;
        this.setViewBox(height);
        this.setBaseCoordinates(height);
        if (!ranges.length) {
            this.setSingleRangeCoordinates(height, value);
            return;
        }
        this.setRangesCoordinates(height, value, ranges);
    }
    setBaseCoordinates(height) {
        const endAngleRadian = 0;
        const coordinates = this.calculateCoordinates(height, poGaugeStartAngle, endAngleRadian);
        this.baseCoordinates = { coordinates };
    }
    setRangesCoordinates(height, value = 0, ranges) {
        const { minRange, maxRange } = this.calculateMinAndMaxValues(ranges);
        const minValue = value < minRange ? value : minRange;
        const maxValue = value > maxRange ? value : maxRange;
        this.setPointerCoordinates(height, value, maxValue, minValue);
        // `.reverse()` no término da iteração para tratar a sobreposicão correta das bordas arredondadas dos ranges.
        const rangesCoordinates = ranges
            .map((range) => {
            const from = range.from ?? 0;
            const to = range.to ?? maxRange;
            const startAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(from, maxValue, minValue);
            const endAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(to, maxValue, minValue);
            const coordinates = this.calculateCoordinates(height, startAngleRadian, endAngleRadian);
            return { coordinates, color: range.color };
        })
            .reverse();
        this.coordinates = rangesCoordinates;
    }
    setSingleRangeCoordinates(height, value) {
        const verifiedValue = value > 100 ? 100 : value;
        const endAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(verifiedValue, poGaugeTotalValueDefault);
        const coordinates = value > 0 ? this.calculateCoordinates(height, poGaugeStartAngle, endAngleRadian) : undefined;
        const color = PoDefaultColors[0][0];
        this.coordinates = [{ coordinates, color }];
    }
    setPointerCoordinates(height, value, maxValue, minValue) {
        const coordinates = this.calculatePointerInitialCoordinates(height, poGaugeStartAngle);
        const pointerDegrees = this.pointerRotation(value, maxValue, minValue);
        this.pointerCoordinates = { ...coordinates, pointerDegrees };
    }
    pointerRotation(value, maxValue, minValue) {
        const percent = this.convertValueToPercentage(value, maxValue, minValue);
        // valores referentes às angulações mínimas e máximas do ponteiro.
        const minRotation = 0;
        const maxRotation = 180;
        return (percent * (maxRotation - minRotation)) / 100 + minRotation;
    }
    calculatePointerInitialCoordinates(height, startAngleRadian) {
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        // Valor que representa a escala do ponteiro para plotagem.
        const scale = 40;
        const pointerScaledWidth = radius / scale;
        const pointerScaledBorderRadius = radius / (scale * 2);
        const sinAlpha = Math.sin(startAngleRadian);
        const cosAlpha = Math.cos(startAngleRadian);
        const targetX = radius + cosAlpha * radius;
        const targetY = radius + sinAlpha * radius;
        const startX = radius;
        const startY = radius + pointerScaledWidth;
        const endX = radius;
        const endY = radius - pointerScaledWidth;
        const coordinates = [
            'M',
            startX,
            startY,
            'L',
            targetX,
            targetY + pointerScaledBorderRadius,
            'A',
            1,
            1,
            0,
            '0,1',
            targetX,
            targetY - pointerScaledBorderRadius,
            'L',
            endX,
            endY,
            'Z'
        ].join(' ');
        return { coordinates, radius };
    }
    calculateCoordinates(height, startAngleRadian, endAngleRadian) {
        // Subtrai altura pelo excedente ponteiro em relação ao gráfico, pela metade do valor da coroa circular.
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        const innerRadius = radius - PoGaugeThickness;
        const sinAlpha = Math.sin(startAngleRadian);
        const cosAlpha = Math.cos(startAngleRadian);
        const sinBeta = Math.sin(endAngleRadian);
        const cosBeta = Math.cos(endAngleRadian);
        const startX = Math.round(radius + cosAlpha * radius);
        const startY = Math.round(radius + sinAlpha * radius);
        const endX = Math.round(radius + cosBeta * radius);
        const endY = Math.round(radius + sinBeta * radius);
        const startInnerX = Math.round(radius + cosAlpha * innerRadius);
        const startInnerY = Math.round(radius + sinAlpha * innerRadius);
        const endInnerX = Math.round(radius + cosBeta * innerRadius);
        const endInnerY = Math.round(radius + sinBeta * innerRadius);
        return [
            'M',
            startX,
            startY,
            'A',
            radius,
            radius,
            0,
            '0,1',
            endX,
            endY,
            'A',
            1,
            1,
            0,
            '0,1',
            endInnerX,
            endInnerY,
            'A',
            innerRadius,
            innerRadius,
            0,
            '0,0',
            startInnerX,
            startInnerY,
            'A',
            1,
            1,
            0,
            '0,1',
            startX,
            startY,
            'Z'
        ].join(' ');
    }
    calculateAngleRadius(value, maxValue, minValue = 0) {
        const angle = ((value - minValue) / (maxValue - minValue)) * (Math.PI * 2);
        return angle / 2;
    }
    convertValueToPercentage(value, maxValue, minValue) {
        return ((value - minValue) / (maxValue - minValue)) * 100;
    }
    setViewBox(height) {
        const width = this.calculateDiameter(height);
        this.viewBox = `0 ${-PoGaugePointerEnd} ${width} ${height}`;
    }
    calculateDiameter(height) {
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        return radius + Math.cos(0) * radius;
    }
    calculateMinAndMaxValues(ranges) {
        const minRange = this.getDomain(ranges, 'min');
        const maxRange = this.getDomain(ranges, 'max');
        return {
            minRange: this.verifyIfFloatOrInteger(minRange) ? minRange : 0,
            maxRange: this.verifyIfFloatOrInteger(maxRange) ? maxRange : 100
        };
    }
    verifyIfFloatOrInteger(number) {
        const notABoolean = typeof number !== 'boolean';
        const notInfinity = number !== Infinity;
        const isInteger = Number(number) === number && number % 1 === 0 && notInfinity;
        const isFloat = Number(number) === number && number % 1 !== 0 && notInfinity;
        return (notABoolean && isInteger) || (notABoolean && isFloat);
    }
    getDomain(ranges, type) {
        const rangeType = { min: 'from', max: 'to' };
        return Math[type](...ranges.map(range => range[rangeType[type]]));
    }
    static ɵfac = function PoGaugeSvgComponent_Factory(t) { return new (t || PoGaugeSvgComponent)(); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoGaugeSvgComponent, selectors: [["po-gauge-svg"]], inputs: { container: [i0.ɵɵInputFlags.None, "p-container", "container"], ranges: [i0.ɵɵInputFlags.None, "p-ranges", "ranges"], value: [i0.ɵɵInputFlags.None, "p-value", "value"] }, features: [i0.ɵɵNgOnChangesFeature], decls: 1, vars: 1, consts: [["class", "po-gauge-svg", "preserveAspectRatio", "xMidYMax meet", "width", "100%", 4, "ngIf"], ["preserveAspectRatio", "xMidYMax meet", "width", "100%", 1, "po-gauge-svg"], ["po-gauge-path", "", 3, "p-base-coordinates", "p-ranges-coordinates"], ["po-gauge-pointer", "", 3, "p-coordinates", 4, "ngIf"], ["po-gauge-pointer", "", 3, "p-coordinates"]], template: function PoGaugeSvgComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵtemplate(0, PoGaugeSvgComponent__svg_svg_0_Template, 3, 5, "svg", 0);
        } if (rf & 2) {
            i0.ɵɵproperty("ngIf", ctx.addSvgElement);
        } }, dependencies: [i1.NgIf, i2.PoGaugePathComponent, i3.PoGaugePointerComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoGaugeSvgComponent, [{
        type: Component,
        args: [{ selector: 'po-gauge-svg', template: "<svg:svg\n  *ngIf=\"addSvgElement\"\n  class=\"po-gauge-svg\"\n  preserveAspectRatio=\"xMidYMax meet\"\n  width=\"100%\"\n  [attr.viewBox]=\"viewBox\"\n  [attr.height]=\"container?.height\"\n>\n  <!-- GAUGE PATHS -->\n  <svg:g po-gauge-path [p-base-coordinates]=\"baseCoordinates\" [p-ranges-coordinates]=\"coordinates\"></svg:g>\n\n  <!-- GAUGE POINTER -->\n  <svg:g *ngIf=\"hasRanges\" po-gauge-pointer [p-coordinates]=\"pointerCoordinates\"></svg:g>\n</svg:svg>\n" }]
    }], null, { container: [{
            type: Input,
            args: ['p-container']
        }], ranges: [{
            type: Input,
            args: ['p-ranges']
        }], value: [{
            type: Input,
            args: ['p-value']
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoGaugeSvgComponent, { className: "PoGaugeSvgComponent", filePath: "lib/components/po-gauge/po-gauge-svg/po-gauge-svg.component.ts", lineNumber: 17 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZ2F1Z2Utc3ZnLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1nYXVnZS9wby1nYXVnZS1zdmcvcG8tZ2F1Z2Utc3ZnLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1nYXVnZS9wby1nYXVnZS1zdmcvcG8tZ2F1Z2Utc3ZnLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUE0QixNQUFNLGVBQWUsQ0FBQztBQUUzRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUVwSCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sK0NBQStDLENBQUM7Ozs7Ozs7SUNROUUsdUJBQXVGOzs7SUFBN0MseURBQW9DOzs7SUFaaEYsbUJBT0M7SUFQRCw4QkFPQztJQUVDLHVCQUF5RztJQUd6RyxnRkFBdUY7SUFDekYsaUJBQVU7OztJQVJSLHlDQUF3QixxRUFBQTtJQUlILGNBQXNDO0lBQXRDLDJEQUFzQyw0Q0FBQTtJQUduRCxjQUFlO0lBQWYsdUNBQWU7O0FERnpCLE1BQU0sQ0FBQyxNQUFNLGlCQUFpQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztBQU0xQyxNQUFNLE9BQU8sbUJBQW1CO0lBQ1IsU0FBUyxDQUFzQjtJQUVsQyxNQUFNLENBQXVCO0lBRTlCLEtBQUssQ0FBUztJQUVoQyxhQUFhLEdBQVksS0FBSyxDQUFDO0lBQy9CLGVBQWUsQ0FBcUI7SUFDcEMsV0FBVyxDQUE0QjtJQUN2QyxrQkFBa0IsQ0FBcUI7SUFDdkMsT0FBTyxDQUFTO0lBRWhCLElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLE1B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RyxNQUFNLEtBQUssUUFBUSxDQUFDO1FBRXhDLE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxNQUFNLElBQUksTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksV0FBVyxDQUFDO1FBQy9FLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxNQUFNLElBQUksTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksV0FBVyxDQUFDO1FBRTdFLE9BQU8sQ0FBQyxXQUFXLElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksT0FBTyxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVPLFNBQVMsQ0FBQyxNQUE0QixFQUFFLElBQVk7UUFDMUQsTUFBTSxTQUFTLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUU3QyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7NkVBeFBVLG1CQUFtQjs2REFBbkIsbUJBQW1CO1lDaEJoQyx5RUFhVTs7WUFaUCx3Q0FBbUI7OztpRkRlVCxtQkFBbUI7Y0FKL0IsU0FBUzsyQkFDRSxjQUFjO2dCQUlGLFNBQVM7a0JBQTlCLEtBQUs7bUJBQUMsYUFBYTtZQUVELE1BQU07a0JBQXhCLEtBQUs7bUJBQUMsVUFBVTtZQUVDLEtBQUs7a0JBQXRCLEtBQUs7bUJBQUMsU0FBUzs7a0ZBTEwsbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFBvR2F1Z2VQb2ludGVyRW5kLCBQb0dhdWdlVGhpY2tuZXNzLCBwb0dhdWdlVG90YWxWYWx1ZURlZmF1bHQgfSBmcm9tICcuLi9wby1nYXVnZS1kZWZhdWx0LXZhbHVlcy5jb25zdGFudCc7XG5cbmltcG9ydCB7IFBvRGVmYXVsdENvbG9ycyB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLWNvbG9yL3BvLWNvbG9ycy5jb25zdGFudCc7XG5cbmltcG9ydCB7IFBvR2F1Z2VDb29yZGluYXRlcyB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tZ2F1Z2UtY29vcmRpbmF0ZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvR2F1Z2VSYW5nZXMgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3BvLWdhdWdlLXJhbmdlcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9HYXVnZVN2Z0NvbnRhaW5lciB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tZ2F1Z2Utc3ZnLWNvbnRhaW5lci5pbnRlcmZhY2UnO1xuXG5leHBvcnQgY29uc3QgcG9HYXVnZVN0YXJ0QW5nbGUgPSAtTWF0aC5QSTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tZ2F1Z2Utc3ZnJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWdhdWdlLXN2Zy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9HYXVnZVN2Z0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgncC1jb250YWluZXInKSBjb250YWluZXI6IFBvR2F1Z2VTdmdDb250YWluZXI7XG5cbiAgQElucHV0KCdwLXJhbmdlcycpIHJhbmdlczogQXJyYXk8UG9HYXVnZVJhbmdlcz47XG5cbiAgQElucHV0KCdwLXZhbHVlJykgdmFsdWU6IG51bWJlcjtcblxuICBhZGRTdmdFbGVtZW50OiBib29sZWFuID0gZmFsc2U7XG4gIGJhc2VDb29yZGluYXRlczogUG9HYXVnZUNvb3JkaW5hdGVzO1xuICBjb29yZGluYXRlczogQXJyYXk8UG9HYXVnZUNvb3JkaW5hdGVzPjtcbiAgcG9pbnRlckNvb3JkaW5hdGVzOiBQb0dhdWdlQ29vcmRpbmF0ZXM7XG4gIHZpZXdCb3g6IHN0cmluZztcblxuICBnZXQgaGFzUmFuZ2VzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnJhbmdlcy5sZW5ndGggPiAwO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmICgodGhpcy5jb250YWluZXIgJiYgY2hhbmdlcy52YWx1ZSkgfHwgKHRoaXMuY29udGFpbmVyICYmIGNoYW5nZXMucmFuZ2VzKSB8fCB0aGlzLmNvbnRhaW5lcikge1xuICAgICAgdGhpcy5zZXRDb29yZGluYXRlcyh0aGlzLnZhbHVlLCB0aGlzLnJhbmdlcywgdGhpcy5jb250YWluZXIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0Q29vcmRpbmF0ZXModmFsdWU6IG51bWJlciwgcmFuZ2VzOiBBcnJheTxQb0dhdWdlUmFuZ2VzPiwgY29udGFpbmVyOiBQb0dhdWdlU3ZnQ29udGFpbmVyKTogdm9pZCB7XG4gICAgY29uc3QgeyBoZWlnaHQgfSA9IGNvbnRhaW5lcjtcblxuICAgIC8vIEFkaWNpb25hIGVsZW1lbnRvIHN2ZyBzb21lbnRlIGFww7NzIGNhbGN1bGFyIGEgYWx0dXJhIGRvIGNvbnRhaW5lciBwb2lzIG8gc3ZnIHRlbSBhbHR1cmEgZGVmYXVsdCBkZSAxNTBweC5cbiAgICB0aGlzLmFkZFN2Z0VsZW1lbnQgPSB0cnVlO1xuICAgIHRoaXMuc2V0Vmlld0JveChoZWlnaHQpO1xuICAgIHRoaXMuc2V0QmFzZUNvb3JkaW5hdGVzKGhlaWdodCk7XG5cbiAgICBpZiAoIXJhbmdlcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuc2V0U2luZ2xlUmFuZ2VDb29yZGluYXRlcyhoZWlnaHQsIHZhbHVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZXRSYW5nZXNDb29yZGluYXRlcyhoZWlnaHQsIHZhbHVlLCByYW5nZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRCYXNlQ29vcmRpbmF0ZXMoaGVpZ2h0OiBQb0dhdWdlU3ZnQ29udGFpbmVyWydoZWlnaHQnXSk6IHZvaWQge1xuICAgIGNvbnN0IGVuZEFuZ2xlUmFkaWFuID0gMDtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IHRoaXMuY2FsY3VsYXRlQ29vcmRpbmF0ZXMoaGVpZ2h0LCBwb0dhdWdlU3RhcnRBbmdsZSwgZW5kQW5nbGVSYWRpYW4pO1xuXG4gICAgdGhpcy5iYXNlQ29vcmRpbmF0ZXMgPSB7IGNvb3JkaW5hdGVzIH07XG4gIH1cblxuICBwcml2YXRlIHNldFJhbmdlc0Nvb3JkaW5hdGVzKGhlaWdodDogbnVtYmVyLCB2YWx1ZTogbnVtYmVyID0gMCwgcmFuZ2VzOiBBcnJheTxQb0dhdWdlUmFuZ2VzPik6IHZvaWQge1xuICAgIGNvbnN0IHsgbWluUmFuZ2UsIG1heFJhbmdlIH0gPSB0aGlzLmNhbGN1bGF0ZU1pbkFuZE1heFZhbHVlcyhyYW5nZXMpO1xuXG4gICAgY29uc3QgbWluVmFsdWUgPSB2YWx1ZSA8IG1pblJhbmdlID8gdmFsdWUgOiBtaW5SYW5nZTtcbiAgICBjb25zdCBtYXhWYWx1ZSA9IHZhbHVlID4gbWF4UmFuZ2UgPyB2YWx1ZSA6IG1heFJhbmdlO1xuXG4gICAgdGhpcy5zZXRQb2ludGVyQ29vcmRpbmF0ZXMoaGVpZ2h0LCB2YWx1ZSwgbWF4VmFsdWUsIG1pblZhbHVlKTtcblxuICAgIC8vIGAucmV2ZXJzZSgpYCBubyB0w6lybWlubyBkYSBpdGVyYcOnw6NvIHBhcmEgdHJhdGFyIGEgc29icmVwb3NpY8OjbyBjb3JyZXRhIGRhcyBib3JkYXMgYXJyZWRvbmRhZGFzIGRvcyByYW5nZXMuXG4gICAgY29uc3QgcmFuZ2VzQ29vcmRpbmF0ZXMgPSByYW5nZXNcbiAgICAgIC5tYXAoKHJhbmdlOiBQb0dhdWdlUmFuZ2VzKSA9PiB7XG4gICAgICAgIGNvbnN0IGZyb20gPSByYW5nZS5mcm9tID8/IDA7XG4gICAgICAgIGNvbnN0IHRvID0gcmFuZ2UudG8gPz8gbWF4UmFuZ2U7XG4gICAgICAgIGNvbnN0IHN0YXJ0QW5nbGVSYWRpYW4gPSBwb0dhdWdlU3RhcnRBbmdsZSArIHRoaXMuY2FsY3VsYXRlQW5nbGVSYWRpdXMoZnJvbSwgbWF4VmFsdWUsIG1pblZhbHVlKTtcbiAgICAgICAgY29uc3QgZW5kQW5nbGVSYWRpYW4gPSBwb0dhdWdlU3RhcnRBbmdsZSArIHRoaXMuY2FsY3VsYXRlQW5nbGVSYWRpdXModG8sIG1heFZhbHVlLCBtaW5WYWx1ZSk7XG5cbiAgICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSB0aGlzLmNhbGN1bGF0ZUNvb3JkaW5hdGVzKGhlaWdodCwgc3RhcnRBbmdsZVJhZGlhbiwgZW5kQW5nbGVSYWRpYW4pO1xuXG4gICAgICAgIHJldHVybiB7IGNvb3JkaW5hdGVzLCBjb2xvcjogcmFuZ2UuY29sb3IgfTtcbiAgICAgIH0pXG4gICAgICAucmV2ZXJzZSgpO1xuXG4gICAgdGhpcy5jb29yZGluYXRlcyA9IHJhbmdlc0Nvb3JkaW5hdGVzO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRTaW5nbGVSYW5nZUNvb3JkaW5hdGVzKGhlaWdodDogUG9HYXVnZVN2Z0NvbnRhaW5lclsnaGVpZ2h0J10sIHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCB2ZXJpZmllZFZhbHVlID0gdmFsdWUgPiAxMDAgPyAxMDAgOiB2YWx1ZTtcblxuICAgIGNvbnN0IGVuZEFuZ2xlUmFkaWFuID0gcG9HYXVnZVN0YXJ0QW5nbGUgKyB0aGlzLmNhbGN1bGF0ZUFuZ2xlUmFkaXVzKHZlcmlmaWVkVmFsdWUsIHBvR2F1Z2VUb3RhbFZhbHVlRGVmYXVsdCk7XG5cbiAgICBjb25zdCBjb29yZGluYXRlcyA9IHZhbHVlID4gMCA/IHRoaXMuY2FsY3VsYXRlQ29vcmRpbmF0ZXMoaGVpZ2h0LCBwb0dhdWdlU3RhcnRBbmdsZSwgZW5kQW5nbGVSYWRpYW4pIDogdW5kZWZpbmVkO1xuICAgIGNvbnN0IGNvbG9yID0gUG9EZWZhdWx0Q29sb3JzWzBdWzBdO1xuICAgIHRoaXMuY29vcmRpbmF0ZXMgPSBbeyBjb29yZGluYXRlcywgY29sb3IgfV07XG4gIH1cblxuICBwcml2YXRlIHNldFBvaW50ZXJDb29yZGluYXRlcyhoZWlnaHQ6IG51bWJlciwgdmFsdWU6IG51bWJlciwgbWF4VmFsdWU6IG51bWJlciwgbWluVmFsdWU6IG51bWJlcikge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gdGhpcy5jYWxjdWxhdGVQb2ludGVySW5pdGlhbENvb3JkaW5hdGVzKGhlaWdodCwgcG9HYXVnZVN0YXJ0QW5nbGUpO1xuICAgIGNvbnN0IHBvaW50ZXJEZWdyZWVzID0gdGhpcy5wb2ludGVyUm90YXRpb24odmFsdWUsIG1heFZhbHVlLCBtaW5WYWx1ZSk7XG5cbiAgICB0aGlzLnBvaW50ZXJDb29yZGluYXRlcyA9IHsgLi4uY29vcmRpbmF0ZXMsIHBvaW50ZXJEZWdyZWVzIH07XG4gIH1cblxuICBwcml2YXRlIHBvaW50ZXJSb3RhdGlvbih2YWx1ZTogbnVtYmVyLCBtYXhWYWx1ZTogbnVtYmVyLCBtaW5WYWx1ZTogbnVtYmVyKSB7XG4gICAgY29uc3QgcGVyY2VudCA9IHRoaXMuY29udmVydFZhbHVlVG9QZXJjZW50YWdlKHZhbHVlLCBtYXhWYWx1ZSwgbWluVmFsdWUpO1xuICAgIC8vIHZhbG9yZXMgcmVmZXJlbnRlcyDDoHMgYW5ndWxhw6fDtWVzIG3DrW5pbWFzIGUgbcOheGltYXMgZG8gcG9udGVpcm8uXG4gICAgY29uc3QgbWluUm90YXRpb24gPSAwO1xuICAgIGNvbnN0IG1heFJvdGF0aW9uID0gMTgwO1xuXG4gICAgcmV0dXJuIChwZXJjZW50ICogKG1heFJvdGF0aW9uIC0gbWluUm90YXRpb24pKSAvIDEwMCArIG1pblJvdGF0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVQb2ludGVySW5pdGlhbENvb3JkaW5hdGVzKGhlaWdodDogbnVtYmVyLCBzdGFydEFuZ2xlUmFkaWFuOiBudW1iZXIpIHtcbiAgICBjb25zdCByYWRpdXMgPSBoZWlnaHQgLSBQb0dhdWdlUG9pbnRlckVuZCAtIFBvR2F1Z2VUaGlja25lc3MgLyAyO1xuXG4gICAgLy8gVmFsb3IgcXVlIHJlcHJlc2VudGEgYSBlc2NhbGEgZG8gcG9udGVpcm8gcGFyYSBwbG90YWdlbS5cbiAgICBjb25zdCBzY2FsZSA9IDQwO1xuICAgIGNvbnN0IHBvaW50ZXJTY2FsZWRXaWR0aCA9IHJhZGl1cyAvIHNjYWxlO1xuICAgIGNvbnN0IHBvaW50ZXJTY2FsZWRCb3JkZXJSYWRpdXMgPSByYWRpdXMgLyAoc2NhbGUgKiAyKTtcblxuICAgIGNvbnN0IHNpbkFscGhhID0gTWF0aC5zaW4oc3RhcnRBbmdsZVJhZGlhbik7XG4gICAgY29uc3QgY29zQWxwaGEgPSBNYXRoLmNvcyhzdGFydEFuZ2xlUmFkaWFuKTtcblxuICAgIGNvbnN0IHRhcmdldFggPSByYWRpdXMgKyBjb3NBbHBoYSAqIHJhZGl1cztcbiAgICBjb25zdCB0YXJnZXRZID0gcmFkaXVzICsgc2luQWxwaGEgKiByYWRpdXM7XG5cbiAgICBjb25zdCBzdGFydFggPSByYWRpdXM7XG4gICAgY29uc3Qgc3RhcnRZID0gcmFkaXVzICsgcG9pbnRlclNjYWxlZFdpZHRoO1xuXG4gICAgY29uc3QgZW5kWCA9IHJhZGl1cztcbiAgICBjb25zdCBlbmRZID0gcmFkaXVzIC0gcG9pbnRlclNjYWxlZFdpZHRoO1xuXG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbXG4gICAgICAnTScsXG4gICAgICBzdGFydFgsXG4gICAgICBzdGFydFksXG4gICAgICAnTCcsXG4gICAgICB0YXJnZXRYLFxuICAgICAgdGFyZ2V0WSArIHBvaW50ZXJTY2FsZWRCb3JkZXJSYWRpdXMsXG4gICAgICAnQScsXG4gICAgICAxLFxuICAgICAgMSxcbiAgICAgIDAsXG4gICAgICAnMCwxJyxcbiAgICAgIHRhcmdldFgsXG4gICAgICB0YXJnZXRZIC0gcG9pbnRlclNjYWxlZEJvcmRlclJhZGl1cyxcbiAgICAgICdMJyxcbiAgICAgIGVuZFgsXG4gICAgICBlbmRZLFxuICAgICAgJ1onXG4gICAgXS5qb2luKCcgJyk7XG5cbiAgICByZXR1cm4geyBjb29yZGluYXRlcywgcmFkaXVzIH07XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUNvb3JkaW5hdGVzKFxuICAgIGhlaWdodDogUG9HYXVnZVN2Z0NvbnRhaW5lclsnaGVpZ2h0J10sXG4gICAgc3RhcnRBbmdsZVJhZGlhbjogbnVtYmVyLFxuICAgIGVuZEFuZ2xlUmFkaWFuOiBudW1iZXJcbiAgKTogUG9HYXVnZUNvb3JkaW5hdGVzWydjb29yZGluYXRlcyddIHtcbiAgICAvLyBTdWJ0cmFpIGFsdHVyYSBwZWxvIGV4Y2VkZW50ZSBwb250ZWlybyBlbSByZWxhw6fDo28gYW8gZ3LDoWZpY28sIHBlbGEgbWV0YWRlIGRvIHZhbG9yIGRhIGNvcm9hIGNpcmN1bGFyLlxuICAgIGNvbnN0IHJhZGl1cyA9IGhlaWdodCAtIFBvR2F1Z2VQb2ludGVyRW5kIC0gUG9HYXVnZVRoaWNrbmVzcyAvIDI7XG4gICAgY29uc3QgaW5uZXJSYWRpdXMgPSByYWRpdXMgLSBQb0dhdWdlVGhpY2tuZXNzO1xuXG4gICAgY29uc3Qgc2luQWxwaGEgPSBNYXRoLnNpbihzdGFydEFuZ2xlUmFkaWFuKTtcbiAgICBjb25zdCBjb3NBbHBoYSA9IE1hdGguY29zKHN0YXJ0QW5nbGVSYWRpYW4pO1xuXG4gICAgY29uc3Qgc2luQmV0YSA9IE1hdGguc2luKGVuZEFuZ2xlUmFkaWFuKTtcbiAgICBjb25zdCBjb3NCZXRhID0gTWF0aC5jb3MoZW5kQW5nbGVSYWRpYW4pO1xuXG4gICAgY29uc3Qgc3RhcnRYID0gTWF0aC5yb3VuZChyYWRpdXMgKyBjb3NBbHBoYSAqIHJhZGl1cyk7XG4gICAgY29uc3Qgc3RhcnRZID0gTWF0aC5yb3VuZChyYWRpdXMgKyBzaW5BbHBoYSAqIHJhZGl1cyk7XG5cbiAgICBjb25zdCBlbmRYID0gTWF0aC5yb3VuZChyYWRpdXMgKyBjb3NCZXRhICogcmFkaXVzKTtcbiAgICBjb25zdCBlbmRZID0gTWF0aC5yb3VuZChyYWRpdXMgKyBzaW5CZXRhICogcmFkaXVzKTtcblxuICAgIGNvbnN0IHN0YXJ0SW5uZXJYID0gTWF0aC5yb3VuZChyYWRpdXMgKyBjb3NBbHBoYSAqIGlubmVyUmFkaXVzKTtcbiAgICBjb25zdCBzdGFydElubmVyWSA9IE1hdGgucm91bmQocmFkaXVzICsgc2luQWxwaGEgKiBpbm5lclJhZGl1cyk7XG5cbiAgICBjb25zdCBlbmRJbm5lclggPSBNYXRoLnJvdW5kKHJhZGl1cyArIGNvc0JldGEgKiBpbm5lclJhZGl1cyk7XG4gICAgY29uc3QgZW5kSW5uZXJZID0gTWF0aC5yb3VuZChyYWRpdXMgKyBzaW5CZXRhICogaW5uZXJSYWRpdXMpO1xuXG4gICAgcmV0dXJuIFtcbiAgICAgICdNJyxcbiAgICAgIHN0YXJ0WCxcbiAgICAgIHN0YXJ0WSxcbiAgICAgICdBJyxcbiAgICAgIHJhZGl1cyxcbiAgICAgIHJhZGl1cyxcbiAgICAgIDAsXG4gICAgICAnMCwxJyxcbiAgICAgIGVuZFgsXG4gICAgICBlbmRZLFxuICAgICAgJ0EnLFxuICAgICAgMSxcbiAgICAgIDEsXG4gICAgICAwLFxuICAgICAgJzAsMScsXG4gICAgICBlbmRJbm5lclgsXG4gICAgICBlbmRJbm5lclksXG4gICAgICAnQScsXG4gICAgICBpbm5lclJhZGl1cyxcbiAgICAgIGlubmVyUmFkaXVzLFxuICAgICAgMCxcbiAgICAgICcwLDAnLFxuICAgICAgc3RhcnRJbm5lclgsXG4gICAgICBzdGFydElubmVyWSxcbiAgICAgICdBJyxcbiAgICAgIDEsXG4gICAgICAxLFxuICAgICAgMCxcbiAgICAgICcwLDEnLFxuICAgICAgc3RhcnRYLFxuICAgICAgc3RhcnRZLFxuICAgICAgJ1onXG4gICAgXS5qb2luKCcgJyk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUFuZ2xlUmFkaXVzKHZhbHVlOiBudW1iZXIsIG1heFZhbHVlOiBudW1iZXIsIG1pblZhbHVlOiBudW1iZXIgPSAwKTogbnVtYmVyIHtcbiAgICBjb25zdCBhbmdsZSA9ICgodmFsdWUgLSBtaW5WYWx1ZSkgLyAobWF4VmFsdWUgLSBtaW5WYWx1ZSkpICogKE1hdGguUEkgKiAyKTtcblxuICAgIHJldHVybiBhbmdsZSAvIDI7XG4gIH1cblxuICBwcml2YXRlIGNvbnZlcnRWYWx1ZVRvUGVyY2VudGFnZSh2YWx1ZTogbnVtYmVyLCBtYXhWYWx1ZTogbnVtYmVyLCBtaW5WYWx1ZSk6IG51bWJlciB7XG4gICAgcmV0dXJuICgodmFsdWUgLSBtaW5WYWx1ZSkgLyAobWF4VmFsdWUgLSBtaW5WYWx1ZSkpICogMTAwO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRWaWV3Qm94KGhlaWdodDogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLmNhbGN1bGF0ZURpYW1ldGVyKGhlaWdodCk7XG5cbiAgICB0aGlzLnZpZXdCb3ggPSBgMCAkey1Qb0dhdWdlUG9pbnRlckVuZH0gJHt3aWR0aH0gJHtoZWlnaHR9YDtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlRGlhbWV0ZXIoaGVpZ2h0OiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IHJhZGl1cyA9IGhlaWdodCAtIFBvR2F1Z2VQb2ludGVyRW5kIC0gUG9HYXVnZVRoaWNrbmVzcyAvIDI7XG5cbiAgICByZXR1cm4gcmFkaXVzICsgTWF0aC5jb3MoMCkgKiByYWRpdXM7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZU1pbkFuZE1heFZhbHVlcyhyYW5nZXM6IEFycmF5PFBvR2F1Z2VSYW5nZXM+KSB7XG4gICAgY29uc3QgbWluUmFuZ2UgPSB0aGlzLmdldERvbWFpbihyYW5nZXMsICdtaW4nKTtcbiAgICBjb25zdCBtYXhSYW5nZSA9IHRoaXMuZ2V0RG9tYWluKHJhbmdlcywgJ21heCcpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG1pblJhbmdlOiB0aGlzLnZlcmlmeUlmRmxvYXRPckludGVnZXIobWluUmFuZ2UpID8gbWluUmFuZ2UgOiAwLFxuICAgICAgbWF4UmFuZ2U6IHRoaXMudmVyaWZ5SWZGbG9hdE9ySW50ZWdlcihtYXhSYW5nZSkgPyBtYXhSYW5nZSA6IDEwMFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHZlcmlmeUlmRmxvYXRPckludGVnZXIobnVtYmVyOiBudW1iZXIpIHtcbiAgICBjb25zdCBub3RBQm9vbGVhbiA9IHR5cGVvZiBudW1iZXIgIT09ICdib29sZWFuJztcbiAgICBjb25zdCBub3RJbmZpbml0eSA9IG51bWJlciAhPT0gSW5maW5pdHk7XG5cbiAgICBjb25zdCBpc0ludGVnZXIgPSBOdW1iZXIobnVtYmVyKSA9PT0gbnVtYmVyICYmIG51bWJlciAlIDEgPT09IDAgJiYgbm90SW5maW5pdHk7XG4gICAgY29uc3QgaXNGbG9hdCA9IE51bWJlcihudW1iZXIpID09PSBudW1iZXIgJiYgbnVtYmVyICUgMSAhPT0gMCAmJiBub3RJbmZpbml0eTtcblxuICAgIHJldHVybiAobm90QUJvb2xlYW4gJiYgaXNJbnRlZ2VyKSB8fCAobm90QUJvb2xlYW4gJiYgaXNGbG9hdCk7XG4gIH1cblxuICBwcml2YXRlIGdldERvbWFpbihyYW5nZXM6IEFycmF5PFBvR2F1Z2VSYW5nZXM+LCB0eXBlOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IHJhbmdlVHlwZSA9IHsgbWluOiAnZnJvbScsIG1heDogJ3RvJyB9O1xuXG4gICAgcmV0dXJuIE1hdGhbdHlwZV0oLi4ucmFuZ2VzLm1hcChyYW5nZSA9PiByYW5nZVtyYW5nZVR5cGVbdHlwZV1dKSk7XG4gIH1cbn1cbiIsIjxzdmc6c3ZnXG4gICpuZ0lmPVwiYWRkU3ZnRWxlbWVudFwiXG4gIGNsYXNzPVwicG8tZ2F1Z2Utc3ZnXCJcbiAgcHJlc2VydmVBc3BlY3RSYXRpbz1cInhNaWRZTWF4IG1lZXRcIlxuICB3aWR0aD1cIjEwMCVcIlxuICBbYXR0ci52aWV3Qm94XT1cInZpZXdCb3hcIlxuICBbYXR0ci5oZWlnaHRdPVwiY29udGFpbmVyPy5oZWlnaHRcIlxuPlxuICA8IS0tIEdBVUdFIFBBVEhTIC0tPlxuICA8c3ZnOmcgcG8tZ2F1Z2UtcGF0aCBbcC1iYXNlLWNvb3JkaW5hdGVzXT1cImJhc2VDb29yZGluYXRlc1wiIFtwLXJhbmdlcy1jb29yZGluYXRlc109XCJjb29yZGluYXRlc1wiPjwvc3ZnOmc+XG5cbiAgPCEtLSBHQVVHRSBQT0lOVEVSIC0tPlxuICA8c3ZnOmcgKm5nSWY9XCJoYXNSYW5nZXNcIiBwby1nYXVnZS1wb2ludGVyIFtwLWNvb3JkaW5hdGVzXT1cInBvaW50ZXJDb29yZGluYXRlc1wiPjwvc3ZnOmc+XG48L3N2Zzpzdmc+XG4iXX0=