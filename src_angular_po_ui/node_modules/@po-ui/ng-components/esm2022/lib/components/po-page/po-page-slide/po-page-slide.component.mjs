import { animate, animateChild, group, query, style, transition, trigger } from '@angular/animations';
import { Component, ElementRef, ViewChild } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import { delay, take } from 'rxjs/operators';
import { getFocusableElements, uuid } from '../../../utils/util';
import { PoPageSlideBaseComponent } from './po-page-slide-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../../services/po-active-overlay/po-active-overlay.service";
import * as i2 from "@angular/common";
import * as i3 from "../../po-button/po-button.component";
const _c0 = ["pageContent"];
function PoPageSlideComponent_div_0_div_9_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 11);
    i0.ɵɵtext(1);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext(2);
    i0.ɵɵadvance();
    i0.ɵɵtextInterpolate(ctx_r2.subtitle);
} }
function PoPageSlideComponent_div_0_po_button_10_Template(rf, ctx) { if (rf & 1) {
    const _r5 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-button", 12);
    i0.ɵɵlistener("p-click", function PoPageSlideComponent_div_0_po_button_10_Template_po_button_p_click_0_listener() { i0.ɵɵrestoreView(_r5); const ctx_r4 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r4.close()); });
    i0.ɵɵelementEnd();
} }
const _c1 = a0 => ({ "width": a0 });
function PoPageSlideComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    const _r7 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "div", 1)(1, "div", 2);
    i0.ɵɵlistener("mousedown", function PoPageSlideComponent_div_0_Template_div_mousedown_1_listener($event) { i0.ɵɵrestoreView(_r7); const ctx_r6 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r6.onClickOut($event)); });
    i0.ɵɵelementEnd();
    i0.ɵɵelementStart(2, "div", 3)(3, "div", 4, 5)(5, "div", 6)(6, "div", 7)(7, "span");
    i0.ɵɵtext(8);
    i0.ɵɵelementEnd();
    i0.ɵɵtemplate(9, PoPageSlideComponent_div_0_div_9_Template, 2, 1, "div", 8);
    i0.ɵɵelementEnd();
    i0.ɵɵtemplate(10, PoPageSlideComponent_div_0_po_button_10_Template, 1, 0, "po-button", 9);
    i0.ɵɵelementEnd();
    i0.ɵɵelementStart(11, "div", 10);
    i0.ɵɵprojection(12);
    i0.ɵɵelementEnd()()()();
} if (rf & 2) {
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵproperty("@fade", undefined);
    i0.ɵɵadvance(2);
    i0.ɵɵclassMapInterpolate1("po-page-slide-container po-page-slide-right po-page-slide-", ctx_r0.size, "");
    i0.ɵɵproperty("@slide", undefined)("ngStyle", i0.ɵɵpureFunction1(9, _c1, ctx_r0.flexibleWidth ? "" : ctx_r0.size === "auto" ? "auto" : ""));
    i0.ɵɵadvance(6);
    i0.ɵɵtextInterpolate(ctx_r0.title);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngIf", ctx_r0.subtitle);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngIf", !ctx_r0.hideClose);
} }
const _c2 = ["*"];
/**
 * @docsExtends PoPageSlideBaseComponent
 *
 * @example
 *
 * <example name="po-page-slide-basic" title="PO Page Slide Basic">
 *  <file name="sample-po-page-slide-basic/sample-po-page-slide-basic.component.html"> </file>
 *  <file name="sample-po-page-slide-basic/sample-po-page-slide-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-page-slide-labs" title="PO Page Slide Labs">
 *  <file name="sample-po-page-slide-labs/sample-po-page-slide-labs.component.html"> </file>
 *  <file name="sample-po-page-slide-labs/sample-po-page-slide-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-page-slide-configuration" title="PO Page Slide - Configuration">
 *  <file name="sample-po-page-slide-configuration/sample-po-page-slide-configuration.component.html"> </file>
 *  <file name="sample-po-page-slide-configuration/sample-po-page-slide-configuration.component.ts"> </file>
 * </example>
 */
export class PoPageSlideComponent extends PoPageSlideBaseComponent {
    poActiveOverlayService;
    _pageContent;
    firstElement;
    id = uuid();
    loadingCompleted = new ReplaySubject();
    sourceElement;
    focusEvent;
    set pageContent(pageContent) {
        if (pageContent) {
            this._pageContent = pageContent;
            this.loadingCompleted.next();
        }
    }
    get pageContent() {
        return this._pageContent;
    }
    constructor(poActiveOverlayService) {
        super();
        this.poActiveOverlayService = poActiveOverlayService;
    }
    open() {
        this.sourceElement = document.activeElement;
        super.open();
        this.loadingCompleted.pipe(take(1)).pipe(delay(0)).subscribe(this.handleFocus.bind(this));
    }
    close() {
        this.poActiveOverlayService.activeOverlay.pop();
        super.close();
        this.removeEventListeners();
        this.sourceElement.focus();
    }
    onClickOut(event) {
        if (this.clickOut && !this.pageContent.nativeElement.contains(event.target)) {
            this.close();
        }
    }
    handleFocus() {
        this.poActiveOverlayService.activeOverlay.push(this.id);
        this.loadFirstElement();
        this.initFocus();
        document.addEventListener('focus', this.focusEvent, true);
    }
    initFocus() {
        // O foco não pode sair da página.
        this.focusEvent = (event) => {
            if (!this.pageContent.nativeElement.contains(event.target) &&
                this.poActiveOverlayService.activeOverlay[this.poActiveOverlayService.activeOverlay.length - 1] === this.id) {
                event.stopPropagation();
                this.firstElement.focus();
            }
        };
        if (this.hideClose) {
            this.firstElement.focus();
        }
        else {
            const elements = getFocusableElements(this.pageContent.nativeElement);
            const element = elements[0] || this.pageContent.nativeElement;
            element.focus();
        }
    }
    loadFirstElement() {
        this.firstElement = getFocusableElements(this.pageContent.nativeElement)[0] || this.pageContent.nativeElement;
    }
    removeEventListeners() {
        document.removeEventListener('focus', this.focusEvent, true);
        this.loadingCompleted.complete();
    }
    static ɵfac = function PoPageSlideComponent_Factory(t) { return new (t || PoPageSlideComponent)(i0.ɵɵdirectiveInject(i1.PoActiveOverlayService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoPageSlideComponent, selectors: [["po-page-slide"]], viewQuery: function PoPageSlideComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(_c0, 5, ElementRef);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.pageContent = _t.first);
        } }, features: [i0.ɵɵProvidersFeature([]), i0.ɵɵInheritDefinitionFeature], ngContentSelectors: _c2, decls: 1, vars: 1, consts: [["class", "po-page-slide", "tabindex", "0", 4, "ngIf"], ["tabindex", "0", 1, "po-page-slide"], [1, "po-page-slide-overlay", 3, "mousedown"], [3, "ngStyle"], ["tabindex", "-1", 1, "po-page-slide-content"], ["pageContent", ""], [1, "po-page-slide-header"], [1, "po-page-slide-title"], ["class", "po-page-slide-subtitle", 4, "ngIf"], ["p-icon", "ICON_CLOSE", "p-kind", "tertiary", 3, "p-click", 4, "ngIf"], [1, "po-page-slide-body"], [1, "po-page-slide-subtitle"], ["p-icon", "ICON_CLOSE", "p-kind", "tertiary", 3, "p-click"]], template: function PoPageSlideComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵprojectionDef();
            i0.ɵɵtemplate(0, PoPageSlideComponent_div_0_Template, 13, 11, "div", 0);
        } if (rf & 2) {
            i0.ɵɵproperty("ngIf", !ctx.hidden);
        } }, dependencies: [i2.NgIf, i2.NgStyle, i3.PoButtonComponent], encapsulation: 2, data: { animation: [
                trigger('fade', [
                    transition(':enter', [
                        style({ opacity: 0 }),
                        group([animate('150ms', style({ opacity: 1 })), query('@slide', animateChild())])
                    ]),
                    transition(':leave', group([query('@slide', animateChild()), animate('150ms', style({ opacity: 0 }))]))
                ]),
                trigger('slide', [
                    transition(':enter', [
                        style({ transform: 'translateX(50px)' }),
                        animate('691ms ease-in-out', style({ transform: 'none' }))
                    ]),
                    transition(':leave', [animate('150ms', style({ transform: 'translateX(50px)' }))])
                ])
            ] } });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoPageSlideComponent, [{
        type: Component,
        args: [{ selector: 'po-page-slide', providers: [], animations: [
                    trigger('fade', [
                        transition(':enter', [
                            style({ opacity: 0 }),
                            group([animate('150ms', style({ opacity: 1 })), query('@slide', animateChild())])
                        ]),
                        transition(':leave', group([query('@slide', animateChild()), animate('150ms', style({ opacity: 0 }))]))
                    ]),
                    trigger('slide', [
                        transition(':enter', [
                            style({ transform: 'translateX(50px)' }),
                            animate('691ms ease-in-out', style({ transform: 'none' }))
                        ]),
                        transition(':leave', [animate('150ms', style({ transform: 'translateX(50px)' }))])
                    ])
                ], template: "<div class=\"po-page-slide\" tabindex=\"0\" *ngIf=\"!hidden\" [@fade]>\n  <div class=\"po-page-slide-overlay\" (mousedown)=\"onClickOut($event)\"></div>\n  <div\n    class=\"po-page-slide-container po-page-slide-right po-page-slide-{{ size }}\"\n    [@slide]\n    [ngStyle]=\"{ 'width': flexibleWidth ? '' : size === 'auto' ? 'auto' : '' }\"\n  >\n    <div class=\"po-page-slide-content\" tabindex=\"-1\" #pageContent>\n      <div class=\"po-page-slide-header\">\n        <div class=\"po-page-slide-title\">\n          <span>{{ title }}</span>\n          <div class=\"po-page-slide-subtitle\" *ngIf=\"subtitle\">{{ subtitle }}</div>\n        </div>\n        <po-button *ngIf=\"!hideClose\" p-icon=\"ICON_CLOSE\" p-kind=\"tertiary\" (p-click)=\"close()\"> </po-button>\n      </div>\n      <div class=\"po-page-slide-body\">\n        <ng-content></ng-content>\n      </div>\n    </div>\n  </div>\n</div>\n" }]
    }], () => [{ type: i1.PoActiveOverlayService }], { pageContent: [{
            type: ViewChild,
            args: ['pageContent', { read: ElementRef }]
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoPageSlideComponent, { className: "PoPageSlideComponent", filePath: "lib/components/po-page/po-page-slide/po-page-slide.component.ts", lineNumber: 52 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1zbGlkZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tcGFnZS9wby1wYWdlLXNsaWRlL3BvLXBhZ2Utc2xpZGUuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLXBhZ2UvcG8tcGFnZS1zbGlkZS9wby1wYWdlLXNsaWRlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RyxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDakUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyQyxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTdDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxJQUFJLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUdqRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7Ozs7OztJQ0doRSwrQkFBcUQ7SUFBQSxZQUFjO0lBQUEsaUJBQU07OztJQUFwQixjQUFjO0lBQWQscUNBQWM7Ozs7SUFFckUscUNBQXdGO0lBQXBCLHNMQUFXLGVBQUEsY0FBTyxDQUFBLElBQUM7SUFBRSxpQkFBWTs7Ozs7SUFiN0csOEJBQWdFLGFBQUE7SUFDM0IsNEtBQWEsZUFBQSx5QkFBa0IsQ0FBQSxJQUFDO0lBQUMsaUJBQU07SUFDMUUsOEJBSUMsZ0JBQUEsYUFBQSxhQUFBLFdBQUE7SUFJYSxZQUFXO0lB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LFVBQVUsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUUsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7cUJBQ3hHLENBQUM7b0JBQ0YsT0FBTyxDQUFDLE9BQU8sRUFBRTt3QkFDZixVQUFVLENBQUMsUUFBUSxFQUFFOzRCQUNuQixLQUFLLENBQUMsRUFBRSxTQUFTLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQzs0QkFDeEMsT0FBTyxDQUFDLG1CQUFtQixFQUFFLEtBQUssQ0FBQyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO3lCQUMzRCxDQUFDO3dCQUNGLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO3FCQUNuRixDQUFDO2lCQUNIO3VEQVltRCxXQUFXO2tCQUE5RCxTQUFTO21CQUFDLGFBQWEsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7O2tGQVZuQyxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhbmltYXRlLCBhbmltYXRlQ2hpbGQsIGdyb3VwLCBxdWVyeSwgc3R5bGUsIHRyYW5zaXRpb24sIHRyaWdnZXIgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWxheSwgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgZ2V0Rm9jdXNhYmxlRWxlbWVudHMsIHV1aWQgfSBmcm9tICcuLi8uLi8uLi91dGlscy91dGlsJztcblxuaW1wb3J0IHsgUG9BY3RpdmVPdmVybGF5U2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLWFjdGl2ZS1vdmVybGF5L3BvLWFjdGl2ZS1vdmVybGF5LnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9QYWdlU2xpZGVCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby1wYWdlLXNsaWRlLWJhc2UuY29tcG9uZW50JztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgUG9QYWdlU2xpZGVCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tcGFnZS1zbGlkZS1iYXNpY1wiIHRpdGxlPVwiUE8gUGFnZSBTbGlkZSBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tcGFnZS1zbGlkZS1iYXNpYy9zYW1wbGUtcG8tcGFnZS1zbGlkZS1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLXNsaWRlLWJhc2ljL3NhbXBsZS1wby1wYWdlLXNsaWRlLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXBhZ2Utc2xpZGUtbGFic1wiIHRpdGxlPVwiUE8gUGFnZSBTbGlkZSBMYWJzXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLXNsaWRlLWxhYnMvc2FtcGxlLXBvLXBhZ2Utc2xpZGUtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLXNsaWRlLWxhYnMvc2FtcGxlLXBvLXBhZ2Utc2xpZGUtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1wYWdlLXNsaWRlLWNvbmZpZ3VyYXRpb25cIiB0aXRsZT1cIlBPIFBhZ2UgU2xpZGUgLSBDb25maWd1cmF0aW9uXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLXNsaWRlLWNvbmZpZ3VyYXRpb24vc2FtcGxlLXBvLXBhZ2Utc2xpZGUtY29uZmlndXJhdGlvbi5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1wYWdlLXNsaWRlLWNvbmZpZ3VyYXRpb24vc2FtcGxlLXBvLXBhZ2Utc2xpZGUtY29uZmlndXJhdGlvbi5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1wYWdlLXNsaWRlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLXBhZ2Utc2xpZGUuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtdLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignZmFkZScsIFtcbiAgICAgIHRyYW5zaXRpb24oJzplbnRlcicsIFtcbiAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwIH0pLFxuICAgICAgICBncm91cChbYW5pbWF0ZSgnMTUwbXMnLCBzdHlsZSh7IG9wYWNpdHk6IDEgfSkpLCBxdWVyeSgnQHNsaWRlJywgYW5pbWF0ZUNoaWxkKCkpXSlcbiAgICAgIF0pLFxuICAgICAgdHJhbnNpdGlvbignOmxlYXZlJywgZ3JvdXAoW3F1ZXJ5KCdAc2xpZGUnLCBhbmltYXRlQ2hpbGQoKSksIGFuaW1hdGUoJzE1MG1zJywgc3R5bGUoeyBvcGFjaXR5OiAwIH0pKV0pKVxuICAgIF0pLFxuICAgIHRyaWdnZXIoJ3NsaWRlJywgW1xuICAgICAgdHJhbnNpdGlvbignOmVudGVyJywgW1xuICAgICAgICBzdHlsZSh7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoNTBweCknIH0pLFxuICAgICAgICBhbmltYXRlKCc2OTFtcyBlYXNlLWluLW91dCcsIHN0eWxlKHsgdHJhbnNmb3JtOiAnbm9uZScgfSkpXG4gICAgICBdKSxcbiAgICAgIHRyYW5zaXRpb24oJzpsZWF2ZScsIFthbmltYXRlKCcxNTBtcycsIHN0eWxlKHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCg1MHB4KScgfSkpXSlcbiAgICBdKVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIFBvUGFnZVNsaWRlQ29tcG9uZW50IGV4dGVuZHMgUG9QYWdlU2xpZGVCYXNlQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBfcGFnZUNvbnRlbnQ6IEVsZW1lbnRSZWY7XG5cbiAgcHJpdmF0ZSBmaXJzdEVsZW1lbnQ6IGFueTtcbiAgcHJpdmF0ZSBpZDogc3RyaW5nID0gdXVpZCgpO1xuICBwcml2YXRlIGxvYWRpbmdDb21wbGV0ZWQgPSBuZXcgUmVwbGF5U3ViamVjdDx2b2lkPigpO1xuICBwcml2YXRlIHNvdXJjZUVsZW1lbnQ6IGFueTtcblxuICBwcml2YXRlIGZvY3VzRXZlbnQ6IEV2ZW50TGlzdGVuZXI7XG5cbiAgQFZpZXdDaGlsZCgncGFnZUNvbnRlbnQnLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSkgc2V0IHBhZ2VDb250ZW50KHBhZ2VDb250ZW50OiBFbGVtZW50UmVmKSB7XG4gICAgaWYgKHBhZ2VDb250ZW50KSB7XG4gICAgICB0aGlzLl9wYWdlQ29udGVudCA9IHBhZ2VDb250ZW50O1xuICAgICAgdGhpcy5sb2FkaW5nQ29tcGxldGVkLm5leHQoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgcGFnZUNvbnRlbnQoKTogRWxlbWVudFJlZiB7XG4gICAgcmV0dXJuIHRoaXMuX3BhZ2VDb250ZW50O1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwb0FjdGl2ZU92ZXJsYXlTZXJ2aWNlOiBQb0FjdGl2ZU92ZXJsYXlTZXJ2aWNlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIHB1YmxpYyBvcGVuKCk6IHZvaWQge1xuICAgIHRoaXMuc291cmNlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gICAgc3VwZXIub3BlbigpO1xuICAgIHRoaXMubG9hZGluZ0NvbXBsZXRlZC5waXBlKHRha2UoMSkpLnBpcGUoZGVsYXkoMCkpLnN1YnNjcmliZSh0aGlzLmhhbmRsZUZvY3VzLmJpbmQodGhpcykpO1xuICB9XG5cbiAgcHVibGljIGNsb3NlKCk6IHZvaWQge1xuICAgIHRoaXMucG9BY3RpdmVPdmVybGF5U2VydmljZS5hY3RpdmVPdmVybGF5LnBvcCgpO1xuICAgIHN1cGVyLmNsb3NlKCk7XG5cbiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5zb3VyY2VFbGVtZW50LmZvY3VzKCk7XG4gIH1cblxuICBwdWJsaWMgb25DbGlja091dChldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNsaWNrT3V0ICYmICF0aGlzLnBhZ2VDb250ZW50Lm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRm9jdXMoKTogdm9pZCB7XG4gICAgdGhpcy5wb0FjdGl2ZU92ZXJsYXlTZXJ2aWNlLmFjdGl2ZU92ZXJsYXkucHVzaCh0aGlzLmlkKTtcbiAgICB0aGlzLmxvYWRGaXJzdEVsZW1lbnQoKTtcbiAgICB0aGlzLmluaXRGb2N1cygpO1xuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLmZvY3VzRXZlbnQsIHRydWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0Rm9jdXMoKSB7XG4gICAgLy8gTyBmb2NvIG7Do28gcG9kZSBzYWlyIGRhIHDDoWdpbmEuXG4gICAgdGhpcy5mb2N1c0V2ZW50ID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICAhdGhpcy5wYWdlQ29udGVudC5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiZcbiAgICAgICAgdGhpcy5wb0FjdGl2ZU92ZXJsYXlTZXJ2aWNlLmFjdGl2ZU92ZXJsYXlbdGhpcy5wb0FjdGl2ZU92ZXJsYXlTZXJ2aWNlLmFjdGl2ZU92ZXJsYXkubGVuZ3RoIC0gMV0gPT09IHRoaXMuaWRcbiAgICAgICkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy5maXJzdEVsZW1lbnQuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHRoaXMuaGlkZUNsb3NlKSB7XG4gICAgICB0aGlzLmZpcnN0RWxlbWVudC5mb2N1cygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBlbGVtZW50cyA9IGdldEZvY3VzYWJsZUVsZW1lbnRzKHRoaXMucGFnZUNvbnRlbnQubmF0aXZlRWxlbWVudCk7XG4gICAgICBjb25zdCBlbGVtZW50ID0gZWxlbWVudHNbMF0gfHwgdGhpcy5wYWdlQ29udGVudC5uYXRpdmVFbGVtZW50O1xuICAgICAgZWxlbWVudC5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbG9hZEZpcnN0RWxlbWVudCgpOiB2b2lkIHtcbiAgICB0aGlzLmZpcnN0RWxlbWVudCA9IGdldEZvY3VzYWJsZUVsZW1lbnRzKHRoaXMucGFnZUNvbnRlbnQubmF0aXZlRWxlbWVudClbMF0gfHwgdGhpcy5wYWdlQ29udGVudC5uYXRpdmVFbGVtZW50O1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVFdmVudExpc3RlbmVycygpOiB2b2lkIHtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuZm9jdXNFdmVudCwgdHJ1ZSk7XG4gICAgdGhpcy5sb2FkaW5nQ29tcGxldGVkLmNvbXBsZXRlKCk7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJwby1wYWdlLXNsaWRlXCIgdGFiaW5kZXg9XCIwXCIgKm5nSWY9XCIhaGlkZGVuXCIgW0BmYWRlXT5cbiAgPGRpdiBjbGFzcz1cInBvLXBhZ2Utc2xpZGUtb3ZlcmxheVwiIChtb3VzZWRvd24pPVwib25DbGlja091dCgkZXZlbnQpXCI+PC9kaXY+XG4gIDxkaXZcbiAgICBjbGFzcz1cInBvLXBhZ2Utc2xpZGUtY29udGFpbmVyIHBvLXBhZ2Utc2xpZGUtcmlnaHQgcG8tcGFnZS1zbGlkZS17eyBzaXplIH19XCJcbiAgICBbQHNsaWRlXVxuICAgIFtuZ1N0eWxlXT1cInsgJ3dpZHRoJzogZmxleGlibGVXaWR0aCA/ICcnIDogc2l6ZSA9PT0gJ2F1dG8nID8gJ2F1dG8nIDogJycgfVwiXG4gID5cbiAgICA8ZGl2IGNsYXNzPVwicG8tcGFnZS1zbGlkZS1jb250ZW50XCIgdGFiaW5kZXg9XCItMVwiICNwYWdlQ29udGVudD5cbiAgICAgIDxkaXYgY2xhc3M9XCJwby1wYWdlLXNsaWRlLWhlYWRlclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwicG8tcGFnZS1zbGlkZS10aXRsZVwiPlxuICAgICAgICAgIDxzcGFuPnt7IHRpdGxlIH19PC9zcGFuPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJwby1wYWdlLXNsaWRlLXN1YnRpdGxlXCIgKm5nSWY9XCJzdWJ0aXRsZVwiPnt7IHN1YnRpdGxlIH19PC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8cG8tYnV0dG9uICpuZ0lmPVwiIWhpZGVDbG9zZVwiIHAtaWNvbj1cIklDT05fQ0xPU0VcIiBwLWtpbmQ9XCJ0ZXJ0aWFyeVwiIChwLWNsaWNrKT1cImNsb3NlKClcIj4gPC9wby1idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJwby1wYWdlLXNsaWRlLWJvZHlcIj5cbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=