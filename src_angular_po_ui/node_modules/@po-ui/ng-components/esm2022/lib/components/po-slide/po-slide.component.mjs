import { Component, ContentChild, HostListener, ViewChild, ViewChildren } from '@angular/core';
import { animate, keyframes, style } from '@angular/animations';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { PoSlideBaseComponent } from './po-slide-base.component';
import { PoSlideContentTemplateDirective } from './directives/po-slide-content-template.directive';
import { PoSlideItemComponent } from './po-slide-item/po-slide-item.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/animations";
import * as i2 from "@angular/common";
import * as i3 from "./po-slide-circles/po-slide-circles.component";
import * as i4 from "./po-slide-control/po-slide-control.component";
import * as i5 from "./po-slide-item/po-slide-item.component";
const _c0 = ["slide"];
function PoSlideComponent_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵelement(1, "po-slide-item", 8);
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const item_r5 = ctx.$implicit;
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-action", item_r5.action)("p-data", item_r5)("p-image", item_r5.image)("p-image-height", ctx_r1.imageHeight)("p-template", ctx_r1.slideContentTemplate)("p-alt", item_r5.alt)("p-link", item_r5.link);
} }
function PoSlideComponent_po_slide_control_5_Template(rf, ctx) { if (rf & 1) {
    const _r8 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-slide-control", 9);
    i0.ɵɵlistener("p-click", function PoSlideComponent_po_slide_control_5_Template_po_slide_control_p_click_0_listener() { i0.ɵɵrestoreView(_r8); const ctx_r7 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r7.previousControl()); });
    i0.ɵɵelementEnd();
} }
function PoSlideComponent_po_slide_control_6_Template(rf, ctx) { if (rf & 1) {
    const _r10 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-slide-control", 10);
    i0.ɵɵlistener("p-click", function PoSlideComponent_po_slide_control_6_Template_po_slide_control_p_click_0_listener() { i0.ɵɵrestoreView(_r10); const ctx_r9 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r9.nextControl()); });
    i0.ɵɵelementEnd();
} }
function PoSlideComponent_po_slide_circles_7_Template(rf, ctx) { if (rf & 1) {
    const _r12 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-slide-circles", 11);
    i0.ɵɵlistener("p-click", function PoSlideComponent_po_slide_circles_7_Template_po_slide_circles_p_click_0_listener($event) { i0.ɵɵrestoreView(_r12); const ctx_r11 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r11.goToItem($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-current-slide-index", ctx_r4.currentSlideIndex)("p-items", ctx_r4.slideItems);
} }
const poSlideDefaultHeight = 336;
const poSlideIntervalMin = 1000;
const poSlideMinHeight = 192;
const poSlideTiming = '250ms ease';
/**
 * @docsExtends PoSlideBaseComponent
 *
 * @example
 * <example name="po-slide-basic" title="PO Slide Basic">
 *   <file name="sample-po-slide-basic/sample-po-slide-basic.component.html"> </file>
 *   <file name="sample-po-slide-basic/sample-po-slide-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-labs" title="PO Slide Labs">
 *   <file name="sample-po-slide-labs/sample-po-slide-labs.component.html"> </file>
 *   <file name="sample-po-slide-labs/sample-po-slide-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-useful-articles" title="PO Slide - Useful articles">
 *   <file name="sample-po-slide-useful-articles/sample-po-slide-useful-articles.component.html"> </file>
 *   <file name="sample-po-slide-useful-articles/sample-po-slide-useful-articles.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-landscapes" title="PO Slide - Landscapes">
 *   <file name="sample-po-slide-landscapes/sample-po-slide-landscapes.component.html"> </file>
 *   <file name="sample-po-slide-landscapes/sample-po-slide-landscapes.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-external-controls" title="PO Slide - External Controls">
 *  <file name="sample-po-slide-external-controls/sample-po-slide-external-controls.component.html"> </file>
 *  <file name="sample-po-slide-external-controls/sample-po-slide-external-controls.component.ts"> </file>
 * </example>
 */
export class PoSlideComponent extends PoSlideBaseComponent {
    builder;
    slideContentTemplate;
    slide;
    itemsElements;
    currentSlideIndex = 0;
    imageHeight;
    slideItems = [];
    slideItemWidth;
    isLoaded = false;
    player;
    setInterval;
    resize$ = new Subject();
    resizeSubscription;
    get hasElements() {
        return !!this.slide.nativeElement.offsetWidth && !!this.itemsElements && !!this.itemsElements.length;
    }
    get isImageSlide() {
        return !this.slideContentTemplate;
    }
    get offset() {
        return this.currentSlideIndex * this.slideItemWidth;
    }
    get hasSlides() {
        return !!this.slides && !!this.slides.length;
    }
    constructor(builder) {
        super();
        this.builder = builder;
    }
    onResize() {
        this.resize$.next({});
    }
    ngOnInit() {
        this.resizeSubscription = this.resize$.pipe(debounceTime(150)).subscribe(() => {
            this.setSlideItemWidth();
            this.goToItem(this.currentSlideIndex);
        });
    }
    ngDoCheck() {
        if (!this.isLoaded && this.hasElements) {
            this.setSlideItemWidth();
            this.isLoaded = true;
            if (this.hasSlides) {
                this.startSlide();
            }
        }
    }
    ngOnChanges(changes) {
        if (changes.height) {
            this.setSlideHeight(this.height);
        }
    }
    ngOnDestroy() {
        this.resizeSubscription?.unsubscribe();
    }
    /**
     * Método que retorna o index do slide atual
     *
     * ```
     * @ViewChild('slideComponent', { static: true }) slideComponent: PoSlideComponent;
     *  myFunction() {
     *    let currentIndex = this.slideComponent.getCurrentSlideIndex();
     * }
     *
     * ```
     */
    getCurrentSlideIndex() {
        return this.currentSlideIndex;
    }
    goToItem(index) {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = index;
        this.animate(this.offset);
    }
    nextControl() {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.next();
    }
    /**
     * Método para chamar o próximo slide.
     *
     * ```
     * @ViewChild('slideComponent', { static: true }) slideComponent: PoSlideComponent;
     *
     * myFunction() {
     *  this.slideComponent.next();
     * }
     * ```
     */
    next() {
        if (this.currentSlideIndex + 1 === this.slideItems.length) {
            this.currentSlideIndex = 0;
            this.animate(0);
            return;
        }
        this.currentSlideIndex = (this.currentSlideIndex + 1) % this.slideItems.length;
        this.animate(this.offset);
    }
    /**
     * Método para chamar o slide anterior.
     *
     * ```
     * @ViewChild('slideComponent', { static: true }) slideComponent: PoSlideComponent;
     *
     * myFunction() {
     *  this.slideComponent.previous();
     * }
     * ```
     */
    previous() {
        if (this.currentSlideIndex === 0) {
            this.currentSlideIndex = this.slideItems.length - 1;
            this.animate(this.offset);
            return;
        }
        this.currentSlideIndex = (this.currentSlideIndex - 1 + this.slideItems.length) % this.slideItems.length;
        this.animate(this.offset);
    }
    previousControl() {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.previous();
    }
    setSlideHeight(height) {
        this.setHeight(height);
    }
    cancelInterval() {
        clearInterval(this.setInterval);
    }
    setSlideItems(slides) {
        if (this.hasSlides) {
            this.slideContentTemplate ? this.createArrayForTemplate(slides) : this.createArrayFromSlides(slides);
        }
        else {
            this.slideItems = [];
            this.cancelInterval();
        }
    }
    startSlide() {
        this.setSlideHeight(this.height);
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = 0;
    }
    startInterval() {
        if (this.setInterval) {
            this.cancelInterval();
        }
        this.setInterval =
            this.hasSlides && this.hasElements
                ? setInterval(() => {
                    this.next();
                }, this.interval)
                : undefined;
    }
    animate(offset) {
        if (this.hasElements) {
            const animation = this.buildTransitionAnimation(offset);
            this.player = animation.create(this.slide.nativeElement);
            this.player.play();
        }
    }
    buildTransitionAnimation(offset) {
        return this.builder.build([animate(poSlideTiming, keyframes([style({ transform: `translateX(-${offset}px)` })]))]);
    }
    createArrayForTemplate(slides) {
        this.slideItems = [...slides];
    }
    createArrayFromSlides(slides) {
        const isStringArray = slides.every(item => typeof item === 'string');
        if (isStringArray) {
            slides.forEach(element => this.slideItems.push({ image: `${element}` }));
        }
        else {
            this.slideItems = [...slides];
        }
    }
    setDefaultHeight(height) {
        if ((height && height <= poSlideMinHeight) || (!height && this.isImageSlide)) {
            this.slide.nativeElement.style.height = `${poSlideDefaultHeight}px`;
            this.imageHeight = poSlideDefaultHeight;
        }
        else {
            this.imageHeight = undefined;
        }
    }
    setHeight(height) {
        if (height && height > poSlideMinHeight) {
            this.slide.nativeElement.style.height = `${height}px`;
            this.imageHeight = height;
        }
        else {
            this.setDefaultHeight(height);
        }
    }
    setSlideItemWidth() {
        if (this.hasElements) {
            this.slideItemWidth = this.itemsElements.first.itemElement.nativeElement.getBoundingClientRect().width;
        }
    }
    static ɵfac = function PoSlideComponent_Factory(t) { return new (t || PoSlideComponent)(i0.ɵɵdirectiveInject(i1.AnimationBuilder)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoSlideComponent, selectors: [["po-slide"]], contentQueries: function PoSlideComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
            i0.ɵɵcontentQuery(dirIndex, PoSlideContentTemplateDirective, 7);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.slideContentTemplate = _t.first);
        } }, viewQuery: function PoSlideComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(_c0, 7);
            i0.ɵɵviewQuery(PoSlideItemComponent, 5);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.slide = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.itemsElements = _t);
        } }, hostBindings: function PoSlideComponent_HostBindings(rf, ctx) { if (rf & 1) {
            i0.ɵɵlistener("resize", function PoSlideComponent_resize_HostBindingHandler() { return ctx.onResize(); }, false, i0.ɵɵresolveWindow);
        } }, features: [i0.ɵɵInheritDefinitionFeature, i0.ɵɵNgOnChangesFeature], decls: 8, vars: 4, consts: [[1, "po-slide-wrapper"], [1, "po-slide-outer"], [1, "po-slide-inner"], ["slide", ""], [4, "ngFor", "ngForOf"], ["p-control", "previous", 3, "p-click", 4, "ngIf"], ["p-control", "next", 3, "p-click", 4, "ngIf"], [3, "p-current-slide-index", "p-items", "p-click", 4, "ngIf"], [3, "p-action", "p-data", "p-image", "p-image-height", "p-template", "p-alt", "p-link"], ["p-control", "previous", 3, "p-click"], ["p-control", "next", 3, "p-click"], [3, "p-current-slide-index", "p-items", "p-click"]], template: function PoSlideComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵelementStart(0, "div", 0)(1, "div", 1)(2, "div", 2, 3);
            i0.ɵɵtemplate(4, PoSlideComponent_ng_container_4_Template, 2, 7, "ng-container", 4);
            i0.ɵɵelementEnd();
            i0.ɵɵtemplate(5, PoSlideComponent_po_slide_control_5_Template, 1, 0, "po-slide-control", 5)(6, PoSlideComponent_po_slide_control_6_Template, 1, 0, "po-slide-control", 6);
            i0.ɵɵelementEnd();
            i0.ɵɵtemplate(7, PoSlideComponent_po_slide_circles_7_Template, 1, 2, "po-slide-circles", 7);
            i0.ɵɵelementEnd();
        } if (rf & 2) {
            i0.ɵɵadvance(4);
            i0.ɵɵproperty("ngForOf", ctx.slideItems);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", !ctx.hideArrows && ctx.hasSlides && ctx.slides.length > 1);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", !ctx.hideArrows && ctx.hasSlides && ctx.slides.length > 1);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.hasSlides && ctx.slides.length > 1);
        } }, dependencies: [i2.NgForOf, i2.NgIf, i3.PoSlideCirclesComponent, i4.PoSlideControlComponent, i5.PoSlideItemComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoSlideComponent, [{
        type: Component,
        args: [{ selector: 'po-slide', template: "<div class=\"po-slide-wrapper\">\n  <div class=\"po-slide-outer\">\n    <div class=\"po-slide-inner\" #slide>\n      <ng-container *ngFor=\"let item of slideItems; let index = index\">\n        <po-slide-item\n          [p-action]=\"item.action\"\n          [p-data]=\"item\"\n          [p-image]=\"item.image\"\n          [p-image-height]=\"imageHeight\"\n          [p-template]=\"slideContentTemplate\"\n          [p-alt]=\"item.alt\"\n          [p-link]=\"item.link\"\n        >\n        </po-slide-item>\n      </ng-container>\n    </div>\n\n    <po-slide-control\n      *ngIf=\"!hideArrows && hasSlides && slides.length > 1\"\n      p-control=\"previous\"\n      (p-click)=\"previousControl()\"\n    >\n    </po-slide-control>\n\n    <po-slide-control *ngIf=\"!hideArrows && hasSlides && slides.length > 1\" p-control=\"next\" (p-click)=\"nextControl()\">\n    </po-slide-control>\n  </div>\n\n  <po-slide-circles\n    *ngIf=\"hasSlides && slides.length > 1\"\n    [p-current-slide-index]=\"currentSlideIndex\"\n    [p-items]=\"slideItems\"\n    (p-click)=\"goToItem($event)\"\n  >\n  </po-slide-circles>\n</div>\n" }]
    }], () => [{ type: i1.AnimationBuilder }], { slideContentTemplate: [{
            type: ContentChild,
            args: [PoSlideContentTemplateDirective, { static: true }]
        }], slide: [{
            type: ViewChild,
            args: ['slide', { static: true }]
        }], itemsElements: [{
            type: ViewChildren,
            args: [PoSlideItemComponent]
        }], onResize: [{
            type: HostListener,
            args: ['window:resize']
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoSlideComponent, { className: "PoSlideComponent", filePath: "lib/components/po-slide/po-slide.component.ts", lineNumber: 64 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tc2xpZGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLXNsaWRlL3BvLXNsaWRlLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1zbGlkZS9wby1zbGlkZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFHWixZQUFZLEVBRVosU0FBUyxFQUNULFlBQVksRUFLYixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsT0FBTyxFQUF1RCxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFckgsT0FBTyxFQUFnQixPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTlDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBRW5HLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDOzs7Ozs7Ozs7SUNwQnpFLDZCQUFpRTtJQUMvRCxtQ0FTZ0I7SUFDbEIsMEJBQWU7Ozs7SUFUWCxjQUF3QjtJQUF4Qix5Q0FBd0IsbUJBQUEsMEJBQUEsc0NBQUEsMkNBQUEsc0JBQUEsd0JBQUE7Ozs7SUFZOUIsMkNBSUM7SUFEQyx3TEFBVyxlQUFBLHdCQUFpQixDQUFBLElBQUM7SUFFL0IsaUJBQW1COzs7O0lBRW5CLDRDQUFtSDtJQUExQix5TEFBVyxlQUFBLG9CQUFhLENBQUEsSUFBQztJQUNsSCxpQkFBbUI7Ozs7SUFHckIsNENBS0M7SUFEQyxnTUFBVyxlQUFBLHdCQUFnQixDQUFB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QztTQUN4RztJQUNILENBQUM7MEVBalBVLGdCQUFnQjs2REFBaEIsZ0JBQWdCO3dDQUNiLCtCQUErQjs7Ozs7OzJCQUsvQixvQkFBb0I7Ozs7OzttR0FOdkIsY0FBVTs7WUMvRHZCLDhCQUE4QixhQUFBLGdCQUFBO1lBR3hCLG1GQVdlO1lBQ2pCLGlCQUFNO1lBRU4sMkZBS21CLDhFQUFBO1lBSXJCLGlCQUFNO1lBRU4sMkZBTW1CO1lBQ3JCLGlCQUFNOztZQWhDK0IsZUFBZTtZQUFmLHdDQUFlO1lBZTdDLGNBQW1EO1lBQW5ELGdGQUFtRDtZQU1uQyxjQUFtRDtZQUFuRCxnRkFBbUQ7WUFLckUsY0FBb0M7WUFBcEMsNkRBQW9DOzs7aUZEa0M1QixnQkFBZ0I7Y0FKNUIsU0FBUzsyQkFDRSxVQUFVO2lEQUtwQixvQkFBb0I7a0JBRG5CLFlBQVk7bUJBQUMsK0JBQStCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO1lBR2pCLEtBQUs7a0JBQWxELFNBQVM7bUJBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtZQUVRLGFBQWE7a0JBQXhELFlBQVk7bUJBQUMsb0JBQW9CO1lBaUNILFFBQVE7a0JBQXRDLFlBQVk7bUJBQUMsZUFBZTs7a0ZBdkNsQixnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgRG9DaGVjayxcbiAgRWxlbWVudFJlZixcbiAgSG9zdExpc3RlbmVyLFxuICBRdWVyeUxpc3QsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NoaWxkcmVuLFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBhbmltYXRlLCBBbmltYXRpb25CdWlsZGVyLCBBbmltYXRpb25GYWN0b3J5LCBBbmltYXRpb25QbGF5ZXIsIGtleWZyYW1lcywgc3R5bGUgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcblxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IFBvU2xpZGVCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby1zbGlkZS1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb1NsaWRlQ29udGVudFRlbXBsYXRlRGlyZWN0aXZlIH0gZnJvbSAnLi9kaXJlY3RpdmVzL3BvLXNsaWRlLWNvbnRlbnQtdGVtcGxhdGUuZGlyZWN0aXZlJztcbmltcG9ydCB7IFBvU2xpZGVJdGVtIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLXNsaWRlLWl0ZW0uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvU2xpZGVJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi9wby1zbGlkZS1pdGVtL3BvLXNsaWRlLWl0ZW0uY29tcG9uZW50JztcblxuY29uc3QgcG9TbGlkZURlZmF1bHRIZWlnaHQgPSAzMzY7XG5jb25zdCBwb1NsaWRlSW50ZXJ2YWxNaW4gPSAxMDAwO1xuY29uc3QgcG9TbGlkZU1pbkhlaWdodCA9IDE5MjtcbmNvbnN0IHBvU2xpZGVUaW1pbmcgPSAnMjUwbXMgZWFzZSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvU2xpZGVCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1zbGlkZS1iYXNpY1wiIHRpdGxlPVwiUE8gU2xpZGUgQmFzaWNcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zbGlkZS1iYXNpYy9zYW1wbGUtcG8tc2xpZGUtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWJhc2ljL3NhbXBsZS1wby1zbGlkZS1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1zbGlkZS1sYWJzXCIgdGl0bGU9XCJQTyBTbGlkZSBMYWJzXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtbGFicy9zYW1wbGUtcG8tc2xpZGUtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtbGFicy9zYW1wbGUtcG8tc2xpZGUtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1zbGlkZS11c2VmdWwtYXJ0aWNsZXNcIiB0aXRsZT1cIlBPIFNsaWRlIC0gVXNlZnVsIGFydGljbGVzXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtdXNlZnVsLWFydGljbGVzL3NhbXBsZS1wby1zbGlkZS11c2VmdWwtYXJ0aWNsZXMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLXVzZWZ1bC1hcnRpY2xlcy9zYW1wbGUtcG8tc2xpZGUtdXNlZnVsLWFydGljbGVzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXNsaWRlLWxhbmRzY2FwZXNcIiB0aXRsZT1cIlBPIFNsaWRlIC0gTGFuZHNjYXBlc1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWxhbmRzY2FwZXMvc2FtcGxlLXBvLXNsaWRlLWxhbmRzY2FwZXMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWxhbmRzY2FwZXMvc2FtcGxlLXBvLXNsaWRlLWxhbmRzY2FwZXMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tc2xpZGUtZXh0ZXJuYWwtY29udHJvbHNcIiB0aXRsZT1cIlBPIFNsaWRlIC0gRXh0ZXJuYWwgQ29udHJvbHNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWV4dGVybmFsLWNvbnRyb2xzL3NhbXBsZS1wby1zbGlkZS1leHRlcm5hbC1jb250cm9scy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zbGlkZS1leHRlcm5hbC1jb250cm9scy9zYW1wbGUtcG8tc2xpZGUtZXh0ZXJuYWwtY29udHJvbHMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tc2xpZGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tc2xpZGUuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvU2xpZGVDb21wb25lbnQgZXh0ZW5kcyBQb1NsaWRlQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgRG9DaGVjaywgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICBAQ29udGVudENoaWxkKFBvU2xpZGVDb250ZW50VGVtcGxhdGVEaXJlY3RpdmUsIHsgc3RhdGljOiB0cnVlIH0pXG4gIHNsaWRlQ29udGVudFRlbXBsYXRlOiBQb1NsaWRlQ29udGVudFRlbXBsYXRlRGlyZWN0aXZlO1xuXG4gIEBWaWV3Q2hpbGQoJ3NsaWRlJywgeyBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBzbGlkZTogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkcmVuKFBvU2xpZGVJdGVtQ29tcG9uZW50KSBwcml2YXRlIGl0ZW1zRWxlbWVudHM6IFF1ZXJ5TGlzdDxQb1NsaWRlSXRlbUNvbXBvbmVudD47XG5cbiAgY3VycmVudFNsaWRlSW5kZXggPSAwO1xuICBpbWFnZUhlaWdodDogbnVtYmVyO1xuICBzbGlkZUl0ZW1zOiBBcnJheTxQb1NsaWRlSXRlbSB8IGFueT4gPSBbXTtcbiAgc2xpZGVJdGVtV2lkdGg6IG51bWJlcjtcblxuICBwcml2YXRlIGlzTG9hZGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgcGxheWVyOiBBbmltYXRpb25QbGF5ZXI7XG4gIHByaXZhdGUgc2V0SW50ZXJ2YWw6IGFueTtcbiAgcHJpdmF0ZSByZXNpemUkID0gbmV3IFN1YmplY3Q8YW55PigpO1xuICBwcml2YXRlIHJlc2l6ZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIHByaXZhdGUgZ2V0IGhhc0VsZW1lbnRzKCkge1xuICAgIHJldHVybiAhIXRoaXMuc2xpZGUubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCAmJiAhIXRoaXMuaXRlbXNFbGVtZW50cyAmJiAhIXRoaXMuaXRlbXNFbGVtZW50cy5sZW5ndGg7XG4gIH1cblxuICBwcml2YXRlIGdldCBpc0ltYWdlU2xpZGUoKSB7XG4gICAgcmV0dXJuICF0aGlzLnNsaWRlQ29udGVudFRlbXBsYXRlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgb2Zmc2V0KCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ICogdGhpcy5zbGlkZUl0ZW1XaWR0aDtcbiAgfVxuXG4gIGdldCBoYXNTbGlkZXMoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5zbGlkZXMgJiYgISF0aGlzLnNsaWRlcy5sZW5ndGg7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJ1aWxkZXI6IEFuaW1hdGlvbkJ1aWxkZXIpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScpIG9uUmVzaXplKCkge1xuICAgIHRoaXMucmVzaXplJC5uZXh0KHt9KTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucmVzaXplU3Vic2NyaXB0aW9uID0gdGhpcy5yZXNpemUkLnBpcGUoZGVib3VuY2VUaW1lKDE1MCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLnNldFNsaWRlSXRlbVdpZHRoKCk7XG4gICAgICB0aGlzLmdvVG9JdGVtKHRoaXMuY3VycmVudFNsaWRlSW5kZXgpO1xuICAgIH0pO1xuICB9XG5cbiAgbmdEb0NoZWNrKCkge1xuICAgIGlmICghdGhpcy5pc0xvYWRlZCAmJiB0aGlzLmhhc0VsZW1lbnRzKSB7XG4gICAgICB0aGlzLnNldFNsaWRlSXRlbVdpZHRoKCk7XG4gICAgICB0aGlzLmlzTG9hZGVkID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMuaGFzU2xpZGVzKSB7XG4gICAgICAgIHRoaXMuc3RhcnRTbGlkZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlcy5oZWlnaHQpIHtcbiAgICAgIHRoaXMuc2V0U2xpZGVIZWlnaHQodGhpcy5oZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMucmVzaXplU3Vic2NyaXB0aW9uPy51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIE3DqXRvZG8gcXVlIHJldG9ybmEgbyBpbmRleCBkbyBzbGlkZSBhdHVhbFxuICAgKlxuICAgKiBgYGBcbiAgICogQFZpZXdDaGlsZCgnc2xpZGVDb21wb25lbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBzbGlkZUNvbXBvbmVudDogUG9TbGlkZUNvbXBvbmVudDtcbiAgICogIG15RnVuY3Rpb24oKSB7XG4gICAqICAgIGxldCBjdXJyZW50SW5kZXggPSB0aGlzLnNsaWRlQ29tcG9uZW50LmdldEN1cnJlbnRTbGlkZUluZGV4KCk7XG4gICAqIH1cbiAgICpcbiAgICogYGBgXG4gICAqL1xuICBnZXRDdXJyZW50U2xpZGVJbmRleCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRTbGlkZUluZGV4O1xuICB9XG5cbiAgZ29Ub0l0ZW0oaW5kZXg6IG51bWJlcikge1xuICAgIGlmICh0aGlzLmludGVydmFsID4gcG9TbGlkZUludGVydmFsTWluKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID0gaW5kZXg7XG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIG5leHRDb250cm9sKCkge1xuICAgIGlmICh0aGlzLmludGVydmFsID4gcG9TbGlkZUludGVydmFsTWluKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLm5leHQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNw6l0b2RvIHBhcmEgY2hhbWFyIG8gcHLDs3hpbW8gc2xpZGUuXG4gICAqXG4gICAqIGBgYFxuICAgKiBAVmlld0NoaWxkKCdzbGlkZUNvbXBvbmVudCcsIHsgc3RhdGljOiB0cnVlIH0pIHNsaWRlQ29tcG9uZW50OiBQb1NsaWRlQ29tcG9uZW50O1xuICAgKlxuICAgKiBteUZ1bmN0aW9uKCkge1xuICAgKiAgdGhpcy5zbGlkZUNvbXBvbmVudC5uZXh0KCk7XG4gICAqIH1cbiAgICogYGBgXG4gICAqL1xuICBuZXh0KCkge1xuICAgIGlmICh0aGlzLmN1cnJlbnRTbGlkZUluZGV4ICsgMSA9PT0gdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aCkge1xuICAgICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IDA7XG4gICAgICB0aGlzLmFuaW1hdGUoMCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAodGhpcy5jdXJyZW50U2xpZGVJbmRleCArIDEpICUgdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aDtcbiAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICB9XG4gIC8qKlxuICAgKiBNw6l0b2RvIHBhcmEgY2hhbWFyIG8gc2xpZGUgYW50ZXJpb3IuXG4gICAqXG4gICAqIGBgYFxuICAgKiBAVmlld0NoaWxkKCdzbGlkZUNvbXBvbmVudCcsIHsgc3RhdGljOiB0cnVlIH0pIHNsaWRlQ29tcG9uZW50OiBQb1NsaWRlQ29tcG9uZW50O1xuICAgKlxuICAgKiBteUZ1bmN0aW9uKCkge1xuICAgKiAgdGhpcy5zbGlkZUNvbXBvbmVudC5wcmV2aW91cygpO1xuICAgKiB9XG4gICAqIGBgYFxuICAgKi9cbiAgcHJldmlvdXMoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFNsaWRlSW5kZXggPT09IDApIHtcbiAgICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoIC0gMTtcbiAgICAgIHRoaXMuYW5pbWF0ZSh0aGlzLm9mZnNldCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAodGhpcy5jdXJyZW50U2xpZGVJbmRleCAtIDEgKyB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoKSAlIHRoaXMuc2xpZGVJdGVtcy5sZW5ndGg7XG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIHByZXZpb3VzQ29udHJvbCgpIHtcbiAgICBpZiAodGhpcy5pbnRlcnZhbCA+IHBvU2xpZGVJbnRlcnZhbE1pbikge1xuICAgICAgdGhpcy5zdGFydEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5wcmV2aW91cygpO1xuICB9XG5cbiAgc2V0U2xpZGVIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcbiAgICB0aGlzLnNldEhlaWdodChoZWlnaHQpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNhbmNlbEludGVydmFsKCkge1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5zZXRJbnRlcnZhbCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0U2xpZGVJdGVtcyhzbGlkZXM6IEFycmF5PFBvU2xpZGVJdGVtIHwgc3RyaW5nIHwgYW55Pikge1xuICAgIGlmICh0aGlzLmhhc1NsaWRlcykge1xuICAgICAgdGhpcy5zbGlkZUNvbnRlbnRUZW1wbGF0ZSA/IHRoaXMuY3JlYXRlQXJyYXlGb3JUZW1wbGF0ZShzbGlkZXMpIDogdGhpcy5jcmVhdGVBcnJheUZyb21TbGlkZXMoc2xpZGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zbGlkZUl0ZW1zID0gW107XG4gICAgICB0aGlzLmNhbmNlbEludGVydmFsKCk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHN0YXJ0U2xpZGUoKSB7XG4gICAgdGhpcy5zZXRTbGlkZUhlaWdodCh0aGlzLmhlaWdodCk7XG5cbiAgICBpZiAodGhpcy5pbnRlcnZhbCA+IHBvU2xpZGVJbnRlcnZhbE1pbikge1xuICAgICAgdGhpcy5zdGFydEludGVydmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IDA7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3RhcnRJbnRlcnZhbCgpIHtcbiAgICBpZiAodGhpcy5zZXRJbnRlcnZhbCkge1xuICAgICAgdGhpcy5jYW5jZWxJbnRlcnZhbCgpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0SW50ZXJ2YWwgPVxuICAgICAgdGhpcy5oYXNTbGlkZXMgJiYgdGhpcy5oYXNFbGVtZW50c1xuICAgICAgICA/IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgICAgIH0sIHRoaXMuaW50ZXJ2YWwpXG4gICAgICAgIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgcHJpdmF0ZSBhbmltYXRlKG9mZnNldDogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMuaGFzRWxlbWVudHMpIHtcbiAgICAgIGNvbnN0IGFuaW1hdGlvbjogQW5pbWF0aW9uRmFjdG9yeSA9IHRoaXMuYnVpbGRUcmFuc2l0aW9uQW5pbWF0aW9uKG9mZnNldCk7XG5cbiAgICAgIHRoaXMucGxheWVyID0gYW5pbWF0aW9uLmNyZWF0ZSh0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgdGhpcy5wbGF5ZXIucGxheSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRUcmFuc2l0aW9uQW5pbWF0aW9uKG9mZnNldDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuYnVpbGRlci5idWlsZChbYW5pbWF0ZShwb1NsaWRlVGltaW5nLCBrZXlmcmFtZXMoW3N0eWxlKHsgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWCgtJHtvZmZzZXR9cHgpYCB9KV0pKV0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcnJheUZvclRlbXBsYXRlKHNsaWRlczogQXJyYXk8YW55Pikge1xuICAgIHRoaXMuc2xpZGVJdGVtcyA9IFsuLi5zbGlkZXNdO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcnJheUZyb21TbGlkZXMoc2xpZGVzOiBBcnJheTxQb1NsaWRlSXRlbSB8IHN0cmluZyB8IGFueT4pIHtcbiAgICBjb25zdCBpc1N0cmluZ0FycmF5ID0gc2xpZGVzLmV2ZXJ5KGl0ZW0gPT4gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKTtcblxuICAgIGlmIChpc1N0cmluZ0FycmF5KSB7XG4gICAgICBzbGlkZXMuZm9yRWFjaChlbGVtZW50ID0+IHRoaXMuc2xpZGVJdGVtcy5wdXNoKHsgaW1hZ2U6IGAke2VsZW1lbnR9YCB9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2xpZGVJdGVtcyA9IFsuLi4oPEFycmF5PFBvU2xpZGVJdGVtPj5zbGlkZXMpXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldERlZmF1bHRIZWlnaHQoaGVpZ2h0OiBudW1iZXIpIHtcbiAgICBpZiAoKGhlaWdodCAmJiBoZWlnaHQgPD0gcG9TbGlkZU1pbkhlaWdodCkgfHwgKCFoZWlnaHQgJiYgdGhpcy5pc0ltYWdlU2xpZGUpKSB7XG4gICAgICB0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7cG9TbGlkZURlZmF1bHRIZWlnaHR9cHhgO1xuICAgICAgdGhpcy5pbWFnZUhlaWdodCA9IHBvU2xpZGVEZWZhdWx0SGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmltYWdlSGVpZ2h0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0SGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgaWYgKGhlaWdodCAmJiBoZWlnaHQgPiBwb1NsaWRlTWluSGVpZ2h0KSB7XG4gICAgICB0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDtcbiAgICAgIHRoaXMuaW1hZ2VIZWlnaHQgPSBoZWlnaHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0RGVmYXVsdEhlaWdodChoZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0U2xpZGVJdGVtV2lkdGgoKSB7XG4gICAgaWYgKHRoaXMuaGFzRWxlbWVudHMpIHtcbiAgICAgIHRoaXMuc2xpZGVJdGVtV2lkdGggPSB0aGlzLml0ZW1zRWxlbWVudHMuZmlyc3QuaXRlbUVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICB9XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJwby1zbGlkZS13cmFwcGVyXCI+XG4gIDxkaXYgY2xhc3M9XCJwby1zbGlkZS1vdXRlclwiPlxuICAgIDxkaXYgY2xhc3M9XCJwby1zbGlkZS1pbm5lclwiICNzbGlkZT5cbiAgICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGl0ZW0gb2Ygc2xpZGVJdGVtczsgbGV0IGluZGV4ID0gaW5kZXhcIj5cbiAgICAgICAgPHBvLXNsaWRlLWl0ZW1cbiAgICAgICAgICBbcC1hY3Rpb25dPVwiaXRlbS5hY3Rpb25cIlxuICAgICAgICAgIFtwLWRhdGFdPVwiaXRlbVwiXG4gICAgICAgICAgW3AtaW1hZ2VdPVwiaXRlbS5pbWFnZVwiXG4gICAgICAgICAgW3AtaW1hZ2UtaGVpZ2h0XT1cImltYWdlSGVpZ2h0XCJcbiAgICAgICAgICBbcC10ZW1wbGF0ZV09XCJzbGlkZUNvbnRlbnRUZW1wbGF0ZVwiXG4gICAgICAgICAgW3AtYWx0XT1cIml0ZW0uYWx0XCJcbiAgICAgICAgICBbcC1saW5rXT1cIml0ZW0ubGlua1wiXG4gICAgICAgID5cbiAgICAgICAgPC9wby1zbGlkZS1pdGVtPlxuICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgPC9kaXY+XG5cbiAgICA8cG8tc2xpZGUtY29udHJvbFxuICAgICAgKm5nSWY9XCIhaGlkZUFycm93cyAmJiBoYXNTbGlkZXMgJiYgc2xpZGVzLmxlbmd0aCA+IDFcIlxuICAgICAgcC1jb250cm9sPVwicHJldmlvdXNcIlxuICAgICAgKHAtY2xpY2spPVwicHJldmlvdXNDb250cm9sKClcIlxuICAgID5cbiAgICA8L3BvLXNsaWRlLWNvbnRyb2w+XG5cbiAgICA8cG8tc2xpZGUtY29udHJvbCAqbmdJZj1cIiFoaWRlQXJyb3dzICYmIGhhc1NsaWRlcyAmJiBzbGlkZXMubGVuZ3RoID4gMVwiIHAtY29udHJvbD1cIm5leHRcIiAocC1jbGljayk9XCJuZXh0Q29udHJvbCgpXCI+XG4gICAgPC9wby1zbGlkZS1jb250cm9sPlxuICA8L2Rpdj5cblxuICA8cG8tc2xpZGUtY2lyY2xlc1xuICAgICpuZ0lmPVwiaGFzU2xpZGVzICYmIHNsaWRlcy5sZW5ndGggPiAxXCJcbiAgICBbcC1jdXJyZW50LXNsaWRlLWluZGV4XT1cImN1cnJlbnRTbGlkZUluZGV4XCJcbiAgICBbcC1pdGVtc109XCJzbGlkZUl0ZW1zXCJcbiAgICAocC1jbGljayk9XCJnb1RvSXRlbSgkZXZlbnQpXCJcbiAgPlxuICA8L3BvLXNsaWRlLWNpcmNsZXM+XG48L2Rpdj5cbiJdfQ==