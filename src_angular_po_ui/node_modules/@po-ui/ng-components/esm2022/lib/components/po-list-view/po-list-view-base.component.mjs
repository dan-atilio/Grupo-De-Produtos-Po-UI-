import { EventEmitter, Input, Output, Directive } from '@angular/core';
import { convertToBoolean } from '../../utils/util';
import { poLocaleDefault } from '../../services/po-language/po-language.constant';
import * as i0 from "@angular/core";
import * as i1 from "../../services/po-language/po-language.service";
export const poListViewLiteralsDefault = {
    en: {
        hideDetails: 'Hide details',
        loadMoreData: 'Load more data',
        noData: 'No data found',
        selectAll: 'Select all',
        showDetails: 'Show details'
    },
    es: {
        hideDetails: 'Ocultar detalles',
        loadMoreData: 'Cargar más resultados',
        noData: 'Datos no encontrados',
        selectAll: 'Seleccionar todos',
        showDetails: 'Mostrar detalles'
    },
    pt: {
        hideDetails: 'Ocultar detalhes',
        loadMoreData: 'Carregar mais resultados',
        noData: 'Nenhum dado encontrado',
        selectAll: 'Selecionar todos',
        showDetails: 'Exibir detalhes'
    },
    ru: {
        hideDetails: 'Скрыть детали',
        loadMoreData: 'Загрузить больше результатов',
        noData: 'Данные не найдены',
        selectAll: 'Выбрать все',
        showDetails: 'Посмотреть детали'
    }
};
/**
 * @description
 *
 * Componente de lista que recebe um array de objetos e renderiza de forma dinâmica os dados de
 * acordo com a necessidade de cada tela e deve ser utilizado em conjunto com as diretivas de *templates*
 *  **[p-list-view-content-template](/documentation/po-list-view-content-template)** e
 * **[p-list-view-detail-template](/documentation/po-list-view-detail-template)**.
 *
 * O componente disponibiliza uma área específica para exibição informações adicionais,
 * através da diretiva **[p-list-view-detail-template](/documentation/po-list-view-detail-template)**.
 */
export class PoListViewBaseComponent {
    /** Recebe uma propriedade que será utilizada para recuperar o valor do objeto que será usado como link para o título. */
    propertyLink;
    /** Recebe uma propriedade que será utilizada para recuperar o valor do objeto que será exibido como o título de cada item. */
    propertyTitle;
    /**
     * @optional
     *
     * @description
     *
     * Recebe uma ação, que será executada quando clicar no botão "Carregar mais resultados".
     *
     * > Caso nenhuma ação for definida o mesmo não ficará visível.
     */
    showMore = new EventEmitter();
    /**
     * @optional
     *
     * @description
     *
     * Ação que será executada ao clicar no título.
     *
     * Ao ser disparado, o método inserido na ação irá receber como parâmetro o item da lista clicado.
     */
    titleAction = new EventEmitter();
    /**
     * @optional
     *
     * @description
     *
     * Ação que será executada ao clicar no botão exibir detalhes.
     *
     * Ao ser disparado, o método passa como parâmetros os detalhes que serão exibidos.
     */
    showDetail = new EventEmitter();
    popupTarget;
    selectAll = false;
    showHeader = false;
    _actions;
    _height;
    _hideSelectAll;
    _items;
    _literals;
    _select;
    _showMoreDisabled;
    language = poLocaleDefault;
    /**
     * @optional
     *
     * @description
     *
     * Lista de ações que serão exibidas no componente.
     */
    set actions(value) {
        this._actions = Array.isArray(value) ? value : [];
    }
    get actions() {
        return this._actions;
    }
    /**
     * @optional
     *
     * @description
     *
     * Define a altura do `po-list-view` em *pixels*.
     */
    set height(height) {
        this._height = height;
    }
    get height() {
        return this._height;
    }
    /**
     * @description
     *
     * Esconde o *checkbox* para seleção de todos os itens.
     *
     * @default `false`
     */
    set hideSelectAll(hideSelectAll) {
        this._hideSelectAll = convertToBoolean(hideSelectAll);
        this.showMainHeader();
    }
    get hideSelectAll() {
        return this._hideSelectAll;
    }
    /** Lista de itens que serão exibidos no componente. */
    set items(value) {
        this._items = Array.isArray(value) ? value : [];
    }
    get items() {
        return this._items;
    }
    /**
     * @optional
     *
     * @description
     *
     * Objeto com as literais usadas no `po-list-view`.
     *
     * Existem duas maneiras de customizar o componente, passando um objeto com todas as literais disponíveis:
     *
     * ```
     *  const customLiterals: PoListViewLiterals = {
     *    hideDetail: 'Ocultar detalhes completamente',
     *    loadMoreData: 'Mais dados',
     *    showDetail: 'Mostrar mais detalhes',
     *    selectAll: 'Selecionar todos os itens'
     *  };
     * ```
     *
     * Ou passando apenas as literais que deseja customizar:
     *
     * ```
     *  const customLiterals: PoListViewLiterals = {
     *    showDetail: 'Mostrar mais detalhes'
     *  };
     * ```
     *
     * E para carregar as literais customizadas, basta apenas passar o objeto para o componente.
     *
     * ```
     * <po-list-view
     *   [p-literals]="customLiterals">
     * </po-list-view>
     * ```
     *
     * > O objeto padrão de literais será traduzido de acordo com o idioma do
     * [`PoI18nService`](/documentation/po-i18n) ou do browser.
     */
    set literals(value) {
        if (value instanceof Object && !(value instanceof Array)) {
            this._literals = {
                ...poListViewLiteralsDefault[poLocaleDefault],
                ...poListViewLiteralsDefault[this.language],
                ...value
            };
        }
        else {
            this._literals = poListViewLiteralsDefault[this.language];
        }
    }
    get literals() {
        return this._literals || poListViewLiteralsDefault[this.language];
    }
    /**
     * @optional
     *
     * @description
     *
     * Habilita um *checkbox* para cada item da lista. Todos os items possuem a propriedade dinâmica `$selected` para identificar se o
     * item está selecionado, por exemplo:
     *
     * ```
     *  item.$selected
     *
     *  // ou
     *
     *  item['$selected']
     * ```
     *
     * @default `false`
     */
    set select(select) {
        this._select = convertToBoolean(select);
        this.showMainHeader();
    }
    get select() {
        return this._select;
    }
    /**
     * @optional
     *
     * @description
     *
     * Indica que o botão `Carregar Mais Resultados` será desabilitado.
     */
    set showMoreDisabled(value) {
        this._showMoreDisabled = convertToBoolean(value);
    }
    get showMoreDisabled() {
        return this._showMoreDisabled;
    }
    constructor(languageService) {
        this.language = languageService.getShortLanguage();
    }
    onClickAction(listViewAction, item) {
        const cleanItem = this.deleteInternalAttrs(item);
        if (listViewAction.action) {
            listViewAction.action(cleanItem);
        }
    }
    onShowMore() {
        this.showMore.emit();
    }
    runTitleAction(listItem) {
        const itemWithPublicProperties = this.deleteInternalAttrs(listItem);
        this.titleAction.emit(itemWithPublicProperties);
    }
    selectAllListItems() {
        if (!this.hideSelectAll) {
            this.selectAll = !this.selectAll;
            this.items.forEach(item => {
                item.$selected = this.selectAll;
            });
        }
    }
    selectListItem(row) {
        row.$selected = !row.$selected;
        this.selectAll = this.checkIfItemsAreSelected(this.items);
    }
    deleteInternalAttrs(item) {
        const itemCopy = item ? { ...item } : undefined;
        for (const key in itemCopy) {
            if (itemCopy.hasOwnProperty(key) && key.startsWith('$')) {
                delete itemCopy[key];
            }
        }
        return itemCopy;
    }
    checkIfItemsAreSelected(items) {
        const someCheckedOrIndeterminate = item => item.$selected || item.$selected === null;
        const everyChecked = item => item.$selected;
        if (items.every(everyChecked)) {
            return true;
        }
        if (items.some(someCheckedOrIndeterminate)) {
            return null;
        }
        return false;
    }
    showMainHeader() {
        this.showHeader = !!(this.select && !this.hideSelectAll && this.items && this.items.length);
    }
    static ɵfac = function PoListViewBaseComponent_Factory(t) { return new (t || PoListViewBaseComponent)(i0.ɵɵdirectiveInject(i1.PoLanguageService)); };
    static ɵdir = /*@__PURE__*/ i0.ɵɵdefineDirective({ type: PoListViewBaseComponent, inputs: { propertyLink: [i0.ɵɵInputFlags.None, "p-property-link", "propertyLink"], propertyTitle: [i0.ɵɵInputFlags.None, "p-property-title", "propertyTitle"], actions: [i0.ɵɵInputFlags.None, "p-actions", "actions"], height: [i0.ɵɵInputFlags.None, "p-height", "height"], hideSelectAll: [i0.ɵɵInputFlags.None, "p-hide-select-all", "hideSelectAll"], items: [i0.ɵɵInputFlags.None, "p-items", "items"], literals: [i0.ɵɵInputFlags.None, "p-literals", "literals"], select: [i0.ɵɵInputFlags.None, "p-select", "select"], showMoreDisabled: [i0.ɵɵInputFlags.None, "p-show-more-disabled", "showMoreDisabled"] }, outputs: { showMore: "p-show-more", titleAction: "p-title-action", showDetail: "p-show-detail" } });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoListViewBaseComponent, [{
        type: Directive
    }], () => [{ type: i1.PoLanguageService }], { propertyLink: [{
            type: Input,
            args: ['p-property-link']
        }], propertyTitle: [{
            type: Input,
            args: ['p-property-title']
        }], showMore: [{
            type: Output,
            args: ['p-show-more']
        }], titleAction: [{
            type: Output,
            args: ['p-title-action']
        }], showDetail: [{
            type: Output,
            args: ['p-show-detail']
        }], actions: [{
            type: Input,
            args: ['p-actions']
        }], height: [{
            type: Input,
            args: ['p-height']
        }], hideSelectAll: [{
            type: Input,
            args: ['p-hide-select-all']
        }], items: [{
            type: Input,
            args: ['p-items']
        }], literals: [{
            type: Input,
            args: ['p-literals']
        }], select: [{
            type: Input,
            args: ['p-select']
        }], showMoreDisabled: [{
            type: Input,
            args: ['p-show-more-disabled']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbGlzdC12aWV3LWJhc2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLWxpc3Qtdmlldy9wby1saXN0LXZpZXctYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVwRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0saURBQWlELENBQUM7OztBQUlsRixNQUFNLENBQUMsTUFBTSx5QkFBeUIsR0FBRztJQUN2QyxFQUFFLEVBQXNCO1FBQ3RCLFdBQVcsRUFBRSxjQUFjO1FBQzNCLFlBQVksRUFBRSxnQkFBZ0I7UUFDOUIsTUFBTSxFQUFFLGVBQWU7UUFDdkIsU0FBUyxFQUFFLFlBQVk7UUFDdkIsV0FBVyxFQUFFLGNBQWM7S0FDNUI7SUFDRCxFQUFFLEVBQXNCO1FBQ3RCLFdBQVcsRUFBRSxrQkFBa0I7UUFDL0IsWUFBWSxFQUFFLHVCQUF1QjtRQUNyQyxNQUFNLEVBQUUsc0JBQXNCO1FBQzlCLFNBQVMsRUFBRSxtQkFBbUI7UUFDOUIsV0FBVyxFQUFFLGtCQUFrQjtLQUNoQztJQUNELEVBQUUsRUFBc0I7UUFDdEIsV0FBVyxFQUFFLGtCQUFrQjtRQUMvQixZQUFZLEVBQUUsMEJBQTBCO1FBQ3hDLE1BQU0sRUFBRSx3QkFBd0I7UUFDaEMsU0FBUyxFQUFFLGtCQUFrQjtRQUM3QixXQUFXLEVBQUUsaUJBQWlCO0tBQy9CO0lBQ0QsRUFBRSxFQUFzQjtRQUN0QixXQUFXLEVBQUUsZUFBZTtRQUM1QixZQUFZLEVBQUUsOEJBQThCO1FBQzVDLE1BQU0sRUFBRSxtQkFBbUI7UUFDM0IsU0FBUyxFQUFFLGFBQWE7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QUVPLGNBQWM7UUFDcEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDOUYsQ0FBQztpRkE1UVUsdUJBQXVCOzZEQUF2Qix1QkFBdUI7O2lGQUF2Qix1QkFBdUI7Y0FEbkMsU0FBUztrREFHa0IsWUFBWTtrQkFBckMsS0FBSzttQkFBQyxpQkFBaUI7WUFHRyxhQUFhO2tCQUF2QyxLQUFLO21CQUFDLGtCQUFrQjtZQVdGLFFBQVE7a0JBQTlCLE1BQU07bUJBQUMsYUFBYTtZQVdLLFdBQVc7a0JBQXBDLE1BQU07bUJBQUMsZ0JBQWdCO1lBV0MsVUFBVTtrQkFBbEMsTUFBTTttQkFBQyxlQUFlO1lBc0JDLE9BQU87a0JBQTlCLEtBQUs7bUJBQUMsV0FBVztZQWVLLE1BQU07a0JBQTVCLEtBQUs7bUJBQUMsVUFBVTtZQWVlLGFBQWE7a0JBQTVDLEtBQUs7bUJBQUMsbUJBQW1CO1lBVUosS0FBSztrQkFBMUIsS0FBSzttQkFBQyxTQUFTO1lBNkNTLFFBQVE7a0JBQWhDLEtBQUs7bUJBQUMsWUFBWTtZQWtDSSxNQUFNO2tCQUE1QixLQUFLO21CQUFDLFVBQVU7WUFnQmtCLGdCQUFnQjtrQkFBbEQsS0FBSzttQkFBQyxzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIERpcmVjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBjb252ZXJ0VG9Cb29sZWFuIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgcG9Mb2NhbGVEZWZhdWx0IH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2UuY29uc3RhbnQnO1xuaW1wb3J0IHsgUG9MaXN0Vmlld0FjdGlvbiB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1saXN0LXZpZXctYWN0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0xpc3RWaWV3TGl0ZXJhbHMgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tbGlzdC12aWV3LWxpdGVyYWxzLmludGVyZmFjZSc7XG5cbmV4cG9ydCBjb25zdCBwb0xpc3RWaWV3TGl0ZXJhbHNEZWZhdWx0ID0ge1xuICBlbjogPFBvTGlzdFZpZXdMaXRlcmFscz57XG4gICAgaGlkZURldGFpbHM6ICdIaWRlIGRldGFpbHMnLFxuICAgIGxvYWRNb3JlRGF0YTogJ0xvYWQgbW9yZSBkYXRhJyxcbiAgICBub0RhdGE6ICdObyBkYXRhIGZvdW5kJyxcbiAgICBzZWxlY3RBbGw6ICdTZWxlY3QgYWxsJyxcbiAgICBzaG93RGV0YWlsczogJ1Nob3cgZGV0YWlscydcbiAgfSxcbiAgZXM6IDxQb0xpc3RWaWV3TGl0ZXJhbHM+e1xuICAgIGhpZGVEZXRhaWxzOiAnT2N1bHRhciBkZXRhbGxlcycsXG4gICAgbG9hZE1vcmVEYXRhOiAnQ2FyZ2FyIG3DoXMgcmVzdWx0YWRvcycsXG4gICAgbm9EYXRhOiAnRGF0b3Mgbm8gZW5jb250cmFkb3MnLFxuICAgIHNlbGVjdEFsbDogJ1NlbGVjY2lvbmFyIHRvZG9zJyxcbiAgICBzaG93RGV0YWlsczogJ01vc3RyYXIgZGV0YWxsZXMnXG4gIH0sXG4gIHB0OiA8UG9MaXN0Vmlld0xpdGVyYWxzPntcbiAgICBoaWRlRGV0YWlsczogJ09jdWx0YXIgZGV0YWxoZXMnLFxuICAgIGxvYWRNb3JlRGF0YTogJ0NhcnJlZ2FyIG1haXMgcmVzdWx0YWRvcycsXG4gICAgbm9EYXRhOiAnTmVuaHVtIGRhZG8gZW5jb250cmFkbycsXG4gICAgc2VsZWN0QWxsOiAnU2VsZWNpb25hciB0b2RvcycsXG4gICAgc2hvd0RldGFpbHM6ICdFeGliaXIgZGV0YWxoZXMnXG4gIH0sXG4gIHJ1OiA8UG9MaXN0Vmlld0xpdGVyYWxzPntcbiAgICBoaWRlRGV0YWlsczogJ9Ch0LrRgNGL0YLRjCDQtNC10YLQsNC70LgnLFxuICAgIGxvYWRNb3JlRGF0YTogJ9CX0LDQs9GA0YPQt9C40YLRjCDQsdC+0LvRjNGI0LUg0YDQtdC30YPQu9GM0YLQsNGC0L7QsicsXG4gICAgbm9EYXRhOiAn0JTQsNC90L3Ri9C1INC90LUg0L3QsNC50LTQtdC90YsnLFxuICAgIHNlbGVjdEFsbDogJ9CS0YvQsdGA0LDRgtGMINCy0YHQtScsXG4gICAgc2hvd0RldGFpbHM6ICfQn9C+0YHQvNC+0YLRgNC10YLRjCDQtNC10YLQsNC70LgnXG4gIH1cbn07XG5cbi8qKlxuICogQGRlc2NyaXB0aW9uXG4gKlxuICogQ29tcG9uZW50ZSBkZSBsaXN0YSBxdWUgcmVjZWJlIHVtIGFycmF5IGRlIG9iamV0b3MgZSByZW5kZXJpemEgZGUgZm9ybWEgZGluw6JtaWNhIG9zIGRhZG9zIGRlXG4gKiBhY29yZG8gY29tIGEgbmVjZXNzaWRhZGUgZGUgY2FkYSB0ZWxhIGUgZGV2ZSBzZXIgdXRpbGl6YWRvIGVtIGNvbmp1bnRvIGNvbSBhcyBkaXJldGl2YXMgZGUgKnRlbXBsYXRlcypcbiAqICAqKltwLWxpc3Qtdmlldy1jb250ZW50LXRlbXBsYXRlXSgvZG9jdW1lbnRhdGlvbi9wby1saXN0LXZpZXctY29udGVudC10ZW1wbGF0ZSkqKiBlXG4gKiAqKltwLWxpc3Qtdmlldy1kZXRhaWwtdGVtcGxhdGVdKC9kb2N1bWVudGF0aW9uL3BvLWxpc3Qtdmlldy1kZXRhaWwtdGVtcGxhdGUpKiouXG4gKlxuICogTyBjb21wb25lbnRlIGRpc3BvbmliaWxpemEgdW1hIMOhcmVhIGVzcGVjw61maWNhIHBhcmEgZXhpYmnDp8OjbyBpbmZvcm1hw6fDtWVzIGFkaWNpb25haXMsXG4gKiBhdHJhdsOpcyBkYSBkaXJldGl2YSAqKltwLWxpc3Qtdmlldy1kZXRhaWwtdGVtcGxhdGVdKC9kb2N1bWVudGF0aW9uL3BvLWxpc3Qtdmlldy1kZXRhaWwtdGVtcGxhdGUpKiouXG4gKi9cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGNsYXNzIFBvTGlzdFZpZXdCYXNlQ29tcG9uZW50IHtcbiAgLyoqIFJlY2ViZSB1bWEgcHJvcHJpZWRhZGUgcXVlIHNlcsOhIHV0aWxpemFkYSBwYXJhIHJlY3VwZXJhciBvIHZhbG9yIGRvIG9iamV0byBxdWUgc2Vyw6EgdXNhZG8gY29tbyBsaW5rIHBhcmEgbyB0w610dWxvLiAqL1xuICBASW5wdXQoJ3AtcHJvcGVydHktbGluaycpIHByb3BlcnR5TGluaz86IHN0cmluZztcblxuICAvKiogUmVjZWJlIHVtYSBwcm9wcmllZGFkZSBxdWUgc2Vyw6EgdXRpbGl6YWRhIHBhcmEgcmVjdXBlcmFyIG8gdmFsb3IgZG8gb2JqZXRvIHF1ZSBzZXLDoSBleGliaWRvIGNvbW8gbyB0w610dWxvIGRlIGNhZGEgaXRlbS4gKi9cbiAgQElucHV0KCdwLXByb3BlcnR5LXRpdGxlJykgcHJvcGVydHlUaXRsZT86IHN0cmluZztcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBSZWNlYmUgdW1hIGHDp8OjbywgcXVlIHNlcsOhIGV4ZWN1dGFkYSBxdWFuZG8gY2xpY2FyIG5vIGJvdMOjbyBcIkNhcnJlZ2FyIG1haXMgcmVzdWx0YWRvc1wiLlxuICAgKlxuICAgKiA+IENhc28gbmVuaHVtYSBhw6fDo28gZm9yIGRlZmluaWRhIG8gbWVzbW8gbsOjbyBmaWNhcsOhIHZpc8OtdmVsLlxuICAgKi9cbiAgQE91dHB1dCgncC1zaG93LW1vcmUnKSBzaG93TW9yZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBBw6fDo28gcXVlIHNlcsOhIGV4ZWN1dGFkYSBhbyBjbGljYXIgbm8gdMOtdHVsby5cbiAgICpcbiAgICogQW8gc2VyIGRpc3BhcmFkbywgbyBtw6l0b2RvIGluc2VyaWRvIG5hIGHDp8OjbyBpcsOhIHJlY2ViZXIgY29tbyBwYXLDom1ldHJvIG8gaXRlbSBkYSBsaXN0YSBjbGljYWRvLlxuICAgKi9cbiAgQE91dHB1dCgncC10aXRsZS1hY3Rpb24nKSB0aXRsZUFjdGlvbjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBBw6fDo28gcXVlIHNlcsOhIGV4ZWN1dGFkYSBhbyBjbGljYXIgbm8gYm90w6NvIGV4aWJpciBkZXRhbGhlcy5cbiAgICpcbiAgICogQW8gc2VyIGRpc3BhcmFkbywgbyBtw6l0b2RvIHBhc3NhIGNvbW8gcGFyw6JtZXRyb3Mgb3MgZGV0YWxoZXMgcXVlIHNlcsOjbyBleGliaWRvcy5cbiAgICovXG4gIEBPdXRwdXQoJ3Atc2hvdy1kZXRhaWwnKSBzaG93RGV0YWlsOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIHBvcHVwVGFyZ2V0OiBhbnk7XG4gIHNlbGVjdEFsbDogYm9vbGVhbiA9IGZhbHNlO1xuICBzaG93SGVhZGVyOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBfYWN0aW9uczogQXJyYXk8UG9MaXN0Vmlld0FjdGlvbj47XG4gIHByaXZhdGUgX2hlaWdodDogbnVtYmVyO1xuICBwcml2YXRlIF9oaWRlU2VsZWN0QWxsOiBib29sZWFuO1xuICBwcml2YXRlIF9pdGVtczogQXJyYXk8YW55PjtcbiAgcHJpdmF0ZSBfbGl0ZXJhbHM6IFBvTGlzdFZpZXdMaXRlcmFscztcbiAgcHJpdmF0ZSBfc2VsZWN0OiBib29sZWFuO1xuICBwcml2YXRlIF9zaG93TW9yZURpc2FibGVkOiBib29sZWFuO1xuICBwcml2YXRlIGxhbmd1YWdlOiBzdHJpbmcgPSBwb0xvY2FsZURlZmF1bHQ7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogTGlzdGEgZGUgYcOnw7VlcyBxdWUgc2Vyw6NvIGV4aWJpZGFzIG5vIGNvbXBvbmVudGUuXG4gICAqL1xuICBASW5wdXQoJ3AtYWN0aW9ucycpIHNldCBhY3Rpb25zKHZhbHVlOiBBcnJheTxQb0xpc3RWaWV3QWN0aW9uPikge1xuICAgIHRoaXMuX2FjdGlvbnMgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW107XG4gIH1cblxuICBnZXQgYWN0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5fYWN0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBhIGFsdHVyYSBkbyBgcG8tbGlzdC12aWV3YCBlbSAqcGl4ZWxzKi5cbiAgICovXG4gIEBJbnB1dCgncC1oZWlnaHQnKSBzZXQgaGVpZ2h0KGhlaWdodDogbnVtYmVyKSB7XG4gICAgdGhpcy5faGVpZ2h0ID0gaGVpZ2h0O1xuICB9XG5cbiAgZ2V0IGhlaWdodCgpIHtcbiAgICByZXR1cm4gdGhpcy5faGVpZ2h0O1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBFc2NvbmRlIG8gKmNoZWNrYm94KiBwYXJhIHNlbGXDp8OjbyBkZSB0b2RvcyBvcyBpdGVucy5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWhpZGUtc2VsZWN0LWFsbCcpIHNldCBoaWRlU2VsZWN0QWxsKGhpZGVTZWxlY3RBbGw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9oaWRlU2VsZWN0QWxsID0gY29udmVydFRvQm9vbGVhbihoaWRlU2VsZWN0QWxsKTtcbiAgICB0aGlzLnNob3dNYWluSGVhZGVyKCk7XG4gIH1cblxuICBnZXQgaGlkZVNlbGVjdEFsbCgpIHtcbiAgICByZXR1cm4gdGhpcy5faGlkZVNlbGVjdEFsbDtcbiAgfVxuXG4gIC8qKiBMaXN0YSBkZSBpdGVucyBxdWUgc2Vyw6NvIGV4aWJpZG9zIG5vIGNvbXBvbmVudGUuICovXG4gIEBJbnB1dCgncC1pdGVtcycpIHNldCBpdGVtcyh2YWx1ZTogQXJyYXk8YW55Pikge1xuICAgIHRoaXMuX2l0ZW1zID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZSA6IFtdO1xuICB9XG5cbiAgZ2V0IGl0ZW1zKCkge1xuICAgIHJldHVybiB0aGlzLl9pdGVtcztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIE9iamV0byBjb20gYXMgbGl0ZXJhaXMgdXNhZGFzIG5vIGBwby1saXN0LXZpZXdgLlxuICAgKlxuICAgKiBFeGlzdGVtIGR1YXMgbWFuZWlyYXMgZGUgY3VzdG9taXphciBvIGNvbXBvbmVudGUsIHBhc3NhbmRvIHVtIG9iamV0byBjb20gdG9kYXMgYXMgbGl0ZXJhaXMgZGlzcG9uw612ZWlzOlxuICAgKlxuICAgKiBgYGBcbiAgICogIGNvbnN0IGN1c3RvbUxpdGVyYWxzOiBQb0xpc3RWaWV3TGl0ZXJhbHMgPSB7XG4gICAqICAgIGhpZGVEZXRhaWw6ICdPY3VsdGFyIGRldGFsaGVzIGNvbXBsZXRhbWVudGUnLFxuICAgKiAgICBsb2FkTW9yZURhdGE6ICdNYWlzIGRhZG9zJyxcbiAgICogICAgc2hvd0RldGFpbDogJ01vc3RyYXIgbWFpcyBkZXRhbGhlcycsXG4gICAqICAgIHNlbGVjdEFsbDogJ1NlbGVjaW9uYXIgdG9kb3Mgb3MgaXRlbnMnXG4gICAqICB9O1xuICAgKiBgYGBcbiAgICpcbiAgICogT3UgcGFzc2FuZG8gYXBlbmFzIGFzIGxpdGVyYWlzIHF1ZSBkZXNlamEgY3VzdG9taXphcjpcbiAgICpcbiAgICogYGBgXG4gICAqICBjb25zdCBjdXN0b21MaXRlcmFsczogUG9MaXN0Vmlld0xpdGVyYWxzID0ge1xuICAgKiAgICBzaG93RGV0YWlsOiAnTW9zdHJhciBtYWlzIGRldGFsaGVzJ1xuICAgKiAgfTtcbiAgICogYGBgXG4gICAqXG4gICAqIEUgcGFyYSBjYXJyZWdhciBhcyBsaXRlcmFpcyBjdXN0b21pemFkYXMsIGJhc3RhIGFwZW5hcyBwYXNzYXIgbyBvYmpldG8gcGFyYSBvIGNvbXBvbmVudGUuXG4gICAqXG4gICAqIGBgYFxuICAgKiA8cG8tbGlzdC12aWV3XG4gICAqICAgW3AtbGl0ZXJhbHNdPVwiY3VzdG9tTGl0ZXJhbHNcIj5cbiAgICogPC9wby1saXN0LXZpZXc+XG4gICAqIGBgYFxuICAgKlxuICAgKiA+IE8gb2JqZXRvIHBhZHLDo28gZGUgbGl0ZXJhaXMgc2Vyw6EgdHJhZHV6aWRvIGRlIGFjb3JkbyBjb20gbyBpZGlvbWEgZG9cbiAgICogW2BQb0kxOG5TZXJ2aWNlYF0oL2RvY3VtZW50YXRpb24vcG8taTE4bikgb3UgZG8gYnJvd3Nlci5cbiAgICovXG4gIEBJbnB1dCgncC1saXRlcmFscycpIHNldCBsaXRlcmFscyh2YWx1ZTogUG9MaXN0Vmlld0xpdGVyYWxzKSB7XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0ICYmICEodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgIHRoaXMuX2xpdGVyYWxzID0ge1xuICAgICAgICAuLi5wb0xpc3RWaWV3TGl0ZXJhbHNEZWZhdWx0W3BvTG9jYWxlRGVmYXVsdF0sXG4gICAgICAgIC4uLnBvTGlzdFZpZXdMaXRlcmFsc0RlZmF1bHRbdGhpcy5sYW5ndWFnZV0sXG4gICAgICAgIC4uLnZhbHVlXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9saXRlcmFscyA9IHBvTGlzdFZpZXdMaXRlcmFsc0RlZmF1bHRbdGhpcy5sYW5ndWFnZV07XG4gICAgfVxuICB9XG5cbiAgZ2V0IGxpdGVyYWxzKCkge1xuICAgIHJldHVybiB0aGlzLl9saXRlcmFscyB8fCBwb0xpc3RWaWV3TGl0ZXJhbHNEZWZhdWx0W3RoaXMubGFuZ3VhZ2VdO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSGFiaWxpdGEgdW0gKmNoZWNrYm94KiBwYXJhIGNhZGEgaXRlbSBkYSBsaXN0YS4gVG9kb3Mgb3MgaXRlbXMgcG9zc3VlbSBhIHByb3ByaWVkYWRlIGRpbsOibWljYSBgJHNlbGVjdGVkYCBwYXJhIGlkZW50aWZpY2FyIHNlIG9cbiAgICogaXRlbSBlc3TDoSBzZWxlY2lvbmFkbywgcG9yIGV4ZW1wbG86XG4gICAqXG4gICAqIGBgYFxuICAgKiAgaXRlbS4kc2VsZWN0ZWRcbiAgICpcbiAgICogIC8vIG91XG4gICAqXG4gICAqICBpdGVtWyckc2VsZWN0ZWQnXVxuICAgKiBgYGBcbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLXNlbGVjdCcpIHNldCBzZWxlY3Qoc2VsZWN0OiBib29sZWFuKSB7XG4gICAgdGhpcy5fc2VsZWN0ID0gY29udmVydFRvQm9vbGVhbihzZWxlY3QpO1xuICAgIHRoaXMuc2hvd01haW5IZWFkZXIoKTtcbiAgfVxuXG4gIGdldCBzZWxlY3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEluZGljYSBxdWUgbyBib3TDo28gYENhcnJlZ2FyIE1haXMgUmVzdWx0YWRvc2Agc2Vyw6EgZGVzYWJpbGl0YWRvLlxuICAgKi9cbiAgQElucHV0KCdwLXNob3ctbW9yZS1kaXNhYmxlZCcpIHNldCBzaG93TW9yZURpc2FibGVkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fc2hvd01vcmVEaXNhYmxlZCA9IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xuICB9XG5cbiAgZ2V0IHNob3dNb3JlRGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3Nob3dNb3JlRGlzYWJsZWQ7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihsYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlKSB7XG4gICAgdGhpcy5sYW5ndWFnZSA9IGxhbmd1YWdlU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCk7XG4gIH1cblxuICBvbkNsaWNrQWN0aW9uKGxpc3RWaWV3QWN0aW9uOiBQb0xpc3RWaWV3QWN0aW9uLCBpdGVtKSB7XG4gICAgY29uc3QgY2xlYW5JdGVtID0gdGhpcy5kZWxldGVJbnRlcm5hbEF0dHJzKGl0ZW0pO1xuICAgIGlmIChsaXN0Vmlld0FjdGlvbi5hY3Rpb24pIHtcbiAgICAgIGxpc3RWaWV3QWN0aW9uLmFjdGlvbihjbGVhbkl0ZW0pO1xuICAgIH1cbiAgfVxuXG4gIG9uU2hvd01vcmUoKTogdm9pZCB7XG4gICAgdGhpcy5zaG93TW9yZS5lbWl0KCk7XG4gIH1cblxuICBydW5UaXRsZUFjdGlvbihsaXN0SXRlbTogYW55KSB7XG4gICAgY29uc3QgaXRlbVdpdGhQdWJsaWNQcm9wZXJ0aWVzID0gdGhpcy5kZWxldGVJbnRlcm5hbEF0dHJzKGxpc3RJdGVtKTtcbiAgICB0aGlzLnRpdGxlQWN0aW9uLmVtaXQoaXRlbVdpdGhQdWJsaWNQcm9wZXJ0aWVzKTtcbiAgfVxuXG4gIHNlbGVjdEFsbExpc3RJdGVtcygpIHtcbiAgICBpZiAoIXRoaXMuaGlkZVNlbGVjdEFsbCkge1xuICAgICAgdGhpcy5zZWxlY3RBbGwgPSAhdGhpcy5zZWxlY3RBbGw7XG5cbiAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaXRlbS4kc2VsZWN0ZWQgPSB0aGlzLnNlbGVjdEFsbDtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHNlbGVjdExpc3RJdGVtKHJvdzogYW55KSB7XG4gICAgcm93LiRzZWxlY3RlZCA9ICFyb3cuJHNlbGVjdGVkO1xuXG4gICAgdGhpcy5zZWxlY3RBbGwgPSB0aGlzLmNoZWNrSWZJdGVtc0FyZVNlbGVjdGVkKHRoaXMuaXRlbXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBkZWxldGVJbnRlcm5hbEF0dHJzKGl0ZW0pIHtcbiAgICBjb25zdCBpdGVtQ29weSA9IGl0ZW0gPyB7IC4uLml0ZW0gfSA6IHVuZGVmaW5lZDtcblxuICAgIGZvciAoY29uc3Qga2V5IGluIGl0ZW1Db3B5KSB7XG4gICAgICBpZiAoaXRlbUNvcHkuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBrZXkuc3RhcnRzV2l0aCgnJCcpKSB7XG4gICAgICAgIGRlbGV0ZSBpdGVtQ29weVtrZXldO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBpdGVtQ29weTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tJZkl0ZW1zQXJlU2VsZWN0ZWQoaXRlbXM6IEFycmF5PGFueT4pOiBib29sZWFuIHtcbiAgICBjb25zdCBzb21lQ2hlY2tlZE9ySW5kZXRlcm1pbmF0ZSA9IGl0ZW0gPT4gaXRlbS4kc2VsZWN0ZWQgfHwgaXRlbS4kc2VsZWN0ZWQgPT09IG51bGw7XG4gICAgY29uc3QgZXZlcnlDaGVja2VkID0gaXRlbSA9PiBpdGVtLiRzZWxlY3RlZDtcblxuICAgIGlmIChpdGVtcy5ldmVyeShldmVyeUNoZWNrZWQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoaXRlbXMuc29tZShzb21lQ2hlY2tlZE9ySW5kZXRlcm1pbmF0ZSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvd01haW5IZWFkZXIoKSB7XG4gICAgdGhpcy5zaG93SGVhZGVyID0gISEodGhpcy5zZWxlY3QgJiYgIXRoaXMuaGlkZVNlbGVjdEFsbCAmJiB0aGlzLml0ZW1zICYmIHRoaXMuaXRlbXMubGVuZ3RoKTtcbiAgfVxufVxuIl19