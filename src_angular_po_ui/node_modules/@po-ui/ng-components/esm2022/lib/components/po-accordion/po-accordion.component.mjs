import { Component, ContentChildren, ViewChildren } from '@angular/core';
import { PoAccordionBaseComponent } from './po-accordion-base.component';
import { PoAccordionItemHeaderComponent } from './po-accordion-item-header/po-accordion-item-header.component';
import { PoAccordionItemComponent } from './po-accordion-item/po-accordion-item.component';
import { PoAccordionService } from './services/po-accordion.service';
import * as i0 from "@angular/core";
import * as i1 from "./services/po-accordion.service";
import * as i2 from "../../services/po-language/po-language.service";
import * as i3 from "@angular/common";
import * as i4 from "./po-accordion-item-body/po-accordion-item-body.component";
import * as i5 from "./po-accordion-item-header/po-accordion-item-header.component";
import * as i6 from "./po-accordion-manager/po-accordion-manager.component";
function PoAccordionComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    const _r3 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "div", 3)(1, "po-accordion-manager", 4);
    i0.ɵɵlistener("p-click", function PoAccordionComponent_div_1_Template_po_accordion_manager_p_click_1_listener() { i0.ɵɵrestoreView(_r3); const ctx_r2 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r2.changeVisibleAllItems(ctx_r2.expandedAllItems)); });
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-expanded-all-items", ctx_r0.expandedAllItems)("p-literals", ctx_r0.literals);
} }
function PoAccordionComponent_li_3_ng_container_3_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainer(0);
} }
function PoAccordionComponent_li_3_Template(rf, ctx) { if (rf & 1) {
    const _r7 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "li", 5)(1, "po-accordion-item-header", 6);
    i0.ɵɵlistener("p-toggle", function PoAccordionComponent_li_3_Template_po_accordion_item_header_p_toggle_1_listener($event) { const restoredCtx = i0.ɵɵrestoreView(_r7); const poAccordionItem_r4 = restoredCtx.$implicit; const ctx_r6 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r6.headerToggle($event, poAccordionItem_r4)); });
    i0.ɵɵelementEnd();
    i0.ɵɵelementStart(2, "po-accordion-item-body", 7);
    i0.ɵɵtemplate(3, PoAccordionComponent_li_3_ng_container_3_Template, 1, 0, "ng-container", 8);
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const poAccordionItem_r4 = ctx.$implicit;
    i0.ɵɵclassProp("po-accordion-item-active", poAccordionItem_r4.expanded);
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-disabled", poAccordionItem_r4.disabledItem)("p-expanded", poAccordionItem_r4.expanded)("p-label", poAccordionItem_r4.label)("p-label-tag", poAccordionItem_r4.labelTag)("p-type-tag", poAccordionItem_r4.typeTag);
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-expanded", poAccordionItem_r4.expanded);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngTemplateOutlet", poAccordionItem_r4.templateRef);
} }
/**
 * @docsExtends PoAccordionBaseComponent
 *
 * @example
 *
 * <example name="po-accordion-basic" title="PO Accordion Basic" >
 *  <file name="sample-po-accordion-basic/sample-po-accordion-basic.component.html"> </file>
 *  <file name="sample-po-accordion-basic/sample-po-accordion-basic.component.ts"> </file>
 *  <file name="sample-po-accordion-basic/sample-po-accordion-basic.component.e2e-spec.ts"> </file>
 *  <file name="sample-po-accordion-basic/sample-po-accordion-basic.component.po.ts"> </file>
 * </example>
 *
 * <example name="po-accordion-labs" title="PO Accordion Labs" >
 *  <file name="sample-po-accordion-labs/sample-po-accordion-labs.component.html"> </file>
 *  <file name="sample-po-accordion-labs/sample-po-accordion-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-accordion-faq" title="PO Accordion - FAQs" >
 *  <file name="sample-po-accordion-faq/sample-po-accordion-faq.component.html"> </file>
 *  <file name="sample-po-accordion-faq/sample-po-accordion-faq.component.ts"> </file>
 * </example>
 */
export class PoAccordionComponent extends PoAccordionBaseComponent {
    accordionService;
    accordionsHeader;
    poAccordionItems;
    expandedAllItems = false;
    accordionServiceSubscription;
    expandedActiveAccordionItem;
    constructor(accordionService, languageService) {
        super(languageService);
        this.accordionService = accordionService;
        this.receiveFromChildAccordionSubscription();
    }
    ngOnDestroy() {
        this.accordionServiceSubscription.unsubscribe();
    }
    changeVisibleAllItems(event) {
        this.expandedAllItems = !event;
        this.poAccordionItems.forEach(item => {
            if (!item.disabledItem) {
                item.expanded = this.expandedAllItems;
                this.toggle(item, false);
            }
        });
        if (this.expandedAllItems) {
            this.expandAllEvent.emit();
        }
        else {
            this.collapseAllEvent.emit();
        }
    }
    /**
     * Método para colapsar todos os itens.
     * Só pode ser utilizado quando a propriedade `p-show-manager-accordion` estiver como `true`.
     */
    collapseAllItems() {
        if (this.showManagerAccordion) {
            this.changeVisibleAllItems(true);
        }
    }
    /**
     * Método para expandir todos os itens.
     * Só pode ser utilizado quando a propriedade `p-show-manager-accordion` estiver como `true`.
     */
    expandAllItems() {
        if (this.showManagerAccordion) {
            this.changeVisibleAllItems(false);
        }
    }
    headerToggle(event, poAccordionItem) {
        poAccordionItem.expanded = event;
        this.accordionService.sendToParentAccordionItemClicked(poAccordionItem);
    }
    checkVisibleAllItems(event) {
        if (this.showManagerAccordion) {
            const accordionList = this.poAccordionItems.toArray();
            const accordionsValids = accordionList.filter(item => !item.disabledItem);
            const allItemsExpanded = accordionsValids.every(item => item.expanded === true);
            if (allItemsExpanded) {
                this.expandedAllItems = event;
            }
            else {
                this.expandedAllItems = false;
            }
        }
    }
    receiveFromChildAccordionSubscription() {
        this.accordionServiceSubscription = this.accordionService
            .receiveFromChildAccordionClicked()
            .subscribe(poAccordionItem => this.toggle(poAccordionItem));
    }
    toggle(poAccordionItem, checkAllItems = true) {
        const isCurrentAccordionCollapsed = !poAccordionItem.expanded;
        if (checkAllItems) {
            this.checkVisibleAllItems(poAccordionItem.expanded);
        }
        if (isCurrentAccordionCollapsed) {
            this.expandedActiveAccordionItem = null;
            return;
        }
        if (!this.showManagerAccordion && !this.allowExpandItems && this.expandedActiveAccordionItem) {
            this.expandedActiveAccordionItem.collapse();
        }
        this.expandedActiveAccordionItem = poAccordionItem;
    }
    static ɵfac = function PoAccordionComponent_Factory(t) { return new (t || PoAccordionComponent)(i0.ɵɵdirectiveInject(i1.PoAccordionService), i0.ɵɵdirectiveInject(i2.PoLanguageService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoAccordionComponent, selectors: [["po-accordion"]], contentQueries: function PoAccordionComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
            i0.ɵɵcontentQuery(dirIndex, PoAccordionItemComponent, 4);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poAccordionItems = _t);
        } }, viewQuery: function PoAccordionComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(PoAccordionItemHeaderComponent, 5);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.accordionsHeader = _t);
        } }, features: [i0.ɵɵProvidersFeature([PoAccordionService]), i0.ɵɵInheritDefinitionFeature], decls: 4, vars: 2, consts: [[1, "po-accordion"], ["class", "po-accordion-manager", 4, "ngIf"], ["class", "po-accordion-item", 3, "po-accordion-item-active", 4, "ngFor", "ngForOf"], [1, "po-accordion-manager"], [3, "p-expanded-all-items", "p-literals", "p-click"], [1, "po-accordion-item"], [3, "p-disabled", "p-expanded", "p-label", "p-label-tag", "p-type-tag", "p-toggle"], [3, "p-expanded"], [4, "ngTemplateOutlet"]], template: function PoAccordionComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵelementStart(0, "div", 0);
            i0.ɵɵtemplate(1, PoAccordionComponent_div_1_Template, 2, 2, "div", 1);
            i0.ɵɵelementStart(2, "ul");
            i0.ɵɵtemplate(3, PoAccordionComponent_li_3_Template, 4, 9, "li", 2);
            i0.ɵɵelementEnd()();
        } if (rf & 2) {
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.showManagerAccordion && ctx.poAccordionItems.length > 1);
            i0.ɵɵadvance(2);
            i0.ɵɵproperty("ngForOf", ctx.poAccordionItems);
        } }, dependencies: [i3.NgForOf, i3.NgIf, i3.NgTemplateOutlet, i4.PoAccordionItemBodyComponent, i5.PoAccordionItemHeaderComponent, i6.PoAccordionManagerComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoAccordionComponent, [{
        type: Component,
        args: [{ selector: 'po-accordion', providers: [PoAccordionService], template: "<div class=\"po-accordion\">\n  <div *ngIf=\"showManagerAccordion && poAccordionItems.length > 1\" class=\"po-accordion-manager\">\n    <po-accordion-manager\n      [p-expanded-all-items]=\"expandedAllItems\"\n      [p-literals]=\"literals\"\n      (p-click)=\"changeVisibleAllItems(expandedAllItems)\"\n    ></po-accordion-manager>\n  </div>\n  <ul>\n    <li\n      *ngFor=\"let poAccordionItem of poAccordionItems\"\n      class=\"po-accordion-item\"\n      [class.po-accordion-item-active]=\"poAccordionItem.expanded\"\n    >\n      <po-accordion-item-header\n        [p-disabled]=\"poAccordionItem.disabledItem\"\n        [p-expanded]=\"poAccordionItem.expanded\"\n        [p-label]=\"poAccordionItem.label\"\n        [p-label-tag]=\"poAccordionItem.labelTag\"\n        [p-type-tag]=\"poAccordionItem.typeTag\"\n        (p-toggle)=\"headerToggle($event, poAccordionItem)\"\n      >\n      </po-accordion-item-header>\n\n      <po-accordion-item-body [p-expanded]=\"poAccordionItem.expanded\">\n        <ng-container *ngTemplateOutlet=\"poAccordionItem.templateRef\"></ng-container>\n      </po-accordion-item-body>\n    </li>\n  </ul>\n</div>\n" }]
    }], () => [{ type: i1.PoAccordionService }, { type: i2.PoLanguageService }], { accordionsHeader: [{
            type: ViewChildren,
            args: [PoAccordionItemHeaderComponent]
        }], poAccordionItems: [{
            type: ContentChildren,
            args: [PoAccordionItemComponent]
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoAccordionComponent, { className: "PoAccordionComponent", filePath: "lib/components/po-accordion/po-accordion.component.ts", lineNumber: 38 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tYWNjb3JkaW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1hY2NvcmRpb24vcG8tYWNjb3JkaW9uLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1hY2NvcmRpb24vcG8tYWNjb3JkaW9uLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUF3QixZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFLL0YsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDekUsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sK0RBQStELENBQUM7QUFDL0csT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0saURBQWlELENBQUM7QUFDM0YsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0saUNBQWlDLENBQUM7Ozs7Ozs7Ozs7SUNQbkUsOEJBQThGLDhCQUFBO0lBSTFGLG1MQUFXLGVBQUEscURBQXVDLENBQUEsSUFBQztJQUNwRCxpQkFBdUIsRUFBQTs7O0lBSHRCLGNBQXlDO0lBQXpDLDhEQUF5QywrQkFBQTs7O0lBc0J2Qyx3QkFBNkU7Ozs7SUFoQmpGLDZCQUlDLGtDQUFBO0lBT0csb1FBQVksZUFBQSwrQ0FBcUMsQ0FBQSxJQUFDO0lBRXBELGlCQUEyQjtJQUUzQixpREFBZ0U7SUFDOUQsNEZBQTZFO0lBQy9FLGlCQUF5QixFQUFBOzs7SUFkekIsdUVBQTJEO0lBR3pELGNBQTJDO0lBQTNDLDREQUEyQywyQ0FBQSxxQ0FBQSw0Q0FBQSwwQ0FBQTtJQVNyQixjQUF1QztJQUF2Qyx3REFBdUM7SUFDOUMsY0FBNkM7SUFBN0MsaUVBQTZDOztBRGZwRTs7Ozs7Ozs7Ozs7Ozs7Ozs7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LENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQztRQUM5RCxJQUFJLGFBQWEsRUFBRTtZQUNqQixJQUFJLENBQUMsb0JBQW9CLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3JEO1FBRUQsSUFBSSwyQkFBMkIsRUFBRTtZQUMvQixJQUFJLENBQUMsMkJBQTJCLEdBQUcsSUFBSSxDQUFDO1lBQ3hDLE9BQU87U0FDUjtRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLElBQUksSUFBSSxDQUFDLDJCQUEyQixFQUFFO1lBQzVGLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUM3QztRQUVELElBQUksQ0FBQywyQkFBMkIsR0FBRyxlQUFlLENBQUM7SUFDckQsQ0FBQzs4RUFuR1Usb0JBQW9COzZEQUFwQixvQkFBb0I7d0NBRWQsd0JBQXdCOzs7OzsyQkFEM0IsOEJBQThCOzs7OzhDQUhqQyxDQUFDLGtCQUFrQixDQUFDO1lDbkNqQyw4QkFBMEI7WUFDeEIscUVBTU07WUFDTiwwQkFBSTtZQUNGLG1FQWtCSztZQUNQLGlCQUFLLEVBQUE7O1lBM0JDLGNBQXlEO1lBQXpELGtGQUF5RDtZQVMvQixlQUFtQjtZQUFuQiw4Q0FBbUI7OztpRkQyQnhDLG9CQUFvQjtjQUxoQyxTQUFTOzJCQUNFLGNBQWMsYUFFYixDQUFDLGtCQUFrQixDQUFDO21GQUdlLGdCQUFnQjtrQkFBN0QsWUFBWTttQkFBQyw4QkFBOEI7WUFDRCxnQkFBZ0I7a0JBQTFELGVBQWU7bUJBQUMsd0JBQXdCOztrRkFGOUIsb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBDb250ZW50Q2hpbGRyZW4sIE9uRGVzdHJveSwgUXVlcnlMaXN0LCBWaWV3Q2hpbGRyZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IFBvTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2Uuc2VydmljZSc7XG5pbXBvcnQgeyBQb0FjY29yZGlvbkJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLWFjY29yZGlvbi1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0FjY29yZGlvbkl0ZW1IZWFkZXJDb21wb25lbnQgfSBmcm9tICcuL3BvLWFjY29yZGlvbi1pdGVtLWhlYWRlci9wby1hY2NvcmRpb24taXRlbS1oZWFkZXIuY29tcG9uZW50JztcbmltcG9ydCB7IFBvQWNjb3JkaW9uSXRlbUNvbXBvbmVudCB9IGZyb20gJy4vcG8tYWNjb3JkaW9uLWl0ZW0vcG8tYWNjb3JkaW9uLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IFBvQWNjb3JkaW9uU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcG8tYWNjb3JkaW9uLnNlcnZpY2UnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb0FjY29yZGlvbkJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1hY2NvcmRpb24tYmFzaWNcIiB0aXRsZT1cIlBPIEFjY29yZGlvbiBCYXNpY1wiID5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWFjY29yZGlvbi1iYXNpYy9zYW1wbGUtcG8tYWNjb3JkaW9uLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWFjY29yZGlvbi1iYXNpYy9zYW1wbGUtcG8tYWNjb3JkaW9uLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1hY2NvcmRpb24tYmFzaWMvc2FtcGxlLXBvLWFjY29yZGlvbi1iYXNpYy5jb21wb25lbnQuZTJlLXNwZWMudHNcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tYWNjb3JkaW9uLWJhc2ljL3NhbXBsZS1wby1hY2NvcmRpb24tYmFzaWMuY29tcG9uZW50LnBvLnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tYWNjb3JkaW9uLWxhYnNcIiB0aXRsZT1cIlBPIEFjY29yZGlvbiBMYWJzXCIgPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tYWNjb3JkaW9uLWxhYnMvc2FtcGxlLXBvLWFjY29yZGlvbi1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWFjY29yZGlvbi1sYWJzL3NhbXBsZS1wby1hY2NvcmRpb24tbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1hY2NvcmRpb24tZmFxXCIgdGl0bGU9XCJQTyBBY2NvcmRpb24gLSBGQVFzXCIgPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tYWNjb3JkaW9uLWZhcS9zYW1wbGUtcG8tYWNjb3JkaW9uLWZhcS5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1hY2NvcmRpb24tZmFxL3NhbXBsZS1wby1hY2NvcmRpb24tZmFxLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLWFjY29yZGlvbicsXG4gIHRlbXBsYXRlVXJsOiAncG8tYWNjb3JkaW9uLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbUG9BY2NvcmRpb25TZXJ2aWNlXVxufSlcbmV4cG9ydCBjbGFzcyBQb0FjY29yZGlvbkNvbXBvbmVudCBleHRlbmRzIFBvQWNjb3JkaW9uQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG4gIEBWaWV3Q2hpbGRyZW4oUG9BY2NvcmRpb25JdGVtSGVhZGVyQ29tcG9uZW50KSBhY2NvcmRpb25zSGVhZGVyOiBRdWVyeUxpc3Q8UG9BY2NvcmRpb25JdGVtSGVhZGVyQ29tcG9uZW50PjtcbiAgQENvbnRlbnRDaGlsZHJlbihQb0FjY29yZGlvbkl0ZW1Db21wb25lbnQpIHBvQWNjb3JkaW9uSXRlbXM6IFF1ZXJ5TGlzdDxQb0FjY29yZGlvbkl0ZW1Db21wb25lbnQ+O1xuXG4gIGV4cGFuZGVkQWxsSXRlbXMgPSBmYWxzZTtcblxuICBwcml2YXRlIGFjY29yZGlvblNlcnZpY2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBleHBhbmRlZEFjdGl2ZUFjY29yZGlvbkl0ZW06IFBvQWNjb3JkaW9uSXRlbUNvbXBvbmVudDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGFjY29yZGlvblNlcnZpY2U6IFBvQWNjb3JkaW9uU2VydmljZSxcbiAgICBsYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKGxhbmd1YWdlU2VydmljZSk7XG4gICAgdGhpcy5yZWNlaXZlRnJvbUNoaWxkQWNjb3JkaW9uU3Vic2NyaXB0aW9uKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmFjY29yZGlvblNlcnZpY2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIGNoYW5nZVZpc2libGVBbGxJdGVtcyhldmVudDogYm9vbGVhbikge1xuICAgIHRoaXMuZXhwYW5kZWRBbGxJdGVtcyA9ICFldmVudDtcblxuICAgIHRoaXMucG9BY2NvcmRpb25JdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaWYgKCFpdGVtLmRpc2FibGVkSXRlbSkge1xuICAgICAgICBpdGVtLmV4cGFuZGVkID0gdGhpcy5leHBhbmRlZEFsbEl0ZW1zO1xuICAgICAgICB0aGlzLnRvZ2dsZShpdGVtLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5leHBhbmRlZEFsbEl0ZW1zKSB7XG4gICAgICB0aGlzLmV4cGFuZEFsbEV2ZW50LmVtaXQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb2xsYXBzZUFsbEV2ZW50LmVtaXQoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTcOpdG9kbyBwYXJhIGNvbGFwc2FyIHRvZG9zIG9zIGl0ZW5zLlxuICAgKiBTw7MgcG9kZSBzZXIgdXRpbGl6YWRvIHF1YW5kbyBhIHByb3ByaWVkYWRlIGBwLXNob3ctbWFuYWdlci1hY2NvcmRpb25gIGVzdGl2ZXIgY29tbyBgdHJ1ZWAuXG4gICAqL1xuICBjb2xsYXBzZUFsbEl0ZW1zKCkge1xuICAgIGlmICh0aGlzLnNob3dNYW5hZ2VyQWNjb3JkaW9uKSB7XG4gICAgICB0aGlzLmNoYW5nZVZpc2libGVBbGxJdGVtcyh0cnVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTcOpdG9kbyBwYXJhIGV4cGFuZGlyIHRvZG9zIG9zIGl0ZW5zLlxuICAgKiBTw7MgcG9kZSBzZXIgdXRpbGl6YWRvIHF1YW5kbyBhIHByb3ByaWVkYWRlIGBwLXNob3ctbWFuYWdlci1hY2NvcmRpb25gIGVzdGl2ZXIgY29tbyBgdHJ1ZWAuXG4gICAqL1xuICBleHBhbmRBbGxJdGVtcygpIHtcbiAgICBpZiAodGhpcy5zaG93TWFuYWdlckFjY29yZGlvbikge1xuICAgICAgdGhpcy5jaGFuZ2VWaXNpYmxlQWxsSXRlbXMoZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIGhlYWRlclRvZ2dsZShldmVudDogYm9vbGVhbiwgcG9BY2NvcmRpb25JdGVtOiBQb0FjY29yZGlvbkl0ZW1Db21wb25lbnQpIHtcbiAgICBwb0FjY29yZGlvbkl0ZW0uZXhwYW5kZWQgPSBldmVudDtcblxuICAgIHRoaXMuYWNjb3JkaW9uU2VydmljZS5zZW5kVG9QYXJlbnRBY2NvcmRpb25JdGVtQ2xpY2tlZChwb0FjY29yZGlvbkl0ZW0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja1Zpc2libGVBbGxJdGVtcyhldmVudDogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLnNob3dNYW5hZ2VyQWNjb3JkaW9uKSB7XG4gICAgICBjb25zdCBhY2NvcmRpb25MaXN0ID0gdGhpcy5wb0FjY29yZGlvbkl0ZW1zLnRvQXJyYXkoKTtcbiAgICAgIGNvbnN0IGFjY29yZGlvbnNWYWxpZHMgPSBhY2NvcmRpb25MaXN0LmZpbHRlcihpdGVtID0+ICFpdGVtLmRpc2FibGVkSXRlbSk7XG4gICAgICBjb25zdCBhbGxJdGVtc0V4cGFuZGVkID0gYWNjb3JkaW9uc1ZhbGlkcy5ldmVyeShpdGVtID0+IGl0ZW0uZXhwYW5kZWQgPT09IHRydWUpO1xuICAgICAgaWYgKGFsbEl0ZW1zRXhwYW5kZWQpIHtcbiAgICAgICAgdGhpcy5leHBhbmRlZEFsbEl0ZW1zID0gZXZlbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmV4cGFuZGVkQWxsSXRlbXMgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlY2VpdmVGcm9tQ2hpbGRBY2NvcmRpb25TdWJzY3JpcHRpb24oKSB7XG4gICAgdGhpcy5hY2NvcmRpb25TZXJ2aWNlU3Vic2NyaXB0aW9uID0gdGhpcy5hY2NvcmRpb25TZXJ2aWNlXG4gICAgICAucmVjZWl2ZUZyb21DaGlsZEFjY29yZGlvbkNsaWNrZWQoKVxuICAgICAgLnN1YnNjcmliZShwb0FjY29yZGlvbkl0ZW0gPT4gdGhpcy50b2dnbGUocG9BY2NvcmRpb25JdGVtKSk7XG4gIH1cblxuICBwcml2YXRlIHRvZ2dsZShwb0FjY29yZGlvbkl0ZW06IFBvQWNjb3JkaW9uSXRlbUNvbXBvbmVudCwgY2hlY2tBbGxJdGVtcyA9IHRydWUpIHtcbiAgICBjb25zdCBpc0N1cnJlbnRBY2NvcmRpb25Db2xsYXBzZWQgPSAhcG9BY2NvcmRpb25JdGVtLmV4cGFuZGVkO1xuICAgIGlmIChjaGVja0FsbEl0ZW1zKSB7XG4gICAgICB0aGlzLmNoZWNrVmlzaWJsZUFsbEl0ZW1zKHBvQWNjb3JkaW9uSXRlbS5leHBhbmRlZCk7XG4gICAgfVxuXG4gICAgaWYgKGlzQ3VycmVudEFjY29yZGlvbkNvbGxhcHNlZCkge1xuICAgICAgdGhpcy5leHBhbmRlZEFjdGl2ZUFjY29yZGlvbkl0ZW0gPSBudWxsO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5zaG93TWFuYWdlckFjY29yZGlvbiAmJiAhdGhpcy5hbGxvd0V4cGFuZEl0ZW1zICYmIHRoaXMuZXhwYW5kZWRBY3RpdmVBY2NvcmRpb25JdGVtKSB7XG4gICAgICB0aGlzLmV4cGFuZGVkQWN0aXZlQWNjb3JkaW9uSXRlbS5jb2xsYXBzZSgpO1xuICAgIH1cblxuICAgIHRoaXMuZXhwYW5kZWRBY3RpdmVBY2NvcmRpb25JdGVtID0gcG9BY2NvcmRpb25JdGVtO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwicG8tYWNjb3JkaW9uXCI+XG4gIDxkaXYgKm5nSWY9XCJzaG93TWFuYWdlckFjY29yZGlvbiAmJiBwb0FjY29yZGlvbkl0ZW1zLmxlbmd0aCA+IDFcIiBjbGFzcz1cInBvLWFjY29yZGlvbi1tYW5hZ2VyXCI+XG4gICAgPHBvLWFjY29yZGlvbi1tYW5hZ2VyXG4gICAgICBbcC1leHBhbmRlZC1hbGwtaXRlbXNdPVwiZXhwYW5kZWRBbGxJdGVtc1wiXG4gICAgICBbcC1saXRlcmFsc109XCJsaXRlcmFsc1wiXG4gICAgICAocC1jbGljayk9XCJjaGFuZ2VWaXNpYmxlQWxsSXRlbXMoZXhwYW5kZWRBbGxJdGVtcylcIlxuICAgID48L3BvLWFjY29yZGlvbi1tYW5hZ2VyPlxuICA8L2Rpdj5cbiAgPHVsPlxuICAgIDxsaVxuICAgICAgKm5nRm9yPVwibGV0IHBvQWNjb3JkaW9uSXRlbSBvZiBwb0FjY29yZGlvbkl0ZW1zXCJcbiAgICAgIGNsYXNzPVwicG8tYWNjb3JkaW9uLWl0ZW1cIlxuICAgICAgW2NsYXNzLnBvLWFjY29yZGlvbi1pdGVtLWFjdGl2ZV09XCJwb0FjY29yZGlvbkl0ZW0uZXhwYW5kZWRcIlxuICAgID5cbiAgICAgIDxwby1hY2NvcmRpb24taXRlbS1oZWFkZXJcbiAgICAgICAgW3AtZGlzYWJsZWRdPVwicG9BY2NvcmRpb25JdGVtLmRpc2FibGVkSXRlbVwiXG4gICAgICAgIFtwLWV4cGFuZGVkXT1cInBvQWNjb3JkaW9uSXRlbS5leHBhbmRlZFwiXG4gICAgICAgIFtwLWxhYmVsXT1cInBvQWNjb3JkaW9uSXRlbS5sYWJlbFwiXG4gICAgICAgIFtwLWxhYmVsLXRhZ109XCJwb0FjY29yZGlvbkl0ZW0ubGFiZWxUYWdcIlxuICAgICAgICBbcC10eXBlLXRhZ109XCJwb0FjY29yZGlvbkl0ZW0udHlwZVRhZ1wiXG4gICAgICAgIChwLXRvZ2dsZSk9XCJoZWFkZXJUb2dnbGUoJGV2ZW50LCBwb0FjY29yZGlvbkl0ZW0pXCJcbiAgICAgID5cbiAgICAgIDwvcG8tYWNjb3JkaW9uLWl0ZW0taGVhZGVyPlxuXG4gICAgICA8cG8tYWNjb3JkaW9uLWl0ZW0tYm9keSBbcC1leHBhbmRlZF09XCJwb0FjY29yZGlvbkl0ZW0uZXhwYW5kZWRcIj5cbiAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cInBvQWNjb3JkaW9uSXRlbS50ZW1wbGF0ZVJlZlwiPjwvbmctY29udGFpbmVyPlxuICAgICAgPC9wby1hY2NvcmRpb24taXRlbS1ib2R5PlxuICAgIDwvbGk+XG4gIDwvdWw+XG48L2Rpdj5cbiJdfQ==