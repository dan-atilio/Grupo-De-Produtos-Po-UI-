import { ChangeDetectionStrategy, Component, ElementRef, ViewChild, forwardRef } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { PoI18nPipe } from '../../../services/po-i18n/po-i18n.pipe';
import { formatBytes, isMobile, uuid } from '../../../utils/util';
import { PoProgressStatus } from '../../po-progress/enums/po-progress-status.enum';
import { PoUploadBaseComponent } from './po-upload-base.component';
import { PoUploadDragDropComponent } from './po-upload-drag-drop/po-upload-drag-drop.component';
import { PoUploadStatus } from './po-upload-status.enum';
import { PoUploadService } from './po-upload.service';
import * as i0 from "@angular/core";
import * as i1 from "./po-upload.service";
import * as i2 from "../../../services/po-i18n/po-i18n.pipe";
import * as i3 from "../../../services/po-notification/po-notification.service";
import * as i4 from "../../../services/po-language/po-language.service";
import * as i5 from "@angular/common";
import * as i6 from "../../po-button/po-button.component";
import * as i7 from "../../po-container/po-container.component";
import * as i8 from "../po-field-container/po-field-container-bottom/po-field-container-bottom.component";
import * as i9 from "../po-field-container/po-field-container.component";
import * as i10 from "../../po-progress/po-progress.component";
import * as i11 from "./po-upload-drag-drop/po-upload-drag-drop.component";
import * as i12 from "./po-upload-file-restrictions/po-upload-file-restrictions.component";
const _c0 = ["inputFile"];
const _c1 = ["uploadButton"];
function PoUploadComponent_po_upload_drag_drop_5_Template(rf, ctx) { if (rf & 1) {
    const _r7 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-upload-drag-drop", 11);
    i0.ɵɵlistener("p-file-change", function PoUploadComponent_po_upload_drag_drop_5_Template_po_upload_drag_drop_p_file_change_0_listener($event) { i0.ɵɵrestoreView(_r7); const ctx_r6 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r6.onFileChangeDragDrop($event)); })("p-select-files", function PoUploadComponent_po_upload_drag_drop_5_Template_po_upload_drag_drop_p_select_files_0_listener() { i0.ɵɵrestoreView(_r7); const ctx_r8 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r8.selectFiles()); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-directory-compatible", ctx_r1.canHandleDirectory)("p-disabled", ctx_r1.isDisabled)("p-drag-drop-height", ctx_r1.dragDropHeight)("p-literals", ctx_r1.literals);
} }
function PoUploadComponent_po_button_6_Template(rf, ctx) { if (rf & 1) {
    const _r11 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-button", 12, 13);
    i0.ɵɵlistener("p-click", function PoUploadComponent_po_button_6_Template_po_button_p_click_0_listener() { i0.ɵɵrestoreView(_r11); const ctx_r10 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r10.selectFiles()); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-disabled", ctx_r2.isDisabled)("p-label", ctx_r2.selectFileButtonLabel);
} }
const _c2 = a0 => ({ "po-upload-file-restrictions-drag-drop": a0 });
function PoUploadComponent_po_upload_file_restrictions_7_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "po-upload-file-restrictions", 14);
} if (rf & 2) {
    const ctx_r3 = i0.ɵɵnextContext();
    i0.ɵɵproperty("ngClass", i0.ɵɵpureFunction1(5, _c2, ctx_r3.displayDragDrop))("p-allowed-extensions", ctx_r3.fileRestrictions == null ? null : ctx_r3.fileRestrictions.allowedExtensions)("p-max-files", ctx_r3.maxFiles)("p-max-file-size", ctx_r3.fileRestrictions == null ? null : ctx_r3.fileRestrictions.maxFileSize)("p-min-file-size", ctx_r3.fileRestrictions == null ? null : ctx_r3.fileRestrictions.minFileSize);
} }
function PoUploadComponent_div_8_po_progress_3_Template(rf, ctx) { if (rf & 1) {
    const _r15 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-progress", 19);
    i0.ɵɵlistener("p-cancel", function PoUploadComponent_div_8_po_progress_3_Template_po_progress_p_cancel_0_listener() { const restoredCtx = i0.ɵɵrestoreView(_r15); const file_r13 = restoredCtx.$implicit; const ctx_r14 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r14.cancel(file_r13)); })("p-retry", function PoUploadComponent_div_8_po_progress_3_Template_po_progress_p_retry_0_listener() { const restoredCtx = i0.ɵɵrestoreView(_r15); const file_r13 = restoredCtx.$implicit; const ctx_r16 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r16.uploadFiles([file_r13])); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const file_r13 = ctx.$implicit;
    const ctx_r12 = i0.ɵɵnextContext(2);
    i0.ɵɵproperty("p-info", ctx_r12.infoByUploadStatus[file_r13.status] == null ? null : ctx_r12.infoByUploadStatus[file_r13.status].text(file_r13.percent))("p-info-icon", ctx_r12.infoByUploadStatus[file_r13.status] == null ? null : ctx_r12.infoByUploadStatus[file_r13.status].icon)("p-status", ctx_r12.progressStatusByFileStatus[file_r13.status])("p-text", file_r13.displayName)("p-value", file_r13.percent);
} }
const _c3 = a0 => ({ "po-upload-progress-container-area po-pt-2 po-pl-1": a0 });
function PoUploadComponent_div_8_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 15)(1, "po-container", 16)(2, "div", 17);
    i0.ɵɵtemplate(3, PoUploadComponent_div_8_po_progress_3_Template, 1, 5, "po-progress", 18);
    i0.ɵɵelementEnd()()();
} if (rf & 2) {
    const ctx_r4 = i0.ɵɵnextContext();
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-height", ctx_r4.hasMoreThanFourItems ? 280 : "auto")("p-no-border", !ctx_r4.hasMoreThanFourItems)("p-no-padding", !ctx_r4.hasMoreThanFourItems);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngClass", i0.ɵɵpureFunction1(6, _c3, ctx_r4.hasMoreThanFourItems));
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngForOf", ctx_r4.currentFiles)("ngForTrackBy", ctx_r4.trackByFn);
} }
function PoUploadComponent_po_button_9_Template(rf, ctx) { if (rf & 1) {
    const _r18 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-button", 20);
    i0.ɵɵlistener("p-click", function PoUploadComponent_po_button_9_Template_po_button_p_click_0_listener() { i0.ɵɵrestoreView(_r18); const ctx_r17 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r17.uploadFiles(ctx_r17.currentFiles)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = i0.ɵɵnextContext();
    i0.ɵɵclassProp("po-mt-3", ctx_r5.hasMoreThanFourItems);
    i0.ɵɵproperty("p-disabled", ctx_r5.hasAnyFileUploading(ctx_r5.currentFiles))("p-label", ctx_r5.literals.startSending);
} }
/**
 * @docsExtends PoUploadBaseComponent
 *
 * @example
 *
 * <example name="po-upload-basic" title="PO Upload Basic">
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.html"> </file>
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-labs" title="PO Upload Labs">
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.html"> </file>
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-resume" title="PO Upload - Resume">
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.html"> </file>
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-rs" title="PO Upload - Realize & Show">
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.html"> </file>
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.ts"> </file>
 * </example>
 */
export class PoUploadComponent extends PoUploadBaseComponent {
    renderer;
    i18nPipe;
    notification;
    cd;
    inputFile;
    poUploadDragDropComponent;
    uploadButton;
    id = `po-upload[${uuid()}]`;
    infoByUploadStatus = {
        [PoUploadStatus.Uploaded]: {
            text: () => this.literals.sentWithSuccess,
            icon: 'ICON_OK'
        },
        [PoUploadStatus.Error]: {
            text: () => this.literals.errorOccurred
        },
        [PoUploadStatus.Uploading]: {
            text: percent => percent + '%'
        }
    };
    progressStatusByFileStatus = {
        [PoUploadStatus.Uploaded]: PoProgressStatus.Success,
        [PoUploadStatus.Error]: PoProgressStatus.Error
    };
    calledByCleanInputValue = false;
    constructor(uploadService, renderer, i18nPipe, notification, cd, languageService) {
        super(uploadService, languageService);
        this.renderer = renderer;
        this.i18nPipe = i18nPipe;
        this.notification = notification;
        this.cd = cd;
    }
    get displayDragDrop() {
        return this.dragDrop && !isMobile();
    }
    get displaySendButton() {
        const currentFiles = this.currentFiles || [];
        return (!this.hideSendButton && !this.autoUpload && currentFiles.length > 0 && this.hasFileNotUploaded && this.requiredUrl);
    }
    get selectFileButtonLabel() {
        if (this.canHandleDirectory) {
            return this.literals.selectFolder;
        }
        else if (this.isMultiple) {
            return this.literals.selectFiles;
        }
        else {
            return this.literals.selectFile;
        }
    }
    get hasMoreThanFourItems() {
        return this.currentFiles && this.currentFiles.length > 4;
    }
    get hasMultipleFiles() {
        return this.currentFiles && this.currentFiles.length > 1;
    }
    get hasFileNotUploaded() {
        if (Array.isArray(this.currentFiles)) {
            return this.currentFiles.some(file => file.status !== PoUploadStatus.Uploaded);
        }
        return false;
    }
    get isDisabled() {
        const currentFiles = this.currentFiles || [];
        return this.requiredUrl
            ? !!(this.hasAnyFileUploading(currentFiles) ||
                !this.url ||
                this.disabled ||
                this.isExceededFileLimit(currentFiles.length))
            : !!(this.hasAnyFileUploading(currentFiles) ||
                this.autoUpload ||
                this.disabled ||
                this.isExceededFileLimit(currentFiles.length));
    }
    get maxFiles() {
        return this.isMultiple && this.fileRestrictions && this.fileRestrictions.maxFiles;
    }
    cancel(file) {
        if (file.status === PoUploadStatus.Uploading) {
            return this.stopUpload(file);
        }
        this.removeFile(file);
    }
    ngAfterViewInit() {
        if (this.autoFocus) {
            this.focus();
        }
    }
    /** Método responsável por **limpar** o(s) arquivo(s) selecionado(s). */
    clear() {
        this.currentFiles = undefined;
        this.updateModel([]);
        this.cleanInputValue();
    }
    /**
     * Função que atribui foco ao componente.
     *
     * Para utilizá-la é necessário ter a instância do componente no DOM, podendo ser utilizado o ViewChild da seguinte forma:
     *
     * ```
     * import { PoUploadComponent } from '@po-ui/ng-components';
     *
     * ...
     *
     * @ViewChild(PoUploadComponent, { static: true }) upload: PoUploadComponent;
     *
     * focusUpload() {
     *   this.upload.focus();
     * }
     * ```
     */
    focus() {
        if (!this.disabled) {
            if (this.uploadButton) {
                this.uploadButton.focus();
                return;
            }
            if (this.displayDragDrop) {
                this.poUploadDragDropComponent.focus();
            }
        }
    }
    // Verifica se existe algum arquivo sendo enviado ao serviço.
    hasAnyFileUploading(files) {
        if (files && files.length) {
            return files.some(file => file.status === PoUploadStatus.Uploading);
        }
        return false;
    }
    // retorna se o status do arquivo é diferente de enviado
    isAllowCancelEvent(status) {
        return status !== PoUploadStatus.Uploaded;
    }
    // Função disparada ao selecionar algum arquivo.
    onFileChange(event) {
        // necessário este tratamento quando para IE, pois nele o change é disparado quando o campo é limpado também
        if (this.calledByCleanInputValue) {
            this.calledByCleanInputValue = false;
            return event.preventDefault();
        }
        const files = event.target.files;
        this.updateFiles(files);
        this.cleanInputValue();
    }
    onFileChangeDragDrop(files) {
        this.updateFiles(files);
    }
    // Remove o arquivo passado por parâmetro da lista dos arquivos correntes.
    removeFile(file) {
        const index = this.currentFiles.indexOf(file);
        this.currentFiles.splice(index, 1);
        this.updateModel([...this.currentFiles]);
    }
    /** Método responsável por **abrir** a janela para seleção de arquivo(s). */
    selectFiles() {
        this.onModelTouched?.();
        this.calledByCleanInputValue = false;
        this.inputFile.nativeElement.click();
    }
    sendFeedback() {
        if (this.sizeNotAllowed > 0) {
            const minFileSize = formatBytes(this.fileRestrictions.minFileSize);
            const maxFileSize = formatBytes(this.fileRestrictions.maxFileSize);
            const args = [this.sizeNotAllowed, minFileSize || '0', maxFileSize];
            this.setPipeArguments('invalidSize', args);
            this.sizeNotAllowed = 0;
        }
        if (this.extensionNotAllowed > 0) {
            const allowedExtensionsFormatted = this.fileRestrictions.allowedExtensions.join(', ').toUpperCase();
            const args = [this.extensionNotAllowed, allowedExtensionsFormatted];
            this.setPipeArguments('invalidFormat', args);
            this.extensionNotAllowed = 0;
        }
        if (this.quantityNotAllowed > 0) {
            const args = [this.quantityNotAllowed];
            this.setPipeArguments('invalidAmount', args);
            this.quantityNotAllowed = 0;
        }
    }
    /** Método responsável por **enviar** o(s) arquivo(s) selecionado(s). */
    sendFiles() {
        if (this.currentFiles && this.currentFiles.length) {
            this.uploadFiles(this.currentFiles);
        }
    }
    setDirectoryAttribute(canHandleDirectory) {
        if (canHandleDirectory) {
            this.renderer.setAttribute(this.inputFile.nativeElement, 'webkitdirectory', 'true');
        }
        else {
            this.renderer.removeAttribute(this.inputFile.nativeElement, 'webkitdirectory');
        }
    }
    // Caso o componente estiver no modo AutoUpload, o arquivo também será removido da lista.
    stopUpload(file) {
        this.uploadService.stopRequestByFile(file, () => {
            if (this.autoUpload) {
                this.removeFile(file);
            }
            else {
                this.stopUploadHandler(file);
            }
            this.cd.markForCheck();
        });
    }
    trackByFn(index, file) {
        return file.uid;
    }
    // Envia os arquivos passados por parâmetro, exceto os que já foram enviados ao serviço.
    uploadFiles(files) {
        const filesFiltered = files.filter(file => file.status !== PoUploadStatus.Uploaded);
        this.uploadService.upload(this.url, filesFiltered, this.headers, this.onUpload, (file, percent) => {
            // UPLOADING
            this.uploadingHandler(file, percent);
        }, (file, eventResponse) => {
            // SUCCESS
            this.responseHandler(file, PoUploadStatus.Uploaded);
            this.onSuccess.emit(eventResponse);
        }, (file, eventError) => {
            // Error
            this.responseHandler(file, PoUploadStatus.Error);
            this.onError.emit(eventError);
        });
    }
    cleanInputValue() {
        this.calledByCleanInputValue = true;
        this.inputFile.nativeElement.value = '';
        this.cd.detectChanges();
    }
    // função disparada na resposta do sucesso ou error
    responseHandler(file, status) {
        file.status = status;
        file.percent = 100;
        this.cd.markForCheck();
    }
    // método responsável por setar os argumentos do i18nPipe de acordo com a restrição.
    setPipeArguments(literalAttributes, literalArguments) {
        const pipeArguments = this.i18nPipe.transform(this.literals[literalAttributes], literalArguments);
        this.notification.information(pipeArguments);
    }
    // Função disparada ao parar um envio de arquivo.
    stopUploadHandler(file) {
        file.status = PoUploadStatus.None;
        file.percent = 0;
        this.cd.markForCheck();
    }
    updateFiles(files) {
        this.currentFiles = this.parseFiles(files);
        this.updateModel([...this.currentFiles]);
        if (this.autoUpload) {
            this.uploadFiles(this.currentFiles);
        }
    }
    // Atualiza o ngModel para os arquivos passados por parâmetro.
    updateModel(files) {
        const modelFiles = this.mapCleanUploadFiles(files);
        this.onModelChange ? this.onModelChange(modelFiles) : this.ngModelChange.emit(modelFiles);
    }
    // Função disparada enquanto o arquivo está sendo enviado ao serviço.
    uploadingHandler(file, percent) {
        file.status = PoUploadStatus.Uploading;
        file.percent = percent;
        this.cd.markForCheck();
    }
    // retorna os objetos do array sem as propriedades: percent e displayName
    mapCleanUploadFiles(files) {
        const mapedByUploadFile = progressFile => {
            const { percent, displayName, ...uploadFile } = progressFile;
            return uploadFile;
        };
        return files.map(mapedByUploadFile);
    }
    static ɵfac = function PoUploadComponent_Factory(t) { return new (t || PoUploadComponent)(i0.ɵɵdirectiveInject(i1.PoUploadService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i2.PoI18nPipe), i0.ɵɵdirectiveInject(i3.PoNotificationService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i4.PoLanguageService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoUploadComponent, selectors: [["po-upload"]], viewQuery: function PoUploadComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(_c0, 7, ElementRef);
            i0.ɵɵviewQuery(PoUploadDragDropComponent, 5);
            i0.ɵɵviewQuery(_c1, 5);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.inputFile = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poUploadDragDropComponent = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.uploadButton = _t.first);
        } }, features: [i0.ɵɵProvidersFeature([
                PoI18nPipe,
                PoUploadService,
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(() => PoUploadComponent),
                    multi: true
                },
                {
                    provide: NG_VALIDATORS,
                    useExisting: forwardRef(() => PoUploadComponent),
                    multi: true
                }
            ]), i0.ɵɵInheritDefinitionFeature], decls: 11, vars: 19, consts: [[3, "p-disabled", "p-id", "p-label", "p-optional", "p-required", "p-show-required"], [1, "po-field-container-content"], [1, "po-upload"], ["type", "file", 1, "po-upload-input", 3, "accept", "id", "disabled", "multiple", "required", "change"], ["inputFile", ""], [3, "p-directory-compatible", "p-disabled", "p-drag-drop-height", "p-literals", "p-file-change", "p-select-files", 4, "ngIf"], ["class", "po-upload-button", "for", "file", 3, "p-disabled", "p-label", "p-click", 4, "ngIf"], ["class", "po-upload-file-restrictions", 3, "ngClass", "p-allowed-extensions", "p-max-files", "p-max-file-size", "p-min-file-size", 4, "ngIf"], ["class", "po-upload-progress-container", 4, "ngIf"], ["class", "po-upload-send-button", "p-kind", "primary", 3, "po-mt-3", "p-disabled", "p-label", "p-click", 4, "ngIf"], [3, "p-help", "p-disabled"], [3, "p-directory-compatible", "p-disabled", "p-drag-drop-height", "p-literals", "p-file-change", "p-select-files"], ["for", "file", 1, "po-upload-button", 3, "p-disabled", "p-label", "p-click"], ["uploadButton", ""], [1, "po-upload-file-restrictions", 3, "ngClass", "p-allowed-extensions", "p-max-files", "p-max-file-size", "p-min-file-size"], [1, "po-upload-progress-container"], [3, "p-height", "p-no-border", "p-no-padding"], [3, "ngClass"], [3, "p-info", "p-info-icon", "p-status", "p-text", "p-value", "p-cancel", "p-retry", 4, "ngFor", "ngForOf", "ngForTrackBy"], [3, "p-info", "p-info-icon", "p-status", "p-text", "p-value", "p-cancel", "p-retry"], ["p-kind", "primary", 1, "po-upload-send-button", 3, "p-disabled", "p-label", "p-click"]], template: function PoUploadComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵelementStart(0, "po-field-container", 0)(1, "div", 1)(2, "div", 2)(3, "input", 3, 4);
            i0.ɵɵlistener("change", function PoUploadComponent_Template_input_change_3_listener($event) { return ctx.onFileChange($event); });
            i0.ɵɵelementEnd();
            i0.ɵɵtemplate(5, PoUploadComponent_po_upload_drag_drop_5_Template, 1, 4, "po-upload-drag-drop", 5)(6, PoUploadComponent_po_button_6_Template, 2, 2, "po-button", 6)(7, PoUploadComponent_po_upload_file_restrictions_7_Template, 1, 7, "po-upload-file-restrictions", 7)(8, PoUploadComponent_div_8_Template, 4, 8, "div", 8)(9, PoUploadComponent_po_button_9_Template, 1, 4, "po-button", 9);
            i0.ɵɵelementEnd()();
            i0.ɵɵelement(10, "po-field-container-bottom", 10);
            i0.ɵɵelementEnd();
        } if (rf & 2) {
            i0.ɵɵproperty("p-disabled", ctx.isDisabled)("p-id", ctx.id)("p-label", ctx.label)("p-optional", ctx.optional)("p-required", ctx.required)("p-show-required", ctx.showRequired);
            i0.ɵɵadvance(3);
            i0.ɵɵproperty("accept", ctx.allowedExtensions)("id", ctx.id)("disabled", ctx.isDisabled)("multiple", ctx.isMultiple)("required", ctx.required);
            i0.ɵɵattribute("name", ctx.name);
            i0.ɵɵadvance(2);
            i0.ɵɵproperty("ngIf", ctx.displayDragDrop);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", !ctx.hideSelectButton && !ctx.displayDragDrop);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.fileRestrictions && !ctx.hideRestrictionsInfo);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.currentFiles && ctx.currentFiles.length);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.displaySendButton);
            i0.ɵɵadvance();
            i0.ɵɵproperty("p-help", ctx.help)("p-disabled", ctx.disabled);
        } }, dependencies: [i5.NgClass, i5.NgForOf, i5.NgIf, i6.PoButtonComponent, i7.PoContainerComponent, i8.PoFieldContainerBottomComponent, i9.PoFieldContainerComponent, i10.PoProgressComponent, i11.PoUploadDragDropComponent, i12.PoUploadFileRestrictionsComponent], encapsulation: 2, changeDetection: 0 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoUploadComponent, [{
        type: Component,
        args: [{ selector: 'po-upload', changeDetection: ChangeDetectionStrategy.OnPush, providers: [
                    PoI18nPipe,
                    PoUploadService,
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef(() => PoUploadComponent),
                        multi: true
                    },
                    {
                        provide: NG_VALIDATORS,
                        useExisting: forwardRef(() => PoUploadComponent),
                        multi: true
                    }
                ], template: "<po-field-container\n  [p-disabled]=\"isDisabled\"\n  [p-id]=\"id\"\n  [p-label]=\"label\"\n  [p-optional]=\"optional\"\n  [p-required]=\"required\"\n  [p-show-required]=\"showRequired\"\n>\n  <div class=\"po-field-container-content\">\n    <div class=\"po-upload\">\n      <input\n        #inputFile\n        class=\"po-upload-input\"\n        type=\"file\"\n        [accept]=\"allowedExtensions\"\n        [attr.name]=\"name\"\n        [id]=\"id\"\n        [disabled]=\"isDisabled\"\n        [multiple]=\"isMultiple\"\n        [required]=\"required\"\n        (change)=\"onFileChange($event)\"\n      />\n\n      <po-upload-drag-drop\n        *ngIf=\"displayDragDrop\"\n        [p-directory-compatible]=\"canHandleDirectory\"\n        [p-disabled]=\"isDisabled\"\n        [p-drag-drop-height]=\"dragDropHeight\"\n        [p-literals]=\"literals\"\n        (p-file-change)=\"onFileChangeDragDrop($event)\"\n        (p-select-files)=\"selectFiles()\"\n      >\n      </po-upload-drag-drop>\n\n      <po-button\n        *ngIf=\"!hideSelectButton && !displayDragDrop\"\n        #uploadButton\n        class=\"po-upload-button\"\n        for=\"file\"\n        [p-disabled]=\"isDisabled\"\n        [p-label]=\"selectFileButtonLabel\"\n        (p-click)=\"selectFiles()\"\n      >\n      </po-button>\n\n      <po-upload-file-restrictions\n        *ngIf=\"fileRestrictions && !hideRestrictionsInfo\"\n        class=\"po-upload-file-restrictions\"\n        [ngClass]=\"{ 'po-upload-file-restrictions-drag-drop': displayDragDrop }\"\n        [p-allowed-extensions]=\"fileRestrictions?.allowedExtensions\"\n        [p-max-files]=\"maxFiles\"\n        [p-max-file-size]=\"fileRestrictions?.maxFileSize\"\n        [p-min-file-size]=\"fileRestrictions?.minFileSize\"\n      >\n      </po-upload-file-restrictions>\n\n      <div *ngIf=\"currentFiles && currentFiles.length\" class=\"po-upload-progress-container\">\n        <po-container\n          [p-height]=\"hasMoreThanFourItems ? 280 : 'auto'\"\n          [p-no-border]=\"!hasMoreThanFourItems\"\n          [p-no-padding]=\"!hasMoreThanFourItems\"\n        >\n          <div [ngClass]=\"{ 'po-upload-progress-container-area po-pt-2 po-pl-1': hasMoreThanFourItems }\">\n            <po-progress\n              *ngFor=\"let file of currentFiles; trackBy: trackByFn\"\n              [p-info]=\"infoByUploadStatus[file.status]?.text(file.percent)\"\n              [p-info-icon]=\"infoByUploadStatus[file.status]?.icon\"\n              [p-status]=\"progressStatusByFileStatus[file.status]\"\n              [p-text]=\"file.displayName\"\n              [p-value]=\"file.percent\"\n              (p-cancel)=\"cancel(file)\"\n              (p-retry)=\"uploadFiles([file])\"\n            >\n            </po-progress>\n          </div>\n        </po-container>\n      </div>\n\n      <po-button\n        *ngIf=\"displaySendButton\"\n        class=\"po-upload-send-button\"\n        [class.po-mt-3]=\"hasMoreThanFourItems\"\n        p-kind=\"primary\"\n        [p-disabled]=\"hasAnyFileUploading(currentFiles)\"\n        [p-label]=\"literals.startSending\"\n        (p-click)=\"uploadFiles(currentFiles)\"\n      ></po-button>\n    </div>\n  </div>\n  <po-field-container-bottom [p-help]=\"help\" [p-disabled]=\"disabled\"></po-field-container-bottom>\n</po-field-container>\n" }]
    }], () => [{ type: i1.PoUploadService }, { type: i0.Renderer2 }, { type: i2.PoI18nPipe }, { type: i3.PoNotificationService }, { type: i0.ChangeDetectorRef }, { type: i4.PoLanguageService }], { inputFile: [{
            type: ViewChild,
            args: ['inputFile', { read: ElementRef, static: true }]
        }], poUploadDragDropComponent: [{
            type: ViewChild,
            args: [PoUploadDragDropComponent]
        }], uploadButton: [{
            type: ViewChild,
            args: ['uploadButton']
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoUploadComponent, { className: "PoUploadComponent", filePath: "lib/components/po-field/po-upload/po-upload.component.ts", lineNumber: 70 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdXBsb2FkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1maWVsZC9wby11cGxvYWQvcG8tdXBsb2FkLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1maWVsZC9wby11cGxvYWQvcG8tdXBsb2FkLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFFdkIsU0FBUyxFQUNULFVBQVUsRUFFVixTQUFTLEVBQ1QsVUFBVSxFQUNYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxhQUFhLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVsRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFHcEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saURBQWlELENBQUM7QUFHbkYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDbkUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0scURBQXFELENBQUM7QUFFaEcsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3pELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lDQWhELCtDQVFDO0lBRkMsaU5BQWlCLGVBQUEsbUNBQTRCLENBQUEsSUFBQyxnTUFDNUIsZUFBQSxvQkFBYSxDQUFBLElBRGU7SUFHaEQsaUJBQXNCOzs7SUFQcEIsa0VBQTZDLGlDQUFBLDZDQUFBLCtCQUFBOzs7O0lBUy9D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UixpREFBK0Y7WUFDakcsaUJBQXFCOztZQXpGbkIsMkNBQXlCLGdCQUFBLHNCQUFBLDRCQUFBLDRCQUFBLHFDQUFBO1lBYW5CLGVBQTRCO1lBQTVCLDhDQUE0QixjQUFBLDRCQUFBLDRCQUFBLDBCQUFBO1lBQzVCLGdDQUFrQjtZQVNqQixlQUFxQjtZQUFyQiwwQ0FBcUI7WUFXckIsY0FBMkM7WUFBM0Msb0VBQTJDO1lBVzNDLGNBQStDO1lBQS9DLHdFQUErQztZQVU1QyxjQUF5QztZQUF6QyxrRUFBeUM7WUF1QjVDLGNBQXVCO1lBQXZCLDRDQUF1QjtZQVVILGNBQWU7WUFBZixpQ0FBZSw0QkFBQTs7O2lGRHBCL0IsaUJBQWlCO2NBbkI3QixTQUFTOzJCQUNFLFdBQVcsbUJBRUosdUJBQXVCLENBQUMsTUFBTSxhQUNwQztvQkFDVCxVQUFVO29CQUNWLGVBQWU7b0JBQ2Y7d0JBQ0UsT0FBTyxFQUFFLGlCQUFpQjt3QkFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLENBQUM7d0JBQ2hELEtBQUssRUFBRSxJQUFJO3FCQUNaO29CQUNEO3dCQUNFLE9BQU8sRUFBRSxhQUFhO3dCQUN0QixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxrQkFBa0IsQ0FBQzt3QkFDaEQsS0FBSyxFQUFFLElBQUk7cUJBQ1o7aUJBQ0Y7cU1BR21FLFNBQVM7a0JBQTVFLFNBQVM7bUJBQUMsV0FBVyxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO1lBQ1oseUJBQXlCO2tCQUF0RSxTQUFTO21CQUFDLHlCQUF5QjtZQUNELFlBQVk7a0JBQTlDLFNBQVM7bUJBQUMsY0FBYzs7a0ZBSGQsaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIFJlbmRlcmVyMixcbiAgVmlld0NoaWxkLFxuICBmb3J3YXJkUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTkdfVkFMSURBVE9SUywgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cbmltcG9ydCB7IFBvSTE4blBpcGUgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wby1pMThuL3BvLWkxOG4ucGlwZSc7XG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9Ob3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvcG8tbm90aWZpY2F0aW9uL3BvLW5vdGlmaWNhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IGZvcm1hdEJ5dGVzLCBpc01vYmlsZSwgdXVpZCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9Qcm9ncmVzc1N0YXR1cyB9IGZyb20gJy4uLy4uL3BvLXByb2dyZXNzL2VudW1zL3BvLXByb2dyZXNzLXN0YXR1cy5lbnVtJztcbmltcG9ydCB7IFBvQnV0dG9uQ29tcG9uZW50IH0gZnJvbSAnLi8uLi8uLi9wby1idXR0b24vcG8tYnV0dG9uLmNvbXBvbmVudCc7XG5cbmltcG9ydCB7IFBvVXBsb2FkQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tdXBsb2FkLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFBvVXBsb2FkRHJhZ0Ryb3BDb21wb25lbnQgfSBmcm9tICcuL3BvLXVwbG9hZC1kcmFnLWRyb3AvcG8tdXBsb2FkLWRyYWctZHJvcC5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9VcGxvYWRGaWxlIH0gZnJvbSAnLi9wby11cGxvYWQtZmlsZSc7XG5pbXBvcnQgeyBQb1VwbG9hZFN0YXR1cyB9IGZyb20gJy4vcG8tdXBsb2FkLXN0YXR1cy5lbnVtJztcbmltcG9ydCB7IFBvVXBsb2FkU2VydmljZSB9IGZyb20gJy4vcG8tdXBsb2FkLnNlcnZpY2UnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb1VwbG9hZEJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby11cGxvYWQtYmFzaWNcIiB0aXRsZT1cIlBPIFVwbG9hZCBCYXNpY1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1iYXNpYy9zYW1wbGUtcG8tdXBsb2FkLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtYmFzaWMvc2FtcGxlLXBvLXVwbG9hZC1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby11cGxvYWQtbGFic1wiIHRpdGxlPVwiUE8gVXBsb2FkIExhYnNcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtbGFicy9zYW1wbGUtcG8tdXBsb2FkLWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1sYWJzL3NhbXBsZS1wby11cGxvYWQtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby11cGxvYWQtcmVzdW1lXCIgdGl0bGU9XCJQTyBVcGxvYWQgLSBSZXN1bWVcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtcmVzdW1lL3NhbXBsZS1wby11cGxvYWQtcmVzdW1lLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtcmVzdW1lL3NhbXBsZS1wby11cGxvYWQtcmVzdW1lLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1yc1wiIHRpdGxlPVwiUE8gVXBsb2FkIC0gUmVhbGl6ZSAmIFNob3dcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtcnMvc2FtcGxlLXBvLXVwbG9hZC1ycy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLXJzL3NhbXBsZS1wby11cGxvYWQtcnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tdXBsb2FkJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLXVwbG9hZC5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtcbiAgICBQb0kxOG5QaXBlLFxuICAgIFBvVXBsb2FkU2VydmljZSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFBvVXBsb2FkQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gUG9VcGxvYWRDb21wb25lbnQpLFxuICAgICAgbXVsdGk6IHRydWVcbiAgICB9XG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgUG9VcGxvYWRDb21wb25lbnQgZXh0ZW5kcyBQb1VwbG9hZEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcbiAgQFZpZXdDaGlsZCgnaW5wdXRGaWxlJywgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBpbnB1dEZpbGU6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoUG9VcGxvYWREcmFnRHJvcENvbXBvbmVudCkgcHJpdmF0ZSBwb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50OiBQb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50O1xuICBAVmlld0NoaWxkKCd1cGxvYWRCdXR0b24nKSBwcml2YXRlIHVwbG9hZEJ1dHRvbjogUG9CdXR0b25Db21wb25lbnQ7XG5cbiAgaWQgPSBgcG8tdXBsb2FkWyR7dXVpZCgpfV1gO1xuXG4gIGluZm9CeVVwbG9hZFN0YXR1czogeyBba2V5OiBzdHJpbmddOiB7IHRleHQ6IChwZXJjZW50PzogbnVtYmVyKSA9PiBzdHJpbmc7IGljb24/OiBzdHJpbmcgfSB9ID0ge1xuICAgIFtQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZF06IHtcbiAgICAgIHRleHQ6ICgpID0+IHRoaXMubGl0ZXJhbHMuc2VudFdpdGhTdWNjZXNzLFxuICAgICAgaWNvbjogJ0lDT05fT0snXG4gICAgfSxcbiAgICBbUG9VcGxvYWRTdGF0dXMuRXJyb3JdOiB7XG4gICAgICB0ZXh0OiAoKSA9PiB0aGlzLmxpdGVyYWxzLmVycm9yT2NjdXJyZWRcbiAgICB9LFxuICAgIFtQb1VwbG9hZFN0YXR1cy5VcGxvYWRpbmddOiB7XG4gICAgICB0ZXh0OiBwZXJjZW50ID0+IHBlcmNlbnQgKyAnJSdcbiAgICB9XG4gIH07XG5cbiAgcHJvZ3Jlc3NTdGF0dXNCeUZpbGVTdGF0dXMgPSB7XG4gICAgW1BvVXBsb2FkU3RhdHVzLlVwbG9hZGVkXTogUG9Qcm9ncmVzc1N0YXR1cy5TdWNjZXNzLFxuICAgIFtQb1VwbG9hZFN0YXR1cy5FcnJvcl06IFBvUHJvZ3Jlc3NTdGF0dXMuRXJyb3JcbiAgfTtcblxuICBwcml2YXRlIGNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgdXBsb2FkU2VydmljZTogUG9VcGxvYWRTZXJ2aWNlLFxuICAgIHB1YmxpYyByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgaTE4blBpcGU6IFBvSTE4blBpcGUsXG4gICAgcHJpdmF0ZSBub3RpZmljYXRpb246IFBvTm90aWZpY2F0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBsYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKHVwbG9hZFNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XG4gIH1cblxuICBnZXQgZGlzcGxheURyYWdEcm9wKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmRyYWdEcm9wICYmICFpc01vYmlsZSgpO1xuICB9XG5cbiAgZ2V0IGRpc3BsYXlTZW5kQnV0dG9uKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGN1cnJlbnRGaWxlcyA9IHRoaXMuY3VycmVudEZpbGVzIHx8IFtdO1xuICAgIHJldHVybiAoXG4gICAgICAhdGhpcy5oaWRlU2VuZEJ1dHRvbiAmJiAhdGhpcy5hdXRvVXBsb2FkICYmIGN1cnJlbnRGaWxlcy5sZW5ndGggPiAwICYmIHRoaXMuaGFzRmlsZU5vdFVwbG9hZGVkICYmIHRoaXMucmVxdWlyZWRVcmxcbiAgICApO1xuICB9XG5cbiAgZ2V0IHNlbGVjdEZpbGVCdXR0b25MYWJlbCgpIHtcbiAgICBpZiAodGhpcy5jYW5IYW5kbGVEaXJlY3RvcnkpIHtcbiAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnNlbGVjdEZvbGRlcjtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNdWx0aXBsZSkge1xuICAgICAgcmV0dXJuIHRoaXMubGl0ZXJhbHMuc2VsZWN0RmlsZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnNlbGVjdEZpbGU7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGhhc01vcmVUaGFuRm91ckl0ZW1zKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlcyAmJiB0aGlzLmN1cnJlbnRGaWxlcy5sZW5ndGggPiA0O1xuICB9XG5cbiAgZ2V0IGhhc011bHRpcGxlRmlsZXMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGVzICYmIHRoaXMuY3VycmVudEZpbGVzLmxlbmd0aCA+IDE7XG4gIH1cblxuICBnZXQgaGFzRmlsZU5vdFVwbG9hZGVkKCk6IGJvb2xlYW4ge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMuY3VycmVudEZpbGVzKSkge1xuICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGVzLnNvbWUoZmlsZSA9PiBmaWxlLnN0YXR1cyAhPT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkZWQpO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGdldCBpc0Rpc2FibGVkKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGN1cnJlbnRGaWxlcyA9IHRoaXMuY3VycmVudEZpbGVzIHx8IFtdO1xuXG4gICAgcmV0dXJuIHRoaXMucmVxdWlyZWRVcmxcbiAgICAgID8gISEoXG4gICAgICAgICAgdGhpcy5oYXNBbnlGaWxlVXBsb2FkaW5nKGN1cnJlbnRGaWxlcykgfHxcbiAgICAgICAgICAhdGhpcy51cmwgfHxcbiAgICAgICAgICB0aGlzLmRpc2FibGVkIHx8XG4gICAgICAgICAgdGhpcy5pc0V4Y2VlZGVkRmlsZUxpbWl0KGN1cnJlbnRGaWxlcy5sZW5ndGgpXG4gICAgICAgIClcbiAgICAgIDogISEoXG4gICAgICAgICAgdGhpcy5oYXNBbnlGaWxlVXBsb2FkaW5nKGN1cnJlbnRGaWxlcykgfHxcbiAgICAgICAgICB0aGlzLmF1dG9VcGxvYWQgfHxcbiAgICAgICAgICB0aGlzLmRpc2FibGVkIHx8XG4gICAgICAgICAgdGhpcy5pc0V4Y2VlZGVkRmlsZUxpbWl0KGN1cnJlbnRGaWxlcy5sZW5ndGgpXG4gICAgICAgICk7XG4gIH1cblxuICBnZXQgbWF4RmlsZXMoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5pc011bHRpcGxlICYmIHRoaXMuZmlsZVJlc3RyaWN0aW9ucyAmJiB0aGlzLmZpbGVSZXN0cmljdGlvbnMubWF4RmlsZXM7XG4gIH1cblxuICBjYW5jZWwoZmlsZTogUG9VcGxvYWRGaWxlKSB7XG4gICAgaWYgKGZpbGUuc3RhdHVzID09PSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRpbmcpIHtcbiAgICAgIHJldHVybiB0aGlzLnN0b3BVcGxvYWQoZmlsZSk7XG4gICAgfVxuXG4gICAgdGhpcy5yZW1vdmVGaWxlKGZpbGUpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIGlmICh0aGlzLmF1dG9Gb2N1cykge1xuICAgICAgdGhpcy5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBNw6l0b2RvIHJlc3BvbnPDoXZlbCBwb3IgKipsaW1wYXIqKiBvKHMpIGFycXVpdm8ocykgc2VsZWNpb25hZG8ocykuICovXG4gIGNsZWFyKCkge1xuICAgIHRoaXMuY3VycmVudEZpbGVzID0gdW5kZWZpbmVkO1xuICAgIHRoaXMudXBkYXRlTW9kZWwoW10pO1xuICAgIHRoaXMuY2xlYW5JbnB1dFZhbHVlKCk7XG4gIH1cblxuICAvKipcbiAgICogRnVuw6fDo28gcXVlIGF0cmlidWkgZm9jbyBhbyBjb21wb25lbnRlLlxuICAgKlxuICAgKiBQYXJhIHV0aWxpesOhLWxhIMOpIG5lY2Vzc8OhcmlvIHRlciBhIGluc3TDom5jaWEgZG8gY29tcG9uZW50ZSBubyBET00sIHBvZGVuZG8gc2VyIHV0aWxpemFkbyBvIFZpZXdDaGlsZCBkYSBzZWd1aW50ZSBmb3JtYTpcbiAgICpcbiAgICogYGBgXG4gICAqIGltcG9ydCB7IFBvVXBsb2FkQ29tcG9uZW50IH0gZnJvbSAnQHBvLXVpL25nLWNvbXBvbmVudHMnO1xuICAgKlxuICAgKiAuLi5cbiAgICpcbiAgICogQFZpZXdDaGlsZChQb1VwbG9hZENvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgdXBsb2FkOiBQb1VwbG9hZENvbXBvbmVudDtcbiAgICpcbiAgICogZm9jdXNVcGxvYWQoKSB7XG4gICAqICAgdGhpcy51cGxvYWQuZm9jdXMoKTtcbiAgICogfVxuICAgKiBgYGBcbiAgICovXG4gIGZvY3VzKCkge1xuICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xuICAgICAgaWYgKHRoaXMudXBsb2FkQnV0dG9uKSB7XG4gICAgICAgIHRoaXMudXBsb2FkQnV0dG9uLmZvY3VzKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuZGlzcGxheURyYWdEcm9wKSB7XG4gICAgICAgIHRoaXMucG9VcGxvYWREcmFnRHJvcENvbXBvbmVudC5mb2N1cygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIFZlcmlmaWNhIHNlIGV4aXN0ZSBhbGd1bSBhcnF1aXZvIHNlbmRvIGVudmlhZG8gYW8gc2VydmnDp28uXG4gIGhhc0FueUZpbGVVcGxvYWRpbmcoZmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4pIHtcbiAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmlsZXMuc29tZShmaWxlID0+IGZpbGUuc3RhdHVzID09PSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRpbmcpO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIHJldG9ybmEgc2UgbyBzdGF0dXMgZG8gYXJxdWl2byDDqSBkaWZlcmVudGUgZGUgZW52aWFkb1xuICBpc0FsbG93Q2FuY2VsRXZlbnQoc3RhdHVzOiBQb1VwbG9hZFN0YXR1cykge1xuICAgIHJldHVybiBzdGF0dXMgIT09IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGVkO1xuICB9XG5cbiAgLy8gRnVuw6fDo28gZGlzcGFyYWRhIGFvIHNlbGVjaW9uYXIgYWxndW0gYXJxdWl2by5cbiAgb25GaWxlQ2hhbmdlKGV2ZW50KTogdm9pZCB7XG4gICAgLy8gbmVjZXNzw6FyaW8gZXN0ZSB0cmF0YW1lbnRvIHF1YW5kbyBwYXJhIElFLCBwb2lzIG5lbGUgbyBjaGFuZ2Ugw6kgZGlzcGFyYWRvIHF1YW5kbyBvIGNhbXBvIMOpIGxpbXBhZG8gdGFtYsOpbVxuICAgIGlmICh0aGlzLmNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlKSB7XG4gICAgICB0aGlzLmNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlID0gZmFsc2U7XG4gICAgICByZXR1cm4gZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBjb25zdCBmaWxlcyA9IGV2ZW50LnRhcmdldC5maWxlcztcbiAgICB0aGlzLnVwZGF0ZUZpbGVzKGZpbGVzKTtcblxuICAgIHRoaXMuY2xlYW5JbnB1dFZhbHVlKCk7XG4gIH1cblxuICBvbkZpbGVDaGFuZ2VEcmFnRHJvcChmaWxlcykge1xuICAgIHRoaXMudXBkYXRlRmlsZXMoZmlsZXMpO1xuICB9XG5cbiAgLy8gUmVtb3ZlIG8gYXJxdWl2byBwYXNzYWRvIHBvciBwYXLDom1ldHJvIGRhIGxpc3RhIGRvcyBhcnF1aXZvcyBjb3JyZW50ZXMuXG4gIHJlbW92ZUZpbGUoZmlsZSk6IHZvaWQge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jdXJyZW50RmlsZXMuaW5kZXhPZihmaWxlKTtcbiAgICB0aGlzLmN1cnJlbnRGaWxlcy5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgdGhpcy51cGRhdGVNb2RlbChbLi4udGhpcy5jdXJyZW50RmlsZXNdKTtcbiAgfVxuXG4gIC8qKiBNw6l0b2RvIHJlc3BvbnPDoXZlbCBwb3IgKiphYnJpcioqIGEgamFuZWxhIHBhcmEgc2VsZcOnw6NvIGRlIGFycXVpdm8ocykuICovXG4gIHNlbGVjdEZpbGVzKCkge1xuICAgIHRoaXMub25Nb2RlbFRvdWNoZWQ/LigpO1xuICAgIHRoaXMuY2FsbGVkQnlDbGVhbklucHV0VmFsdWUgPSBmYWxzZTtcbiAgICB0aGlzLmlucHV0RmlsZS5uYXRpdmVFbGVtZW50LmNsaWNrKCk7XG4gIH1cblxuICBzZW5kRmVlZGJhY2soKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc2l6ZU5vdEFsbG93ZWQgPiAwKSB7XG4gICAgICBjb25zdCBtaW5GaWxlU2l6ZSA9IGZvcm1hdEJ5dGVzKHRoaXMuZmlsZVJlc3RyaWN0aW9ucy5taW5GaWxlU2l6ZSk7XG4gICAgICBjb25zdCBtYXhGaWxlU2l6ZSA9IGZvcm1hdEJ5dGVzKHRoaXMuZmlsZVJlc3RyaWN0aW9ucy5tYXhGaWxlU2l6ZSk7XG4gICAgICBjb25zdCBhcmdzID0gW3RoaXMuc2l6ZU5vdEFsbG93ZWQsIG1pbkZpbGVTaXplIHx8ICcwJywgbWF4RmlsZVNpemVdO1xuICAgICAgdGhpcy5zZXRQaXBlQXJndW1lbnRzKCdpbnZhbGlkU2l6ZScsIGFyZ3MpO1xuICAgICAgdGhpcy5zaXplTm90QWxsb3dlZCA9IDA7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZXh0ZW5zaW9uTm90QWxsb3dlZCA+IDApIHtcbiAgICAgIGNvbnN0IGFsbG93ZWRFeHRlbnNpb25zRm9ybWF0dGVkID0gdGhpcy5maWxlUmVzdHJpY3Rpb25zLmFsbG93ZWRFeHRlbnNpb25zLmpvaW4oJywgJykudG9VcHBlckNhc2UoKTtcbiAgICAgIGNvbnN0IGFyZ3MgPSBbdGhpcy5leHRlbnNpb25Ob3RBbGxvd2VkLCBhbGxvd2VkRXh0ZW5zaW9uc0Zvcm1hdHRlZF07XG4gICAgICB0aGlzLnNldFBpcGVBcmd1bWVudHMoJ2ludmFsaWRGb3JtYXQnLCBhcmdzKTtcbiAgICAgIHRoaXMuZXh0ZW5zaW9uTm90QWxsb3dlZCA9IDA7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucXVhbnRpdHlOb3RBbGxvd2VkID4gMCkge1xuICAgICAgY29uc3QgYXJncyA9IFt0aGlzLnF1YW50aXR5Tm90QWxsb3dlZF07XG4gICAgICB0aGlzLnNldFBpcGVBcmd1bWVudHMoJ2ludmFsaWRBbW91bnQnLCBhcmdzKTtcbiAgICAgIHRoaXMucXVhbnRpdHlOb3RBbGxvd2VkID0gMDtcbiAgICB9XG4gIH1cblxuICAvKiogTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yICoqZW52aWFyKiogbyhzKSBhcnF1aXZvKHMpIHNlbGVjaW9uYWRvKHMpLiAqL1xuICBzZW5kRmlsZXMoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY3VycmVudEZpbGVzICYmIHRoaXMuY3VycmVudEZpbGVzLmxlbmd0aCkge1xuICAgICAgdGhpcy51cGxvYWRGaWxlcyh0aGlzLmN1cnJlbnRGaWxlcyk7XG4gICAgfVxuICB9XG5cbiAgc2V0RGlyZWN0b3J5QXR0cmlidXRlKGNhbkhhbmRsZURpcmVjdG9yeTogYm9vbGVhbikge1xuICAgIGlmIChjYW5IYW5kbGVEaXJlY3RvcnkpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuaW5wdXRGaWxlLm5hdGl2ZUVsZW1lbnQsICd3ZWJraXRkaXJlY3RvcnknLCAndHJ1ZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmlucHV0RmlsZS5uYXRpdmVFbGVtZW50LCAnd2Via2l0ZGlyZWN0b3J5Jyk7XG4gICAgfVxuICB9XG5cbiAgLy8gQ2FzbyBvIGNvbXBvbmVudGUgZXN0aXZlciBubyBtb2RvIEF1dG9VcGxvYWQsIG8gYXJxdWl2byB0YW1iw6ltIHNlcsOhIHJlbW92aWRvIGRhIGxpc3RhLlxuICBzdG9wVXBsb2FkKGZpbGU6IFBvVXBsb2FkRmlsZSkge1xuICAgIHRoaXMudXBsb2FkU2VydmljZS5zdG9wUmVxdWVzdEJ5RmlsZShmaWxlLCAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5hdXRvVXBsb2FkKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlRmlsZShmaWxlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3RvcFVwbG9hZEhhbmRsZXIoZmlsZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICAgIH0pO1xuICB9XG5cbiAgdHJhY2tCeUZuKGluZGV4LCBmaWxlOiBQb1VwbG9hZEZpbGUpIHtcbiAgICByZXR1cm4gZmlsZS51aWQ7XG4gIH1cblxuICAvLyBFbnZpYSBvcyBhcnF1aXZvcyBwYXNzYWRvcyBwb3IgcGFyw6JtZXRybywgZXhjZXRvIG9zIHF1ZSBqw6EgZm9yYW0gZW52aWFkb3MgYW8gc2VydmnDp28uXG4gIHVwbG9hZEZpbGVzKGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+KSB7XG4gICAgY29uc3QgZmlsZXNGaWx0ZXJlZCA9IGZpbGVzLmZpbHRlcihmaWxlID0+IGZpbGUuc3RhdHVzICE9PSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZCk7XG4gICAgdGhpcy51cGxvYWRTZXJ2aWNlLnVwbG9hZChcbiAgICAgIHRoaXMudXJsLFxuICAgICAgZmlsZXNGaWx0ZXJlZCxcbiAgICAgIHRoaXMuaGVhZGVycyxcbiAgICAgIHRoaXMub25VcGxvYWQsXG4gICAgICAoZmlsZSwgcGVyY2VudCk6IGFueSA9PiB7XG4gICAgICAgIC8vIFVQTE9BRElOR1xuICAgICAgICB0aGlzLnVwbG9hZGluZ0hhbmRsZXIoZmlsZSwgcGVyY2VudCk7XG4gICAgICB9LFxuICAgICAgKGZpbGUsIGV2ZW50UmVzcG9uc2UpOiBhbnkgPT4ge1xuICAgICAgICAvLyBTVUNDRVNTXG4gICAgICAgIHRoaXMucmVzcG9uc2VIYW5kbGVyKGZpbGUsIFBvVXBsb2FkU3RhdHVzLlVwbG9hZGVkKTtcbiAgICAgICAgdGhpcy5vblN1Y2Nlc3MuZW1pdChldmVudFJlc3BvbnNlKTtcbiAgICAgIH0sXG4gICAgICAoZmlsZSwgZXZlbnRFcnJvcik6IGFueSA9PiB7XG4gICAgICAgIC8vIEVycm9yXG4gICAgICAgIHRoaXMucmVzcG9uc2VIYW5kbGVyKGZpbGUsIFBvVXBsb2FkU3RhdHVzLkVycm9yKTtcbiAgICAgICAgdGhpcy5vbkVycm9yLmVtaXQoZXZlbnRFcnJvcik7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYW5JbnB1dFZhbHVlKCkge1xuICAgIHRoaXMuY2FsbGVkQnlDbGVhbklucHV0VmFsdWUgPSB0cnVlO1xuICAgIHRoaXMuaW5wdXRGaWxlLm5hdGl2ZUVsZW1lbnQudmFsdWUgPSAnJztcbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIC8vIGZ1bsOnw6NvIGRpc3BhcmFkYSBuYSByZXNwb3N0YSBkbyBzdWNlc3NvIG91IGVycm9yXG4gIHByaXZhdGUgcmVzcG9uc2VIYW5kbGVyKGZpbGU6IFBvVXBsb2FkRmlsZSwgc3RhdHVzOiBQb1VwbG9hZFN0YXR1cykge1xuICAgIGZpbGUuc3RhdHVzID0gc3RhdHVzO1xuICAgIGZpbGUucGVyY2VudCA9IDEwMDtcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgLy8gbcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yIHNldGFyIG9zIGFyZ3VtZW50b3MgZG8gaTE4blBpcGUgZGUgYWNvcmRvIGNvbSBhIHJlc3RyacOnw6NvLlxuICBwcml2YXRlIHNldFBpcGVBcmd1bWVudHMobGl0ZXJhbEF0dHJpYnV0ZXM6IHN0cmluZywgbGl0ZXJhbEFyZ3VtZW50cz8pIHtcbiAgICBjb25zdCBwaXBlQXJndW1lbnRzID0gdGhpcy5pMThuUGlwZS50cmFuc2Zvcm0odGhpcy5saXRlcmFsc1tsaXRlcmFsQXR0cmlidXRlc10sIGxpdGVyYWxBcmd1bWVudHMpO1xuICAgIHRoaXMubm90aWZpY2F0aW9uLmluZm9ybWF0aW9uKHBpcGVBcmd1bWVudHMpO1xuICB9XG5cbiAgLy8gRnVuw6fDo28gZGlzcGFyYWRhIGFvIHBhcmFyIHVtIGVudmlvIGRlIGFycXVpdm8uXG4gIHByaXZhdGUgc3RvcFVwbG9hZEhhbmRsZXIoZmlsZTogUG9VcGxvYWRGaWxlKSB7XG4gICAgZmlsZS5zdGF0dXMgPSBQb1VwbG9hZFN0YXR1cy5Ob25lO1xuICAgIGZpbGUucGVyY2VudCA9IDA7XG4gICAgdGhpcy5jZC5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRmlsZXMoZmlsZXMpIHtcbiAgICB0aGlzLmN1cnJlbnRGaWxlcyA9IHRoaXMucGFyc2VGaWxlcyhmaWxlcyk7XG5cbiAgICB0aGlzLnVwZGF0ZU1vZGVsKFsuLi50aGlzLmN1cnJlbnRGaWxlc10pO1xuXG4gICAgaWYgKHRoaXMuYXV0b1VwbG9hZCkge1xuICAgICAgdGhpcy51cGxvYWRGaWxlcyh0aGlzLmN1cnJlbnRGaWxlcyk7XG4gICAgfVxuICB9XG5cbiAgLy8gQXR1YWxpemEgbyBuZ01vZGVsIHBhcmEgb3MgYXJxdWl2b3MgcGFzc2Fkb3MgcG9yIHBhcsOibWV0cm8uXG4gIHByaXZhdGUgdXBkYXRlTW9kZWwoZmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4pIHtcbiAgICBjb25zdCBtb2RlbEZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+ID0gdGhpcy5tYXBDbGVhblVwbG9hZEZpbGVzKGZpbGVzKTtcbiAgICB0aGlzLm9uTW9kZWxDaGFuZ2UgPyB0aGlzLm9uTW9kZWxDaGFuZ2UobW9kZWxGaWxlcykgOiB0aGlzLm5nTW9kZWxDaGFuZ2UuZW1pdChtb2RlbEZpbGVzKTtcbiAgfVxuXG4gIC8vIEZ1bsOnw6NvIGRpc3BhcmFkYSBlbnF1YW50byBvIGFycXVpdm8gZXN0w6Egc2VuZG8gZW52aWFkbyBhbyBzZXJ2acOnby5cbiAgcHJpdmF0ZSB1cGxvYWRpbmdIYW5kbGVyKGZpbGU6IGFueSwgcGVyY2VudDogbnVtYmVyKSB7XG4gICAgZmlsZS5zdGF0dXMgPSBQb1VwbG9hZFN0YXR1cy5VcGxvYWRpbmc7XG4gICAgZmlsZS5wZXJjZW50ID0gcGVyY2VudDtcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgLy8gcmV0b3JuYSBvcyBvYmpldG9zIGRvIGFycmF5IHNlbSBhcyBwcm9wcmllZGFkZXM6IHBlcmNlbnQgZSBkaXNwbGF5TmFtZVxuICBwcml2YXRlIG1hcENsZWFuVXBsb2FkRmlsZXMoZmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4pOiBBcnJheTxQb1VwbG9hZEZpbGU+IHtcbiAgICBjb25zdCBtYXBlZEJ5VXBsb2FkRmlsZSA9IHByb2dyZXNzRmlsZSA9PiB7XG4gICAgICBjb25zdCB7IHBlcmNlbnQsIGRpc3BsYXlOYW1lLCAuLi51cGxvYWRGaWxlIH0gPSBwcm9ncmVzc0ZpbGU7XG5cbiAgICAgIHJldHVybiB1cGxvYWRGaWxlO1xuICAgIH07XG5cbiAgICByZXR1cm4gZmlsZXMubWFwKG1hcGVkQnlVcGxvYWRGaWxlKTtcbiAgfVxufVxuIiwiPHBvLWZpZWxkLWNvbnRhaW5lclxuICBbcC1kaXNhYmxlZF09XCJpc0Rpc2FibGVkXCJcbiAgW3AtaWRdPVwiaWRcIlxuICBbcC1sYWJlbF09XCJsYWJlbFwiXG4gIFtwLW9wdGlvbmFsXT1cIm9wdGlvbmFsXCJcbiAgW3AtcmVxdWlyZWRdPVwicmVxdWlyZWRcIlxuICBbcC1zaG93LXJlcXVpcmVkXT1cInNob3dSZXF1aXJlZFwiXG4+XG4gIDxkaXYgY2xhc3M9XCJwby1maWVsZC1jb250YWluZXItY29udGVudFwiPlxuICAgIDxkaXYgY2xhc3M9XCJwby11cGxvYWRcIj5cbiAgICAgIDxpbnB1dFxuICAgICAgICAjaW5wdXRGaWxlXG4gICAgICAgIGNsYXNzPVwicG8tdXBsb2FkLWlucHV0XCJcbiAgICAgICAgdHlwZT1cImZpbGVcIlxuICAgICAgICBbYWNjZXB0XT1cImFsbG93ZWRFeHRlbnNpb25zXCJcbiAgICAgICAgW2F0dHIubmFtZV09XCJuYW1lXCJcbiAgICAgICAgW2lkXT1cImlkXCJcbiAgICAgICAgW2Rpc2FibGVkXT1cImlzRGlzYWJsZWRcIlxuICAgICAgICBbbXVsdGlwbGVdPVwiaXNNdWx0aXBsZVwiXG4gICAgICAgIFtyZXF1aXJlZF09XCJyZXF1aXJlZFwiXG4gICAgICAgIChjaGFuZ2UpPVwib25GaWxlQ2hhbmdlKCRldmVudClcIlxuICAgICAgLz5cblxuICAgICAgPHBvLXVwbG9hZC1kcmFnLWRyb3BcbiAgICAgICAgKm5nSWY9XCJkaXNwbGF5RHJhZ0Ryb3BcIlxuICAgICAgICBbcC1kaXJlY3RvcnktY29tcGF0aWJsZV09XCJjYW5IYW5kbGVEaXJlY3RvcnlcIlxuICAgICAgICBbcC1kaXNhYmxlZF09XCJpc0Rpc2FibGVkXCJcbiAgICAgICAgW3AtZHJhZy1kcm9wLWhlaWdodF09XCJkcmFnRHJvcEhlaWdodFwiXG4gICAgICAgIFtwLWxpdGVyYWxzXT1cImxpdGVyYWxzXCJcbiAgICAgICAgKHAtZmlsZS1jaGFuZ2UpPVwib25GaWxlQ2hhbmdlRHJhZ0Ryb3AoJGV2ZW50KVwiXG4gICAgICAgIChwLXNlbGVjdC1maWxlcyk9XCJzZWxlY3RGaWxlcygpXCJcbiAgICAgID5cbiAgICAgIDwvcG8tdXBsb2FkLWRyYWctZHJvcD5cblxuICAgICAgPHBvLWJ1dHRvblxuICAgICAgICAqbmdJZj1cIiFoaWRlU2VsZWN0QnV0dG9uICYmICFkaXNwbGF5RHJhZ0Ryb3BcIlxuICAgICAgICAjdXBsb2FkQnV0dG9uXG4gICAgICAgIGNsYXNzPVwicG8tdXBsb2FkLWJ1dHRvblwiXG4gICAgICAgIGZvcj1cImZpbGVcIlxuICAgICAgICBbcC1kaXNhYmxlZF09XCJpc0Rpc2FibGVkXCJcbiAgICAgICAgW3AtbGFiZWxdPVwic2VsZWN0RmlsZUJ1dHRvbkxhYmVsXCJcbiAgICAgICAgKHAtY2xpY2spPVwic2VsZWN0RmlsZXMoKVwiXG4gICAgICA+XG4gICAgICA8L3BvLWJ1dHRvbj5cblxuICAgICAgPHBvLXVwbG9hZC1maWxlLXJlc3RyaWN0aW9uc1xuICAgICAgICAqbmdJZj1cImZpbGVSZXN0cmljdGlvbnMgJiYgIWhpZGVSZXN0cmljdGlvbnNJbmZvXCJcbiAgICAgICAgY2xhc3M9XCJwby11cGxvYWQtZmlsZS1yZXN0cmljdGlvbnNcIlxuICAgICAgICBbbmdDbGFzc109XCJ7ICdwby11cGxvYWQtZmlsZS1yZXN0cmljdGlvbnMtZHJhZy1kcm9wJzogZGlzcGxheURyYWdEcm9wIH1cIlxuICAgICAgICBbcC1hbGxvd2VkLWV4dGVuc2lvbnNdPVwiZmlsZVJlc3RyaWN0aW9ucz8uYWxsb3dlZEV4dGVuc2lvbnNcIlxuICAgICAgICBbcC1tYXgtZmlsZXNdPVwibWF4RmlsZXNcIlxuICAgICAgICBbcC1tYXgtZmlsZS1zaXplXT1cImZpbGVSZXN0cmljdGlvbnM/Lm1heEZpbGVTaXplXCJcbiAgICAgICAgW3AtbWluLWZpbGUtc2l6ZV09XCJmaWxlUmVzdHJpY3Rpb25zPy5taW5GaWxlU2l6ZVwiXG4gICAgICA+XG4gICAgICA8L3BvLXVwbG9hZC1maWxlLXJlc3RyaWN0aW9ucz5cblxuICAgICAgPGRpdiAqbmdJZj1cImN1cnJlbnRGaWxlcyAmJiBjdXJyZW50RmlsZXMubGVuZ3RoXCIgY2xhc3M9XCJwby11cGxvYWQtcHJvZ3Jlc3MtY29udGFpbmVyXCI+XG4gICAgICAgIDxwby1jb250YWluZXJcbiAgICAgICAgICBbcC1oZWlnaHRdPVwiaGFzTW9yZVRoYW5Gb3VySXRlbXMgPyAyODAgOiAnYXV0bydcIlxuICAgICAgICAgIFtwLW5vLWJvcmRlcl09XCIhaGFzTW9yZVRoYW5Gb3VySXRlbXNcIlxuICAgICAgICAgIFtwLW5vLXBhZGRpbmddPVwiIWhhc01vcmVUaGFuRm91ckl0ZW1zXCJcbiAgICAgICAgPlxuICAgICAgICAgIDxkaXYgW25nQ2xhc3NdPVwieyAncG8tdXBsb2FkLXByb2dyZXNzLWNvbnRhaW5lci1hcmVhIHBvLXB0LTIgcG8tcGwtMSc6IGhhc01vcmVUaGFuRm91ckl0ZW1zIH1cIj5cbiAgICAgICAgICAgIDxwby1wcm9ncmVzc1xuICAgICAgICAgICAgICAqbmdGb3I9XCJsZXQgZmlsZSBvZiBjdXJyZW50RmlsZXM7IHRyYWNrQnk6IHRyYWNrQnlGblwiXG4gICAgICAgICAgICAgIFtwLWluZm9dPVwiaW5mb0J5VXBsb2FkU3RhdHVzW2ZpbGUuc3RhdHVzXT8udGV4dChmaWxlLnBlcmNlbnQpXCJcbiAgICAgICAgICAgICAgW3AtaW5mby1pY29uXT1cImluZm9CeVVwbG9hZFN0YXR1c1tmaWxlLnN0YXR1c10/Lmljb25cIlxuICAgICAgICAgICAgICBbcC1zdGF0dXNdPVwicHJvZ3Jlc3NTdGF0dXNCeUZpbGVTdGF0dXNbZmlsZS5zdGF0dXNdXCJcbiAgICAgICAgICAgICAgW3AtdGV4dF09XCJmaWxlLmRpc3BsYXlOYW1lXCJcbiAgICAgICAgICAgICAgW3AtdmFsdWVdPVwiZmlsZS5wZXJjZW50XCJcbiAgICAgICAgICAgICAgKHAtY2FuY2VsKT1cImNhbmNlbChmaWxlKVwiXG4gICAgICAgICAgICAgIChwLXJldHJ5KT1cInVwbG9hZEZpbGVzKFtmaWxlXSlcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9wby1wcm9ncmVzcz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9wby1jb250YWluZXI+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPHBvLWJ1dHRvblxuICAgICAgICAqbmdJZj1cImRpc3BsYXlTZW5kQnV0dG9uXCJcbiAgICAgICAgY2xhc3M9XCJwby11cGxvYWQtc2VuZC1idXR0b25cIlxuICAgICAgICBbY2xhc3MucG8tbXQtM109XCJoYXNNb3JlVGhhbkZvdXJJdGVtc1wiXG4gICAgICAgIHAta2luZD1cInByaW1hcnlcIlxuICAgICAgICBbcC1kaXNhYmxlZF09XCJoYXNBbnlGaWxlVXBsb2FkaW5nKGN1cnJlbnRGaWxlcylcIlxuICAgICAgICBbcC1sYWJlbF09XCJsaXRlcmFscy5zdGFydFNlbmRpbmdcIlxuICAgICAgICAocC1jbGljayk9XCJ1cGxvYWRGaWxlcyhjdXJyZW50RmlsZXMpXCJcbiAgICAgID48L3BvLWJ1dHRvbj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIDxwby1maWVsZC1jb250YWluZXItYm90dG9tIFtwLWhlbHBdPVwiaGVscFwiIFtwLWRpc2FibGVkXT1cImRpc2FibGVkXCI+PC9wby1maWVsZC1jb250YWluZXItYm90dG9tPlxuPC9wby1maWVsZC1jb250YWluZXI+XG4iXX0=