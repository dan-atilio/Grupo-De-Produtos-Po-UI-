import { ChangeDetectionStrategy, Component, ElementRef, ViewChild } from '@angular/core';
import { PoControlPositionService } from '../../services/po-control-position/po-control-position.service';
import { PoKeyCodeEnum } from './../../enums/po-key-code.enum';
import { PoSearchFilterMode } from './enum/po-search-filter-mode.enum';
import { PoSearchBaseComponent } from './po-search-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../services/po-language/po-language.service";
import * as i2 from "../../services/po-control-position/po-control-position.service";
import * as i3 from "@angular/common";
import * as i4 from "../po-field/po-clean/po-clean.component";
import * as i5 from "../po-icon/po-icon.component";
import * as i6 from "../po-listbox/po-listbox.component";
import * as i7 from "../po-dropdown/po-dropdown.component";
const _c0 = ["poSearchInput"];
const _c1 = ["poListboxContainerElement"];
const _c2 = ["poListboxElement"];
const _c3 = ["poListbox"];
function PoSearchComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 12);
    i0.ɵɵelement(1, "po-dropdown", 13);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-label", ctx_r0.searchFilterSelectLabel)("p-disabled", ctx_r0.disabled)("p-actions", ctx_r0.searchFilterSelectActions);
} }
function PoSearchComponent_div_2_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 14);
    i0.ɵɵelement(1, "po-icon", 15);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-icon", ctx_r1.icon ? ctx_r1.icon : "ICON_SEARCH");
} }
function PoSearchComponent_button_6_Template(rf, ctx) { if (rf & 1) {
    const _r9 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "button", 16);
    i0.ɵɵlistener("click", function PoSearchComponent_button_6_Template_button_click_0_listener() { i0.ɵɵrestoreView(_r9); const ctx_r8 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r8.clearSearch()); })("keydown.enter", function PoSearchComponent_button_6_Template_button_keydown_enter_0_listener() { i0.ɵɵrestoreView(_r9); const ctx_r10 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r10.clearSearch()); });
    i0.ɵɵelement(1, "po-clean", 17);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = i0.ɵɵnextContext();
    i0.ɵɵproperty("ariaLabel", ctx_r3.literals.clean);
} }
function PoSearchComponent_button_7_Template(rf, ctx) { if (rf & 1) {
    const _r12 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "button", 18);
    i0.ɵɵlistener("click", function PoSearchComponent_button_7_Template_button_click_0_listener() { i0.ɵɵrestoreView(_r12); const ctx_r11 = i0.ɵɵnextContext(); const _r2 = i0.ɵɵreference(4); return i0.ɵɵresetView(ctx_r11.onSearchChange(_r2.value, true, true)); })("keydown.enter", function PoSearchComponent_button_7_Template_button_keydown_enter_0_listener() { i0.ɵɵrestoreView(_r12); const ctx_r13 = i0.ɵɵnextContext(); const _r2 = i0.ɵɵreference(4); return i0.ɵɵresetView(ctx_r13.onSearchChange(_r2.value, true, true)); });
    i0.ɵɵelement(1, "po-icon", 15);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = i0.ɵɵnextContext();
    i0.ɵɵproperty("ariaLabel", ctx_r4.literals.search)("disabled", ctx_r4.disabled);
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-icon", ctx_r4.icon ? ctx_r4.icon : "ICON_SEARCH");
} }
const poSearchContainerOffset = 8;
const poSearchContainerPositionDefault = 'bottom';
/**
 * @docsExtends PoSearchBaseComponent
 *
 * @example
 *
 * <example name="po-search-basic" title="PO Search Basic">
 *  <file name="sample-po-search-basic/sample-po-search-basic.component.html"> </file>
 *  <file name="sample-po-search-basic/sample-po-search-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-search-labs" title="PO Search Labs">
 *  <file name="sample-po-search-labs/sample-po-search-labs.component.html"> </file>
 *  <file name="sample-po-search-labs/sample-po-search-labs.component.ts"> </file>
 *  <file name="sample-po-search-labs/sample-po-search-labs.service.ts"> </file>
 * </example>
 *
 * <example name="po-search-find-people" title="PO Search Find People">
 *  <file name="sample-po-search-find-people/sample-po-search-find-people.component.html"> </file>
 *  <file name="sample-po-search-find-people/sample-po-search-find-people.component.ts"> </file>
 *  <file name="sample-po-search-find-people/sample-po-search-find-people.service.ts"> </file>
 * </example>
 *
 * <example name="po-search-listbox" title="PO Search With Listbox">
 *  <file name="sample-po-search-listbox/sample-po-search-listbox.component.html"> </file>
 *  <file name="sample-po-search-listbox/sample-po-search-listbox.component.ts"> </file>
 *  <file name="sample-po-search-listbox/sample-po-search-listbox.service.ts"> </file>
 * </example>
 *
 * <example name="po-search-filter-select" title="PO Search With Filter Select + Listbox">
 *  <file name="sample-po-search-filter-select/sample-po-search-filter-select.component.html"> </file>
 *  <file name="sample-po-search-filter-select/sample-po-search-filter-select.component.ts"> </file>
 * </example>
 *
 */
export class PoSearchComponent extends PoSearchBaseComponent {
    languageService;
    renderer;
    changeDetector;
    controlPosition;
    clickoutListener;
    eventResizeListener;
    poSearchInput;
    poListboxContainerElement;
    poListboxElement;
    poListbox;
    listboxFilteredItems = [];
    filteredItems = [];
    listboxOpen = false;
    shouldMarkLetters = true;
    isFiltering = false;
    listboxItemclicked = false;
    searchFilter = {};
    searchFilterSelectLabel;
    searchFilterSelectActions;
    constructor(languageService, renderer, changeDetector, controlPosition) {
        super(languageService);
        this.languageService = languageService;
        this.renderer = renderer;
        this.changeDetector = changeDetector;
        this.controlPosition = controlPosition;
    }
    ngOnInit() {
        this.filteredItems = this.items;
        if (this.showListbox) {
            this.listboxFilteredItems = this.listboxItems;
        }
        if (this.filterSelect) {
            this.createDropdownFilterSelect();
        }
    }
    ngOnChanges(changes) {
        if (changes.filterSelect && changes.filterSelect.currentValue) {
            this.createDropdownFilterSelect();
        }
    }
    ngOnDestroy() {
        this.removeListeners();
    }
    clearSearch() {
        this.poSearchInput.nativeElement.value = '';
        this.onSearchChange('', true);
        this.filteredItemsChange.emit(this.items);
        this.onCloseListbox();
    }
    onSearchChange(searchText, activated, buttonClick) {
        const searchTextInitial = searchText;
        if (searchText !== undefined) {
            searchText = searchText.toLowerCase();
        }
        this.isFiltering = true;
        if (this.showListbox && !buttonClick && searchText.length > 0) {
            this.controlListboxVisibility(true);
            this.listboxFilteredItems = this.getListboxFilteredItems(searchText);
        }
        else {
            if (searchText.length === 0) {
                this.listboxFilteredItems = this.listboxItems;
            }
        }
        if (activated && !this.listboxItemclicked) {
            this.updateFilteredItems(searchText);
            this.filteredItemsChange.emit(this.filteredItems);
            if (this.filterSelect) {
                this.searchFilter = {
                    ...this.searchFilter,
                    value: searchTextInitial
                };
            }
            else {
                this.searchFilter = {
                    filter: this.filterKeys,
                    value: searchTextInitial
                };
            }
            this.filter.emit(this.searchFilter);
            this.changeModel.emit(searchText);
        }
        if (this.listboxItemclicked) {
            this.listboxItemclicked = false;
        }
        this.changeDetector.detectChanges();
    }
    updateFilteredItems(searchText) {
        if (this.items && this.items.length > 0) {
            this.filteredItems = this.getFilteredItems(searchText);
        }
        else {
            this.filteredItems = [];
        }
    }
    getFilteredItems(searchText) {
        return this.items.filter(item => this.itemMatchesFilter(item, searchText));
    }
    itemMatchesFilter(item, searchText) {
        const valuesToSearch = this.filterKeys
            .map(key => (typeof item[key] !== 'string' ? String(item[key]) : item[key]))
            .map(value => (value ? value.toLowerCase() : ''));
        return valuesToSearch.some(value => this.filterValue(value, searchText));
    }
    getListboxFilteredItems(searchText) {
        return this.listboxItems.filter(item => this.filterValue(item.value, searchText));
    }
    filterValue(value, searchText) {
        value = value?.toLowerCase();
        switch (this.filterType) {
            case PoSearchFilterMode.startsWith:
                return value?.startsWith(searchText);
            case PoSearchFilterMode.contains:
                return value?.includes(searchText);
            case PoSearchFilterMode.endsWith:
                return value?.endsWith(searchText);
            default:
                return false;
        }
    }
    get listboxItems() {
        return this.items
            .map(item => this.filterKeys.map(key => item[key]).map(item => (typeof item !== 'string' ? String(item) : item)))
            .flat()
            .map(value => ({ label: value, value }))
            .filter((obj, index, self) => index === self.findIndex(o => o.label === obj.label && o.value === obj.value));
    }
    onCloseListbox() {
        this.poSearchInput.nativeElement.focus();
        this.controlListboxVisibility(false);
        this.isFiltering = false;
    }
    onListboxClick(option, event) {
        if (event) {
            event.stopPropagation();
        }
        if (!event || event.code === 'Enter') {
            this.listboxItemclicked = true;
        }
        this.poSearchInput.nativeElement.value = option.value;
        this.listboxOnClick.emit(option.value);
        this.onCloseListbox();
        if (this.type === 'action') {
            this.listboxItemclicked = false;
            this.onSearchChange(option.value.toString(), true, true);
        }
    }
    onBlur() {
        if (this.listboxOpen) {
            if (!this.poListbox.items.length) {
                this.controlListboxVisibility(false);
            }
            else {
                this.focusItem();
            }
        }
    }
    onKeyDown(event) {
        const key = event.keyCode;
        if (event.shiftKey && key === PoKeyCodeEnum.tab) {
            this.controlListboxVisibility(false);
            return;
        }
        if (key === PoKeyCodeEnum.tab) {
            this.controlListboxVisibility(false);
            return;
        }
        if (key === PoKeyCodeEnum.arrowDown) {
            event.preventDefault();
            if (!this.listboxOpen) {
                return;
            }
            this.focusItem();
            this.controlListboxVisibility(true);
            return;
        }
        if (key === PoKeyCodeEnum.esc) {
            this.controlListboxVisibility(false);
            this.poSearchInput.nativeElement.focus();
        }
        if (key === PoKeyCodeEnum.enter && this.listboxOpen) {
            this.controlListboxVisibility(false);
            this.isFiltering = false;
        }
    }
    focusItem() {
        const listboxItemList = document.querySelectorAll('.po-listbox-item');
        setTimeout(() => {
            Array.from(listboxItemList).forEach((el) => {
                el.tabIndex = -1;
                el.classList.remove('cdk-option-active');
            });
            const firstOption = listboxItemList[0];
            firstOption.focus();
            firstOption.classList.add('cdk-option-active');
        });
    }
    setContainerPosition() {
        if (this.poListboxContainerElement && this.poSearchInput) {
            this.controlPosition.setElements(this.poListboxContainerElement.nativeElement, poSearchContainerOffset, this.poSearchInput, ['top', 'bottom'], true);
            this.adjustContainerPosition();
        }
    }
    adjustContainerPosition() {
        if (this.poListboxContainerElement && this.poSearchInput) {
            this.controlPosition.adjustPosition(poSearchContainerPositionDefault);
        }
    }
    controlListboxVisibility(toOpen) {
        toOpen ? this.openListbox() : this.closeListbox();
    }
    openListbox() {
        this.listboxOpen = true;
        this.changeDetector.detectChanges();
        this.initializeListeners();
        this.poSearchInput.nativeElement.focus();
        this.setContainerPosition();
    }
    closeListbox() {
        this.listboxOpen = false;
        this.changeDetector.detectChanges();
        this.removeListeners();
    }
    clickedOutsideInput(event) {
        if (this.listboxOpen &&
            !this.poSearchInput.nativeElement.contains(event.target) &&
            (!this.poListboxElement || !this.poListboxElement.nativeElement.contains(event.target))) {
            this.controlListboxVisibility(false);
        }
    }
    initializeListeners() {
        this.removeListeners();
        this.clickoutListener = this.renderer.listen('document', 'click', (event) => {
            this.clickedOutsideInput(event);
        });
        this.eventResizeListener = this.renderer.listen('window', 'resize', () => {
            setTimeout(() => this.adjustContainerPosition(), 250);
        });
        window.addEventListener('scroll', this.onScroll, true);
    }
    removeListeners() {
        if (this.clickoutListener) {
            this.clickoutListener();
        }
        if (this.eventResizeListener) {
            this.eventResizeListener();
        }
        window.removeEventListener('scroll', this.onScroll, true);
    }
    onScroll = () => {
        this.adjustContainerPosition();
    };
    getInputValue() {
        return this.poSearchInput.nativeElement.value;
    }
    createDropdownFilterSelect() {
        this.searchFilterSelectActions = [];
        if (!this.filterSelect) {
            return;
        }
        this.filterSelect.forEach(filterOption => {
            const selectOption = {
                label: filterOption.label,
                action: () => this.changeFilterSelect(filterOption),
                selected: this.isSelected(filterOption)
            };
            this.searchFilterSelectActions.push(selectOption);
        });
        this.changeFilterSelect(this.filterSelect[0]);
    }
    isSelected(filterOption) {
        return this.searchFilterSelectLabel === filterOption.label;
    }
    changeFilterSelect(filterOption) {
        this.searchFilterSelectLabel = filterOption.label;
        this.filterKeys = Array.isArray(filterOption.value) ? [...filterOption.value] : [filterOption.value];
        if (!this.searchFilterSelectActions) {
            return;
        }
        this.searchFilterSelectActions.map(action => (action.selected = false));
        const selectAction = this.searchFilterSelectActions.find(action => action.label === this.searchFilterSelectLabel);
        selectAction.selected = true;
        this.searchFilter = {
            filter: filterOption.label === this.literals.all ? ['all'] : filterOption.value
        };
        this.poSearchInput.nativeElement.focus();
        if (this.type === 'action') {
            this.onSearchChange(this.getInputValue(), true);
        }
    }
    static ɵfac = function PoSearchComponent_Factory(t) { return new (t || PoSearchComponent)(i0.ɵɵdirectiveInject(i1.PoLanguageService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i2.PoControlPositionService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoSearchComponent, selectors: [["po-search"]], viewQuery: function PoSearchComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(_c0, 7, ElementRef);
            i0.ɵɵviewQuery(_c1, 5, ElementRef);
            i0.ɵɵviewQuery(_c2, 5, ElementRef);
            i0.ɵɵviewQuery(_c3, 5);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poSearchInput = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poListboxContainerElement = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poListboxElement = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poListbox = _t.first);
        } }, features: [i0.ɵɵProvidersFeature([PoControlPositionService]), i0.ɵɵInheritDefinitionFeature, i0.ɵɵNgOnChangesFeature], decls: 13, vars: 20, consts: [[1, "po-search"], ["class", "po-search-select", 4, "ngIf"], ["class", "po-search-icon", 4, "ngIf"], ["type", "text", 1, "po-search-input", 3, "ariaLabel", "disabled", "placeholder", "input", "keyup.enter", "keydown", "blur"], ["poSearchInput", ""], [1, "po-search-buttons"], ["class", "po-search-button po-search-button-clean", "type", "button", 3, "ariaLabel", "click", "keydown.enter", 4, "ngIf"], ["class", "po-search-button po-search-button-trigger", "type", "button", 3, "ariaLabel", "disabled", "click", "keydown.enter", 4, "ngIf"], [1, "po-search-listbox-container", 3, "hidden"], ["poListboxContainerElement", ""], ["p-type", "option", 3, "p-items", "p-visible", "p-filter-mode", "p-should-mark-letter", "p-filtering", "p-search-value", "p-selectcombo-item", "p-close"], ["poListbox", "", "poListboxElement", ""], [1, "po-search-select"], [3, "p-label", "p-disabled", "p-actions"], [1, "po-search-icon"], [3, "p-icon"], ["type", "button", 1, "po-search-button", "po-search-button-clean", 3, "ariaLabel", "click", "keydown.enter"], [1, "po-icon-input"], ["type", "button", 1, "po-search-button", "po-search-button-trigger", 3, "ariaLabel", "disabled", "click", "keydown.enter"]], template: function PoSearchComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵelementStart(0, "div", 0);
            i0.ɵɵtemplate(1, PoSearchComponent_div_1_Template, 2, 3, "div", 1)(2, PoSearchComponent_div_2_Template, 2, 1, "div", 2);
            i0.ɵɵelementStart(3, "input", 3, 4);
            i0.ɵɵlistener("input", function PoSearchComponent_Template_input_input_3_listener($event) { ctx.onSearchChange($event.target.value, false); return ctx.onSearchChange($event.target.value, ctx.type === "action" ? true : false); })("keyup.enter", function PoSearchComponent_Template_input_keyup_enter_3_listener($event) { ctx.listboxOpen ? ctx.closeListbox() : ctx.onSearchChange($event.target.value, ctx.type === "trigger" ? true : false, true); return ctx.closeListbox(); })("keydown", function PoSearchComponent_Template_input_keydown_3_listener($event) { return ctx.onKeyDown($event); })("blur", function PoSearchComponent_Template_input_blur_3_listener() { return ctx.onBlur(); });
            i0.ɵɵelementEnd();
            i0.ɵɵelementStart(5, "div", 5);
            i0.ɵɵtemplate(6, PoSearchComponent_button_6_Template, 2, 1, "button", 6)(7, PoSearchComponent_button_7_Template, 2, 3, "button", 7);
            i0.ɵɵelementEnd()();
            i0.ɵɵelementStart(8, "div", 8, 9)(10, "po-listbox", 10, 11);
            i0.ɵɵlistener("p-selectcombo-item", function PoSearchComponent_Template_po_listbox_p_selectcombo_item_10_listener($event) { return ctx.onListboxClick($event, $event.event); })("p-close", function PoSearchComponent_Template_po_listbox_p_close_10_listener() { return ctx.onCloseListbox(); });
            i0.ɵɵelementEnd()();
        } if (rf & 2) {
            const _r2 = i0.ɵɵreference(4);
            i0.ɵɵclassProp("po-search-disabled", ctx.disabled);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.filterSelect);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.type === "action");
            i0.ɵɵadvance();
            i0.ɵɵclassProp("po-search-input-clean", !!_r2.value && !ctx.disabled)("po-search-input-trigger", ctx.type === "trigger");
            i0.ɵɵproperty("ariaLabel", ctx.ariaLabel)("disabled", ctx.disabled)("placeholder", ctx.literals.search);
            i0.ɵɵadvance(3);
            i0.ɵɵproperty("ngIf", !!_r2.value && !ctx.disabled);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.type === "trigger");
            i0.ɵɵadvance();
            i0.ɵɵproperty("hidden", !ctx.listboxOpen);
            i0.ɵɵadvance(2);
            i0.ɵɵproperty("p-items", ctx.listboxFilteredItems)("p-visible", ctx.listboxOpen)("p-filter-mode", ctx.filterType)("p-should-mark-letter", ctx.shouldMarkLetters)("p-filtering", ctx.isFiltering)("p-search-value", ctx.getInputValue());
        } }, dependencies: [i3.NgIf, i4.PoCleanComponent, i5.PoIconComponent, i6.PoListBoxComponent, i7.PoDropdownComponent], encapsulation: 2, changeDetection: 0 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoSearchComponent, [{
        type: Component,
        args: [{ selector: 'po-search', providers: [PoControlPositionService], changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"po-search\" [class.po-search-disabled]=\"disabled\">\n  <div class=\"po-search-select\" *ngIf=\"filterSelect\">\n    <po-dropdown [p-label]=\"searchFilterSelectLabel\" [p-disabled]=\"disabled\" [p-actions]=\"searchFilterSelectActions\">\n    </po-dropdown>\n  </div>\n\n  <div *ngIf=\"type === 'action'\" class=\"po-search-icon\">\n    <po-icon [p-icon]=\"icon ? icon : 'ICON_SEARCH'\"></po-icon>\n  </div>\n\n  <input\n    #poSearchInput\n    class=\"po-search-input\"\n    type=\"text\"\n    [ariaLabel]=\"ariaLabel\"\n    [class.po-search-input-clean]=\"!!poSearchInput.value && !disabled\"\n    [class.po-search-input-trigger]=\"type === 'trigger'\"\n    [disabled]=\"disabled\"\n    [placeholder]=\"literals.search\"\n    (input)=\"\n      onSearchChange($event.target.value, false); onSearchChange($event.target.value, type === 'action' ? true : false)\n    \"\n    (keyup.enter)=\"\n      listboxOpen ? closeListbox() : onSearchChange($event.target.value, type === 'trigger' ? true : false, true);\n      closeListbox()\n    \"\n    (keydown)=\"onKeyDown($event)\"\n    (blur)=\"onBlur()\"\n  />\n\n  <div class=\"po-search-buttons\">\n    <button\n      *ngIf=\"!!poSearchInput.value && !disabled\"\n      class=\"po-search-button po-search-button-clean\"\n      type=\"button\"\n      [ariaLabel]=\"literals.clean\"\n      (click)=\"clearSearch()\"\n      (keydown.enter)=\"clearSearch()\"\n    >\n      <po-clean class=\"po-icon-input\"></po-clean>\n    </button>\n\n    <button\n      *ngIf=\"type === 'trigger'\"\n      class=\"po-search-button po-search-button-trigger\"\n      type=\"button\"\n      [ariaLabel]=\"literals.search\"\n      (click)=\"onSearchChange(poSearchInput.value, true, true)\"\n      (keydown.enter)=\"onSearchChange(poSearchInput.value, true, true)\"\n      [disabled]=\"disabled\"\n    >\n      <po-icon [p-icon]=\"icon ? icon : 'ICON_SEARCH'\"> </po-icon>\n    </button>\n  </div>\n</div>\n\n<div #poListboxContainerElement class=\"po-search-listbox-container\" [hidden]=\"!listboxOpen\">\n  <po-listbox\n    #poListbox\n    #poListboxElement\n    p-type=\"option\"\n    [p-items]=\"listboxFilteredItems\"\n    (p-selectcombo-item)=\"onListboxClick($event, $event.event)\"\n    [p-visible]=\"listboxOpen\"\n    [p-filter-mode]=\"filterType\"\n    [p-should-mark-letter]=\"shouldMarkLetters\"\n    [p-filtering]=\"isFiltering\"\n    [p-search-value]=\"getInputValue()\"\n    (p-close)=\"onCloseListbox()\"\n  ></po-listbox>\n</div>\n" }]
    }], () => [{ type: i1.PoLanguageService }, { type: i0.Renderer2 }, { type: i0.ChangeDetectorRef }, { type: i2.PoControlPositionService }], { poSearchInput: [{
            type: ViewChild,
            args: ['poSearchInput', { read: ElementRef, static: true }]
        }], poListboxContainerElement: [{
            type: ViewChild,
            args: ['poListboxContainerElement', { read: ElementRef }]
        }], poListboxElement: [{
            type: ViewChild,
            args: ['poListboxElement', { read: ElementRef }]
        }], poListbox: [{
            type: ViewChild,
            args: ['poListbox']
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoSearchComponent, { className: "PoSearchComponent", filePath: "lib/components/po-search/po-search.component.ts", lineNumber: 64 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tc2VhcmNoLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1zZWFyY2gvcG8tc2VhcmNoLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1zZWFyY2gvcG8tc2VhcmNoLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFFdkIsU0FBUyxFQUNULFVBQVUsRUFNVixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sZ0VBQWdFLENBQUM7QUFJMUcsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQy9ELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBR3ZFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDRCQUE0QixDQUFDOzs7Ozs7Ozs7Ozs7OztJQ25CakUsK0JBQW1EO0lBQ2pELGtDQUNjO0lBQ2hCLGlCQUFNOzs7SUFGUyxjQUFtQztJQUFuQyx3REFBbUMsK0JBQUEsK0NBQUE7OztJQUlsRCwrQkFBc0Q7SUFDcEQsOEJBQTBEO0lBQzVELGlCQUFNOzs7SUFESyxjQUFzQztJQUF0QyxrRUFBc0M7Ozs7SUF3Qi9DLGtDQU9DO0lBRkMsaUtBQVMsZUFBQSxvQkFBYSxDQUFBLElBQUMscUtBQ04sZUFBQSxxQkFBYSxDQUFBLElBRFA7SUFHdkIsK0JBQTJDO0lBQzdDLGlCQUFTOzs7SUFMUCxpREFBNEI7Ozs7SUFPOUIsa0NBUUM7SUFIQyxrTUFBUyxlQUFBLGtDQUFvQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUEsSUFBQyxxTUFDeEMsZUFBQSxrQ0FBb0MsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBLElB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QXVCLENBQUMsTUFBTTtpSkFNaUIsYUFBYTtrQkFBNUUsU0FBUzttQkFBQyxlQUFlLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7WUFDQSx5QkFBeUI7a0JBQXRGLFNBQVM7bUJBQUMsMkJBQTJCLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO1lBQ1AsZ0JBQWdCO2tCQUFwRSxTQUFTO21CQUFDLGtCQUFrQixFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTtZQUMzQixTQUFTO2tCQUFoQyxTQUFTO21CQUFDLFdBQVc7O2tGQVBYLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBSZW5kZXJlcjIsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBvQ29udHJvbFBvc2l0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BvLWNvbnRyb2wtcG9zaXRpb24vcG8tY29udHJvbC1wb3NpdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IFBvTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2Uuc2VydmljZSc7XG5pbXBvcnQgeyBQb0Ryb3Bkb3duQWN0aW9uIH0gZnJvbSAnLi4vcG8tZHJvcGRvd24nO1xuaW1wb3J0IHsgUG9MaXN0Qm94Q29tcG9uZW50IH0gZnJvbSAnLi4vcG8tbGlzdGJveCc7XG5pbXBvcnQgeyBQb0tleUNvZGVFbnVtIH0gZnJvbSAnLi8uLi8uLi9lbnVtcy9wby1rZXktY29kZS5lbnVtJztcbmltcG9ydCB7IFBvU2VhcmNoRmlsdGVyTW9kZSB9IGZyb20gJy4vZW51bS9wby1zZWFyY2gtZmlsdGVyLW1vZGUuZW51bSc7XG5pbXBvcnQgeyBQb1NlYXJjaEZpbHRlclNlbGVjdCB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1zZWFyY2gtZmlsdGVyLXNlbGVjdC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9TZWFyY2hPcHRpb24gfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tc2VhcmNoLW9wdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9TZWFyY2hCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby1zZWFyY2gtYmFzZS5jb21wb25lbnQnO1xuY29uc3QgcG9TZWFyY2hDb250YWluZXJPZmZzZXQgPSA4O1xuY29uc3QgcG9TZWFyY2hDb250YWluZXJQb3NpdGlvbkRlZmF1bHQgPSAnYm90dG9tJztcbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvU2VhcmNoQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXNlYXJjaC1iYXNpY1wiIHRpdGxlPVwiUE8gU2VhcmNoIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zZWFyY2gtYmFzaWMvc2FtcGxlLXBvLXNlYXJjaC1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zZWFyY2gtYmFzaWMvc2FtcGxlLXBvLXNlYXJjaC1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1zZWFyY2gtbGFic1wiIHRpdGxlPVwiUE8gU2VhcmNoIExhYnNcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNlYXJjaC1sYWJzL3NhbXBsZS1wby1zZWFyY2gtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zZWFyY2gtbGFicy9zYW1wbGUtcG8tc2VhcmNoLWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNlYXJjaC1sYWJzL3NhbXBsZS1wby1zZWFyY2gtbGFicy5zZXJ2aWNlLnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tc2VhcmNoLWZpbmQtcGVvcGxlXCIgdGl0bGU9XCJQTyBTZWFyY2ggRmluZCBQZW9wbGVcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNlYXJjaC1maW5kLXBlb3BsZS9zYW1wbGUtcG8tc2VhcmNoLWZpbmQtcGVvcGxlLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNlYXJjaC1maW5kLXBlb3BsZS9zYW1wbGUtcG8tc2VhcmNoLWZpbmQtcGVvcGxlLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zZWFyY2gtZmluZC1wZW9wbGUvc2FtcGxlLXBvLXNlYXJjaC1maW5kLXBlb3BsZS5zZXJ2aWNlLnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tc2VhcmNoLWxpc3Rib3hcIiB0aXRsZT1cIlBPIFNlYXJjaCBXaXRoIExpc3Rib3hcIj5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNlYXJjaC1saXN0Ym94L3NhbXBsZS1wby1zZWFyY2gtbGlzdGJveC5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zZWFyY2gtbGlzdGJveC9zYW1wbGUtcG8tc2VhcmNoLWxpc3Rib3guY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNlYXJjaC1saXN0Ym94L3NhbXBsZS1wby1zZWFyY2gtbGlzdGJveC5zZXJ2aWNlLnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tc2VhcmNoLWZpbHRlci1zZWxlY3RcIiB0aXRsZT1cIlBPIFNlYXJjaCBXaXRoIEZpbHRlciBTZWxlY3QgKyBMaXN0Ym94XCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zZWFyY2gtZmlsdGVyLXNlbGVjdC9zYW1wbGUtcG8tc2VhcmNoLWZpbHRlci1zZWxlY3QuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2VhcmNoLWZpbHRlci1zZWxlY3Qvc2FtcGxlLXBvLXNlYXJjaC1maWx0ZXItc2VsZWN0LmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1zZWFyY2gnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tc2VhcmNoLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbUG9Db250cm9sUG9zaXRpb25TZXJ2aWNlXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgUG9TZWFyY2hDb21wb25lbnQgZXh0ZW5kcyBQb1NlYXJjaEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcbiAgcHJpdmF0ZSBjbGlja291dExpc3RlbmVyOiAoKSA9PiB2b2lkO1xuICBwcml2YXRlIGV2ZW50UmVzaXplTGlzdGVuZXI6ICgpID0+IHZvaWQ7XG5cbiAgQFZpZXdDaGlsZCgncG9TZWFyY2hJbnB1dCcsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIHBvU2VhcmNoSW5wdXQ6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3BvTGlzdGJveENvbnRhaW5lckVsZW1lbnQnLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSkgcG9MaXN0Ym94Q29udGFpbmVyRWxlbWVudDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgncG9MaXN0Ym94RWxlbWVudCcsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBwb0xpc3Rib3hFbGVtZW50OiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdwb0xpc3Rib3gnKSBwb0xpc3Rib3g6IFBvTGlzdEJveENvbXBvbmVudDtcblxuICBsaXN0Ym94RmlsdGVyZWRJdGVtczogQXJyYXk8YW55PiA9IFtdO1xuICBmaWx0ZXJlZEl0ZW1zOiBBcnJheTxhbnk+ID0gW107XG4gIGxpc3Rib3hPcGVuOiBib29sZWFuID0gZmFsc2U7XG4gIHNob3VsZE1hcmtMZXR0ZXJzOiBib29sZWFuID0gdHJ1ZTtcbiAgaXNGaWx0ZXJpbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgbGlzdGJveEl0ZW1jbGlja2VkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgc2VhcmNoRmlsdGVyID0ge307XG5cbiAgc2VhcmNoRmlsdGVyU2VsZWN0TGFiZWw6IHN0cmluZztcbiAgc2VhcmNoRmlsdGVyU2VsZWN0QWN0aW9uczogQXJyYXk8UG9Ecm9wZG93bkFjdGlvbj47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGxhbmd1YWdlU2VydmljZTogUG9MYW5ndWFnZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgY29udHJvbFBvc2l0aW9uOiBQb0NvbnRyb2xQb3NpdGlvblNlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIobGFuZ3VhZ2VTZXJ2aWNlKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IHRoaXMuaXRlbXM7XG4gICAgaWYgKHRoaXMuc2hvd0xpc3Rib3gpIHtcbiAgICAgIHRoaXMubGlzdGJveEZpbHRlcmVkSXRlbXMgPSB0aGlzLmxpc3Rib3hJdGVtcztcbiAgICB9XG4gICAgaWYgKHRoaXMuZmlsdGVyU2VsZWN0KSB7XG4gICAgICB0aGlzLmNyZWF0ZURyb3Bkb3duRmlsdGVyU2VsZWN0KCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzLmZpbHRlclNlbGVjdCAmJiBjaGFuZ2VzLmZpbHRlclNlbGVjdC5jdXJyZW50VmFsdWUpIHtcbiAgICAgIHRoaXMuY3JlYXRlRHJvcGRvd25GaWx0ZXJTZWxlY3QoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnJlbW92ZUxpc3RlbmVycygpO1xuICB9XG5cbiAgY2xlYXJTZWFyY2goKTogdm9pZCB7XG4gICAgdGhpcy5wb1NlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSAnJztcbiAgICB0aGlzLm9uU2VhcmNoQ2hhbmdlKCcnLCB0cnVlKTtcbiAgICB0aGlzLmZpbHRlcmVkSXRlbXNDaGFuZ2UuZW1pdCh0aGlzLml0ZW1zKTtcbiAgICB0aGlzLm9uQ2xvc2VMaXN0Ym94KCk7XG4gIH1cblxuICBvblNlYXJjaENoYW5nZShzZWFyY2hUZXh0OiBzdHJpbmcsIGFjdGl2YXRlZDogYm9vbGVhbiwgYnV0dG9uQ2xpY2s/OiBib29sZWFuKTogdm9pZCB7XG4gICAgY29uc3Qgc2VhcmNoVGV4dEluaXRpYWwgPSBzZWFyY2hUZXh0O1xuICAgIGlmIChzZWFyY2hUZXh0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHNlYXJjaFRleHQgPSBzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuICAgIHRoaXMuaXNGaWx0ZXJpbmcgPSB0cnVlO1xuXG4gICAgaWYgKHRoaXMuc2hvd0xpc3Rib3ggJiYgIWJ1dHRvbkNsaWNrICYmIHNlYXJjaFRleHQubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5jb250cm9sTGlzdGJveFZpc2liaWxpdHkodHJ1ZSk7XG4gICAgICB0aGlzLmxpc3Rib3hGaWx0ZXJlZEl0ZW1zID0gdGhpcy5nZXRMaXN0Ym94RmlsdGVyZWRJdGVtcyhzZWFyY2hUZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNlYXJjaFRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMubGlzdGJveEZpbHRlcmVkSXRlbXMgPSB0aGlzLmxpc3Rib3hJdGVtcztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYWN0aXZhdGVkICYmICF0aGlzLmxpc3Rib3hJdGVtY2xpY2tlZCkge1xuICAgICAgdGhpcy51cGRhdGVGaWx0ZXJlZEl0ZW1zKHNlYXJjaFRleHQpO1xuICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zQ2hhbmdlLmVtaXQodGhpcy5maWx0ZXJlZEl0ZW1zKTtcblxuICAgICAgaWYgKHRoaXMuZmlsdGVyU2VsZWN0KSB7XG4gICAgICAgIHRoaXMuc2VhcmNoRmlsdGVyID0ge1xuICAgICAgICAgIC4uLnRoaXMuc2VhcmNoRmlsdGVyLFxuICAgICAgICAgIHZhbHVlOiBzZWFyY2hUZXh0SW5pdGlhbFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZWFyY2hGaWx0ZXIgPSB7XG4gICAgICAgICAgZmlsdGVyOiB0aGlzLmZpbHRlcktleXMsXG4gICAgICAgICAgdmFsdWU6IHNlYXJjaFRleHRJbml0aWFsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB0aGlzLmZpbHRlci5lbWl0KHRoaXMuc2VhcmNoRmlsdGVyKTtcbiAgICAgIHRoaXMuY2hhbmdlTW9kZWwuZW1pdChzZWFyY2hUZXh0KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5saXN0Ym94SXRlbWNsaWNrZWQpIHtcbiAgICAgIHRoaXMubGlzdGJveEl0ZW1jbGlja2VkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUZpbHRlcmVkSXRlbXMoc2VhcmNoVGV4dDogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXRlbXMgJiYgdGhpcy5pdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSB0aGlzLmdldEZpbHRlcmVkSXRlbXMoc2VhcmNoVGV4dCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0RmlsdGVyZWRJdGVtcyhzZWFyY2hUZXh0KSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gdGhpcy5pdGVtTWF0Y2hlc0ZpbHRlcihpdGVtLCBzZWFyY2hUZXh0KSk7XG4gIH1cblxuICBwcml2YXRlIGl0ZW1NYXRjaGVzRmlsdGVyKGl0ZW06IGFueSwgc2VhcmNoVGV4dDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgdmFsdWVzVG9TZWFyY2g6IEFycmF5PHN0cmluZz4gPSB0aGlzLmZpbHRlcktleXNcbiAgICAgIC5tYXAoa2V5ID0+ICh0eXBlb2YgaXRlbVtrZXldICE9PSAnc3RyaW5nJyA/IFN0cmluZyhpdGVtW2tleV0pIDogaXRlbVtrZXldKSlcbiAgICAgIC5tYXAodmFsdWUgPT4gKHZhbHVlID8gdmFsdWUudG9Mb3dlckNhc2UoKSA6ICcnKSk7XG5cbiAgICByZXR1cm4gdmFsdWVzVG9TZWFyY2guc29tZSh2YWx1ZSA9PiB0aGlzLmZpbHRlclZhbHVlKHZhbHVlLCBzZWFyY2hUZXh0KSk7XG4gIH1cblxuICBnZXRMaXN0Ym94RmlsdGVyZWRJdGVtcyhzZWFyY2hUZXh0KSB7XG4gICAgcmV0dXJuIHRoaXMubGlzdGJveEl0ZW1zLmZpbHRlcihpdGVtID0+IHRoaXMuZmlsdGVyVmFsdWUoaXRlbS52YWx1ZSwgc2VhcmNoVGV4dCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJWYWx1ZSh2YWx1ZTogc3RyaW5nLCBzZWFyY2hUZXh0OiBzdHJpbmcpIHtcbiAgICB2YWx1ZSA9IHZhbHVlPy50b0xvd2VyQ2FzZSgpO1xuICAgIHN3aXRjaCAodGhpcy5maWx0ZXJUeXBlKSB7XG4gICAgICBjYXNlIFBvU2VhcmNoRmlsdGVyTW9kZS5zdGFydHNXaXRoOlxuICAgICAgICByZXR1cm4gdmFsdWU/LnN0YXJ0c1dpdGgoc2VhcmNoVGV4dCk7XG4gICAgICBjYXNlIFBvU2VhcmNoRmlsdGVyTW9kZS5jb250YWluczpcbiAgICAgICAgcmV0dXJuIHZhbHVlPy5pbmNsdWRlcyhzZWFyY2hUZXh0KTtcbiAgICAgIGNhc2UgUG9TZWFyY2hGaWx0ZXJNb2RlLmVuZHNXaXRoOlxuICAgICAgICByZXR1cm4gdmFsdWU/LmVuZHNXaXRoKHNlYXJjaFRleHQpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGdldCBsaXN0Ym94SXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXNcbiAgICAgIC5tYXAoaXRlbSA9PiB0aGlzLmZpbHRlcktleXMubWFwKGtleSA9PiBpdGVtW2tleV0pLm1hcChpdGVtID0+ICh0eXBlb2YgaXRlbSAhPT0gJ3N0cmluZycgPyBTdHJpbmcoaXRlbSkgOiBpdGVtKSkpXG4gICAgICAuZmxhdCgpXG4gICAgICAubWFwKHZhbHVlID0+ICh7IGxhYmVsOiB2YWx1ZSwgdmFsdWUgfSkpXG4gICAgICAuZmlsdGVyKChvYmosIGluZGV4LCBzZWxmKSA9PiBpbmRleCA9PT0gc2VsZi5maW5kSW5kZXgobyA9PiBvLmxhYmVsID09PSBvYmoubGFiZWwgJiYgby52YWx1ZSA9PT0gb2JqLnZhbHVlKSk7XG4gIH1cblxuICBvbkNsb3NlTGlzdGJveCgpIHtcbiAgICB0aGlzLnBvU2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIHRoaXMuY29udHJvbExpc3Rib3hWaXNpYmlsaXR5KGZhbHNlKTtcbiAgICB0aGlzLmlzRmlsdGVyaW5nID0gZmFsc2U7XG4gIH1cblxuICBvbkxpc3Rib3hDbGljayhvcHRpb246IFBvU2VhcmNoT3B0aW9uLCBldmVudD86IGFueSkge1xuICAgIGlmIChldmVudCkge1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuXG4gICAgaWYgKCFldmVudCB8fCBldmVudC5jb2RlID09PSAnRW50ZXInKSB7XG4gICAgICB0aGlzLmxpc3Rib3hJdGVtY2xpY2tlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy5wb1NlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQudmFsdWUgPSBvcHRpb24udmFsdWU7XG4gICAgdGhpcy5saXN0Ym94T25DbGljay5lbWl0KG9wdGlvbi52YWx1ZSk7XG5cbiAgICB0aGlzLm9uQ2xvc2VMaXN0Ym94KCk7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gJ2FjdGlvbicpIHtcbiAgICAgIHRoaXMubGlzdGJveEl0ZW1jbGlja2VkID0gZmFsc2U7XG4gICAgICB0aGlzLm9uU2VhcmNoQ2hhbmdlKG9wdGlvbi52YWx1ZS50b1N0cmluZygpLCB0cnVlLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICBvbkJsdXIoKSB7XG4gICAgaWYgKHRoaXMubGlzdGJveE9wZW4pIHtcbiAgICAgIGlmICghdGhpcy5wb0xpc3Rib3guaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuY29udHJvbExpc3Rib3hWaXNpYmlsaXR5KGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZm9jdXNJdGVtKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25LZXlEb3duKGV2ZW50PzogYW55KSB7XG4gICAgY29uc3Qga2V5ID0gZXZlbnQua2V5Q29kZTtcblxuICAgIGlmIChldmVudC5zaGlmdEtleSAmJiBrZXkgPT09IFBvS2V5Q29kZUVudW0udGFiKSB7XG4gICAgICB0aGlzLmNvbnRyb2xMaXN0Ym94VmlzaWJpbGl0eShmYWxzZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGtleSA9PT0gUG9LZXlDb2RlRW51bS50YWIpIHtcbiAgICAgIHRoaXMuY29udHJvbExpc3Rib3hWaXNpYmlsaXR5KGZhbHNlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoa2V5ID09PSBQb0tleUNvZGVFbnVtLmFycm93RG93bikge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgaWYgKCF0aGlzLmxpc3Rib3hPcGVuKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5mb2N1c0l0ZW0oKTtcbiAgICAgIHRoaXMuY29udHJvbExpc3Rib3hWaXNpYmlsaXR5KHRydWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChrZXkgPT09IFBvS2V5Q29kZUVudW0uZXNjKSB7XG4gICAgICB0aGlzLmNvbnRyb2xMaXN0Ym94VmlzaWJpbGl0eShmYWxzZSk7XG4gICAgICB0aGlzLnBvU2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIH1cblxuICAgIGlmIChrZXkgPT09IFBvS2V5Q29kZUVudW0uZW50ZXIgJiYgdGhpcy5saXN0Ym94T3Blbikge1xuICAgICAgdGhpcy5jb250cm9sTGlzdGJveFZpc2liaWxpdHkoZmFsc2UpO1xuICAgICAgdGhpcy5pc0ZpbHRlcmluZyA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZm9jdXNJdGVtKCkge1xuICAgIGNvbnN0IGxpc3Rib3hJdGVtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wby1saXN0Ym94LWl0ZW0nKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIEFycmF5LmZyb20obGlzdGJveEl0ZW1MaXN0KS5mb3JFYWNoKChlbDogSFRNTEVsZW1lbnQpID0+IHtcbiAgICAgICAgZWwudGFiSW5kZXggPSAtMTtcbiAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnY2RrLW9wdGlvbi1hY3RpdmUnKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBmaXJzdE9wdGlvbiA9IGxpc3Rib3hJdGVtTGlzdFswXSBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGZpcnN0T3B0aW9uLmZvY3VzKCk7XG4gICAgICBmaXJzdE9wdGlvbi5jbGFzc0xpc3QuYWRkKCdjZGstb3B0aW9uLWFjdGl2ZScpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRDb250YWluZXJQb3NpdGlvbigpIHtcbiAgICBpZiAodGhpcy5wb0xpc3Rib3hDb250YWluZXJFbGVtZW50ICYmIHRoaXMucG9TZWFyY2hJbnB1dCkge1xuICAgICAgdGhpcy5jb250cm9sUG9zaXRpb24uc2V0RWxlbWVudHMoXG4gICAgICAgIHRoaXMucG9MaXN0Ym94Q29udGFpbmVyRWxlbWVudC5uYXRpdmVFbGVtZW50LFxuICAgICAgICBwb1NlYXJjaENvbnRhaW5lck9mZnNldCxcbiAgICAgICAgdGhpcy5wb1NlYXJjaElucHV0LFxuICAgICAgICBbJ3RvcCcsICdib3R0b20nXSxcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcblxuICAgICAgdGhpcy5hZGp1c3RDb250YWluZXJQb3NpdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRqdXN0Q29udGFpbmVyUG9zaXRpb24oKSB7XG4gICAgaWYgKHRoaXMucG9MaXN0Ym94Q29udGFpbmVyRWxlbWVudCAmJiB0aGlzLnBvU2VhcmNoSW5wdXQpIHtcbiAgICAgIHRoaXMuY29udHJvbFBvc2l0aW9uLmFkanVzdFBvc2l0aW9uKHBvU2VhcmNoQ29udGFpbmVyUG9zaXRpb25EZWZhdWx0KTtcbiAgICB9XG4gIH1cblxuICBjb250cm9sTGlzdGJveFZpc2liaWxpdHkodG9PcGVuOiBib29sZWFuKSB7XG4gICAgdG9PcGVuID8gdGhpcy5vcGVuTGlzdGJveCgpIDogdGhpcy5jbG9zZUxpc3Rib3goKTtcbiAgfVxuXG4gIHByaXZhdGUgb3Blbkxpc3Rib3goKSB7XG4gICAgdGhpcy5saXN0Ym94T3BlbiA9IHRydWU7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgdGhpcy5pbml0aWFsaXplTGlzdGVuZXJzKCk7XG4gICAgdGhpcy5wb1NlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB0aGlzLnNldENvbnRhaW5lclBvc2l0aW9uKCk7XG4gIH1cblxuICBjbG9zZUxpc3Rib3goKSB7XG4gICAgdGhpcy5saXN0Ym94T3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzKCk7XG4gIH1cblxuICBjbGlja2VkT3V0c2lkZUlucHV0KGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5saXN0Ym94T3BlbiAmJlxuICAgICAgIXRoaXMucG9TZWFyY2hJbnB1dC5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiZcbiAgICAgICghdGhpcy5wb0xpc3Rib3hFbGVtZW50IHx8ICF0aGlzLnBvTGlzdGJveEVsZW1lbnQubmF0aXZlRWxlbWVudC5jb250YWlucyhldmVudC50YXJnZXQpKVxuICAgICkge1xuICAgICAgdGhpcy5jb250cm9sTGlzdGJveFZpc2liaWxpdHkoZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZUxpc3RlbmVycygpIHtcbiAgICB0aGlzLnJlbW92ZUxpc3RlbmVycygpO1xuXG4gICAgdGhpcy5jbGlja291dExpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oJ2RvY3VtZW50JywgJ2NsaWNrJywgKGV2ZW50OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICB0aGlzLmNsaWNrZWRPdXRzaWRlSW5wdXQoZXZlbnQpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5ldmVudFJlc2l6ZUxpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oJ3dpbmRvdycsICdyZXNpemUnLCAoKSA9PiB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuYWRqdXN0Q29udGFpbmVyUG9zaXRpb24oKSwgMjUwKTtcbiAgICB9KTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsLCB0cnVlKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlTGlzdGVuZXJzKCkge1xuICAgIGlmICh0aGlzLmNsaWNrb3V0TGlzdGVuZXIpIHtcbiAgICAgIHRoaXMuY2xpY2tvdXRMaXN0ZW5lcigpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmV2ZW50UmVzaXplTGlzdGVuZXIpIHtcbiAgICAgIHRoaXMuZXZlbnRSZXNpemVMaXN0ZW5lcigpO1xuICAgIH1cblxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsLCB0cnVlKTtcbiAgfVxuXG4gIHByaXZhdGUgb25TY3JvbGwgPSAoKTogdm9pZCA9PiB7XG4gICAgdGhpcy5hZGp1c3RDb250YWluZXJQb3NpdGlvbigpO1xuICB9O1xuXG4gIGdldElucHV0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMucG9TZWFyY2hJbnB1dC5uYXRpdmVFbGVtZW50LnZhbHVlO1xuICB9XG5cbiAgY3JlYXRlRHJvcGRvd25GaWx0ZXJTZWxlY3QoKTogdm9pZCB7XG4gICAgdGhpcy5zZWFyY2hGaWx0ZXJTZWxlY3RBY3Rpb25zID0gW107XG4gICAgaWYgKCF0aGlzLmZpbHRlclNlbGVjdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmZpbHRlclNlbGVjdC5mb3JFYWNoKGZpbHRlck9wdGlvbiA9PiB7XG4gICAgICBjb25zdCBzZWxlY3RPcHRpb246IFBvRHJvcGRvd25BY3Rpb24gPSB7XG4gICAgICAgIGxhYmVsOiBmaWx0ZXJPcHRpb24ubGFiZWwsXG4gICAgICAgIGFjdGlvbjogKCkgPT4gdGhpcy5jaGFuZ2VGaWx0ZXJTZWxlY3QoZmlsdGVyT3B0aW9uKSxcbiAgICAgICAgc2VsZWN0ZWQ6IHRoaXMuaXNTZWxlY3RlZChmaWx0ZXJPcHRpb24pXG4gICAgICB9O1xuICAgICAgdGhpcy5zZWFyY2hGaWx0ZXJTZWxlY3RBY3Rpb25zLnB1c2goc2VsZWN0T3B0aW9uKTtcbiAgICB9KTtcblxuICAgIHRoaXMuY2hhbmdlRmlsdGVyU2VsZWN0KHRoaXMuZmlsdGVyU2VsZWN0WzBdKTtcbiAgfVxuXG4gIGlzU2VsZWN0ZWQoZmlsdGVyT3B0aW9uOiBQb1NlYXJjaEZpbHRlclNlbGVjdCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNlYXJjaEZpbHRlclNlbGVjdExhYmVsID09PSBmaWx0ZXJPcHRpb24ubGFiZWw7XG4gIH1cblxuICBjaGFuZ2VGaWx0ZXJTZWxlY3QoZmlsdGVyT3B0aW9uOiBQb1NlYXJjaEZpbHRlclNlbGVjdCkge1xuICAgIHRoaXMuc2VhcmNoRmlsdGVyU2VsZWN0TGFiZWwgPSBmaWx0ZXJPcHRpb24ubGFiZWw7XG4gICAgdGhpcy5maWx0ZXJLZXlzID0gQXJyYXkuaXNBcnJheShmaWx0ZXJPcHRpb24udmFsdWUpID8gWy4uLmZpbHRlck9wdGlvbi52YWx1ZV0gOiBbZmlsdGVyT3B0aW9uLnZhbHVlXTtcblxuICAgIGlmICghdGhpcy5zZWFyY2hGaWx0ZXJTZWxlY3RBY3Rpb25zKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zZWFyY2hGaWx0ZXJTZWxlY3RBY3Rpb25zLm1hcChhY3Rpb24gPT4gKGFjdGlvbi5zZWxlY3RlZCA9IGZhbHNlKSk7XG4gICAgY29uc3Qgc2VsZWN0QWN0aW9uID0gdGhpcy5zZWFyY2hGaWx0ZXJTZWxlY3RBY3Rpb25zLmZpbmQoYWN0aW9uID0+IGFjdGlvbi5sYWJlbCA9PT0gdGhpcy5zZWFyY2hGaWx0ZXJTZWxlY3RMYWJlbCk7XG4gICAgc2VsZWN0QWN0aW9uLnNlbGVjdGVkID0gdHJ1ZTtcblxuICAgIHRoaXMuc2VhcmNoRmlsdGVyID0ge1xuICAgICAgZmlsdGVyOiBmaWx0ZXJPcHRpb24ubGFiZWwgPT09IHRoaXMubGl0ZXJhbHMuYWxsID8gWydhbGwnXSA6IGZpbHRlck9wdGlvbi52YWx1ZVxuICAgIH07XG5cbiAgICB0aGlzLnBvU2VhcmNoSW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIGlmICh0aGlzLnR5cGUgPT09ICdhY3Rpb24nKSB7XG4gICAgICB0aGlzLm9uU2VhcmNoQ2hhbmdlKHRoaXMuZ2V0SW5wdXRWYWx1ZSgpLCB0cnVlKTtcbiAgICB9XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJwby1zZWFyY2hcIiBbY2xhc3MucG8tc2VhcmNoLWRpc2FibGVkXT1cImRpc2FibGVkXCI+XG4gIDxkaXYgY2xhc3M9XCJwby1zZWFyY2gtc2VsZWN0XCIgKm5nSWY9XCJmaWx0ZXJTZWxlY3RcIj5cbiAgICA8cG8tZHJvcGRvd24gW3AtbGFiZWxdPVwic2VhcmNoRmlsdGVyU2VsZWN0TGFiZWxcIiBbcC1kaXNhYmxlZF09XCJkaXNhYmxlZFwiIFtwLWFjdGlvbnNdPVwic2VhcmNoRmlsdGVyU2VsZWN0QWN0aW9uc1wiPlxuICAgIDwvcG8tZHJvcGRvd24+XG4gIDwvZGl2PlxuXG4gIDxkaXYgKm5nSWY9XCJ0eXBlID09PSAnYWN0aW9uJ1wiIGNsYXNzPVwicG8tc2VhcmNoLWljb25cIj5cbiAgICA8cG8taWNvbiBbcC1pY29uXT1cImljb24gPyBpY29uIDogJ0lDT05fU0VBUkNIJ1wiPjwvcG8taWNvbj5cbiAgPC9kaXY+XG5cbiAgPGlucHV0XG4gICAgI3BvU2VhcmNoSW5wdXRcbiAgICBjbGFzcz1cInBvLXNlYXJjaC1pbnB1dFwiXG4gICAgdHlwZT1cInRleHRcIlxuICAgIFthcmlhTGFiZWxdPVwiYXJpYUxhYmVsXCJcbiAgICBbY2xhc3MucG8tc2VhcmNoLWlucHV0LWNsZWFuXT1cIiEhcG9TZWFyY2hJbnB1dC52YWx1ZSAmJiAhZGlzYWJsZWRcIlxuICAgIFtjbGFzcy5wby1zZWFyY2gtaW5wdXQtdHJpZ2dlcl09XCJ0eXBlID09PSAndHJpZ2dlcidcIlxuICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgW3BsYWNlaG9sZGVyXT1cImxpdGVyYWxzLnNlYXJjaFwiXG4gICAgKGlucHV0KT1cIlxuICAgICAgb25TZWFyY2hDaGFuZ2UoJGV2ZW50LnRhcmdldC52YWx1ZSwgZmFsc2UpOyBvblNlYXJjaENoYW5nZSgkZXZlbnQudGFyZ2V0LnZhbHVlLCB0eXBlID09PSAnYWN0aW9uJyA/IHRydWUgOiBmYWxzZSlcbiAgICBcIlxuICAgIChrZXl1cC5lbnRlcik9XCJcbiAgICAgIGxpc3Rib3hPcGVuID8gY2xvc2VMaXN0Ym94KCkgOiBvblNlYXJjaENoYW5nZSgkZXZlbnQudGFyZ2V0LnZhbHVlLCB0eXBlID09PSAndHJpZ2dlcicgPyB0cnVlIDogZmFsc2UsIHRydWUpO1xuICAgICAgY2xvc2VMaXN0Ym94KClcbiAgICBcIlxuICAgIChrZXlkb3duKT1cIm9uS2V5RG93bigkZXZlbnQpXCJcbiAgICAoYmx1cik9XCJvbkJsdXIoKVwiXG4gIC8+XG5cbiAgPGRpdiBjbGFzcz1cInBvLXNlYXJjaC1idXR0b25zXCI+XG4gICAgPGJ1dHRvblxuICAgICAgKm5nSWY9XCIhIXBvU2VhcmNoSW5wdXQudmFsdWUgJiYgIWRpc2FibGVkXCJcbiAgICAgIGNsYXNzPVwicG8tc2VhcmNoLWJ1dHRvbiBwby1zZWFyY2gtYnV0dG9uLWNsZWFuXCJcbiAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgW2FyaWFMYWJlbF09XCJsaXRlcmFscy5jbGVhblwiXG4gICAgICAoY2xpY2spPVwiY2xlYXJTZWFyY2goKVwiXG4gICAgICAoa2V5ZG93bi5lbnRlcik9XCJjbGVhclNlYXJjaCgpXCJcbiAgICA+XG4gICAgICA8cG8tY2xlYW4gY2xhc3M9XCJwby1pY29uLWlucHV0XCI+PC9wby1jbGVhbj5cbiAgICA8L2J1dHRvbj5cblxuICAgIDxidXR0b25cbiAgICAgICpuZ0lmPVwidHlwZSA9PT0gJ3RyaWdnZXInXCJcbiAgICAgIGNsYXNzPVwicG8tc2VhcmNoLWJ1dHRvbiBwby1zZWFyY2gtYnV0dG9uLXRyaWdnZXJcIlxuICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICBbYXJpYUxhYmVsXT1cImxpdGVyYWxzLnNlYXJjaFwiXG4gICAgICAoY2xpY2spPVwib25TZWFyY2hDaGFuZ2UocG9TZWFyY2hJbnB1dC52YWx1ZSwgdHJ1ZSwgdHJ1ZSlcIlxuICAgICAgKGtleWRvd24uZW50ZXIpPVwib25TZWFyY2hDaGFuZ2UocG9TZWFyY2hJbnB1dC52YWx1ZSwgdHJ1ZSwgdHJ1ZSlcIlxuICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCJcbiAgICA+XG4gICAgICA8cG8taWNvbiBbcC1pY29uXT1cImljb24gPyBpY29uIDogJ0lDT05fU0VBUkNIJ1wiPiA8L3BvLWljb24+XG4gICAgPC9idXR0b24+XG4gIDwvZGl2PlxuPC9kaXY+XG5cbjxkaXYgI3BvTGlzdGJveENvbnRhaW5lckVsZW1lbnQgY2xhc3M9XCJwby1zZWFyY2gtbGlzdGJveC1jb250YWluZXJcIiBbaGlkZGVuXT1cIiFsaXN0Ym94T3BlblwiPlxuICA8cG8tbGlzdGJveFxuICAgICNwb0xpc3Rib3hcbiAgICAjcG9MaXN0Ym94RWxlbWVudFxuICAgIHAtdHlwZT1cIm9wdGlvblwiXG4gICAgW3AtaXRlbXNdPVwibGlzdGJveEZpbHRlcmVkSXRlbXNcIlxuICAgIChwLXNlbGVjdGNvbWJvLWl0ZW0pPVwib25MaXN0Ym94Q2xpY2soJGV2ZW50LCAkZXZlbnQuZXZlbnQpXCJcbiAgICBbcC12aXNpYmxlXT1cImxpc3Rib3hPcGVuXCJcbiAgICBbcC1maWx0ZXItbW9kZV09XCJmaWx0ZXJUeXBlXCJcbiAgICBbcC1zaG91bGQtbWFyay1sZXR0ZXJdPVwic2hvdWxkTWFya0xldHRlcnNcIlxuICAgIFtwLWZpbHRlcmluZ109XCJpc0ZpbHRlcmluZ1wiXG4gICAgW3Atc2VhcmNoLXZhbHVlXT1cImdldElucHV0VmFsdWUoKVwiXG4gICAgKHAtY2xvc2UpPVwib25DbG9zZUxpc3Rib3goKVwiXG4gID48L3BvLWxpc3Rib3g+XG48L2Rpdj5cbiJdfQ==