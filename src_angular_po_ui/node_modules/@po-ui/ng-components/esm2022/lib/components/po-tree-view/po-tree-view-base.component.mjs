import { EventEmitter, Input, Output, Directive } from '@angular/core';
import { convertToBoolean, convertToInt } from '../../utils/util';
import * as i0 from "@angular/core";
const poTreeViewMaxLevel = 4;
/**
 * @description
 *
 * O componente fornece um modelo de visualização em árvore, possibilitando a visualização das informações de maneira
 * hierárquica, desta forma sendo possível utilizar até 4 níveis.
 *
 * Nele é possível navegar entre os itens através da tecla *tab*, permitindo expandir ou colapsar o item em foco
 * por meio das teclas *enter* e *space*.
 *
 * Além da navegação, o componente possibilita também a seleção dos itens do primeiro ao último nível, tanto de forma parcial como completa.
 *
 * O componente também possui eventos disparados ao marcar/desmarcar e expandir/colapsar os itens.
 */
export class PoTreeViewBaseComponent {
    /**
     * @optional
     *
     * @description
     *
     * Ação que será disparada ao colapsar um item.
     *
     * > Como parâmetro o componente envia o item colapsado.
     */
    collapsed = new EventEmitter();
    /**
     * @optional
     *
     * @description
     *
     * Ação que será disparada ao expandir um item.
     *
     * > Como parâmetro o componente envia o item expandido.
     */
    expanded = new EventEmitter();
    /**
     * @optional
     *
     * @description
     *
     * Ação que será disparada ao selecionar um item.
     *
     * > Como parâmetro o componente envia o item selecionado.
     */
    selected = new EventEmitter();
    /**
     * @optional
     *
     * @description
     *
     * Ação que será disparada ao desfazer a seleção de um item.
     *
     * > Como parâmetro o componente envia o item que foi desmarcado.
     */
    unselected = new EventEmitter();
    _items = [];
    _selectable = false;
    _maxLevel = poTreeViewMaxLevel;
    _singleSelect = false;
    // armazena o value do item selecionado
    selectedValue;
    /**
     * Lista de itens do tipo `PoTreeViewItem` que será renderizada pelo componente.
     */
    inputedItems;
    set items(value) {
        this._items = Array.isArray(value) ? this.getItemsByMaxLevel(value) : [];
    }
    get items() {
        return this._items;
    }
    /**
     * @optional
     *
     * @description
     *
     * Habilita uma caixa de seleção para selecionar e/ou desmarcar um item da lista.
     *
     * @default false
     */
    set selectable(value) {
        this._selectable = convertToBoolean(value);
    }
    get selectable() {
        return this._selectable;
    }
    /**
     * @optional
     *
     * @description
     *
     * Habilita a seleção para item único atráves de po-radio.
     *
     * @default false
     */
    set singleSelect(value) {
        this._singleSelect = convertToBoolean(value);
    }
    get singleSelect() {
        return this._singleSelect;
    }
    /**
     * @optional
     *
     * @description
     *
     * Define o máximo de níveis para o tree-view.
     *
     * > O valor padrão é 4
     *
     * @default 4
     */
    set maxLevel(value) {
        this._maxLevel = convertToInt(value, poTreeViewMaxLevel);
    }
    get maxLevel() {
        return this._maxLevel;
    }
    emitExpanded(treeViewItem) {
        const event = treeViewItem.expanded ? 'expanded' : 'collapsed';
        this[event].emit({ ...treeViewItem });
    }
    emitSelected(treeViewItem) {
        const event = treeViewItem.selected ? 'selected' : 'unselected';
        this.selectedValue = treeViewItem.value;
        // Não emitir subItems quando for singleSelect
        const { subItems, ...rest } = treeViewItem;
        const treeViewToEmit = this.singleSelect ? { ...rest } : treeViewItem;
        this.updateItemsOnSelect(treeViewToEmit);
        this[event].emit({ ...treeViewToEmit });
    }
    addChildItemInParent(childItem, parentItem) {
        if (!parentItem.subItems) {
            parentItem.subItems = [];
        }
        parentItem.subItems.push(childItem);
    }
    // caso houver parentItem:
    //  - expande o parentItem caso o filho estiver expandido;
    //  - adiciona o childItem no parentItem;
    //  - marca o parentItem caso conter subItems marcodos ou nulos;
    // Se não conter parentItem, adiciona o childItem no items.
    addItem(items, childItem, parentItem, isNewItem) {
        if (parentItem) {
            if (isNewItem) {
                this.expandParentItem(childItem, parentItem);
            }
            this.addChildItemInParent(childItem, parentItem);
            if (!this.singleSelect) {
                this.selectItemBySubItems(parentItem);
            }
            items.push(parentItem);
        }
        else {
            items.push(childItem);
        }
    }
    selectAllItems(items, isSelected) {
        items.forEach(item => {
            if (item.subItems) {
                this.selectAllItems(item.subItems, isSelected);
            }
            item.selected = item.isSelectable !== false ? isSelected : false;
        });
    }
    selectItemBySubItems(item) {
        item.selected = this.everyItemSelected(item.subItems);
    }
    // retornará:
    //  - true: se todos os items estiverem marcados;
    //  - null: se no minimo um item esteja marcado ou nullo (indeterminate)
    //  - false: caso não corresponda em nenhuma das opções acima, no caso, nenhum marcado ou nulo;
    everyItemSelected(items = []) {
        const itemsLength = items.length;
        const lengthCheckedItems = items.filter(item => item.selected).length;
        if (itemsLength && itemsLength === lengthCheckedItems) {
            return true;
        }
        const hasIndeterminateItems = items.filter(item => item.selected || item.selected === null).length;
        if (hasIndeterminateItems) {
            return null;
        }
        return false;
    }
    // expande o item pai caso o filho estiver expandido.
    expandParentItem(childItem, parentItem) {
        if (childItem.expanded) {
            parentItem.expanded = true;
        }
    }
    getItemsByMaxLevel(items = [], level = 0, parentItem, newItems = []) {
        items.forEach(item => {
            const { subItems, ...currentItem } = item;
            if (level === this.maxLevel) {
                return;
            }
            if (Array.isArray(subItems)) {
                // caso um item pai iniciar selecionado, deve selecionar os filhos.
                if (currentItem.selected) {
                    this.selectAllItems(subItems, currentItem.selected);
                }
                this.getItemsByMaxLevel(subItems, ++level, currentItem);
                --level;
            }
            if (item.selected) {
                this.selectedValue = currentItem.value;
            }
            this.addItem(newItems, currentItem, parentItem, true);
        });
        return newItems;
    }
    getItemsWithParentSelected(items = [], parentItem, newItems = []) {
        items.forEach(item => {
            const { subItems, ...currentItem } = item;
            if (Array.isArray(subItems)) {
                this.getItemsWithParentSelected(subItems, currentItem);
            }
            this.addItem(newItems, currentItem, parentItem);
        });
        return newItems;
    }
    updateItemsOnSelect(selectedItem) {
        if (selectedItem.subItems && !this.singleSelect) {
            this.selectAllItems(selectedItem.subItems, selectedItem.selected);
        }
        this._items = this.getItemsWithParentSelected(this.items);
    }
    static ɵfac = function PoTreeViewBaseComponent_Factory(t) { return new (t || PoTreeViewBaseComponent)(); };
    static ɵdir = /*@__PURE__*/ i0.ɵɵdefineDirective({ type: PoTreeViewBaseComponent, inputs: { inputedItems: [i0.ɵɵInputFlags.None, "p-items", "inputedItems"], selectable: [i0.ɵɵInputFlags.None, "p-selectable", "selectable"], singleSelect: [i0.ɵɵInputFlags.None, "p-single-select", "singleSelect"], maxLevel: [i0.ɵɵInputFlags.None, "p-max-level", "maxLevel"] }, outputs: { collapsed: "p-collapsed", expanded: "p-expanded", selected: "p-selected", unselected: "p-unselected" } });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoTreeViewBaseComponent, [{
        type: Directive
    }], null, { collapsed: [{
            type: Output,
            args: ['p-collapsed']
        }], expanded: [{
            type: Output,
            args: ['p-expanded']
        }], selected: [{
            type: Output,
            args: ['p-selected']
        }], unselected: [{
            type: Output,
            args: ['p-unselected']
        }], inputedItems: [{
            type: Input,
            args: ['p-items']
        }], selectable: [{
            type: Input,
            args: ['p-selectable']
        }], singleSelect: [{
            type: Input,
            args: ['p-single-select']
        }], maxLevel: [{
            type: Input,
            args: ['p-max-level']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdHJlZS12aWV3LWJhc2UuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLXRyZWUtdmlldy9wby10cmVlLXZpZXctYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV2RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7O0FBSWxFLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxDQUFDO0FBRTdCOzs7Ozs7Ozs7Ozs7R0FZRztBQUVILE1BQU0sT0FBTyx1QkFBdUI7SUFDbEM7Ozs7Ozs7O09BUUc7SUFDb0IsU0FBUyxHQUFHLElBQUksWUFBWSxFQUFrQixDQUFDO0lBRXRFOzs7Ozs7OztPQVFHO0lBQ21CLFFBQVEsR0FBRyxJQUFJLFlBQVksRUFBa0IsQ0FBQztJQUVwRTs7Ozs7Ozs7T0FRRztJQUNtQixRQUFRLEdBQUcsSUFBSSxZQUFZLEVBQWtCLENBQUM7SUFFcEU7Ozs7Ozs7O09BUUc7SUFDcUIsVUFBVSxHQUFHLElBQUksWUFBWSxFQUFrQixDQUFDO0lBRWhFLE1BQU0sR0FBMEIsRUFBRSxDQUFDO0lBQ25DLFdBQVcsR0FBWSxLQUFLLENBQUM7SUFDN0IsU0FBUyxHQUFHLGtCQUFrQixDQUFDO0lBQy9CLGFBQWEsR0FBWSxLQUFLLENBQUM7SUFFdkMsdUNBQXVDO0lBQ3ZDLGFBQWEsQ0FBa0I7SUFFL0I7O09BRUc7SUFDZSxZQUFZLENBQXdCO0lBRXRELElBQUksS0FBSyxDQUFDLEtBQTRCO1FBQ3BDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFr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O2tCQUFqQyxLQUFLO21CQUFDLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIERpcmVjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBjb252ZXJ0VG9Cb29sZWFuLCBjb252ZXJ0VG9JbnQgfSBmcm9tICcuLi8uLi91dGlscy91dGlsJztcblxuaW1wb3J0IHsgUG9UcmVlVmlld0l0ZW0gfSBmcm9tICcuL3BvLXRyZWUtdmlldy1pdGVtL3BvLXRyZWUtdmlldy1pdGVtLmludGVyZmFjZSc7XG5cbmNvbnN0IHBvVHJlZVZpZXdNYXhMZXZlbCA9IDQ7XG5cbi8qKlxuICogQGRlc2NyaXB0aW9uXG4gKlxuICogTyBjb21wb25lbnRlIGZvcm5lY2UgdW0gbW9kZWxvIGRlIHZpc3VhbGl6YcOnw6NvIGVtIMOhcnZvcmUsIHBvc3NpYmlsaXRhbmRvIGEgdmlzdWFsaXphw6fDo28gZGFzIGluZm9ybWHDp8O1ZXMgZGUgbWFuZWlyYVxuICogaGllcsOhcnF1aWNhLCBkZXN0YSBmb3JtYSBzZW5kbyBwb3Nzw612ZWwgdXRpbGl6YXIgYXTDqSA0IG7DrXZlaXMuXG4gKlxuICogTmVsZSDDqSBwb3Nzw612ZWwgbmF2ZWdhciBlbnRyZSBvcyBpdGVucyBhdHJhdsOpcyBkYSB0ZWNsYSAqdGFiKiwgcGVybWl0aW5kbyBleHBhbmRpciBvdSBjb2xhcHNhciBvIGl0ZW0gZW0gZm9jb1xuICogcG9yIG1laW8gZGFzIHRlY2xhcyAqZW50ZXIqIGUgKnNwYWNlKi5cbiAqXG4gKiBBbMOpbSBkYSBuYXZlZ2HDp8OjbywgbyBjb21wb25lbnRlIHBvc3NpYmlsaXRhIHRhbWLDqW0gYSBzZWxlw6fDo28gZG9zIGl0ZW5zIGRvIHByaW1laXJvIGFvIMO6bHRpbW8gbsOtdmVsLCB0YW50byBkZSBmb3JtYSBwYXJjaWFsIGNvbW8gY29tcGxldGEuXG4gKlxuICogTyBjb21wb25lbnRlIHRhbWLDqW0gcG9zc3VpIGV2ZW50b3MgZGlzcGFyYWRvcyBhbyBtYXJjYXIvZGVzbWFyY2FyIGUgZXhwYW5kaXIvY29sYXBzYXIgb3MgaXRlbnMuXG4gKi9cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGNsYXNzIFBvVHJlZVZpZXdCYXNlQ29tcG9uZW50IHtcbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogQcOnw6NvIHF1ZSBzZXLDoSBkaXNwYXJhZGEgYW8gY29sYXBzYXIgdW0gaXRlbS5cbiAgICpcbiAgICogPiBDb21vIHBhcsOibWV0cm8gbyBjb21wb25lbnRlIGVudmlhIG8gaXRlbSBjb2xhcHNhZG8uXG4gICAqL1xuICBAT3V0cHV0KCdwLWNvbGxhcHNlZCcpIGNvbGxhcHNlZCA9IG5ldyBFdmVudEVtaXR0ZXI8UG9UcmVlVmlld0l0ZW0+KCk7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogQcOnw6NvIHF1ZSBzZXLDoSBkaXNwYXJhZGEgYW8gZXhwYW5kaXIgdW0gaXRlbS5cbiAgICpcbiAgICogPiBDb21vIHBhcsOibWV0cm8gbyBjb21wb25lbnRlIGVudmlhIG8gaXRlbSBleHBhbmRpZG8uXG4gICAqL1xuICBAT3V0cHV0KCdwLWV4cGFuZGVkJykgZXhwYW5kZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFBvVHJlZVZpZXdJdGVtPigpO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEHDp8OjbyBxdWUgc2Vyw6EgZGlzcGFyYWRhIGFvIHNlbGVjaW9uYXIgdW0gaXRlbS5cbiAgICpcbiAgICogPiBDb21vIHBhcsOibWV0cm8gbyBjb21wb25lbnRlIGVudmlhIG8gaXRlbSBzZWxlY2lvbmFkby5cbiAgICovXG4gIEBPdXRwdXQoJ3Atc2VsZWN0ZWQnKSBzZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXI8UG9UcmVlVmlld0l0ZW0+KCk7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogQcOnw6NvIHF1ZSBzZXLDoSBkaXNwYXJhZGEgYW8gZGVzZmF6ZXIgYSBzZWxlw6fDo28gZGUgdW0gaXRlbS5cbiAgICpcbiAgICogPiBDb21vIHBhcsOibWV0cm8gbyBjb21wb25lbnRlIGVudmlhIG8gaXRlbSBxdWUgZm9pIGRlc21hcmNhZG8uXG4gICAqL1xuICBAT3V0cHV0KCdwLXVuc2VsZWN0ZWQnKSB1bnNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxQb1RyZWVWaWV3SXRlbT4oKTtcblxuICBwcml2YXRlIF9pdGVtczogQXJyYXk8UG9UcmVlVmlld0l0ZW0+ID0gW107XG4gIHByaXZhdGUgX3NlbGVjdGFibGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfbWF4TGV2ZWwgPSBwb1RyZWVWaWV3TWF4TGV2ZWw7XG4gIHByaXZhdGUgX3NpbmdsZVNlbGVjdDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8vIGFybWF6ZW5hIG8gdmFsdWUgZG8gaXRlbSBzZWxlY2lvbmFkb1xuICBzZWxlY3RlZFZhbHVlOiBzdHJpbmcgfCBudW1iZXI7XG5cbiAgLyoqXG4gICAqIExpc3RhIGRlIGl0ZW5zIGRvIHRpcG8gYFBvVHJlZVZpZXdJdGVtYCBxdWUgc2Vyw6EgcmVuZGVyaXphZGEgcGVsbyBjb21wb25lbnRlLlxuICAgKi9cbiAgQElucHV0KCdwLWl0ZW1zJykgaW5wdXRlZEl0ZW1zOiBBcnJheTxQb1RyZWVWaWV3SXRlbT47XG5cbiAgc2V0IGl0ZW1zKHZhbHVlOiBBcnJheTxQb1RyZWVWaWV3SXRlbT4pIHtcbiAgICB0aGlzLl9pdGVtcyA9IEFycmF5LmlzQXJyYXkodmFsdWUpID8gdGhpcy5nZXRJdGVtc0J5TWF4TGV2ZWwodmFsdWUpIDogW107XG4gIH1cblxuICBnZXQgaXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSGFiaWxpdGEgdW1hIGNhaXhhIGRlIHNlbGXDp8OjbyBwYXJhIHNlbGVjaW9uYXIgZS9vdSBkZXNtYXJjYXIgdW0gaXRlbSBkYSBsaXN0YS5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIEBJbnB1dCgncC1zZWxlY3RhYmxlJykgc2V0IHNlbGVjdGFibGUodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9zZWxlY3RhYmxlID0gY29udmVydFRvQm9vbGVhbih2YWx1ZSk7XG4gIH1cblxuICBnZXQgc2VsZWN0YWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0YWJsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEhhYmlsaXRhIGEgc2VsZcOnw6NvIHBhcmEgaXRlbSDDum5pY28gYXRyw6F2ZXMgZGUgcG8tcmFkaW8uXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICBASW5wdXQoJ3Atc2luZ2xlLXNlbGVjdCcpIHNldCBzaW5nbGVTZWxlY3QodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9zaW5nbGVTZWxlY3QgPSBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlKTtcbiAgfVxuXG4gIGdldCBzaW5nbGVTZWxlY3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NpbmdsZVNlbGVjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBvIG3DoXhpbW8gZGUgbsOtdmVpcyBwYXJhIG8gdHJlZS12aWV3LlxuICAgKlxuICAgKiA+IE8gdmFsb3IgcGFkcsOjbyDDqSA0XG4gICAqXG4gICAqIEBkZWZhdWx0IDRcbiAgICovXG4gIEBJbnB1dCgncC1tYXgtbGV2ZWwnKSBzZXQgbWF4TGV2ZWwodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMuX21heExldmVsID0gY29udmVydFRvSW50KHZhbHVlLCBwb1RyZWVWaWV3TWF4TGV2ZWwpO1xuICB9XG5cbiAgZ2V0IG1heExldmVsKCkge1xuICAgIHJldHVybiB0aGlzLl9tYXhMZXZlbDtcbiAgfVxuXG4gIHByb3RlY3RlZCBlbWl0RXhwYW5kZWQodHJlZVZpZXdJdGVtOiBQb1RyZWVWaWV3SXRlbSkge1xuICAgIGNvbnN0IGV2ZW50ID0gdHJlZVZpZXdJdGVtLmV4cGFuZGVkID8gJ2V4cGFuZGVkJyA6ICdjb2xsYXBzZWQnO1xuXG4gICAgdGhpc1tldmVudF0uZW1pdCh7IC4uLnRyZWVWaWV3SXRlbSB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBlbWl0U2VsZWN0ZWQodHJlZVZpZXdJdGVtOiBQb1RyZWVWaWV3SXRlbSkge1xuICAgIGNvbnN0IGV2ZW50ID0gdHJlZVZpZXdJdGVtLnNlbGVjdGVkID8gJ3NlbGVjdGVkJyA6ICd1bnNlbGVjdGVkJztcblxuICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZSA9IHRyZWVWaWV3SXRlbS52YWx1ZTtcblxuICAgIC8vIE7Do28gZW1pdGlyIHN1Ykl0ZW1zIHF1YW5kbyBmb3Igc2luZ2xlU2VsZWN0XG4gICAgY29uc3QgeyBzdWJJdGVtcywgLi4ucmVzdCB9ID0gdHJlZVZpZXdJdGVtO1xuICAgIGNvbnN0IHRyZWVWaWV3VG9FbWl0ID0gdGhpcy5zaW5nbGVTZWxlY3QgPyB7IC4uLnJlc3QgfSA6IHRyZWVWaWV3SXRlbTtcblxuICAgIHRoaXMudXBkYXRlSXRlbXNPblNlbGVjdCh0cmVlVmlld1RvRW1pdCk7XG5cbiAgICB0aGlzW2V2ZW50XS5lbWl0KHsgLi4udHJlZVZpZXdUb0VtaXQgfSk7XG4gIH1cblxuICBwcml2YXRlIGFkZENoaWxkSXRlbUluUGFyZW50KGNoaWxkSXRlbTogUG9UcmVlVmlld0l0ZW0sIHBhcmVudEl0ZW06IFBvVHJlZVZpZXdJdGVtKSB7XG4gICAgaWYgKCFwYXJlbnRJdGVtLnN1Ykl0ZW1zKSB7XG4gICAgICBwYXJlbnRJdGVtLnN1Ykl0ZW1zID0gW107XG4gICAgfVxuXG4gICAgcGFyZW50SXRlbS5zdWJJdGVtcy5wdXNoKGNoaWxkSXRlbSk7XG4gIH1cblxuICAvLyBjYXNvIGhvdXZlciBwYXJlbnRJdGVtOlxuICAvLyAgLSBleHBhbmRlIG8gcGFyZW50SXRlbSBjYXNvIG8gZmlsaG8gZXN0aXZlciBleHBhbmRpZG87XG4gIC8vICAtIGFkaWNpb25hIG8gY2hpbGRJdGVtIG5vIHBhcmVudEl0ZW07XG4gIC8vICAtIG1hcmNhIG8gcGFyZW50SXRlbSBjYXNvIGNvbnRlciBzdWJJdGVtcyBtYXJjb2RvcyBvdSBudWxvcztcbiAgLy8gU2UgbsOjbyBjb250ZXIgcGFyZW50SXRlbSwgYWRpY2lvbmEgbyBjaGlsZEl0ZW0gbm8gaXRlbXMuXG4gIHByaXZhdGUgYWRkSXRlbShpdGVtczogQXJyYXk8UG9UcmVlVmlld0l0ZW0+LCBjaGlsZEl0ZW06IFBvVHJlZVZpZXdJdGVtLCBwYXJlbnRJdGVtPzogUG9UcmVlVmlld0l0ZW0sIGlzTmV3SXRlbT8pIHtcbiAgICBpZiAocGFyZW50SXRlbSkge1xuICAgICAgaWYgKGlzTmV3SXRlbSkge1xuICAgICAgICB0aGlzLmV4cGFuZFBhcmVudEl0ZW0oY2hpbGRJdGVtLCBwYXJlbnRJdGVtKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5hZGRDaGlsZEl0ZW1JblBhcmVudChjaGlsZEl0ZW0sIHBhcmVudEl0ZW0pO1xuXG4gICAgICBpZiAoIXRoaXMuc2luZ2xlU2VsZWN0KSB7XG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbUJ5U3ViSXRlbXMocGFyZW50SXRlbSk7XG4gICAgICB9XG5cbiAgICAgIGl0ZW1zLnB1c2gocGFyZW50SXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGl0ZW1zLnB1c2goY2hpbGRJdGVtKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNlbGVjdEFsbEl0ZW1zKGl0ZW1zOiBBcnJheTxQb1RyZWVWaWV3SXRlbT4sIGlzU2VsZWN0ZWQ6IGJvb2xlYW4pIHtcbiAgICBpdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaWYgKGl0ZW0uc3ViSXRlbXMpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RBbGxJdGVtcyhpdGVtLnN1Ykl0ZW1zLCBpc1NlbGVjdGVkKTtcbiAgICAgIH1cblxuICAgICAgaXRlbS5zZWxlY3RlZCA9IGl0ZW0uaXNTZWxlY3RhYmxlICE9PSBmYWxzZSA/IGlzU2VsZWN0ZWQgOiBmYWxzZTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2VsZWN0SXRlbUJ5U3ViSXRlbXMoaXRlbTogUG9UcmVlVmlld0l0ZW0pIHtcbiAgICBpdGVtLnNlbGVjdGVkID0gdGhpcy5ldmVyeUl0ZW1TZWxlY3RlZChpdGVtLnN1Ykl0ZW1zKTtcbiAgfVxuXG4gIC8vIHJldG9ybmFyw6E6XG4gIC8vICAtIHRydWU6IHNlIHRvZG9zIG9zIGl0ZW1zIGVzdGl2ZXJlbSBtYXJjYWRvcztcbiAgLy8gIC0gbnVsbDogc2Ugbm8gbWluaW1vIHVtIGl0ZW0gZXN0ZWphIG1hcmNhZG8gb3UgbnVsbG8gKGluZGV0ZXJtaW5hdGUpXG4gIC8vICAtIGZhbHNlOiBjYXNvIG7Do28gY29ycmVzcG9uZGEgZW0gbmVuaHVtYSBkYXMgb3DDp8O1ZXMgYWNpbWEsIG5vIGNhc28sIG5lbmh1bSBtYXJjYWRvIG91IG51bG87XG4gIHByaXZhdGUgZXZlcnlJdGVtU2VsZWN0ZWQoaXRlbXM6IEFycmF5PFBvVHJlZVZpZXdJdGVtPiA9IFtdKTogYm9vbGVhbiB8IG51bGwge1xuICAgIGNvbnN0IGl0ZW1zTGVuZ3RoID0gaXRlbXMubGVuZ3RoO1xuXG4gICAgY29uc3QgbGVuZ3RoQ2hlY2tlZEl0ZW1zID0gaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zZWxlY3RlZCkubGVuZ3RoO1xuXG4gICAgaWYgKGl0ZW1zTGVuZ3RoICYmIGl0ZW1zTGVuZ3RoID09PSBsZW5ndGhDaGVja2VkSXRlbXMpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGNvbnN0IGhhc0luZGV0ZXJtaW5hdGVJdGVtcyA9IGl0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0uc2VsZWN0ZWQgfHwgaXRlbS5zZWxlY3RlZCA9PT0gbnVsbCkubGVuZ3RoO1xuXG4gICAgaWYgKGhhc0luZGV0ZXJtaW5hdGVJdGVtcykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gZXhwYW5kZSBvIGl0ZW0gcGFpIGNhc28gbyBmaWxobyBlc3RpdmVyIGV4cGFuZGlkby5cbiAgcHJpdmF0ZSBleHBhbmRQYXJlbnRJdGVtKGNoaWxkSXRlbTogUG9UcmVlVmlld0l0ZW0sIHBhcmVudEl0ZW06IFBvVHJlZVZpZXdJdGVtKSB7XG4gICAgaWYgKGNoaWxkSXRlbS5leHBhbmRlZCkge1xuICAgICAgcGFyZW50SXRlbS5leHBhbmRlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRJdGVtc0J5TWF4TGV2ZWwoXG4gICAgaXRlbXM6IEFycmF5PFBvVHJlZVZpZXdJdGVtPiA9IFtdLFxuICAgIGxldmVsOiBudW1iZXIgPSAwLFxuICAgIHBhcmVudEl0ZW0/OiBQb1RyZWVWaWV3SXRlbSxcbiAgICBuZXdJdGVtcyA9IFtdXG4gICkge1xuICAgIGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBjb25zdCB7IHN1Ykl0ZW1zLCAuLi5jdXJyZW50SXRlbSB9ID0gaXRlbTtcblxuICAgICAgaWYgKGxldmVsID09PSB0aGlzLm1heExldmVsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc3ViSXRlbXMpKSB7XG4gICAgICAgIC8vIGNhc28gdW0gaXRlbSBwYWkgaW5pY2lhciBzZWxlY2lvbmFkbywgZGV2ZSBzZWxlY2lvbmFyIG9zIGZpbGhvcy5cbiAgICAgICAgaWYgKGN1cnJlbnRJdGVtLnNlbGVjdGVkKSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RBbGxJdGVtcyhzdWJJdGVtcywgY3VycmVudEl0ZW0uc2VsZWN0ZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5nZXRJdGVtc0J5TWF4TGV2ZWwoc3ViSXRlbXMsICsrbGV2ZWwsIGN1cnJlbnRJdGVtKTtcbiAgICAgICAgLS1sZXZlbDtcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0uc2VsZWN0ZWQpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlID0gY3VycmVudEl0ZW0udmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYWRkSXRlbShuZXdJdGVtcywgY3VycmVudEl0ZW0sIHBhcmVudEl0ZW0sIHRydWUpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5ld0l0ZW1zO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRJdGVtc1dpdGhQYXJlbnRTZWxlY3RlZChpdGVtczogQXJyYXk8UG9UcmVlVmlld0l0ZW0+ID0gW10sIHBhcmVudEl0ZW0/OiBQb1RyZWVWaWV3SXRlbSwgbmV3SXRlbXMgPSBbXSkge1xuICAgIGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBjb25zdCB7IHN1Ykl0ZW1zLCAuLi5jdXJyZW50SXRlbSB9ID0gaXRlbTtcblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc3ViSXRlbXMpKSB7XG4gICAgICAgIHRoaXMuZ2V0SXRlbXNXaXRoUGFyZW50U2VsZWN0ZWQoc3ViSXRlbXMsIGN1cnJlbnRJdGVtKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5hZGRJdGVtKG5ld0l0ZW1zLCBjdXJyZW50SXRlbSwgcGFyZW50SXRlbSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3SXRlbXM7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUl0ZW1zT25TZWxlY3Qoc2VsZWN0ZWRJdGVtOiBQb1RyZWVWaWV3SXRlbSkge1xuICAgIGlmIChzZWxlY3RlZEl0ZW0uc3ViSXRlbXMgJiYgIXRoaXMuc2luZ2xlU2VsZWN0KSB7XG4gICAgICB0aGlzLnNlbGVjdEFsbEl0ZW1zKHNlbGVjdGVkSXRlbS5zdWJJdGVtcywgc2VsZWN0ZWRJdGVtLnNlbGVjdGVkKTtcbiAgICB9XG5cbiAgICB0aGlzLl9pdGVtcyA9IHRoaXMuZ2V0SXRlbXNXaXRoUGFyZW50U2VsZWN0ZWQodGhpcy5pdGVtcyk7XG4gIH1cbn1cbiJdfQ==