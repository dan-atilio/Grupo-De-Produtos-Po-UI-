import { Input, EventEmitter, Output, Directive } from '@angular/core';
import { isTypeof, sortFields } from '../../../../utils/util';
import { getGridColumnsClasses, isVisibleField } from '../../po-dynamic.util';
import { PoDynamicFieldType } from '../../po-dynamic-field-type.enum';
import { PoDynamicSharedBase } from '../../shared/po-dynamic-shared-base';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class PoDynamicFormFieldsBaseComponent extends PoDynamicSharedBase {
    titleCasePipe;
    autoFocus;
    disabledForm;
    validate;
    formValidate = new EventEmitter();
    fieldsChange = new EventEmitter();
    // Evento disparado se existir optionsService em visibleField. Necessário resgatar referência do objeto selecionado para quando se tratar de recebimento de opções via serviço.
    objectValue = new EventEmitter();
    validateOnInput;
    _fields;
    _validateFields;
    _value = {};
    // array de objetos que implementam a interface PoDynamicFormField, que serão exibidos no componente.
    set fields(value) {
        this._fields = Array.isArray(value) ? [...value] : [];
    }
    get fields() {
        return this._fields;
    }
    // valor que será utilizado para iniciar valor no componente.
    set value(value) {
        this._value = value && isTypeof(value, 'object') ? value : {};
    }
    get value() {
        return this._value;
    }
    set validateFields(value) {
        this._validateFields = Array.isArray(value) ? [...value] : [];
    }
    get validateFields() {
        return this._validateFields;
    }
    constructor(titleCasePipe) {
        super();
        this.titleCasePipe = titleCasePipe;
    }
    compareTo(value, compareTo) {
        return value === compareTo;
    }
    // retorna um array com os objetos configurados e visíveis.
    getVisibleFields() {
        const visibleFields = [];
        this.fields.forEach(field => {
            if (this.existsProperty(visibleFields, field.property)) {
                this.printError(`"po-dynamic-form" property "${field.property}" está duplicado. Interface: PoDynamicFormField.`);
                return;
            }
            if (!field['property']) {
                this.printError('"po-dynamic-form" É obrigatório ser especificado um property.');
                return;
            }
            if (isVisibleField(field)) {
                visibleFields.push(this.createField(field));
            }
        });
        const _visibleFields = sortFields(visibleFields);
        this.ensureFieldHasContainer(_visibleFields);
        return _visibleFields;
    }
    // converte um array em string para um array de objetos que contem label e value.
    convertOptions(options) {
        const everyOptionString = options.every(option => typeof option === 'string');
        if (everyOptionString) {
            return options.map(value => ({ label: value, value }));
        }
        return options;
    }
    // cria um novo objeto com as classes de grid system, com control (tipo do componente) e label default.
    createField(field) {
        const control = this.getComponentControl(field);
        const options = !!field.options ? this.convertOptions(field.options) : undefined;
        const focus = this.hasFocus(field);
        const type = field && field.type ? field.type.toLocaleLowerCase() : 'string';
        const componentClass = getGridColumnsClasses(field.gridColumns, field.offsetColumns, {
            smGrid: field.gridSmColumns,
            mdGrid: field.gridMdColumns,
            lgGrid: field.gridLgColumns,
            xlGrid: field.gridXlColumns
        }, {
            smOffset: field.offsetSmColumns,
            mdOffset: field.offsetMdColumns,
            lgOffset: field.offsetLgColumns,
            xlOffset: field.offsetXlColumns
        }, {
            smPull: field.gridSmPull,
            mdPull: field.gridMdPull,
            lgPull: field.gridLgPull,
            xlPull: field.gridXlPull
        });
        return {
            label: this.titleCasePipe.transform(field.property),
            maskFormatModel: this.compareTo(type, PoDynamicFieldType.Time),
            ...field,
            componentClass,
            control,
            focus,
            options
        };
    }
    existsProperty(fields, property) {
        return fields.some(field => field.property === property);
    }
    // recupera o componente de acordo com algumas regras do field.
    getComponentControl(field = {}) {
        const type = field && field.type ? field.type.toLocaleLowerCase() : 'string';
        const { forceBooleanComponentType } = field;
        const forceOptionComponent = this.verifyForceOptionComponent(field);
        if (forceBooleanComponentType) {
            return forceBooleanComponentType;
        }
        if (forceOptionComponent) {
            const { forceOptionsComponentType } = field;
            return forceOptionsComponentType;
        }
        if (this.isNumberType(field, type)) {
            return 'number';
        }
        else if (this.isCurrencyType(field, type) || type === PoDynamicFieldType.Decimal) {
            return 'decimal';
        }
        else if (this.isSelect(field)) {
            return 'select';
        }
        else if (this.isRadioGroup(field)) {
            return 'radioGroup';
        }
        else if (this.isCheckboxGroup(field)) {
            return 'checkboxGroup';
        }
        else if (this.isMultiselect(field)) {
            return 'multiselect';
        }
        else if (this.compareTo(type, PoDynamicFieldType.Boolean)) {
            return 'switch';
        }
        else if (this.compareTo(type, PoDynamicFieldType.Date) || this.compareTo(type, PoDynamicFieldType.DateTime)) {
            return field.range ? 'datepickerrange' : 'datepicker';
        }
        else if (this.compareTo(type, PoDynamicFieldType.Time)) {
            field.mask = field.mask || '99:99';
            return 'input';
        }
        else if (this.isCombo(field)) {
            return 'combo';
        }
        else if (this.isLookup(field)) {
            return 'lookup';
        }
        else if (this.isTextarea(field)) {
            return 'textarea';
        }
        else if (this.isPassword(field)) {
            return 'password';
        }
        else if (this.isUpload(field)) {
            return 'upload';
        }
        return 'input';
    }
    hasFocus(field) {
        return !!this.autoFocus && this.autoFocus === field.property;
    }
    isCheckboxGroup(field) {
        const { optionsService, optionsMulti, options } = field;
        return !optionsService && optionsMulti && !!options && options.length <= 3;
    }
    isCombo(field) {
        const { optionsService } = field;
        return !!optionsService && (isTypeof(optionsService, 'string') || this.isComboFilter(optionsService));
    }
    isCurrencyType(field, type) {
        const { mask, pattern } = field;
        return this.compareTo(type, PoDynamicFieldType.Currency) && !mask && !pattern;
    }
    isLookupFilter(object) {
        return object && object.getObjectByValue !== undefined;
    }
    isComboFilter(object) {
        return object && object.getFilteredData !== undefined;
    }
    isLookup(field) {
        const { searchService } = field;
        return !!searchService && (isTypeof(searchService, 'string') || this.isLookupFilter(searchService));
    }
    isMultiselect(field) {
        const { optionsService, optionsMulti, options } = field;
        return optionsMulti && (!!optionsService || (!!options && options.length > 3));
    }
    isNumberType(field, type) {
        const { mask, pattern } = field;
        return this.compareTo(type, PoDynamicFieldType.Number) && !mask && !pattern;
    }
    isPassword(field) {
        const { secret } = field;
        return secret;
    }
    isRadioGroup(field) {
        const { optionsMulti, options } = field;
        return !optionsMulti && !!options && options.length <= 3;
    }
    isUpload(field) {
        const { url, type } = field;
        return url && type === 'upload';
    }
    verifyForceOptionComponent(field) {
        const { optionsMulti, optionsService, forceOptionsComponentType } = field;
        if (forceOptionsComponentType && !optionsMulti && !optionsService) {
            return true;
        }
        return false;
    }
    isSelect(field) {
        const { optionsMulti, options } = field;
        return !optionsMulti && !!options && options.length > 3;
    }
    isTextarea(field) {
        const { rows } = field;
        return rows && rows >= 3;
    }
    printError(error) {
        console.error(error);
    }
    static ɵfac = function PoDynamicFormFieldsBaseComponent_Factory(t) { return new (t || PoDynamicFormFieldsBaseComponent)(i0.ɵɵdirectiveInject(i1.TitleCasePipe)); };
    static ɵdir = /*@__PURE__*/ i0.ɵɵdefineDirective({ type: PoDynamicFormFieldsBaseComponent, inputs: { autoFocus: [i0.ɵɵInputFlags.None, "p-auto-focus", "autoFocus"], disabledForm: [i0.ɵɵInputFlags.None, "p-disabled-form", "disabledForm"], validate: [i0.ɵɵInputFlags.None, "p-validate", "validate"], validateOnInput: [i0.ɵɵInputFlags.None, "p-validate-on-input", "validateOnInput"], fields: [i0.ɵɵInputFlags.None, "p-fields", "fields"], value: [i0.ɵɵInputFlags.None, "p-value", "value"], validateFields: [i0.ɵɵInputFlags.None, "p-validate-fields", "validateFields"] }, outputs: { formValidate: "p-form-validate", fieldsChange: "p-fieldsChange", objectValue: "p-object-value" }, features: [i0.ɵɵInheritDefinitionFeature] });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoDynamicFormFieldsBaseComponent, [{
        type: Directive
    }], () => [{ type: i1.TitleCasePipe }], { autoFocus: [{
            type: Input,
            args: ['p-auto-focus']
        }], disabledForm: [{
            type: Input,
            args: ['p-disabled-form']
        }], validate: [{
            type: Input,
            args: ['p-validate']
        }], formValidate: [{
            type: Output,
            args: ['p-form-validate']
        }], fieldsChange: [{
            type: Output,
            args: ['p-fieldsChange']
        }], objectValue: [{
            type: Output,
            args: ['p-object-value']
        }], validateOnInput: [{
            type: Input,
            args: ['p-validate-on-input']
        }], fields: [{
            type: Input,
            args: ['p-fields']
        }], value: [{
            type: Input,
            args: ['p-value']
        }], validateFields: [{
            type: Input,
            args: ['p-validate-fields']
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZHluYW1pYy1mb3JtLWZpZWxkcy1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1keW5hbWljL3BvLWR5bmFtaWMtZm9ybS9wby1keW5hbWljLWZvcm0tZmllbGRzL3BvLWR5bmFtaWMtZm9ybS1maWVsZHMtYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUd2RSxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRTlELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxjQUFjLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM5RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUt0RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQzs7O0FBRzFFLE1BQU0sT0FBTyxnQ0FBaUMsU0FBUSxtQkFBbUI7SUE4Q25EO0lBN0NHLFNBQVMsQ0FBVTtJQUVoQixZQUFZLENBQVU7SUFFM0IsUUFBUSxDQUFxQjtJQUV2QixZQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztJQUV4QyxZQUFZLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztJQUVqRSwrS0FBK0s7SUFDckosV0FBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7SUFFbEMsZUFBZSxDQUFVO0lBRS9DLE9BQU8sQ0FBNEI7SUFDbkMsZUFBZSxDQUFnQjtJQUMvQixNQUFNLEdBQVMsRUFBRSxDQUFDO0lBRTFCLHFHQUFxRztJQUNyRyxJQUF1QixNQUFNLENBQUMsS0FBZ0M7UUFDNUQsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FB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TCxNQUFNO2tCQUE1QixLQUFLO21CQUFDLFVBQVU7WUFTSyxLQUFLO2tCQUExQixLQUFLO21CQUFDLFNBQVM7WUFRZ0IsY0FBYztrQkFBN0MsS0FBSzttQkFBQyxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbnB1dCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIERpcmVjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVGl0bGVDYXNlUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbmltcG9ydCB7IGlzVHlwZW9mLCBzb3J0RmllbGRzIH0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5cbmltcG9ydCB7IGdldEdyaWRDb2x1bW5zQ2xhc3NlcywgaXNWaXNpYmxlRmllbGQgfSBmcm9tICcuLi8uLi9wby1keW5hbWljLnV0aWwnO1xuaW1wb3J0IHsgUG9EeW5hbWljRmllbGRUeXBlIH0gZnJvbSAnLi4vLi4vcG8tZHluYW1pYy1maWVsZC10eXBlLmVudW0nO1xuaW1wb3J0IHsgUG9EeW5hbWljRm9ybUZpZWxkIH0gZnJvbSAnLi4vcG8tZHluYW1pYy1mb3JtLWZpZWxkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0R5bmFtaWNGb3JtRmllbGRJbnRlcm5hbCB9IGZyb20gJy4vcG8tZHluYW1pYy1mb3JtLWZpZWxkLWludGVybmFsLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0NvbWJvRmlsdGVyIH0gZnJvbSAnLi4vLi4vLi4vcG8tZmllbGQvcG8tY29tYm8vaW50ZXJmYWNlcy9wby1jb21iby1maWx0ZXIuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvTG9va3VwRmlsdGVyIH0gZnJvbSAnLi4vLi4vLi4vcG8tZmllbGQvcG8tbG9va3VwL2ludGVyZmFjZXMvcG8tbG9va3VwLWZpbHRlci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9EeW5hbWljU2hhcmVkQmFzZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9wby1keW5hbWljLXNoYXJlZC1iYXNlJztcblxuQERpcmVjdGl2ZSgpXG5leHBvcnQgY2xhc3MgUG9EeW5hbWljRm9ybUZpZWxkc0Jhc2VDb21wb25lbnQgZXh0ZW5kcyBQb0R5bmFtaWNTaGFyZWRCYXNlIHtcbiAgQElucHV0KCdwLWF1dG8tZm9jdXMnKSBhdXRvRm9jdXM/OiBzdHJpbmc7XG5cbiAgQElucHV0KCdwLWRpc2FibGVkLWZvcm0nKSBkaXNhYmxlZEZvcm06IGJvb2xlYW47XG5cbiAgQElucHV0KCdwLXZhbGlkYXRlJykgdmFsaWRhdGU/OiBzdHJpbmcgfCBGdW5jdGlvbjtcblxuICBAT3V0cHV0KCdwLWZvcm0tdmFsaWRhdGUnKSBmb3JtVmFsaWRhdGUgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KCdwLWZpZWxkc0NoYW5nZScpIGZpZWxkc0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8vIEV2ZW50byBkaXNwYXJhZG8gc2UgZXhpc3RpciBvcHRpb25zU2VydmljZSBlbSB2aXNpYmxlRmllbGQuIE5lY2Vzc8OhcmlvIHJlc2dhdGFyIHJlZmVyw6puY2lhIGRvIG9iamV0byBzZWxlY2lvbmFkbyBwYXJhIHF1YW5kbyBzZSB0cmF0YXIgZGUgcmVjZWJpbWVudG8gZGUgb3DDp8O1ZXMgdmlhIHNlcnZpw6dvLlxuICBAT3V0cHV0KCdwLW9iamVjdC12YWx1ZScpIG9iamVjdFZhbHVlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQElucHV0KCdwLXZhbGlkYXRlLW9uLWlucHV0JykgdmFsaWRhdGVPbklucHV0OiBib29sZWFuO1xuXG4gIHByaXZhdGUgX2ZpZWxkczogQXJyYXk8UG9EeW5hbWljRm9ybUZpZWxkPjtcbiAgcHJpdmF0ZSBfdmFsaWRhdGVGaWVsZHM6IEFycmF5PHN0cmluZz47XG4gIHByaXZhdGUgX3ZhbHVlPzogYW55ID0ge307XG5cbiAgLy8gYXJyYXkgZGUgb2JqZXRvcyBxdWUgaW1wbGVtZW50YW0gYSBpbnRlcmZhY2UgUG9EeW5hbWljRm9ybUZpZWxkLCBxdWUgc2Vyw6NvIGV4aWJpZG9zIG5vIGNvbXBvbmVudGUuXG4gIEBJbnB1dCgncC1maWVsZHMnKSBzZXQgZmllbGRzKHZhbHVlOiBBcnJheTxQb0R5bmFtaWNGb3JtRmllbGQ+KSB7XG4gICAgdGhpcy5fZmllbGRzID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBbLi4udmFsdWVdIDogW107XG4gIH1cblxuICBnZXQgZmllbGRzKCkge1xuICAgIHJldHVybiB0aGlzLl9maWVsZHM7XG4gIH1cblxuICAvLyB2YWxvciBxdWUgc2Vyw6EgdXRpbGl6YWRvIHBhcmEgaW5pY2lhciB2YWxvciBubyBjb21wb25lbnRlLlxuICBASW5wdXQoJ3AtdmFsdWUnKSBzZXQgdmFsdWUodmFsdWU6IGFueSkge1xuICAgIHRoaXMuX3ZhbHVlID0gdmFsdWUgJiYgaXNUeXBlb2YodmFsdWUsICdvYmplY3QnKSA/IHZhbHVlIDoge307XG4gIH1cblxuICBnZXQgdmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICB9XG5cbiAgQElucHV0KCdwLXZhbGlkYXRlLWZpZWxkcycpIHNldCB2YWxpZGF0ZUZpZWxkcyh2YWx1ZTogQXJyYXk8c3RyaW5nPikge1xuICAgIHRoaXMuX3ZhbGlkYXRlRmllbGRzID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBbLi4udmFsdWVdIDogW107XG4gIH1cblxuICBnZXQgdmFsaWRhdGVGaWVsZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbGlkYXRlRmllbGRzO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB0aXRsZUNhc2VQaXBlOiBUaXRsZUNhc2VQaXBlKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIGNvbXBhcmVUbyh2YWx1ZSwgY29tcGFyZVRvKSB7XG4gICAgcmV0dXJuIHZhbHVlID09PSBjb21wYXJlVG87XG4gIH1cblxuICAvLyByZXRvcm5hIHVtIGFycmF5IGNvbSBvcyBvYmpldG9zIGNvbmZpZ3VyYWRvcyBlIHZpc8OtdmVpcy5cbiAgcHJvdGVjdGVkIGdldFZpc2libGVGaWVsZHMoKSB7XG4gICAgY29uc3QgdmlzaWJsZUZpZWxkcyA9IFtdO1xuXG4gICAgdGhpcy5maWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICBpZiAodGhpcy5leGlzdHNQcm9wZXJ0eSh2aXNpYmxlRmllbGRzLCBmaWVsZC5wcm9wZXJ0eSkpIHtcbiAgICAgICAgdGhpcy5wcmludEVycm9yKFxuICAgICAgICAgIGBcInBvLWR5bmFtaWMtZm9ybVwiIHByb3BlcnR5IFwiJHtmaWVsZC5wcm9wZXJ0eX1cIiBlc3TDoSBkdXBsaWNhZG8uIEludGVyZmFjZTogUG9EeW5hbWljRm9ybUZpZWxkLmBcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWZpZWxkWydwcm9wZXJ0eSddKSB7XG4gICAgICAgIHRoaXMucHJpbnRFcnJvcignXCJwby1keW5hbWljLWZvcm1cIiDDiSBvYnJpZ2F0w7NyaW8gc2VyIGVzcGVjaWZpY2FkbyB1bSBwcm9wZXJ0eS4nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNWaXNpYmxlRmllbGQoZmllbGQpKSB7XG4gICAgICAgIHZpc2libGVGaWVsZHMucHVzaCh0aGlzLmNyZWF0ZUZpZWxkKGZpZWxkKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBfdmlzaWJsZUZpZWxkcyA9IHNvcnRGaWVsZHModmlzaWJsZUZpZWxkcyk7XG4gICAgdGhpcy5lbnN1cmVGaWVsZEhhc0NvbnRhaW5lcihfdmlzaWJsZUZpZWxkcyk7XG5cbiAgICByZXR1cm4gX3Zpc2libGVGaWVsZHM7XG4gIH1cblxuICAvLyBjb252ZXJ0ZSB1bSBhcnJheSBlbSBzdHJpbmcgcGFyYSB1bSBhcnJheSBkZSBvYmpldG9zIHF1ZSBjb250ZW0gbGFiZWwgZSB2YWx1ZS5cbiAgcHJpdmF0ZSBjb252ZXJ0T3B0aW9ucyhvcHRpb25zOiBBcnJheTxhbnk+KTogQXJyYXk8eyBsYWJlbDogc3RyaW5nOyB2YWx1ZTogc3RyaW5nIH0+IHtcbiAgICBjb25zdCBldmVyeU9wdGlvblN0cmluZyA9IG9wdGlvbnMuZXZlcnkob3B0aW9uID0+IHR5cGVvZiBvcHRpb24gPT09ICdzdHJpbmcnKTtcblxuICAgIGlmIChldmVyeU9wdGlvblN0cmluZykge1xuICAgICAgcmV0dXJuIG9wdGlvbnMubWFwKHZhbHVlID0+ICh7IGxhYmVsOiB2YWx1ZSwgdmFsdWUgfSkpO1xuICAgIH1cblxuICAgIHJldHVybiBvcHRpb25zO1xuICB9XG5cbiAgLy8gY3JpYSB1bSBub3ZvIG9iamV0byBjb20gYXMgY2xhc3NlcyBkZSBncmlkIHN5c3RlbSwgY29tIGNvbnRyb2wgKHRpcG8gZG8gY29tcG9uZW50ZSkgZSBsYWJlbCBkZWZhdWx0LlxuICBwcml2YXRlIGNyZWF0ZUZpZWxkKGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQpOiBQb0R5bmFtaWNGb3JtRmllbGRJbnRlcm5hbCB7XG4gICAgY29uc3QgY29udHJvbCA9IHRoaXMuZ2V0Q29tcG9uZW50Q29udHJvbChmaWVsZCk7XG4gICAgY29uc3Qgb3B0aW9ucyA9ICEhZmllbGQub3B0aW9ucyA/IHRoaXMuY29udmVydE9wdGlvbnMoZmllbGQub3B0aW9ucykgOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgZm9jdXMgPSB0aGlzLmhhc0ZvY3VzKGZpZWxkKTtcbiAgICBjb25zdCB0eXBlID0gZmllbGQgJiYgZmllbGQudHlwZSA/IGZpZWxkLnR5cGUudG9Mb2NhbGVMb3dlckNhc2UoKSA6ICdzdHJpbmcnO1xuXG4gICAgY29uc3QgY29tcG9uZW50Q2xhc3MgPSBnZXRHcmlkQ29sdW1uc0NsYXNzZXMoXG4gICAgICBmaWVsZC5ncmlkQ29sdW1ucyxcbiAgICAgIGZpZWxkLm9mZnNldENvbHVtbnMsXG4gICAgICB7XG4gICAgICAgIHNtR3JpZDogZmllbGQuZ3JpZFNtQ29sdW1ucyxcbiAgICAgICAgbWRHcmlkOiBmaWVsZC5ncmlkTWRDb2x1bW5zLFxuICAgICAgICBsZ0dyaWQ6IGZpZWxkLmdyaWRMZ0NvbHVtbnMsXG4gICAgICAgIHhsR3JpZDogZmllbGQuZ3JpZFhsQ29sdW1uc1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgc21PZmZzZXQ6IGZpZWxkLm9mZnNldFNtQ29sdW1ucyxcbiAgICAgICAgbWRPZmZzZXQ6IGZpZWxkLm9mZnNldE1kQ29sdW1ucyxcbiAgICAgICAgbGdPZmZzZXQ6IGZpZWxkLm9mZnNldExnQ29sdW1ucyxcbiAgICAgICAgeGxPZmZzZXQ6IGZpZWxkLm9mZnNldFhsQ29sdW1uc1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgc21QdWxsOiBmaWVsZC5ncmlkU21QdWxsLFxuICAgICAgICBtZFB1bGw6IGZpZWxkLmdyaWRNZFB1bGwsXG4gICAgICAgIGxnUHVsbDogZmllbGQuZ3JpZExnUHVsbCxcbiAgICAgICAgeGxQdWxsOiBmaWVsZC5ncmlkWGxQdWxsXG4gICAgICB9XG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBsYWJlbDogdGhpcy50aXRsZUNhc2VQaXBlLnRyYW5zZm9ybShmaWVsZC5wcm9wZXJ0eSksXG4gICAgICBtYXNrRm9ybWF0TW9kZWw6IHRoaXMuY29tcGFyZVRvKHR5cGUsIFBvRHluYW1pY0ZpZWxkVHlwZS5UaW1lKSxcbiAgICAgIC4uLmZpZWxkLFxuICAgICAgY29tcG9uZW50Q2xhc3MsXG4gICAgICBjb250cm9sLFxuICAgICAgZm9jdXMsXG4gICAgICBvcHRpb25zXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZXhpc3RzUHJvcGVydHkoZmllbGRzOiBBcnJheTxQb0R5bmFtaWNGb3JtRmllbGQ+LCBwcm9wZXJ0eTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGZpZWxkcy5zb21lKGZpZWxkID0+IGZpZWxkLnByb3BlcnR5ID09PSBwcm9wZXJ0eSk7XG4gIH1cblxuICAvLyByZWN1cGVyYSBvIGNvbXBvbmVudGUgZGUgYWNvcmRvIGNvbSBhbGd1bWFzIHJlZ3JhcyBkbyBmaWVsZC5cbiAgcHJpdmF0ZSBnZXRDb21wb25lbnRDb250cm9sKGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQgPSA8YW55Pnt9KSB7XG4gICAgY29uc3QgdHlwZSA9IGZpZWxkICYmIGZpZWxkLnR5cGUgPyBmaWVsZC50eXBlLnRvTG9jYWxlTG93ZXJDYXNlKCkgOiAnc3RyaW5nJztcblxuICAgIGNvbnN0IHsgZm9yY2VCb29sZWFuQ29tcG9uZW50VHlwZSB9ID0gZmllbGQ7XG4gICAgY29uc3QgZm9yY2VPcHRpb25Db21wb25lbnQgPSB0aGlzLnZlcmlmeUZvcmNlT3B0aW9uQ29tcG9uZW50KGZpZWxkKTtcblxuICAgIGlmIChmb3JjZUJvb2xlYW5Db21wb25lbnRUeXBlKSB7XG4gICAgICByZXR1cm4gZm9yY2VCb29sZWFuQ29tcG9uZW50VHlwZTtcbiAgICB9XG5cbiAgICBpZiAoZm9yY2VPcHRpb25Db21wb25lbnQpIHtcbiAgICAgIGNvbnN0IHsgZm9yY2VPcHRpb25zQ29tcG9uZW50VHlwZSB9ID0gZmllbGQ7XG4gICAgICByZXR1cm4gZm9yY2VPcHRpb25zQ29tcG9uZW50VHlwZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc051bWJlclR5cGUoZmllbGQsIHR5cGUpKSB7XG4gICAgICByZXR1cm4gJ251bWJlcic7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzQ3VycmVuY3lUeXBlKGZpZWxkLCB0eXBlKSB8fCB0eXBlID09PSBQb0R5bmFtaWNGaWVsZFR5cGUuRGVjaW1hbCkge1xuICAgICAgcmV0dXJuICdkZWNpbWFsJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNTZWxlY3QoZmllbGQpKSB7XG4gICAgICByZXR1cm4gJ3NlbGVjdCc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzUmFkaW9Hcm91cChmaWVsZCkpIHtcbiAgICAgIHJldHVybiAncmFkaW9Hcm91cCc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzQ2hlY2tib3hHcm91cChmaWVsZCkpIHtcbiAgICAgIHJldHVybiAnY2hlY2tib3hHcm91cCc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzTXVsdGlzZWxlY3QoZmllbGQpKSB7XG4gICAgICByZXR1cm4gJ211bHRpc2VsZWN0JztcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29tcGFyZVRvKHR5cGUsIFBvRHluYW1pY0ZpZWxkVHlwZS5Cb29sZWFuKSkge1xuICAgICAgcmV0dXJuICdzd2l0Y2gnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb21wYXJlVG8odHlwZSwgUG9EeW5hbWljRmllbGRUeXBlLkRhdGUpIHx8IHRoaXMuY29tcGFyZVRvKHR5cGUsIFBvRHluYW1pY0ZpZWxkVHlwZS5EYXRlVGltZSkpIHtcbiAgICAgIHJldHVybiBmaWVsZC5yYW5nZSA/ICdkYXRlcGlja2VycmFuZ2UnIDogJ2RhdGVwaWNrZXInO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb21wYXJlVG8odHlwZSwgUG9EeW5hbWljRmllbGRUeXBlLlRpbWUpKSB7XG4gICAgICBmaWVsZC5tYXNrID0gZmllbGQubWFzayB8fCAnOTk6OTknO1xuXG4gICAgICByZXR1cm4gJ2lucHV0JztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNDb21ibyhmaWVsZCkpIHtcbiAgICAgIHJldHVybiAnY29tYm8nO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc0xvb2t1cChmaWVsZCkpIHtcbiAgICAgIHJldHVybiAnbG9va3VwJztcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNUZXh0YXJlYShmaWVsZCkpIHtcbiAgICAgIHJldHVybiAndGV4dGFyZWEnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5pc1Bhc3N3b3JkKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICdwYXNzd29yZCc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzVXBsb2FkKGZpZWxkKSkge1xuICAgICAgcmV0dXJuICd1cGxvYWQnO1xuICAgIH1cblxuICAgIHJldHVybiAnaW5wdXQnO1xuICB9XG5cbiAgcHJpdmF0ZSBoYXNGb2N1cyhmaWVsZDogUG9EeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgcmV0dXJuICEhdGhpcy5hdXRvRm9jdXMgJiYgdGhpcy5hdXRvRm9jdXMgPT09IGZpZWxkLnByb3BlcnR5O1xuICB9XG5cbiAgcHJpdmF0ZSBpc0NoZWNrYm94R3JvdXAoZmllbGQ6IFBvRHluYW1pY0Zvcm1GaWVsZCkge1xuICAgIGNvbnN0IHsgb3B0aW9uc1NlcnZpY2UsIG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNTZXJ2aWNlICYmIG9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPD0gMztcbiAgfVxuXG4gIHByaXZhdGUgaXNDb21ibyhmaWVsZDogUG9EeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgY29uc3QgeyBvcHRpb25zU2VydmljZSB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gISFvcHRpb25zU2VydmljZSAmJiAoaXNUeXBlb2Yob3B0aW9uc1NlcnZpY2UsICdzdHJpbmcnKSB8fCB0aGlzLmlzQ29tYm9GaWx0ZXIob3B0aW9uc1NlcnZpY2UpKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNDdXJyZW5jeVR5cGUoZmllbGQ6IFBvRHluYW1pY0Zvcm1GaWVsZCwgdHlwZTogc3RyaW5nKSB7XG4gICAgY29uc3QgeyBtYXNrLCBwYXR0ZXJuIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiB0aGlzLmNvbXBhcmVUbyh0eXBlLCBQb0R5bmFtaWNGaWVsZFR5cGUuQ3VycmVuY3kpICYmICFtYXNrICYmICFwYXR0ZXJuO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0xvb2t1cEZpbHRlcihvYmplY3Q6IGFueSk6IG9iamVjdCBpcyBQb0xvb2t1cEZpbHRlciB7XG4gICAgcmV0dXJuIG9iamVjdCAmJiAoPFBvTG9va3VwRmlsdGVyPm9iamVjdCkuZ2V0T2JqZWN0QnlWYWx1ZSAhPT0gdW5kZWZpbmVkO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0NvbWJvRmlsdGVyKG9iamVjdDogYW55KTogb2JqZWN0IGlzIFBvQ29tYm9GaWx0ZXIge1xuICAgIHJldHVybiBvYmplY3QgJiYgKDxQb0NvbWJvRmlsdGVyPm9iamVjdCkuZ2V0RmlsdGVyZWREYXRhICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICBwcml2YXRlIGlzTG9va3VwKGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IHNlYXJjaFNlcnZpY2UgfSA9IGZpZWxkO1xuXG4gICAgcmV0dXJuICEhc2VhcmNoU2VydmljZSAmJiAoaXNUeXBlb2Yoc2VhcmNoU2VydmljZSwgJ3N0cmluZycpIHx8IHRoaXMuaXNMb29rdXBGaWx0ZXIoc2VhcmNoU2VydmljZSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc011bHRpc2VsZWN0KGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IG9wdGlvbnNTZXJ2aWNlLCBvcHRpb25zTXVsdGksIG9wdGlvbnMgfSA9IGZpZWxkO1xuXG4gICAgcmV0dXJuIG9wdGlvbnNNdWx0aSAmJiAoISFvcHRpb25zU2VydmljZSB8fCAoISFvcHRpb25zICYmIG9wdGlvbnMubGVuZ3RoID4gMykpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc051bWJlclR5cGUoZmllbGQ6IFBvRHluYW1pY0Zvcm1GaWVsZCwgdHlwZTogc3RyaW5nKSB7XG4gICAgY29uc3QgeyBtYXNrLCBwYXR0ZXJuIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiB0aGlzLmNvbXBhcmVUbyh0eXBlLCBQb0R5bmFtaWNGaWVsZFR5cGUuTnVtYmVyKSAmJiAhbWFzayAmJiAhcGF0dGVybjtcbiAgfVxuXG4gIHByaXZhdGUgaXNQYXNzd29yZChmaWVsZDogUG9EeW5hbWljRm9ybUZpZWxkKSB7XG4gICAgY29uc3QgeyBzZWNyZXQgfSA9IGZpZWxkO1xuXG4gICAgcmV0dXJuIHNlY3JldDtcbiAgfVxuXG4gIHByaXZhdGUgaXNSYWRpb0dyb3VwKGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPD0gMztcbiAgfVxuXG4gIHByaXZhdGUgaXNVcGxvYWQoZmllbGQ6IFBvRHluYW1pY0Zvcm1GaWVsZCkge1xuICAgIGNvbnN0IHsgdXJsLCB0eXBlIH0gPSBmaWVsZDtcblxuICAgIHJldHVybiB1cmwgJiYgdHlwZSA9PT0gJ3VwbG9hZCc7XG4gIH1cblxuICBwcml2YXRlIHZlcmlmeUZvcmNlT3B0aW9uQ29tcG9uZW50KGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IG9wdGlvbnNNdWx0aSwgb3B0aW9uc1NlcnZpY2UsIGZvcmNlT3B0aW9uc0NvbXBvbmVudFR5cGUgfSA9IGZpZWxkO1xuXG4gICAgaWYgKGZvcmNlT3B0aW9uc0NvbXBvbmVudFR5cGUgJiYgIW9wdGlvbnNNdWx0aSAmJiAhb3B0aW9uc1NlcnZpY2UpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGlzU2VsZWN0KGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IG9wdGlvbnNNdWx0aSwgb3B0aW9ucyB9ID0gZmllbGQ7XG5cbiAgICByZXR1cm4gIW9wdGlvbnNNdWx0aSAmJiAhIW9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPiAzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1RleHRhcmVhKGZpZWxkOiBQb0R5bmFtaWNGb3JtRmllbGQpIHtcbiAgICBjb25zdCB7IHJvd3MgfSA9IGZpZWxkO1xuXG4gICAgcmV0dXJuIHJvd3MgJiYgcm93cyA+PSAzO1xuICB9XG5cbiAgcHJpdmF0ZSBwcmludEVycm9yKGVycm9yOiBzdHJpbmcpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgfVxufVxuIl19