import { Component } from '@angular/core';
import { PoDynamicViewBaseComponent } from './po-dynamic-view-base.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "../../../pipes/po-time/po-time.pipe";
import * as i3 from "./services/po-dynamic-view.service";
import * as i4 from "../../po-field/po-combo/po-combo-filter.service";
import * as i5 from "../../po-field/po-multiselect/po-multiselect-filter.service";
import * as i6 from "../../po-divider/po-divider.component";
import * as i7 from "../../po-info/po-info.component";
import * as i8 from "../../po-tag/po-tag.component";
import * as i9 from "../../po-image/po-image.component";
import * as i10 from "../po-dynamic-container/po-dynamic-container.component";
function PoDynamicViewComponent_div_0_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainer(0);
} }
const _c0 = a0 => ({ $implicit: a0 });
function PoDynamicViewComponent_div_0_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 6);
    i0.ɵɵtemplate(1, PoDynamicViewComponent_div_0_ng_container_1_Template, 1, 0, "ng-container", 7);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = i0.ɵɵnextContext();
    const _r4 = i0.ɵɵreference(4);
    const _r2 = i0.ɵɵreference(2);
    i0.ɵɵclassProp("po-dynamic", ctx_r0.hasContainers);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngTemplateOutlet", ctx_r0.hasContainers ? _r4 : _r2)("ngTemplateOutletContext", i0.ɵɵpureFunction1(4, _c0, ctx_r0.hasContainers ? ctx_r0.containerFields : ctx_r0.visibleFields));
} }
function PoDynamicViewComponent_ng_template_1_ng_template_0_po_divider_0_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "po-divider", 10);
} if (rf & 2) {
    const field_r14 = i0.ɵɵnextContext().$implicit;
    i0.ɵɵproperty("p-label", field_r14.divider);
} }
function PoDynamicViewComponent_ng_template_1_ng_template_0_ng_container_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainer(0);
} }
function PoDynamicViewComponent_ng_template_1_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵtemplate(0, PoDynamicViewComponent_ng_template_1_ng_template_0_po_divider_0_Template, 1, 1, "po-divider", 9)(1, PoDynamicViewComponent_ng_template_1_ng_template_0_ng_container_1_Template, 1, 0, "ng-container", 7);
} if (rf & 2) {
    const field_r14 = ctx.$implicit;
    i0.ɵɵnextContext(2);
    const _r6 = i0.ɵɵreference(6);
    const _r8 = i0.ɵɵreference(8);
    const _r10 = i0.ɵɵreference(10);
    i0.ɵɵproperty("ngIf", field_r14 == null ? null : field_r14.divider == null ? null : field_r14.divider.trim());
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngTemplateOutlet", !field_r14.tag && !field_r14.image ? _r6 : !field_r14.image ? _r8 : _r10)("ngTemplateOutletContext", i0.ɵɵpureFunction1(3, _c0, field_r14));
} }
function PoDynamicViewComponent_ng_template_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵtemplate(0, PoDynamicViewComponent_ng_template_1_ng_template_0_Template, 2, 5, "ng-template", 8);
} if (rf & 2) {
    const fields_r12 = ctx.$implicit;
    i0.ɵɵproperty("ngForOf", fields_r12);
} }
function PoDynamicViewComponent_ng_template_3_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "po-dynamic-container", 11);
} if (rf & 2) {
    const fields_r18 = ctx.$implicit;
    i0.ɵɵnextContext();
    const _r2 = i0.ɵɵreference(2);
    i0.ɵɵproperty("p-fields", fields_r18)("p-content", _r2);
} }
function PoDynamicViewComponent_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "po-info", 12);
} if (rf & 2) {
    const field_r19 = ctx.$implicit;
    const ctx_r5 = i0.ɵɵnextContext();
    i0.ɵɵproperty("ngClass", field_r19.cssClass)("p-label", field_r19.label)("p-value", ctx_r5.setFieldValue(field_r19));
} }
function PoDynamicViewComponent_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "po-tag", 13);
} if (rf & 2) {
    const field_r20 = ctx.$implicit;
    const ctx_r7 = i0.ɵɵnextContext();
    i0.ɵɵproperty("ngClass", field_r20.cssClass)("p-color", field_r20.color)("p-icon", field_r20.icon)("p-inverse", field_r20.inverse)("p-label", field_r20.label)("p-value", ctx_r7.setFieldValue(field_r20));
} }
function PoDynamicViewComponent_ng_template_9_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelement(0, "po-image", 14);
} if (rf & 2) {
    const field_r21 = ctx.$implicit;
    i0.ɵɵproperty("p-alt", field_r21.alt)("p-height", field_r21.height)("p-src", field_r21.value);
} }
/**
 * @docsExtends PoDynamicViewBaseComponent
 *
 * @example
 *
 * <example name="po-dynamic-view-basic" title="PO Dynamic View Basic">
 *  <file name="sample-po-dynamic-view-basic/sample-po-dynamic-view-basic.component.html"> </file>
 *  <file name="sample-po-dynamic-view-basic/sample-po-dynamic-view-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-dynamic-view-employee" title="PO Dynamic View - Employee">
 *  <file name="sample-po-dynamic-view-employee/sample-po-dynamic-view-employee.component.html"> </file>
 *  <file name="sample-po-dynamic-view-employee/sample-po-dynamic-view-employee.component.ts"> </file>
 * </example>
 *
 * <example name="po-dynamic-view-employee-on-load" title="PO Dynamic View - Employee on load">
 *  <file name="sample-po-dynamic-view-employee-on-load/sample-po-dynamic-view-employee-on-load.component.html"> </file>
 *  <file name="sample-po-dynamic-view-employee-on-load/sample-po-dynamic-view-employee-on-load.component.ts"> </file>
 *  <file name="sample-po-dynamic-view-employee-on-load/sample-po-dynamic-view-employee-on-load.service.ts"> </file>
 * </example>
 *
 * <example name="po-dynamic-view-container" title="PO Dynamic View - Employee on load">
 *  <file name="sample-po-dynamic-view-container/sample-po-dynamic-view-container.component.html"> </file>
 *  <file name="sample-po-dynamic-view-container/sample-po-dynamic-view-container.component.ts"> </file>
 * </example>
 */
export class PoDynamicViewComponent extends PoDynamicViewBaseComponent {
    initChanges;
    constructor(currencyPipe, datePipe, decimalPipe, timePipe, titleCasePipe, dynamicViewService, comboFilterService, multiselectFilterService) {
        super(currencyPipe, datePipe, decimalPipe, timePipe, titleCasePipe, dynamicViewService, comboFilterService, multiselectFilterService);
    }
    ngOnChanges(changes) {
        if (this.load && !this.initChanges) {
            this.initChanges = false;
        }
        else {
            this.initChanges = true;
        }
        if ((changes.fields || changes.value || changes.showAllValue) && this.initChanges) {
            this.visibleFields = this.getVisibleFields();
            this.setContainerFields();
        }
    }
    ngOnInit() {
        if (this.load) {
            this.updateValuesAndFieldsOnLoad().finally(() => {
                this.setContainerFields();
            });
        }
    }
    setFieldValue(field) {
        if (field.options) {
            const selectedOption = field.options.find(option => option.value === field.value);
            return selectedOption ? selectedOption.label : field.value;
        }
        else if (field.type === 'boolean' && 'booleanTrue' in field && 'booleanFalse' in field) {
            return field.value ? field.booleanTrue : field.booleanFalse;
        }
        else {
            return field.value;
        }
    }
    async getValuesAndFieldsFromLoad() {
        let valueAndFieldsFromLoad;
        if (typeof this.load === 'string') {
            valueAndFieldsFromLoad = await this.dynamicViewService.onLoad(this.load, this.value);
        }
        else if (typeof this.load === 'function') {
            valueAndFieldsFromLoad = this.load();
        }
        return valueAndFieldsFromLoad || {};
    }
    getVisibleFields() {
        if (this.showAllValue) {
            return this.getMergedFields();
        }
        return this.value && this.fields.length ? this.getConfiguredFields() : this.getValueFields();
    }
    setFieldOnLoad(fieldOnLoad) {
        const index = this.fields.findIndex(field => field.property === fieldOnLoad.property);
        if (index >= 0) {
            this.fields[index] = { ...this.fields[index], ...fieldOnLoad };
        }
        else {
            this.fields.push({ ...fieldOnLoad });
        }
    }
    setFieldsOnLoad(fields) {
        if (fields) {
            fields.forEach(fieldOnLoad => {
                this.setFieldOnLoad(fieldOnLoad);
            });
        }
    }
    setValueOnLoad(newValue) {
        Object.assign(this.value, newValue);
    }
    async updateValuesAndFieldsOnLoad() {
        const { value, fields } = await this.getValuesAndFieldsFromLoad();
        this.setValueOnLoad(value);
        this.setFieldsOnLoad(fields);
        this.visibleFields = this.getVisibleFields();
        this.initChanges = true;
    }
    static ɵfac = function PoDynamicViewComponent_Factory(t) { return new (t || PoDynamicViewComponent)(i0.ɵɵdirectiveInject(i1.CurrencyPipe), i0.ɵɵdirectiveInject(i1.DatePipe), i0.ɵɵdirectiveInject(i1.DecimalPipe), i0.ɵɵdirectiveInject(i2.PoTimePipe), i0.ɵɵdirectiveInject(i1.TitleCasePipe), i0.ɵɵdirectiveInject(i3.PoDynamicViewService), i0.ɵɵdirectiveInject(i4.PoComboFilterService), i0.ɵɵdirectiveInject(i5.PoMultiselectFilterService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoDynamicViewComponent, selectors: [["po-dynamic-view"]], features: [i0.ɵɵInheritDefinitionFeature, i0.ɵɵNgOnChangesFeature], decls: 11, vars: 1, consts: [["class", "po-row", 3, "po-dynamic", 4, "ngIf"], ["poContent", ""], ["poContentContainer", ""], ["poInfo", ""], ["poTag", ""], ["poImage", ""], [1, "po-row"], [4, "ngTemplateOutlet", "ngTemplateOutletContext"], ["ngFor", "", 3, "ngForOf"], ["class", "po-sm-12", 3, "p-label", 4, "ngIf"], [1, "po-sm-12", 3, "p-label"], [3, "p-fields", "p-content"], [3, "ngClass", "p-label", "p-value"], [3, "ngClass", "p-color", "p-icon", "p-inverse", "p-label", "p-value"], [3, "p-alt", "p-height", "p-src"]], template: function PoDynamicViewComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵtemplate(0, PoDynamicViewComponent_div_0_Template, 2, 6, "div", 0)(1, PoDynamicViewComponent_ng_template_1_Template, 1, 1, "ng-template", null, 1, i0.ɵɵtemplateRefExtractor)(3, PoDynamicViewComponent_ng_template_3_Template, 1, 2, "ng-template", null, 2, i0.ɵɵtemplateRefExtractor)(5, PoDynamicViewComponent_ng_template_5_Template, 1, 3, "ng-template", null, 3, i0.ɵɵtemplateRefExtractor)(7, PoDynamicViewComponent_ng_template_7_Template, 1, 6, "ng-template", null, 4, i0.ɵɵtemplateRefExtractor)(9, PoDynamicViewComponent_ng_template_9_Template, 1, 3, "ng-template", null, 5, i0.ɵɵtemplateRefExtractor);
        } if (rf & 2) {
            i0.ɵɵproperty("ngIf", ctx.visibleFields.length);
        } }, dependencies: [i1.NgClass, i1.NgForOf, i1.NgIf, i1.NgTemplateOutlet, i6.PoDividerComponent, i7.PoInfoComponent, i8.PoTagComponent, i9.PoImageComponent, i10.PoDynamicContainerComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoDynamicViewComponent, [{
        type: Component,
        args: [{ selector: 'po-dynamic-view', template: "<div class=\"po-row\" [class.po-dynamic]=\"hasContainers\" *ngIf=\"visibleFields.length\">\n  <ng-container\n    *ngTemplateOutlet=\"\n      hasContainers ? poContentContainer : poContent;\n      context: { $implicit: hasContainers ? containerFields : visibleFields }\n    \"\n  ></ng-container>\n</div>\n\n<ng-template #poContent let-fields>\n  <ng-template ngFor let-field [ngForOf]=\"fields\">\n    <po-divider *ngIf=\"field?.divider?.trim()\" class=\"po-sm-12\" [p-label]=\"field.divider\"> </po-divider>\n    <ng-container\n      *ngTemplateOutlet=\"\n        !field.tag && !field.image ? poInfo : !field.image ? poTag : poImage;\n        context: { $implicit: field }\n      \"\n    >\n    </ng-container>\n  </ng-template>\n</ng-template>\n\n<ng-template #poContentContainer let-fields>\n  <po-dynamic-container [p-fields]=\"fields\" [p-content]=\"poContent\"></po-dynamic-container>\n</ng-template>\n\n<ng-template #poInfo let-field>\n  <po-info [ngClass]=\"field.cssClass\" [p-label]=\"field.label\" [p-value]=\"setFieldValue(field)\"> </po-info>\n</ng-template>\n\n<ng-template #poTag let-field>\n  <po-tag\n    [ngClass]=\"field.cssClass\"\n    [p-color]=\"field.color\"\n    [p-icon]=\"field.icon\"\n    [p-inverse]=\"field.inverse\"\n    [p-label]=\"field.label\"\n    [p-value]=\"setFieldValue(field)\"\n  >\n  </po-tag>\n</ng-template>\n\n<ng-template #poImage let-field>\n  <po-image [p-alt]=\"field.alt\" [p-height]=\"field.height\" [p-src]=\"field.value\"> </po-image>\n</ng-template>\n" }]
    }], () => [{ type: i1.CurrencyPipe }, { type: i1.DatePipe }, { type: i1.DecimalPipe }, { type: i2.PoTimePipe }, { type: i1.TitleCasePipe }, { type: i3.PoDynamicViewService }, { type: i4.PoComboFilterService }, { type: i5.PoMultiselectFilterService }], null); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoDynamicViewComponent, { className: "PoDynamicViewComponent", filePath: "lib/components/po-dynamic/po-dynamic-view/po-dynamic-view.component.ts", lineNumber: 42 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZHluYW1pYy12aWV3LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1keW5hbWljL3BvLWR5bmFtaWMtdmlldy9wby1keW5hbWljLXZpZXcuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLWR5bmFtaWMvcG8tZHluYW1pYy12aWV3L3BvLWR5bmFtaWMtdmlldy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsU0FBUyxFQUFvQyxNQUFNLGVBQWUsQ0FBQztBQUs1RSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQzs7Ozs7Ozs7Ozs7OztJQ0w1RSx3QkFLZ0I7Ozs7SUFObEIsOEJBQW9GO0lBQ2xGLCtGQUtnQjtJQUNsQixpQkFBTTs7Ozs7SUFQYyxrREFBa0M7SUFFakQsY0FFUTtJQUZSLG1FQUVRLDZIQUFBOzs7SUFPVCxpQ0FBb0c7OztJQUF4QywyQ0FBeUI7OztJQUNyRix3QkFNZTs7O0lBUGYsaUhBQW9HLHdHQUFBOzs7Ozs7O0lBQXZGLDZHQUE0QjtJQUV0QyxjQUVVO0lBRlYsMkdBRVUsa0VBQUE7OztJQUxmLHFHQVNjOzs7SUFUZSxvQ0FBa0I7OztJQWEvQywyQ0FBeUY7Ozs7O0lBQW5FLHFDQUFtQixrQkFBQTs7O0lBSXpDLDhCQUF3Rzs7OztJQUEvRiw0Q0FBMEIsNEJBQUEsNENBQUE7OztJQUluQyw2QkFRUzs7OztJQVBQLDRDQUEwQiw0QkFBQSwwQkFBQSxnQ0FBQSw0QkFBQSw0Q0FBQTs7O0lBVzVCLCtCQUEwRjs7O0lBQWhGLHFDQUFtQiw4QkFBQSwwQkFBQTs7QURoQy9COzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBeUJHO0FBS0gsTUFBTSxPQUFPLHNCQUF1QixT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LENBQUM7SUFDMUIsQ0FBQztnRkF6R1Usc0JBQXNCOzZEQUF0QixzQkFBc0I7WUN6Q25DLHVFQU9NLDJHQUFBLDJHQUFBLDJHQUFBLDJHQUFBLDJHQUFBOztZQVBrRCwrQ0FBMEI7OztpRkR5Q3JFLHNCQUFzQjtjQUpsQyxTQUFTOzJCQUNFLGlCQUFpQjs7a0ZBR2hCLHNCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEN1cnJlbmN5UGlwZSwgRGF0ZVBpcGUsIERlY2ltYWxQaXBlLCBUaXRsZUNhc2VQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgT25DaGFuZ2VzLCBPbkluaXQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgUG9UaW1lUGlwZSB9IGZyb20gJy4uLy4uLy4uL3BpcGVzL3BvLXRpbWUvcG8tdGltZS5waXBlJztcblxuaW1wb3J0IHsgUG9EeW5hbWljVmlld0ZpZWxkIH0gZnJvbSAnLi8uLi9wby1keW5hbWljLXZpZXcvcG8tZHluYW1pYy12aWV3LWZpZWxkLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0R5bmFtaWNWaWV3QmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tZHluYW1pYy12aWV3LWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFBvRHluYW1pY1ZpZXdTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9wby1keW5hbWljLXZpZXcuc2VydmljZSc7XG5pbXBvcnQgeyBQb0NvbWJvRmlsdGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3BvLWZpZWxkL3BvLWNvbWJvL3BvLWNvbWJvLWZpbHRlci5zZXJ2aWNlJztcbmltcG9ydCB7IFBvTXVsdGlzZWxlY3RGaWx0ZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vcG8tZmllbGQvcG8tbXVsdGlzZWxlY3QvcG8tbXVsdGlzZWxlY3QtZmlsdGVyLnNlcnZpY2UnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb0R5bmFtaWNWaWV3QmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLWR5bmFtaWMtdmlldy1iYXNpY1wiIHRpdGxlPVwiUE8gRHluYW1pYyBWaWV3IEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1keW5hbWljLXZpZXctYmFzaWMvc2FtcGxlLXBvLWR5bmFtaWMtdmlldy1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1keW5hbWljLXZpZXctYmFzaWMvc2FtcGxlLXBvLWR5bmFtaWMtdmlldy1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1keW5hbWljLXZpZXctZW1wbG95ZWVcIiB0aXRsZT1cIlBPIER5bmFtaWMgVmlldyAtIEVtcGxveWVlXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1keW5hbWljLXZpZXctZW1wbG95ZWUvc2FtcGxlLXBvLWR5bmFtaWMtdmlldy1lbXBsb3llZS5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1keW5hbWljLXZpZXctZW1wbG95ZWUvc2FtcGxlLXBvLWR5bmFtaWMtdmlldy1lbXBsb3llZS5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1keW5hbWljLXZpZXctZW1wbG95ZWUtb24tbG9hZFwiIHRpdGxlPVwiUE8gRHluYW1pYyBWaWV3IC0gRW1wbG95ZWUgb24gbG9hZFwiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tZHluYW1pYy12aWV3LWVtcGxveWVlLW9uLWxvYWQvc2FtcGxlLXBvLWR5bmFtaWMtdmlldy1lbXBsb3llZS1vbi1sb2FkLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWR5bmFtaWMtdmlldy1lbXBsb3llZS1vbi1sb2FkL3NhbXBsZS1wby1keW5hbWljLXZpZXctZW1wbG95ZWUtb24tbG9hZC5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tZHluYW1pYy12aWV3LWVtcGxveWVlLW9uLWxvYWQvc2FtcGxlLXBvLWR5bmFtaWMtdmlldy1lbXBsb3llZS1vbi1sb2FkLnNlcnZpY2UudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1keW5hbWljLXZpZXctY29udGFpbmVyXCIgdGl0bGU9XCJQTyBEeW5hbWljIFZpZXcgLSBFbXBsb3llZSBvbiBsb2FkXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1keW5hbWljLXZpZXctY29udGFpbmVyL3NhbXBsZS1wby1keW5hbWljLXZpZXctY29udGFpbmVyLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWR5bmFtaWMtdmlldy1jb250YWluZXIvc2FtcGxlLXBvLWR5bmFtaWMtdmlldy1jb250YWluZXIuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tZHluYW1pYy12aWV3JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWR5bmFtaWMtdmlldy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9EeW5hbWljVmlld0NvbXBvbmVudCBleHRlbmRzIFBvRHluYW1pY1ZpZXdCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkluaXQge1xuICBpbml0Q2hhbmdlcztcbiAgY29uc3RydWN0b3IoXG4gICAgY3VycmVuY3lQaXBlOiBDdXJyZW5jeVBpcGUsXG4gICAgZGF0ZVBpcGU6IERhdGVQaXBlLFxuICAgIGRlY2ltYWxQaXBlOiBEZWNpbWFsUGlwZSxcbiAgICB0aW1lUGlwZTogUG9UaW1lUGlwZSxcbiAgICB0aXRsZUNhc2VQaXBlOiBUaXRsZUNhc2VQaXBlLFxuICAgIGR5bmFtaWNWaWV3U2VydmljZTogUG9EeW5hbWljVmlld1NlcnZpY2UsXG4gICAgY29tYm9GaWx0ZXJTZXJ2aWNlOiBQb0NvbWJvRmlsdGVyU2VydmljZSxcbiAgICBtdWx0aXNlbGVjdEZpbHRlclNlcnZpY2U6IFBvTXVsdGlzZWxlY3RGaWx0ZXJTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKFxuICAgICAgY3VycmVuY3lQaXBlLFxuICAgICAgZGF0ZVBpcGUsXG4gICAgICBkZWNpbWFsUGlwZSxcbiAgICAgIHRpbWVQaXBlLFxuICAgICAgdGl0bGVDYXNlUGlwZSxcbiAgICAgIGR5bmFtaWNWaWV3U2VydmljZSxcbiAgICAgIGNvbWJvRmlsdGVyU2VydmljZSxcbiAgICAgIG11bHRpc2VsZWN0RmlsdGVyU2VydmljZVxuICAgICk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKHRoaXMubG9hZCAmJiAhdGhpcy5pbml0Q2hhbmdlcykge1xuICAgICAgdGhpcy5pbml0Q2hhbmdlcyA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmluaXRDaGFuZ2VzID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKChjaGFuZ2VzLmZpZWxkcyB8fCBjaGFuZ2VzLnZhbHVlIHx8IGNoYW5nZXMuc2hvd0FsbFZhbHVlKSAmJiB0aGlzLmluaXRDaGFuZ2VzKSB7XG4gICAgICB0aGlzLnZpc2libGVGaWVsZHMgPSB0aGlzLmdldFZpc2libGVGaWVsZHMoKTtcbiAgICAgIHRoaXMuc2V0Q29udGFpbmVyRmllbGRzKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKHRoaXMubG9hZCkge1xuICAgICAgdGhpcy51cGRhdGVWYWx1ZXNBbmRGaWVsZHNPbkxvYWQoKS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRDb250YWluZXJGaWVsZHMoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHNldEZpZWxkVmFsdWUoZmllbGQpIHtcbiAgICBpZiAoZmllbGQub3B0aW9ucykge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBmaWVsZC5vcHRpb25zLmZpbmQob3B0aW9uID0+IG9wdGlvbi52YWx1ZSA9PT0gZmllbGQudmFsdWUpO1xuICAgICAgcmV0dXJuIHNlbGVjdGVkT3B0aW9uID8gc2VsZWN0ZWRPcHRpb24ubGFiZWwgOiBmaWVsZC52YWx1ZTtcbiAgICB9IGVsc2UgaWYgKGZpZWxkLnR5cGUgPT09ICdib29sZWFuJyAmJiAnYm9vbGVhblRydWUnIGluIGZpZWxkICYmICdib29sZWFuRmFsc2UnIGluIGZpZWxkKSB7XG4gICAgICByZXR1cm4gZmllbGQudmFsdWUgPyBmaWVsZC5ib29sZWFuVHJ1ZSA6IGZpZWxkLmJvb2xlYW5GYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZpZWxkLnZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0VmFsdWVzQW5kRmllbGRzRnJvbUxvYWQoKTogUHJvbWlzZTx7IHZhbHVlPzogYW55OyBmaWVsZHM/OiBBcnJheTxQb0R5bmFtaWNWaWV3RmllbGQ+IH0+IHtcbiAgICBsZXQgdmFsdWVBbmRGaWVsZHNGcm9tTG9hZDtcblxuICAgIGlmICh0eXBlb2YgdGhpcy5sb2FkID09PSAnc3RyaW5nJykge1xuICAgICAgdmFsdWVBbmRGaWVsZHNGcm9tTG9hZCA9IGF3YWl0IHRoaXMuZHluYW1pY1ZpZXdTZXJ2aWNlLm9uTG9hZCh0aGlzLmxvYWQsIHRoaXMudmFsdWUpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMubG9hZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdmFsdWVBbmRGaWVsZHNGcm9tTG9hZCA9IHRoaXMubG9hZCgpO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZUFuZEZpZWxkc0Zyb21Mb2FkIHx8IHt9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRWaXNpYmxlRmllbGRzKCkge1xuICAgIGlmICh0aGlzLnNob3dBbGxWYWx1ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TWVyZ2VkRmllbGRzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMudmFsdWUgJiYgdGhpcy5maWVsZHMubGVuZ3RoID8gdGhpcy5nZXRDb25maWd1cmVkRmllbGRzKCkgOiB0aGlzLmdldFZhbHVlRmllbGRzKCk7XG4gIH1cblxuICBwcml2YXRlIHNldEZpZWxkT25Mb2FkKGZpZWxkT25Mb2FkOiBQb0R5bmFtaWNWaWV3RmllbGQpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZmllbGRzLmZpbmRJbmRleChmaWVsZCA9PiBmaWVsZC5wcm9wZXJ0eSA9PT0gZmllbGRPbkxvYWQucHJvcGVydHkpO1xuXG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgIHRoaXMuZmllbGRzW2luZGV4XSA9IHsgLi4udGhpcy5maWVsZHNbaW5kZXhdLCAuLi5maWVsZE9uTG9hZCB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmZpZWxkcy5wdXNoKHsgLi4uZmllbGRPbkxvYWQgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRGaWVsZHNPbkxvYWQoZmllbGRzOiBBcnJheTxQb0R5bmFtaWNWaWV3RmllbGQ+KSB7XG4gICAgaWYgKGZpZWxkcykge1xuICAgICAgZmllbGRzLmZvckVhY2goZmllbGRPbkxvYWQgPT4ge1xuICAgICAgICB0aGlzLnNldEZpZWxkT25Mb2FkKGZpZWxkT25Mb2FkKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0VmFsdWVPbkxvYWQobmV3VmFsdWU6IGFueSkge1xuICAgIE9iamVjdC5hc3NpZ24odGhpcy52YWx1ZSwgbmV3VmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVWYWx1ZXNBbmRGaWVsZHNPbkxvYWQoKSB7XG4gICAgY29uc3QgeyB2YWx1ZSwgZmllbGRzIH0gPSBhd2FpdCB0aGlzLmdldFZhbHVlc0FuZEZpZWxkc0Zyb21Mb2FkKCk7XG5cbiAgICB0aGlzLnNldFZhbHVlT25Mb2FkKHZhbHVlKTtcbiAgICB0aGlzLnNldEZpZWxkc09uTG9hZChmaWVsZHMpO1xuXG4gICAgdGhpcy52aXNpYmxlRmllbGRzID0gdGhpcy5nZXRWaXNpYmxlRmllbGRzKCk7XG4gICAgdGhpcy5pbml0Q2hhbmdlcyA9IHRydWU7XG4gIH1cbn1cbiIsIjxkaXYgY2xhc3M9XCJwby1yb3dcIiBbY2xhc3MucG8tZHluYW1pY109XCJoYXNDb250YWluZXJzXCIgKm5nSWY9XCJ2aXNpYmxlRmllbGRzLmxlbmd0aFwiPlxuICA8bmctY29udGFpbmVyXG4gICAgKm5nVGVtcGxhdGVPdXRsZXQ9XCJcbiAgICAgIGhhc0NvbnRhaW5lcnMgPyBwb0NvbnRlbnRDb250YWluZXIgOiBwb0NvbnRlbnQ7XG4gICAgICBjb250ZXh0OiB7ICRpbXBsaWNpdDogaGFzQ29udGFpbmVycyA/IGNvbnRhaW5lckZpZWxkcyA6IHZpc2libGVGaWVsZHMgfVxuICAgIFwiXG4gID48L25nLWNvbnRhaW5lcj5cbjwvZGl2PlxuXG48bmctdGVtcGxhdGUgI3BvQ29udGVudCBsZXQtZmllbGRzPlxuICA8bmctdGVtcGxhdGUgbmdGb3IgbGV0LWZpZWxkIFtuZ0Zvck9mXT1cImZpZWxkc1wiPlxuICAgIDxwby1kaXZpZGVyICpuZ0lmPVwiZmllbGQ/LmRpdmlkZXI/LnRyaW0oKVwiIGNsYXNzPVwicG8tc20tMTJcIiBbcC1sYWJlbF09XCJmaWVsZC5kaXZpZGVyXCI+IDwvcG8tZGl2aWRlcj5cbiAgICA8bmctY29udGFpbmVyXG4gICAgICAqbmdUZW1wbGF0ZU91dGxldD1cIlxuICAgICAgICAhZmllbGQudGFnICYmICFmaWVsZC5pbWFnZSA/IHBvSW5mbyA6ICFmaWVsZC5pbWFnZSA/IHBvVGFnIDogcG9JbWFnZTtcbiAgICAgICAgY29udGV4dDogeyAkaW1wbGljaXQ6IGZpZWxkIH1cbiAgICAgIFwiXG4gICAgPlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L25nLXRlbXBsYXRlPlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICNwb0NvbnRlbnRDb250YWluZXIgbGV0LWZpZWxkcz5cbiAgPHBvLWR5bmFtaWMtY29udGFpbmVyIFtwLWZpZWxkc109XCJmaWVsZHNcIiBbcC1jb250ZW50XT1cInBvQ29udGVudFwiPjwvcG8tZHluYW1pYy1jb250YWluZXI+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI3BvSW5mbyBsZXQtZmllbGQ+XG4gIDxwby1pbmZvIFtuZ0NsYXNzXT1cImZpZWxkLmNzc0NsYXNzXCIgW3AtbGFiZWxdPVwiZmllbGQubGFiZWxcIiBbcC12YWx1ZV09XCJzZXRGaWVsZFZhbHVlKGZpZWxkKVwiPiA8L3BvLWluZm8+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI3BvVGFnIGxldC1maWVsZD5cbiAgPHBvLXRhZ1xuICAgIFtuZ0NsYXNzXT1cImZpZWxkLmNzc0NsYXNzXCJcbiAgICBbcC1jb2xvcl09XCJmaWVsZC5jb2xvclwiXG4gICAgW3AtaWNvbl09XCJmaWVsZC5pY29uXCJcbiAgICBbcC1pbnZlcnNlXT1cImZpZWxkLmludmVyc2VcIlxuICAgIFtwLWxhYmVsXT1cImZpZWxkLmxhYmVsXCJcbiAgICBbcC12YWx1ZV09XCJzZXRGaWVsZFZhbHVlKGZpZWxkKVwiXG4gID5cbiAgPC9wby10YWc+XG48L25nLXRlbXBsYXRlPlxuXG48bmctdGVtcGxhdGUgI3BvSW1hZ2UgbGV0LWZpZWxkPlxuICA8cG8taW1hZ2UgW3AtYWx0XT1cImZpZWxkLmFsdFwiIFtwLWhlaWdodF09XCJmaWVsZC5oZWlnaHRcIiBbcC1zcmNdPVwiZmllbGQudmFsdWVcIj4gPC9wby1pbWFnZT5cbjwvbmctdGVtcGxhdGU+XG4iXX0=