import { Component, ContentChildren, ElementRef, ViewChild, ViewChildren } from '@angular/core';
import { Subscription, fromEvent } from 'rxjs';
import { PoTabComponent } from './po-tab/po-tab.component';
import { PoTabsBaseComponent } from './po-tabs-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../services/po-language/po-language.service";
import * as i2 from "./po-tabs.service";
import * as i3 from "@angular/common";
import * as i4 from "./po-tab-button/po-tab-button.component";
import * as i5 from "./po-tab-dropdown/po-tab-dropdown.component";
const _c0 = ["tabDropdown"];
const _c1 = ["containerTabs"];
const _c2 = ["tabButton"];
function PoTabsComponent_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    const _r6 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵelementStart(1, "po-tab-button", 7, 8);
    i0.ɵɵlistener("keyup.enter", function PoTabsComponent_ng_container_4_Template_po_tab_button_keyup_enter_1_listener() { i0.ɵɵrestoreView(_r6); const ctx_r5 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r5.closePopover()); })("p-activated", function PoTabsComponent_ng_container_4_Template_po_tab_button_p_activated_1_listener() { const restoredCtx = i0.ɵɵrestoreView(_r6); const tab_r3 = restoredCtx.$implicit; const ctx_r7 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r7.onTabActive(tab_r3)); })("p-change-state", function PoTabsComponent_ng_container_4_Template_po_tab_button_p_change_state_1_listener() { const restoredCtx = i0.ɵɵrestoreView(_r6); const tab_r3 = restoredCtx.$implicit; const ctx_r8 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r8.onTabChangeState(tab_r3)); })("p-click", function PoTabsComponent_ng_container_4_Template_po_tab_button_p_click_1_listener() { const restoredCtx = i0.ɵɵrestoreView(_r6); const tab_r3 = restoredCtx.$implicit; const ctx_r9 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r9.selectedTab(tab_r3)); });
    i0.ɵɵelementEnd();
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const tab_r3 = ctx.$implicit;
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-active", tab_r3.active)("p-disabled", tab_r3.disabled)("p-hide", tab_r3.hide)("p-id", tab_r3.id)("hidden", tab_r3.hide)("p-label", tab_r3.label)("p-small", ctx_r1.small)("id", tab_r3.id);
    i0.ɵɵattribute("disabled", tab_r3.disabled);
} }
function PoTabsComponent_po_tab_dropdown_5_Template(rf, ctx) { if (rf & 1) {
    const _r12 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-tab-dropdown", 9, 10);
    i0.ɵɵlistener("p-change-state", function PoTabsComponent_po_tab_dropdown_5_Template_po_tab_dropdown_p_change_state_0_listener($event) { i0.ɵɵrestoreView(_r12); const ctx_r11 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r11.onTabChangeState($event)); })("p-click", function PoTabsComponent_po_tab_dropdown_5_Template_po_tab_dropdown_p_click_0_listener($event) { i0.ɵɵrestoreView(_r12); const ctx_r13 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r13.onTabActiveByDropdown($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext();
    i0.ɵɵclassProp("po-tab-dropdown-device", !(ctx_r2.tabsDefault == null ? null : ctx_r2.tabsDefault.length));
    i0.ɵɵproperty("p-label", ctx_r2.literals.moreTabs)("p-small", ctx_r2.small)("p-tabs", ctx_r2.overflowedTabs);
} }
const _c3 = ["*"];
export const poTabsLiterals = {
    en: {
        moreTabs: 'More'
    },
    es: {
        moreTabs: 'Más'
    },
    pt: {
        moreTabs: 'Mais'
    },
    ru: {
        moreTabs: 'Ещё'
    }
};
const poTabsMaxNumberOfTabs = 5;
/**
 * @docsExtends PoTabsBaseComponent
 *
 * @example
 *
 * <example name="po-tabs-basic" title="PO Tabs Basic">
 *  <file name="sample-po-tabs-basic/sample-po-tabs-basic.component.html"> </file>
 *  <file name="sample-po-tabs-basic/sample-po-tabs-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-tabs-labs" title="PO Tabs Labs">
 *  <file name="sample-po-tabs-labs/sample-po-tabs-labs.component.html"> </file>
 *  <file name="sample-po-tabs-labs/sample-po-tabs-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-tabs-travel" title="PO Tabs - Travel">
 *  <file name="sample-po-tabs-travel/sample-po-tabs-travel.component.html"> </file>
 *  <file name="sample-po-tabs-travel/sample-po-tabs-travel.component.ts"> </file>
 * </example>
 *
 * <example name="po-tabs-business-conf" title="PO Tabs - Business Conference">
 *  <file name="sample-po-tabs-business-conf/sample-po-tabs-business-conf.component.html"> </file>
 *  <file name="sample-po-tabs-business-conf/sample-po-tabs-business-conf.component.ts"> </file>
 * </example>
 */
export class PoTabsComponent extends PoTabsBaseComponent {
    changeDetector;
    languageService;
    tabsService;
    // Tabs utilizados no ng-content
    tabsChildren;
    tabButton;
    tabDropdown;
    containerTabs;
    maxNumberOfTabs = poTabsMaxNumberOfTabs;
    literals;
    tabsDefault = [];
    tabsDropdown = [];
    initializeCalculation = true;
    initializeComponent = false;
    quantityTabsButton;
    defaultLastTabWidth;
    previousActiveTab;
    subscription = new Subscription();
    subscriptionTabsService = new Subscription();
    subscriptionTabActive = new Subscription();
    constructor(changeDetector, languageService, tabsService) {
        super();
        this.changeDetector = changeDetector;
        this.languageService = languageService;
        this.tabsService = tabsService;
        const language = languageService.getShortLanguage();
        this.literals = {
            ...poTabsLiterals[language]
        };
    }
    ngOnInit() {
        this.subscriptionTabsService = this.tabsService.onChangesTriggered$.subscribe(() => {
            this.updateTabsState();
            if (this.initializeComponent) {
                this.handleKeyboardNavigationTab();
            }
        });
        this.subscriptionTabActive = this.tabsService.triggerActiveOnChanges$.subscribe(tab => {
            const isTabInDropdown = this.tabsDropdown.some(t => t.id === tab.id);
            if (isTabInDropdown) {
                this.onTabActiveByDropdown(tab);
            }
        });
    }
    ngAfterViewInit() {
        this.calculateTabs(this.initializeCalculation);
        this.initializeCalculation = false;
        this.updateTabsState();
        this.changeDetector.detectChanges();
        this.handleKeyboardNavigationTab();
        this.initializeComponent = true;
    }
    ngAfterContentInit() {
        this.updateTabsState(true);
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
        this.subscriptionTabsService.unsubscribe();
        this.subscriptionTabActive.unsubscribe();
    }
    get isShowTabDropdown() {
        return this.tabsChildren['_results'].slice(this.quantityTabsButton).filter(item => !item.hide).length;
    }
    // tabs que serão apresentadas na aba "Mais"
    get overflowedTabs() {
        return this.tabsChildren['_results'].slice(this.quantityTabsButton);
    }
    get tabs() {
        return this.tabsChildren['_results'].slice(0, this.quantityTabsButton);
    }
    get tabsChildrenArray() {
        return this.tabsChildren.toArray();
    }
    closePopover() {
        const containsPopoverVisible = this.tabDropdown && this.tabDropdown.popover && !this.tabDropdown.popover.isHidden;
        if (containsPopoverVisible) {
            this.tabDropdown.popover.close();
        }
    }
    isVisibleTab(tab) {
        return !tab.hide;
    }
    onTabActiveByDropdown(tab) {
        this.changeTabPositionByDropdown(tab);
        const lastTabWidth = this.defaultLastTabWidth > 0
            ? this.defaultLastTabWidth
            : this.tabsChildren.find(e => e === this.tabsChildrenArray[this.quantityTabsButton - 1])?.widthButton;
        this.reorderTabs(tab);
        tab.widthButton = lastTabWidth;
        this.tabButton.last.nativeElement.style.width = `${lastTabWidth}px`;
        this.handleKeyboardNavigationTab();
    }
    // Função disparada quando alguma tab ficar ativa
    onTabActive(tab) {
        this.previousActiveTab = this.tabsChildren.find(tabChild => tabChild.active && tabChild.id !== tab.id);
        this.deactivateTab();
    }
    // funcao será disparada quando mudar o estado do poTab para desabilitado ou escondido.
    onTabChangeState(tab) {
        if (tab.active) {
            tab.active = false;
            this.activeDistinctTab();
            this.changeDetector.detectChanges();
        }
    }
    reorderTabs(tabToReorder) {
        const tabsArray = this.tabsChildrenArray;
        const tabIndex = tabsArray.findIndex(item => item.id === tabToReorder.id);
        if (tabIndex !== -1) {
            const [tab] = tabsArray.splice(tabIndex, 1);
            tabsArray.splice(this.quantityTabsButton - 1, 0, tab);
        }
        this.tabsChildren.reset(tabsArray);
        this.changeDetector.detectChanges();
    }
    // selectiona a aba informada por parametro, caso houver click faz a emição do evento.
    selectedTab(tab) {
        tab.active = true;
        if (tab.click) {
            tab.click.emit(tab);
        }
        const isTabInDropdown = this.tabsDropdown.some(t => t.id === tab.id);
        if (isTabInDropdown) {
            this.onTabActiveByDropdown(tab);
        }
        this.changeDetector.detectChanges();
    }
    trackByFn(_i, tab) {
        return tab.id;
    }
    // ativa a previousActiveTab ou primeira tab encontrada.
    activeDistinctTab() {
        if (this.previousActiveTab) {
            this.previousActiveTab.active = true;
        }
        else {
            this.activeFirstTab();
        }
    }
    // Ativa a primeira Tab que não estiver desabilitada ou escondida.
    activeFirstTab() {
        this.tabs.some(tabChild => {
            if (!tabChild.disabled && !tabChild.hide) {
                tabChild.active = true;
                return true;
            }
        });
    }
    // Movimenta a tab da visão de tabs para o dropdown, e vice-versa.
    changeTabPositionByDropdown(tabToActivate) {
        const lastTab = this.tabsDefault[this.tabsDefault.length - 1];
        this.tabsDefault = this.tabsDefault.filter(tab => tab.id !== lastTab.id);
        this.tabsDefault.push(tabToActivate);
        const _tabsDropdown = this.tabsDropdown.filter(tab => tab.id !== tabToActivate.id);
        _tabsDropdown.unshift(lastTab);
        this.tabsDropdown = _tabsDropdown;
        tabToActivate.active = true;
        this.onTabActive(tabToActivate);
    }
    // desativa previousActiveTab e dispara a detecção de mudança.
    deactivateTab() {
        if (this.previousActiveTab) {
            this.previousActiveTab.active = false;
            this.changeDetector.detectChanges();
        }
    }
    updateTabsState(initialState = false) {
        this.defaultLastTabWidth = this.tabButton?.last?.nativeElement?.getBoundingClientRect().width;
        if (this.defaultLastTabWidth <= 0) {
            return;
        }
        const lastTabChildren = this.tabsChildrenArray[this.quantityTabsButton - 1];
        if (lastTabChildren) {
            lastTabChildren.widthButton = this.defaultLastTabWidth;
        }
        if (this.tabsChildren) {
            const _tabsChildren = this.tabsChildrenArray;
            if (initialState) {
                this.tabsDefault = _tabsChildren;
                this.tabsDropdown = _tabsChildren;
            }
            else {
                this.tabsDefault = _tabsChildren.slice(0, this.quantityTabsButton);
                this.tabsDropdown = _tabsChildren.slice(this.quantityTabsButton);
            }
        }
    }
    calculateTabs(initializeCalculation) {
        if (initializeCalculation) {
            let sumOfWidth = 150;
            const screenSize = this.containerTabs.nativeElement.offsetWidth;
            const listTabButton = [];
            if (this.tabButton?.length) {
                this.tabButton.forEach(element => {
                    const width = element.nativeElement.offsetWidth;
                    if (sumOfWidth + width <= screenSize || screenSize < 1) {
                        listTabButton.push(element);
                    }
                    sumOfWidth += width;
                });
            }
            this.quantityTabsButton = listTabButton.length;
        }
    }
    handleKeyboardNavigationTab(initialIndex = 0) {
        this.subscription.unsubscribe();
        this.subscription = new Subscription();
        if (this.tabButton?.length) {
            const tabFocusable = this.tabButton
                .filter((element, index) => element.nativeElement.children[0]?.id === this.tabsChildren['_results'][index]?.id)
                .map(el => {
                if (el.nativeElement.children[0].classList.contains('po-tab-focusable')) {
                    return el.nativeElement.children[0];
                }
            })
                .filter(Boolean);
            if (tabFocusable) {
                this.initializeTabAccessibilityElements(tabFocusable, initialIndex);
            }
        }
    }
    /**
     * Função que atribui o número de tabs fora do dropdown.
     *
     * Para utilizá-la é necessário ter a instância do componente no DOM, podendo ser utilizado o ViewChild da seguinte forma:
     *
     * ```
     * import { PoTabsComponent } from '@po-ui/ng-components';
     *
     * ...
     *
     * @ViewChild('poTab', { static: true }) poTab: PoTabsComponent;
     *
     * changeQuantityTabs() {
     *   this.poTab.setQuantityTabsButton(1); //Número de tabs
     * }
     * ```
     */
    setQuantityTabsButton(number) {
        this.quantityTabsButton = number;
    }
    initializeTabAccessibilityElements(tabRemoveElements, initialIndex) {
        tabRemoveElements.forEach((tabRemoveElement, index) => {
            if (index === initialIndex) {
                this.setTabIndex(tabRemoveElements[initialIndex], 0);
            }
            else if (tabRemoveElements.length === initialIndex) {
                this.setTabIndex(tabRemoveElements[initialIndex - 1], 0);
            }
            else {
                this.setTabIndex(tabRemoveElement, -1);
            }
            this.subscription.add(fromEvent(tabRemoveElement, 'keydown').subscribe((event) => {
                this.handleKeyDown(event, tabRemoveElements, index);
            }));
            if (index !== 0) {
                this.subscription.add(fromEvent(tabRemoveElements, 'blur').subscribe(() => {
                    this.setTabIndex(tabRemoveElements[index], -1);
                    this.setTabIndex(tabRemoveElements[0], 0);
                }));
            }
        });
    }
    setTabIndex(element, tabIndex) {
        element.setAttribute('tabindex', tabIndex);
    }
    handleKeyDown(event, tabRemoveElements, index) {
        const KEY_SPACE = 'Space';
        const KEY_ARROW_LEFT = 'ArrowLeft';
        const KEY_ARROW_RIGHT = 'ArrowRight';
        const KEY_HOME = 'Home';
        const KEY_END = 'End';
        if (event.code === KEY_SPACE || event.code === KEY_HOME || event.code === KEY_END) {
            event.preventDefault();
            event.stopPropagation();
        }
        if (event.key === KEY_ARROW_LEFT) {
            this.handleArrowLeft(tabRemoveElements, index);
        }
        else if (event.key === KEY_ARROW_RIGHT) {
            this.handleArrowRight(tabRemoveElements, index);
        }
        else if (event.key === KEY_HOME) {
            this.handleHomeKey(tabRemoveElements, index);
        }
        else if (event.key === KEY_END) {
            this.handleEndKey(tabRemoveElements, index);
        }
    }
    handleArrowLeft(tabRemoveElements, index) {
        if (index > 0) {
            this.setTabIndex(tabRemoveElements[index], -1);
            tabRemoveElements[index - 1].focus();
            this.setTabIndex(tabRemoveElements[index - 1], 0);
        }
        else {
            this.setTabIndex(tabRemoveElements[index], -1);
            tabRemoveElements[tabRemoveElements.length - 1].focus();
            this.setTabIndex(tabRemoveElements[tabRemoveElements.length - 1], 0);
        }
    }
    handleHomeKey(tabRemoveElements, index) {
        if (index > 0) {
            this.setTabIndex(tabRemoveElements[index], -1);
            tabRemoveElements[0].focus();
            this.setTabIndex(tabRemoveElements[0], 0);
        }
    }
    handleEndKey(tabRemoveElements, index) {
        if (index < tabRemoveElements.length - 1) {
            this.setTabIndex(tabRemoveElements[index], -1);
            tabRemoveElements[tabRemoveElements.length - 1].focus();
            this.setTabIndex(tabRemoveElements[tabRemoveElements.length - 1], 0);
        }
    }
    handleArrowRight(tabRemoveElements, index) {
        if (index < tabRemoveElements.length - 1) {
            this.setTabIndex(tabRemoveElements[index], -1);
            tabRemoveElements[index + 1].focus();
            this.setTabIndex(tabRemoveElements[index + 1], 0);
        }
        else {
            this.setTabIndex(tabRemoveElements[index], -1);
            tabRemoveElements[0].focus();
            this.setTabIndex(tabRemoveElements[0], 0);
        }
    }
    static ɵfac = function PoTabsComponent_Factory(t) { return new (t || PoTabsComponent)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.PoLanguageService), i0.ɵɵdirectiveInject(i2.PoTabsService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoTabsComponent, selectors: [["po-tabs"]], contentQueries: function PoTabsComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
            i0.ɵɵcontentQuery(dirIndex, PoTabComponent, 4);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tabsChildren = _t);
        } }, viewQuery: function PoTabsComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(_c0, 7);
            i0.ɵɵviewQuery(_c1, 7, ElementRef);
            i0.ɵɵviewQuery(_c2, 5, ElementRef);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tabDropdown = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.containerTabs = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tabButton = _t);
        } }, features: [i0.ɵɵInheritDefinitionFeature], ngContentSelectors: _c3, decls: 8, vars: 3, consts: [[1, "po-tabs-container"], [1, "po-tabs-header"], ["containerTabs", ""], ["role", "tablist", 1, "po-tabs-button-wrapper"], [4, "ngFor", "ngForOf", "ngForTrackBy"], ["class", "po-tab-dropdown", 3, "po-tab-dropdown-device", "p-label", "p-small", "p-tabs", "p-change-state", "p-click", 4, "ngIf"], [1, "po-tabs-content"], [1, "po-tab-button", 3, "p-active", "p-disabled", "p-hide", "p-id", "hidden", "p-label", "p-small", "id", "keyup.enter", "p-activated", "p-change-state", "p-click"], ["tabButton", ""], [1, "po-tab-dropdown", 3, "p-label", "p-small", "p-tabs", "p-change-state", "p-click"], ["tabDropdown", ""]], template: function PoTabsComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵprojectionDef();
            i0.ɵɵelementStart(0, "div", 0)(1, "div", 1, 2)(3, "div", 3);
            i0.ɵɵtemplate(4, PoTabsComponent_ng_container_4_Template, 3, 9, "ng-container", 4)(5, PoTabsComponent_po_tab_dropdown_5_Template, 2, 5, "po-tab-dropdown", 5);
            i0.ɵɵelementEnd()()();
            i0.ɵɵelementStart(6, "div", 6);
            i0.ɵɵprojection(7);
            i0.ɵɵelementEnd();
        } if (rf & 2) {
            i0.ɵɵadvance(4);
            i0.ɵɵproperty("ngForOf", ctx.tabs)("ngForTrackBy", ctx.trackByFn);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.isShowTabDropdown);
        } }, dependencies: [i3.NgForOf, i3.NgIf, i4.PoTabButtonComponent, i5.PoTabDropdownComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoTabsComponent, [{
        type: Component,
        args: [{ selector: 'po-tabs', template: "<div class=\"po-tabs-container\">\n  <div #containerTabs class=\"po-tabs-header\">\n    <div class=\"po-tabs-button-wrapper\" role=\"tablist\">\n      <ng-container *ngFor=\"let tab of tabs; trackBy: trackByFn\">\n        <po-tab-button\n          #tabButton\n          class=\"po-tab-button\"\n          [p-active]=\"tab.active\"\n          [p-disabled]=\"tab.disabled\"\n          [p-hide]=\"tab.hide\"\n          [p-id]=\"tab.id\"\n          [hidden]=\"tab.hide\"\n          [attr.disabled]=\"tab.disabled\"\n          [p-label]=\"tab.label\"\n          [p-small]=\"small\"\n          [id]=\"tab.id\"\n          (keyup.enter)=\"closePopover()\"\n          (p-activated)=\"onTabActive(tab)\"\n          (p-change-state)=\"onTabChangeState(tab)\"\n          (p-click)=\"selectedTab(tab)\"\n        >\n        </po-tab-button>\n      </ng-container>\n\n      <po-tab-dropdown\n        #tabDropdown\n        *ngIf=\"isShowTabDropdown\"\n        class=\"po-tab-dropdown\"\n        [class.po-tab-dropdown-device]=\"!tabsDefault?.length\"\n        [p-label]=\"literals.moreTabs\"\n        [p-small]=\"small\"\n        [p-tabs]=\"overflowedTabs\"\n        (p-change-state)=\"onTabChangeState($event)\"\n        (p-click)=\"onTabActiveByDropdown($event)\"\n      >\n      </po-tab-dropdown>\n    </div>\n  </div>\n</div>\n<div class=\"po-tabs-content\">\n  <ng-content></ng-content>\n</div>\n" }]
    }], () => [{ type: i0.ChangeDetectorRef }, { type: i1.PoLanguageService }, { type: i2.PoTabsService }], { tabsChildren: [{
            type: ContentChildren,
            args: [PoTabComponent]
        }], tabButton: [{
            type: ViewChildren,
            args: ['tabButton', { read: ElementRef }]
        }], tabDropdown: [{
            type: ViewChild,
            args: ['tabDropdown', { static: true }]
        }], containerTabs: [{
            type: ViewChild,
            args: ['containerTabs', { read: ElementRef, static: true }]
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoTabsComponent, { className: "PoTabsComponent", filePath: "lib/components/po-tabs/po-tabs.component.ts", lineNumber: 69 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdGFicy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tdGFicy9wby10YWJzLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby10YWJzL3BvLXRhYnMuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUlMLFNBQVMsRUFDVCxlQUFlLEVBQ2YsVUFBVSxFQUlWLFNBQVMsRUFDVCxZQUFZLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFJdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzNELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDOzs7Ozs7Ozs7Ozs7SUNoQnpELDZCQUEyRDtJQUN6RCwyQ0FnQkM7SUFKQyx3TEFBZSxlQUFBLHFCQUFjLENBQUEsSUFBQyxxT0FDZixlQUFBLDBCQUFnQixDQUFBLElBREQsMk9BRVosZUFBQSwrQkFBcUIsQ0FBQSxJQUZULDZOQUduQixlQUFBLDBCQUFnQixDQUFBLElBSEc7SUFLaEMsaUJBQWdCO0lBQ2xCLDBCQUFlOzs7O0lBZlgsY0FBdUI7SUFBdkIsd0NBQXVCLCtCQUFBLHVCQUFBLG1CQUFBLHVCQUFBLHlCQUFBLHlCQUFBLGlCQUFBO0lBS3ZCLDJDQUE4Qjs7OztJQVlsQyw4Q0FVQztJQUZDLDJNQUFrQixlQUFBLGdDQUF3QixDQUFBLElBQUMsZ0xBQ2hDLGVBQUEscUNBQTZCLENBQUEsSUFERztJQUc3QyxpQkFBa0I7OztJQVBoQiwwR0FBcUQ7SUFDckQsa0RBQTZCLHlCQUFBLGlDQUFBOzs7QURQckMsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFX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cG9ydCB7XG4gIEFmdGVyQ29udGVudEluaXQsXG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRWxlbWVudFJlZixcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q2hpbGRyZW5cbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFBvTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2Uuc2VydmljZSc7XG5cbmltcG9ydCB7IFN1YnNjcmlwdGlvbiwgZnJvbUV2ZW50IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBQb1RhYkRyb3Bkb3duQ29tcG9uZW50IH0gZnJvbSAnLi9wby10YWItZHJvcGRvd24vcG8tdGFiLWRyb3Bkb3duLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb1RhYkNvbXBvbmVudCB9IGZyb20gJy4vcG8tdGFiL3BvLXRhYi5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9UYWJzQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tdGFicy1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb1RhYnNTZXJ2aWNlIH0gZnJvbSAnLi9wby10YWJzLnNlcnZpY2UnO1xuXG5leHBvcnQgY29uc3QgcG9UYWJzTGl0ZXJhbHM6IE9iamVjdCA9IHtcbiAgZW46IDxhbnk+e1xuICAgIG1vcmVUYWJzOiAnTW9yZSdcbiAgfSxcbiAgZXM6IDxhbnk+e1xuICAgIG1vcmVUYWJzOiAnTcOhcydcbiAgfSxcbiAgcHQ6IDxhbnk+e1xuICAgIG1vcmVUYWJzOiAnTWFpcydcbiAgfSxcbiAgcnU6IDxhbnk+e1xuICAgIG1vcmVUYWJzOiAn0JXRidGRJ1xuICB9XG59O1xuXG5jb25zdCBwb1RhYnNNYXhOdW1iZXJPZlRhYnMgPSA1O1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb1RhYnNCYXNlQ29tcG9uZW50XG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tdGFicy1iYXNpY1wiIHRpdGxlPVwiUE8gVGFicyBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdGFicy1iYXNpYy9zYW1wbGUtcG8tdGFicy1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10YWJzLWJhc2ljL3NhbXBsZS1wby10YWJzLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXRhYnMtbGFic1wiIHRpdGxlPVwiUE8gVGFicyBMYWJzXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10YWJzLWxhYnMvc2FtcGxlLXBvLXRhYnMtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10YWJzLWxhYnMvc2FtcGxlLXBvLXRhYnMtbGFicy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby10YWJzLXRyYXZlbFwiIHRpdGxlPVwiUE8gVGFicyAtIFRyYXZlbFwiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdGFicy10cmF2ZWwvc2FtcGxlLXBvLXRhYnMtdHJhdmVsLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXRhYnMtdHJhdmVsL3NhbXBsZS1wby10YWJzLXRyYXZlbC5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby10YWJzLWJ1c2luZXNzLWNvbmZcIiB0aXRsZT1cIlBPIFRhYnMgLSBCdXNpbmVzcyBDb25mZXJlbmNlXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10YWJzLWJ1c2luZXNzLWNvbmYvc2FtcGxlLXBvLXRhYnMtYnVzaW5lc3MtY29uZi5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby10YWJzLWJ1c2luZXNzLWNvbmYvc2FtcGxlLXBvLXRhYnMtYnVzaW5lc3MtY29uZi5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby10YWJzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLXRhYnMuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvVGFic0NvbXBvbmVudCBleHRlbmRzIFBvVGFic0Jhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgQWZ0ZXJDb250ZW50SW5pdCB7XG4gIC8vIFRhYnMgdXRpbGl6YWRvcyBubyBuZy1jb250ZW50XG4gIEBDb250ZW50Q2hpbGRyZW4oUG9UYWJDb21wb25lbnQpIHRhYnNDaGlsZHJlbjogUXVlcnlMaXN0PFBvVGFiQ29tcG9uZW50PjtcbiAgQFZpZXdDaGlsZHJlbigndGFiQnV0dG9uJywgeyByZWFkOiBFbGVtZW50UmVmIH0pIHRhYkJ1dHRvbjogUXVlcnlMaXN0PGFueT47XG5cbiAgQFZpZXdDaGlsZCgndGFiRHJvcGRvd24nLCB7IHN0YXRpYzogdHJ1ZSB9KSB0YWJEcm9wZG93bjogUG9UYWJEcm9wZG93bkNvbXBvbmVudDtcbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyVGFicycsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGNvbnRhaW5lclRhYnM6IEVsZW1lbnRSZWY7XG5cbiAgbWF4TnVtYmVyT2ZUYWJzID0gcG9UYWJzTWF4TnVtYmVyT2ZUYWJzO1xuICBsaXRlcmFscztcbiAgdGFic0RlZmF1bHQgPSBbXTtcbiAgdGFic0Ryb3Bkb3duID0gW107XG4gIGluaXRpYWxpemVDYWxjdWxhdGlvbiA9IHRydWU7XG4gIGluaXRpYWxpemVDb21wb25lbnQgPSBmYWxzZTtcblxuICBxdWFudGl0eVRhYnNCdXR0b247XG4gIGRlZmF1bHRMYXN0VGFiV2lkdGghOiBudW1iZXI7XG5cbiAgcHJpdmF0ZSBwcmV2aW91c0FjdGl2ZVRhYjogUG9UYWJDb21wb25lbnQ7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uVGFic1NlcnZpY2U6IFN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25UYWJBY3RpdmU6IFN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlLFxuICAgIHByaXZhdGUgdGFic1NlcnZpY2U6IFBvVGFic1NlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgICBjb25zdCBsYW5ndWFnZSA9IGxhbmd1YWdlU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCk7XG5cbiAgICB0aGlzLmxpdGVyYWxzID0ge1xuICAgICAgLi4ucG9UYWJzTGl0ZXJhbHNbbGFuZ3VhZ2VdXG4gICAgfTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uVGFic1NlcnZpY2UgPSB0aGlzLnRhYnNTZXJ2aWNlLm9uQ2hhbmdlc1RyaWdnZXJlZCQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlVGFic1N0YXRlKCk7XG4gICAgICBpZiAodGhpcy5pbml0aWFsaXplQ29tcG9uZW50KSB7XG4gICAgICAgIHRoaXMuaGFuZGxlS2V5Ym9hcmROYXZpZ2F0aW9uVGFiKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnN1YnNjcmlwdGlvblRhYkFjdGl2ZSA9IHRoaXMudGFic1NlcnZpY2UudHJpZ2dlckFjdGl2ZU9uQ2hhbmdlcyQuc3Vic2NyaWJlKHRhYiA9PiB7XG4gICAgICBjb25zdCBpc1RhYkluRHJvcGRvd24gPSB0aGlzLnRhYnNEcm9wZG93bi5zb21lKHQgPT4gdC5pZCA9PT0gdGFiLmlkKTtcbiAgICAgIGlmIChpc1RhYkluRHJvcGRvd24pIHtcbiAgICAgICAgdGhpcy5vblRhYkFjdGl2ZUJ5RHJvcGRvd24odGFiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVRhYnModGhpcy5pbml0aWFsaXplQ2FsY3VsYXRpb24pO1xuICAgIHRoaXMuaW5pdGlhbGl6ZUNhbGN1bGF0aW9uID0gZmFsc2U7XG5cbiAgICB0aGlzLnVwZGF0ZVRhYnNTdGF0ZSgpO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIHRoaXMuaGFuZGxlS2V5Ym9hcmROYXZpZ2F0aW9uVGFiKCk7XG4gICAgdGhpcy5pbml0aWFsaXplQ29tcG9uZW50ID0gdHJ1ZTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICB0aGlzLnVwZGF0ZVRhYnNTdGF0ZSh0cnVlKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25UYWJzU2VydmljZS51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uVGFiQWN0aXZlLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBnZXQgaXNTaG93VGFiRHJvcGRvd24oKSB7XG4gICAgcmV0dXJuIHRoaXMudGFic0NoaWxkcmVuWydfcmVzdWx0cyddLnNsaWNlKHRoaXMucXVhbnRpdHlUYWJzQnV0dG9uKS5maWx0ZXIoaXRlbSA9PiAhaXRlbS5oaWRlKS5sZW5ndGg7XG4gIH1cblxuICAvLyB0YWJzIHF1ZSBzZXLDo28gYXByZXNlbnRhZGFzIG5hIGFiYSBcIk1haXNcIlxuICBnZXQgb3ZlcmZsb3dlZFRhYnMoKSB7XG4gICAgcmV0dXJuIHRoaXMudGFic0NoaWxkcmVuWydfcmVzdWx0cyddLnNsaWNlKHRoaXMucXVhbnRpdHlUYWJzQnV0dG9uKTtcbiAgfVxuXG4gIGdldCB0YWJzKCkge1xuICAgIHJldHVybiB0aGlzLnRhYnNDaGlsZHJlblsnX3Jlc3VsdHMnXS5zbGljZSgwLCB0aGlzLnF1YW50aXR5VGFic0J1dHRvbik7XG4gIH1cblxuICBnZXQgdGFic0NoaWxkcmVuQXJyYXkoKTogQXJyYXk8UG9UYWJDb21wb25lbnQ+IHtcbiAgICByZXR1cm4gdGhpcy50YWJzQ2hpbGRyZW4udG9BcnJheSgpO1xuICB9XG5cbiAgY2xvc2VQb3BvdmVyKCk6IHZvaWQge1xuICAgIGNvbnN0IGNvbnRhaW5zUG9wb3ZlclZpc2libGUgPSB0aGlzLnRhYkRyb3Bkb3duICYmIHRoaXMudGFiRHJvcGRvd24ucG9wb3ZlciAmJiAhdGhpcy50YWJEcm9wZG93bi5wb3BvdmVyLmlzSGlkZGVuO1xuXG4gICAgaWYgKGNvbnRhaW5zUG9wb3ZlclZpc2libGUpIHtcbiAgICAgIHRoaXMudGFiRHJvcGRvd24ucG9wb3Zlci5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIGlzVmlzaWJsZVRhYih0YWIpIHtcbiAgICByZXR1cm4gIXRhYi5oaWRlO1xuICB9XG5cbiAgb25UYWJBY3RpdmVCeURyb3Bkb3duKHRhYjogUG9UYWJDb21wb25lbnQpOiB2b2lkIHtcbiAgICB0aGlzLmNoYW5nZVRhYlBvc2l0aW9uQnlEcm9wZG93bih0YWIpO1xuICAgIGNvbnN0IGxhc3RUYWJXaWR0aCA9XG4gICAgICB0aGlzLmRlZmF1bHRMYXN0VGFiV2lkdGggPiAwXG4gICAgICAgID8gdGhpcy5kZWZhdWx0TGFzdFRhYldpZHRoXG4gICAgICAgIDogdGhpcy50YWJzQ2hpbGRyZW4uZmluZChlID0+IGUgPT09IHRoaXMudGFic0NoaWxkcmVuQXJyYXlbdGhpcy5xdWFudGl0eVRhYnNCdXR0b24gLSAxXSk/LndpZHRoQnV0dG9uO1xuXG4gICAgdGhpcy5yZW9yZGVyVGFicyh0YWIpO1xuICAgIHRhYi53aWR0aEJ1dHRvbiA9IGxhc3RUYWJXaWR0aDtcbiAgICB0aGlzLnRhYkJ1dHRvbi5sYXN0Lm5hdGl2ZUVsZW1lbnQuc3R5bGUud2lkdGggPSBgJHtsYXN0VGFiV2lkdGh9cHhgO1xuICAgIHRoaXMuaGFuZGxlS2V5Ym9hcmROYXZpZ2F0aW9uVGFiKCk7XG4gIH1cblxuICAvLyBGdW7Dp8OjbyBkaXNwYXJhZGEgcXVhbmRvIGFsZ3VtYSB0YWIgZmljYXIgYXRpdmFcbiAgb25UYWJBY3RpdmUodGFiOiBQb1RhYkNvbXBvbmVudCkge1xuICAgIHRoaXMucHJldmlvdXNBY3RpdmVUYWIgPSB0aGlzLnRhYnNDaGlsZHJlbi5maW5kKHRhYkNoaWxkID0+IHRhYkNoaWxkLmFjdGl2ZSAmJiB0YWJDaGlsZC5pZCAhPT0gdGFiLmlkKTtcbiAgICB0aGlzLmRlYWN0aXZhdGVUYWIoKTtcbiAgfVxuXG4gIC8vIGZ1bmNhbyBzZXLDoSBkaXNwYXJhZGEgcXVhbmRvIG11ZGFyIG8gZXN0YWRvIGRvIHBvVGFiIHBhcmEgZGVzYWJpbGl0YWRvIG91IGVzY29uZGlkby5cbiAgb25UYWJDaGFuZ2VTdGF0ZSh0YWI6IFBvVGFiQ29tcG9uZW50IHwgYW55KSB7XG4gICAgaWYgKHRhYi5hY3RpdmUpIHtcbiAgICAgIHRhYi5hY3RpdmUgPSBmYWxzZTtcblxuICAgICAgdGhpcy5hY3RpdmVEaXN0aW5jdFRhYigpO1xuXG4gICAgICB0aGlzLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICByZW9yZGVyVGFicyh0YWJUb1Jlb3JkZXI6IFBvVGFiQ29tcG9uZW50KTogdm9pZCB7XG4gICAgY29uc3QgdGFic0FycmF5ID0gdGhpcy50YWJzQ2hpbGRyZW5BcnJheTtcbiAgICBjb25zdCB0YWJJbmRleCA9IHRhYnNBcnJheS5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSB0YWJUb1Jlb3JkZXIuaWQpO1xuICAgIGlmICh0YWJJbmRleCAhPT0gLTEpIHtcbiAgICAgIGNvbnN0IFt0YWJdID0gdGFic0FycmF5LnNwbGljZSh0YWJJbmRleCwgMSk7XG4gICAgICB0YWJzQXJyYXkuc3BsaWNlKHRoaXMucXVhbnRpdHlUYWJzQnV0dG9uIC0gMSwgMCwgdGFiKTtcbiAgICB9XG4gICAgdGhpcy50YWJzQ2hpbGRyZW4ucmVzZXQodGFic0FycmF5KTtcbiAgICB0aGlzLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIC8vIHNlbGVjdGlvbmEgYSBhYmEgaW5mb3JtYWRhIHBvciBwYXJhbWV0cm8sIGNhc28gaG91dmVyIGNsaWNrIGZheiBhIGVtacOnw6NvIGRvIGV2ZW50by5cbiAgc2VsZWN0ZWRUYWIodGFiOiBQb1RhYkNvbXBvbmVudCB8IGFueSkge1xuICAgIHRhYi5hY3RpdmUgPSB0cnVlO1xuXG4gICAgaWYgKHRhYi5jbGljaykge1xuICAgICAgdGFiLmNsaWNrLmVtaXQodGFiKTtcbiAgICB9XG5cbiAgICBjb25zdCBpc1RhYkluRHJvcGRvd24gPSB0aGlzLnRhYnNEcm9wZG93bi5zb21lKHQgPT4gdC5pZCA9PT0gdGFiLmlkKTtcbiAgICBpZiAoaXNUYWJJbkRyb3Bkb3duKSB7XG4gICAgICB0aGlzLm9uVGFiQWN0aXZlQnlEcm9wZG93bih0YWIpO1xuICAgIH1cblxuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgdHJhY2tCeUZuKF9pLCB0YWI6IFBvVGFiQ29tcG9uZW50KSB7XG4gICAgcmV0dXJuIHRhYi5pZDtcbiAgfVxuXG4gIC8vIGF0aXZhIGEgcHJldmlvdXNBY3RpdmVUYWIgb3UgcHJpbWVpcmEgdGFiIGVuY29udHJhZGEuXG4gIHByaXZhdGUgYWN0aXZlRGlzdGluY3RUYWIoKSB7XG4gICAgaWYgKHRoaXMucHJldmlvdXNBY3RpdmVUYWIpIHtcbiAgICAgIHRoaXMucHJldmlvdXNBY3RpdmVUYWIuYWN0aXZlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hY3RpdmVGaXJzdFRhYigpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEF0aXZhIGEgcHJpbWVpcmEgVGFiIHF1ZSBuw6NvIGVzdGl2ZXIgZGVzYWJpbGl0YWRhIG91IGVzY29uZGlkYS5cbiAgcHJpdmF0ZSBhY3RpdmVGaXJzdFRhYigpIHtcbiAgICB0aGlzLnRhYnMuc29tZSh0YWJDaGlsZCA9PiB7XG4gICAgICBpZiAoIXRhYkNoaWxkLmRpc2FibGVkICYmICF0YWJDaGlsZC5oaWRlKSB7XG4gICAgICAgIHRhYkNoaWxkLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gTW92aW1lbnRhIGEgdGFiIGRhIHZpc8OjbyBkZSB0YWJzIHBhcmEgbyBkcm9wZG93biwgZSB2aWNlLXZlcnNhLlxuICBwcml2YXRlIGNoYW5nZVRhYlBvc2l0aW9uQnlEcm9wZG93bih0YWJUb0FjdGl2YXRlOiBQb1RhYkNvbXBvbmVudCk6IHZvaWQge1xuICAgIGNvbnN0IGxhc3RUYWIgPSB0aGlzLnRhYnNEZWZhdWx0W3RoaXMudGFic0RlZmF1bHQubGVuZ3RoIC0gMV07XG4gICAgdGhpcy50YWJzRGVmYXVsdCA9IHRoaXMudGFic0RlZmF1bHQuZmlsdGVyKHRhYiA9PiB0YWIuaWQgIT09IGxhc3RUYWIuaWQpO1xuICAgIHRoaXMudGFic0RlZmF1bHQucHVzaCh0YWJUb0FjdGl2YXRlKTtcblxuICAgIGNvbnN0IF90YWJzRHJvcGRvd24gPSB0aGlzLnRhYnNEcm9wZG93bi5maWx0ZXIodGFiID0+IHRhYi5pZCAhPT0gdGFiVG9BY3RpdmF0ZS5pZCk7XG4gICAgX3RhYnNEcm9wZG93bi51bnNoaWZ0KGxhc3RUYWIpO1xuICAgIHRoaXMudGFic0Ryb3Bkb3duID0gX3RhYnNEcm9wZG93bjtcblxuICAgIHRhYlRvQWN0aXZhdGUuYWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLm9uVGFiQWN0aXZlKHRhYlRvQWN0aXZhdGUpO1xuICB9XG5cbiAgLy8gZGVzYXRpdmEgcHJldmlvdXNBY3RpdmVUYWIgZSBkaXNwYXJhIGEgZGV0ZWPDp8OjbyBkZSBtdWRhbsOnYS5cbiAgcHJpdmF0ZSBkZWFjdGl2YXRlVGFiKCkge1xuICAgIGlmICh0aGlzLnByZXZpb3VzQWN0aXZlVGFiKSB7XG4gICAgICB0aGlzLnByZXZpb3VzQWN0aXZlVGFiLmFjdGl2ZSA9IGZhbHNlO1xuXG4gICAgICB0aGlzLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVRhYnNTdGF0ZShpbml0aWFsU3RhdGU6IGJvb2xlYW4gPSBmYWxzZSk6IHZvaWQge1xuICAgIHRoaXMuZGVmYXVsdExhc3RUYWJXaWR0aCA9IHRoaXMudGFiQnV0dG9uPy5sYXN0Py5uYXRpdmVFbGVtZW50Py5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICBpZiAodGhpcy5kZWZhdWx0TGFzdFRhYldpZHRoIDw9IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBsYXN0VGFiQ2hpbGRyZW46IFBvVGFiQ29tcG9uZW50ID0gdGhpcy50YWJzQ2hpbGRyZW5BcnJheVt0aGlzLnF1YW50aXR5VGFic0J1dHRvbiAtIDFdO1xuICAgIGlmIChsYXN0VGFiQ2hpbGRyZW4pIHtcbiAgICAgIGxhc3RUYWJDaGlsZHJlbi53aWR0aEJ1dHRvbiA9IHRoaXMuZGVmYXVsdExhc3RUYWJXaWR0aDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy50YWJzQ2hpbGRyZW4pIHtcbiAgICAgIGNvbnN0IF90YWJzQ2hpbGRyZW4gPSB0aGlzLnRhYnNDaGlsZHJlbkFycmF5O1xuICAgICAgaWYgKGluaXRpYWxTdGF0ZSkge1xuICAgICAgICB0aGlzLnRhYnNEZWZhdWx0ID0gX3RhYnNDaGlsZHJlbjtcbiAgICAgICAgdGhpcy50YWJzRHJvcGRvd24gPSBfdGFic0NoaWxkcmVuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50YWJzRGVmYXVsdCA9IF90YWJzQ2hpbGRyZW4uc2xpY2UoMCwgdGhpcy5xdWFudGl0eVRhYnNCdXR0b24pO1xuICAgICAgICB0aGlzLnRhYnNEcm9wZG93biA9IF90YWJzQ2hpbGRyZW4uc2xpY2UodGhpcy5xdWFudGl0eVRhYnNCdXR0b24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNhbGN1bGF0ZVRhYnMoaW5pdGlhbGl6ZUNhbGN1bGF0aW9uPzogYm9vbGVhbikge1xuICAgIGlmIChpbml0aWFsaXplQ2FsY3VsYXRpb24pIHtcbiAgICAgIGxldCBzdW1PZldpZHRoID0gMTUwO1xuICAgICAgY29uc3Qgc2NyZWVuU2l6ZSA9IHRoaXMuY29udGFpbmVyVGFicy5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgY29uc3QgbGlzdFRhYkJ1dHRvbiA9IFtdO1xuICAgICAgaWYgKHRoaXMudGFiQnV0dG9uPy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy50YWJCdXR0b24uZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgICBjb25zdCB3aWR0aCA9IGVsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgICAgICBpZiAoc3VtT2ZXaWR0aCArIHdpZHRoIDw9IHNjcmVlblNpemUgfHwgc2NyZWVuU2l6ZSA8IDEpIHtcbiAgICAgICAgICAgIGxpc3RUYWJCdXR0b24ucHVzaChlbGVtZW50KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzdW1PZldpZHRoICs9IHdpZHRoO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMucXVhbnRpdHlUYWJzQnV0dG9uID0gbGlzdFRhYkJ1dHRvbi5sZW5ndGg7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5Ym9hcmROYXZpZ2F0aW9uVGFiKGluaXRpYWxJbmRleCA9IDApIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICAgIGlmICh0aGlzLnRhYkJ1dHRvbj8ubGVuZ3RoKSB7XG4gICAgICBjb25zdCB0YWJGb2N1c2FibGUgPSB0aGlzLnRhYkJ1dHRvblxuICAgICAgICAuZmlsdGVyKChlbGVtZW50LCBpbmRleCkgPT4gZWxlbWVudC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdPy5pZCA9PT0gdGhpcy50YWJzQ2hpbGRyZW5bJ19yZXN1bHRzJ11baW5kZXhdPy5pZClcbiAgICAgICAgLm1hcChlbCA9PiB7XG4gICAgICAgICAgaWYgKGVsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdwby10YWItZm9jdXNhYmxlJykpIHtcbiAgICAgICAgICAgIHJldHVybiBlbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgIGlmICh0YWJGb2N1c2FibGUpIHtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplVGFiQWNjZXNzaWJpbGl0eUVsZW1lbnRzKHRhYkZvY3VzYWJsZSwgaW5pdGlhbEluZGV4KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRnVuw6fDo28gcXVlIGF0cmlidWkgbyBuw7ptZXJvIGRlIHRhYnMgZm9yYSBkbyBkcm9wZG93bi5cbiAgICpcbiAgICogUGFyYSB1dGlsaXrDoS1sYSDDqSBuZWNlc3PDoXJpbyB0ZXIgYSBpbnN0w6JuY2lhIGRvIGNvbXBvbmVudGUgbm8gRE9NLCBwb2RlbmRvIHNlciB1dGlsaXphZG8gbyBWaWV3Q2hpbGQgZGEgc2VndWludGUgZm9ybWE6XG4gICAqXG4gICAqIGBgYFxuICAgKiBpbXBvcnQgeyBQb1RhYnNDb21wb25lbnQgfSBmcm9tICdAcG8tdWkvbmctY29tcG9uZW50cyc7XG4gICAqXG4gICAqIC4uLlxuICAgKlxuICAgKiBAVmlld0NoaWxkKCdwb1RhYicsIHsgc3RhdGljOiB0cnVlIH0pIHBvVGFiOiBQb1RhYnNDb21wb25lbnQ7XG4gICAqXG4gICAqIGNoYW5nZVF1YW50aXR5VGFicygpIHtcbiAgICogICB0aGlzLnBvVGFiLnNldFF1YW50aXR5VGFic0J1dHRvbigxKTsgLy9Ow7ptZXJvIGRlIHRhYnNcbiAgICogfVxuICAgKiBgYGBcbiAgICovXG4gIHNldFF1YW50aXR5VGFic0J1dHRvbihudW1iZXI6IE51bWJlcikge1xuICAgIHRoaXMucXVhbnRpdHlUYWJzQnV0dG9uID0gbnVtYmVyO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplVGFiQWNjZXNzaWJpbGl0eUVsZW1lbnRzKHRhYlJlbW92ZUVsZW1lbnRzLCBpbml0aWFsSW5kZXgpIHtcbiAgICB0YWJSZW1vdmVFbGVtZW50cy5mb3JFYWNoKCh0YWJSZW1vdmVFbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGluZGV4ID09PSBpbml0aWFsSW5kZXgpIHtcbiAgICAgICAgdGhpcy5zZXRUYWJJbmRleCh0YWJSZW1vdmVFbGVtZW50c1tpbml0aWFsSW5kZXhdLCAwKTtcbiAgICAgIH0gZWxzZSBpZiAodGFiUmVtb3ZlRWxlbWVudHMubGVuZ3RoID09PSBpbml0aWFsSW5kZXgpIHtcbiAgICAgICAgdGhpcy5zZXRUYWJJbmRleCh0YWJSZW1vdmVFbGVtZW50c1tpbml0aWFsSW5kZXggLSAxXSwgMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFRhYkluZGV4KHRhYlJlbW92ZUVsZW1lbnQsIC0xKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zdWJzY3JpcHRpb24uYWRkKFxuICAgICAgICBmcm9tRXZlbnQodGFiUmVtb3ZlRWxlbWVudCwgJ2tleWRvd24nKS5zdWJzY3JpYmUoKGV2ZW50OiBLZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVLZXlEb3duKGV2ZW50LCB0YWJSZW1vdmVFbGVtZW50cywgaW5kZXgpO1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgaWYgKGluZGV4ICE9PSAwKSB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uLmFkZChcbiAgICAgICAgICBmcm9tRXZlbnQodGFiUmVtb3ZlRWxlbWVudHMsICdibHVyJykuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0VGFiSW5kZXgodGFiUmVtb3ZlRWxlbWVudHNbaW5kZXhdLCAtMSk7XG4gICAgICAgICAgICB0aGlzLnNldFRhYkluZGV4KHRhYlJlbW92ZUVsZW1lbnRzWzBdLCAwKTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUYWJJbmRleChlbGVtZW50LCB0YWJJbmRleCkge1xuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIHRhYkluZGV4KTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCwgdGFiUmVtb3ZlRWxlbWVudHMsIGluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBLRVlfU1BBQ0UgPSAnU3BhY2UnO1xuICAgIGNvbnN0IEtFWV9BUlJPV19MRUZUID0gJ0Fycm93TGVmdCc7XG4gICAgY29uc3QgS0VZX0FSUk9XX1JJR0hUID0gJ0Fycm93UmlnaHQnO1xuICAgIGNvbnN0IEtFWV9IT01FID0gJ0hvbWUnO1xuICAgIGNvbnN0IEtFWV9FTkQgPSAnRW5kJztcblxuICAgIGlmIChldmVudC5jb2RlID09PSBLRVlfU1BBQ0UgfHwgZXZlbnQuY29kZSA9PT0gS0VZX0hPTUUgfHwgZXZlbnQuY29kZSA9PT0gS0VZX0VORCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cblxuICAgIGlmIChldmVudC5rZXkgPT09IEtFWV9BUlJPV19MRUZUKSB7XG4gICAgICB0aGlzLmhhbmRsZUFycm93TGVmdCh0YWJSZW1vdmVFbGVtZW50cywgaW5kZXgpO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSBLRVlfQVJST1dfUklHSFQpIHtcbiAgICAgIHRoaXMuaGFuZGxlQXJyb3dSaWdodCh0YWJSZW1vdmVFbGVtZW50cywgaW5kZXgpO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5ID09PSBLRVlfSE9NRSkge1xuICAgICAgdGhpcy5oYW5kbGVIb21lS2V5KHRhYlJlbW92ZUVsZW1lbnRzLCBpbmRleCk7XG4gICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09IEtFWV9FTkQpIHtcbiAgICAgIHRoaXMuaGFuZGxlRW5kS2V5KHRhYlJlbW92ZUVsZW1lbnRzLCBpbmRleCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVBcnJvd0xlZnQodGFiUmVtb3ZlRWxlbWVudHMsIGluZGV4KSB7XG4gICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgdGhpcy5zZXRUYWJJbmRleCh0YWJSZW1vdmVFbGVtZW50c1tpbmRleF0sIC0xKTtcbiAgICAgIHRhYlJlbW92ZUVsZW1lbnRzW2luZGV4IC0gMV0uZm9jdXMoKTtcbiAgICAgIHRoaXMuc2V0VGFiSW5kZXgodGFiUmVtb3ZlRWxlbWVudHNbaW5kZXggLSAxXSwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0VGFiSW5kZXgodGFiUmVtb3ZlRWxlbWVudHNbaW5kZXhdLCAtMSk7XG4gICAgICB0YWJSZW1vdmVFbGVtZW50c1t0YWJSZW1vdmVFbGVtZW50cy5sZW5ndGggLSAxXS5mb2N1cygpO1xuICAgICAgdGhpcy5zZXRUYWJJbmRleCh0YWJSZW1vdmVFbGVtZW50c1t0YWJSZW1vdmVFbGVtZW50cy5sZW5ndGggLSAxXSwgMCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVIb21lS2V5KHRhYlJlbW92ZUVsZW1lbnRzLCBpbmRleCkge1xuICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgIHRoaXMuc2V0VGFiSW5kZXgodGFiUmVtb3ZlRWxlbWVudHNbaW5kZXhdLCAtMSk7XG4gICAgICB0YWJSZW1vdmVFbGVtZW50c1swXS5mb2N1cygpO1xuICAgICAgdGhpcy5zZXRUYWJJbmRleCh0YWJSZW1vdmVFbGVtZW50c1swXSwgMCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVFbmRLZXkodGFiUmVtb3ZlRWxlbWVudHMsIGluZGV4KSB7XG4gICAgaWYgKGluZGV4IDwgdGFiUmVtb3ZlRWxlbWVudHMubGVuZ3RoIC0gMSkge1xuICAgICAgdGhpcy5zZXRUYWJJbmRleCh0YWJSZW1vdmVFbGVtZW50c1tpbmRleF0sIC0xKTtcbiAgICAgIHRhYlJlbW92ZUVsZW1lbnRzW3RhYlJlbW92ZUVsZW1lbnRzLmxlbmd0aCAtIDFdLmZvY3VzKCk7XG4gICAgICB0aGlzLnNldFRhYkluZGV4KHRhYlJlbW92ZUVsZW1lbnRzW3RhYlJlbW92ZUVsZW1lbnRzLmxlbmd0aCAtIDFdLCAwKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUFycm93UmlnaHQodGFiUmVtb3ZlRWxlbWVudHMsIGluZGV4KSB7XG4gICAgaWYgKGluZGV4IDwgdGFiUmVtb3ZlRWxlbWVudHMubGVuZ3RoIC0gMSkge1xuICAgICAgdGhpcy5zZXRUYWJJbmRleCh0YWJSZW1vdmVFbGVtZW50c1tpbmRleF0sIC0xKTtcbiAgICAgIHRhYlJlbW92ZUVsZW1lbnRzW2luZGV4ICsgMV0uZm9jdXMoKTtcbiAgICAgIHRoaXMuc2V0VGFiSW5kZXgodGFiUmVtb3ZlRWxlbWVudHNbaW5kZXggKyAxXSwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0VGFiSW5kZXgodGFiUmVtb3ZlRWxlbWVudHNbaW5kZXhdLCAtMSk7XG4gICAgICB0YWJSZW1vdmVFbGVtZW50c1swXS5mb2N1cygpO1xuICAgICAgdGhpcy5zZXRUYWJJbmRleCh0YWJSZW1vdmVFbGVtZW50c1swXSwgMCk7XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwicG8tdGFicy1jb250YWluZXJcIj5cbiAgPGRpdiAjY29udGFpbmVyVGFicyBjbGFzcz1cInBvLXRhYnMtaGVhZGVyXCI+XG4gICAgPGRpdiBjbGFzcz1cInBvLXRhYnMtYnV0dG9uLXdyYXBwZXJcIiByb2xlPVwidGFibGlzdFwiPlxuICAgICAgPG5nLWNvbnRhaW5lciAqbmdGb3I9XCJsZXQgdGFiIG9mIHRhYnM7IHRyYWNrQnk6IHRyYWNrQnlGblwiPlxuICAgICAgICA8cG8tdGFiLWJ1dHRvblxuICAgICAgICAgICN0YWJCdXR0b25cbiAgICAgICAgICBjbGFzcz1cInBvLXRhYi1idXR0b25cIlxuICAgICAgICAgIFtwLWFjdGl2ZV09XCJ0YWIuYWN0aXZlXCJcbiAgICAgICAgICBbcC1kaXNhYmxlZF09XCJ0YWIuZGlzYWJsZWRcIlxuICAgICAgICAgIFtwLWhpZGVdPVwidGFiLmhpZGVcIlxuICAgICAgICAgIFtwLWlkXT1cInRhYi5pZFwiXG4gICAgICAgICAgW2hpZGRlbl09XCJ0YWIuaGlkZVwiXG4gICAgICAgICAgW2F0dHIuZGlzYWJsZWRdPVwidGFiLmRpc2FibGVkXCJcbiAgICAgICAgICBbcC1sYWJlbF09XCJ0YWIubGFiZWxcIlxuICAgICAgICAgIFtwLXNtYWxsXT1cInNtYWxsXCJcbiAgICAgICAgICBbaWRdPVwidGFiLmlkXCJcbiAgICAgICAgICAoa2V5dXAuZW50ZXIpPVwiY2xvc2VQb3BvdmVyKClcIlxuICAgICAgICAgIChwLWFjdGl2YXRlZCk9XCJvblRhYkFjdGl2ZSh0YWIpXCJcbiAgICAgICAgICAocC1jaGFuZ2Utc3RhdGUpPVwib25UYWJDaGFuZ2VTdGF0ZSh0YWIpXCJcbiAgICAgICAgICAocC1jbGljayk9XCJzZWxlY3RlZFRhYih0YWIpXCJcbiAgICAgICAgPlxuICAgICAgICA8L3BvLXRhYi1idXR0b24+XG4gICAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgICAgPHBvLXRhYi1kcm9wZG93blxuICAgICAgICAjdGFiRHJvcGRvd25cbiAgICAgICAgKm5nSWY9XCJpc1Nob3dUYWJEcm9wZG93blwiXG4gICAgICAgIGNsYXNzPVwicG8tdGFiLWRyb3Bkb3duXCJcbiAgICAgICAgW2NsYXNzLnBvLXRhYi1kcm9wZG93bi1kZXZpY2VdPVwiIXRhYnNEZWZhdWx0Py5sZW5ndGhcIlxuICAgICAgICBbcC1sYWJlbF09XCJsaXRlcmFscy5tb3JlVGFic1wiXG4gICAgICAgIFtwLXNtYWxsXT1cInNtYWxsXCJcbiAgICAgICAgW3AtdGFic109XCJvdmVyZmxvd2VkVGFic1wiXG4gICAgICAgIChwLWNoYW5nZS1zdGF0ZSk9XCJvblRhYkNoYW5nZVN0YXRlKCRldmVudClcIlxuICAgICAgICAocC1jbGljayk9XCJvblRhYkFjdGl2ZUJ5RHJvcGRvd24oJGV2ZW50KVwiXG4gICAgICA+XG4gICAgICA8L3BvLXRhYi1kcm9wZG93bj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L2Rpdj5cbjxkaXYgY2xhc3M9XCJwby10YWJzLWNvbnRlbnRcIj5cbiAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuPC9kaXY+XG4iXX0=