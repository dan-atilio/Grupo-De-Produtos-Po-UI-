import { Directive, Input } from '@angular/core';
import * as i0 from "@angular/core";
export class PoTableColumnFrozenDirective {
    el;
    renderer;
    _frozen = true;
    get frozen() {
        return this._frozen;
    }
    set frozen(val) {
        this._frozen = val;
        if (!val) {
            this.renderer.removeClass(this.el.nativeElement, 'po-table-column-fixed');
        }
        else {
            this.updateStickyPosition();
        }
    }
    alignFrozen = 'left';
    constructor(el, renderer) {
        this.el = el;
        this.renderer = renderer;
    }
    ngAfterViewInit() {
        setTimeout(() => {
            this.updateStickyPosition();
        }, 300);
    }
    ngOnChanges(changes) {
        if (changes.frozen.previousValue && !changes.frozen.currentValue) {
            setTimeout(() => {
                this.resizeColumns();
            }, 100);
        }
    }
    /* istanbul ignore next */
    updateStickyPosition() {
        if (this._frozen) {
            if (this.alignFrozen === 'right') {
                let right = 0;
                const next = this.el.nativeElement.nextElementSibling;
                if (next) {
                    right = this.getOuterWidth(next) + (parseFloat(next.style.right) || 0);
                }
                this.el.nativeElement.style.right = right + 'px';
            }
            else {
                let left = 0;
                const prev = this.el.nativeElement.previousElementSibling;
                if (prev &&
                    !prev.classList.contains('po-table-column-selectable') &&
                    !prev.classList.contains('po-table-column-actions') &&
                    !prev.classList.contains('po-table-column-detail-toggle') &&
                    !prev.classList.contains('po-table-header-master-detail')) {
                    left = this.getOuterWidth(prev) + (parseFloat(prev.style.left) || 0);
                }
                this.el.nativeElement.style.left = left - 1 + 'px';
                this.renderer.addClass(this.el.nativeElement, 'po-table-column-fixed');
            }
            const filterRow = this.el.nativeElement.parentElement.nextElementSibling;
            if (filterRow) {
                const index = this.index(this.el.nativeElement);
                if (filterRow.children && filterRow.children[index]) {
                    filterRow.children[index].style.left = this.el.nativeElement.style.left;
                    filterRow.children[index].style.right = this.el.nativeElement.style.right;
                }
            }
        }
    }
    /* istanbul ignore next */
    resizeColumns() {
        const currentElement = this.el.nativeElement;
        const prevElements = [];
        let prevElement = currentElement.previousElementSibling;
        // Encontra todos os elementos anteriores com a classe 'po-table-column-fixed'
        while (prevElement && prevElement.classList.contains('po-table-column-fixed')) {
            prevElements.push(prevElement);
            prevElement = prevElement.previousElementSibling;
        }
        // Verifica se há elementos suficientes para ajustar os widths
        if (prevElements.length >= 2) {
            let leftAccumulator = 0;
            // Calcula o novo 'left' para cada elemento anterior e aplica
            for (let i = prevElements.length - 1; i >= 0; i--) {
                const prevWidth = this.getOuterWidth(prevElements[i], true);
                prevElements[i].style.left = leftAccumulator - 1 + 'px';
                leftAccumulator += prevWidth;
            }
        }
    }
    getOuterWidth(el, margin) {
        let width = el.offsetWidth;
        if (margin) {
            const style = getComputedStyle(el);
            width += parseFloat(style.marginLeft) + parseFloat(style.marginRight);
        }
        return width - 1;
    }
    index(element) {
        const children = element.parentNode.childNodes;
        let num = 0;
        for (let i = 0; i < children.length; i++) {
            if (children[i] === element) {
                return num;
            }
            if (children[i].nodeType === 1) {
                num++;
            }
        }
        return -1;
    }
    static ɵfac = function PoTableColumnFrozenDirective_Factory(t) { return new (t || PoTableColumnFrozenDirective)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i0.Renderer2)); };
    static ɵdir = /*@__PURE__*/ i0.ɵɵdefineDirective({ type: PoTableColumnFrozenDirective, selectors: [["", "pFrozenColumn", ""]], hostAttrs: [1, "p-element"], hostVars: 2, hostBindings: function PoTableColumnFrozenDirective_HostBindings(rf, ctx) { if (rf & 2) {
            i0.ɵɵclassProp("po-frozen-column", ctx.frozen);
        } }, inputs: { frozen: [i0.ɵɵInputFlags.None, "pFrozenColumn", "frozen"], alignFrozen: "alignFrozen" }, features: [i0.ɵɵNgOnChangesFeature] });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoTableColumnFrozenDirective, [{
        type: Directive,
        args: [{
                selector: '[pFrozenColumn]',
                host: {
                    class: 'p-element',
                    '[class.po-frozen-column]': 'frozen'
                }
            }]
    }], () => [{ type: i0.ElementRef }, { type: i0.Renderer2 }], { frozen: [{
            type: Input,
            args: ['pFrozenColumn']
        }], alignFrozen: [{
            type: Input
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdGFibGUtY29sdW1uLWZyb3plbi5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tdGFibGUvcG8tdGFibGUtY29sdW1uLWZyb3plbi9wby10YWJsZS1jb2x1bW4tZnJvemVuLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWlCLFNBQVMsRUFBYyxLQUFLLEVBQXVDLE1BQU0sZUFBZSxDQUFDOztBQVNqSCxNQUFNLE9BQU8sNEJBQTRCO0lBb0I3QjtJQUNBO0lBcEJWLE9BQU8sR0FBWSxJQUFJLENBQUM7SUFFeEIsSUFBSSxNQUFNO1FBQ1IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3RCLENBQUM7SUFFRCxJQUE0QixNQUFNLENBQUMsR0FBWTtRQUM3QyxJQUFJLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQztRQUVuQixJQUFJLENBQUMsR0FBRyxFQUFFO1lBQ1IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsdUJBQXVCLENBQUMsQ0FBQztTQUMzRTthQUFNO1lBQ0wsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7U0FDN0I7SUFDSCxDQUFDO0lBRVEsV0FBVyxHQUFXLE1BQU0sQ0FBQztJQUV0QyxZQUNVLEVBQWMsRUFDZCxRQUFtQjtRQURuQixPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2QsYUFBUSxHQUFSLFFBQVEsQ0FBVztJQUMxQixDQUFDO0lBRUosZUFBZTtRQUNiLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDZCxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUM5QixDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDVixDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksT0FBTyxDQUFDLE1BQU0s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O1FBQ2hCLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDO1FBQy9DLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztRQUNaLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3hDLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLE9BQU8sRUFBRTtnQkFDM0IsT0FBTyxHQUFHLENBQUM7YUFDWjtZQUNELElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxDQUFDLEVBQUU7Z0JBQzlCLEdBQUcsRUFBRSxDQUFDO2FBQ1A7U0FDRjtRQUNELE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDWixDQUFDO3NGQTdIVSw0QkFBNEI7NkRBQTVCLDRCQUE0Qjs7OztpRkFBNUIsNEJBQTRCO2NBUHhDLFNBQVM7ZUFBQztnQkFDVCxRQUFRLEVBQUUsaUJBQWlCO2dCQUMzQixJQUFJLEVBQUU7b0JBQ0osS0FBSyxFQUFFLFdBQVc7b0JBQ2xCLDBCQUEwQixFQUFFLFFBQVE7aUJBQ3JDO2FBQ0Y7bUVBUTZCLE1BQU07a0JBQWpDLEtBQUs7bUJBQUMsZUFBZTtZQVViLFdBQVc7a0JBQW5CLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIElucHV0LCBSZW5kZXJlcjIsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbcEZyb3plbkNvbHVtbl0nLFxuICBob3N0OiB7XG4gICAgY2xhc3M6ICdwLWVsZW1lbnQnLFxuICAgICdbY2xhc3MucG8tZnJvemVuLWNvbHVtbl0nOiAnZnJvemVuJ1xuICB9XG59KVxuZXhwb3J0IGNsYXNzIFBvVGFibGVDb2x1bW5Gcm96ZW5EaXJlY3RpdmUgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xuICBfZnJvemVuOiBib29sZWFuID0gdHJ1ZTtcblxuICBnZXQgZnJvemVuKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9mcm96ZW47XG4gIH1cblxuICBASW5wdXQoJ3BGcm96ZW5Db2x1bW4nKSBzZXQgZnJvemVuKHZhbDogYm9vbGVhbikge1xuICAgIHRoaXMuX2Zyb3plbiA9IHZhbDtcblxuICAgIGlmICghdmFsKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ3BvLXRhYmxlLWNvbHVtbi1maXhlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZVN0aWNreVBvc2l0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgYWxpZ25Gcm96ZW46IHN0cmluZyA9ICdsZWZ0JztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMlxuICApIHt9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVTdGlja3lQb3NpdGlvbigpO1xuICAgIH0sIDMwMCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXMuZnJvemVuLnByZXZpb3VzVmFsdWUgJiYgIWNoYW5nZXMuZnJvemVuLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMucmVzaXplQ29sdW1ucygpO1xuICAgICAgfSwgMTAwKTtcbiAgICB9XG4gIH1cblxuICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICB1cGRhdGVTdGlja3lQb3NpdGlvbigpIHtcbiAgICBpZiAodGhpcy5fZnJvemVuKSB7XG4gICAgICBpZiAodGhpcy5hbGlnbkZyb3plbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICBsZXQgcmlnaHQgPSAwO1xuICAgICAgICBjb25zdCBuZXh0ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50Lm5leHRFbGVtZW50U2libGluZztcblxuICAgICAgICBpZiAobmV4dCkge1xuICAgICAgICAgIHJpZ2h0ID0gdGhpcy5nZXRPdXRlcldpZHRoKG5leHQpICsgKHBhcnNlRmxvYXQobmV4dC5zdHlsZS5yaWdodCkgfHwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LnN0eWxlLnJpZ2h0ID0gcmlnaHQgKyAncHgnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGxlZnQgPSAwO1xuICAgICAgICBjb25zdCBwcmV2ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBwcmV2ICYmXG4gICAgICAgICAgIXByZXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdwby10YWJsZS1jb2x1bW4tc2VsZWN0YWJsZScpICYmXG4gICAgICAgICAgIXByZXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdwby10YWJsZS1jb2x1bW4tYWN0aW9ucycpICYmXG4gICAgICAgICAgIXByZXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdwby10YWJsZS1jb2x1bW4tZGV0YWlsLXRvZ2dsZScpICYmXG4gICAgICAgICAgIXByZXYuY2xhc3NMaXN0LmNvbnRhaW5zKCdwby10YWJsZS1oZWFkZXItbWFzdGVyLWRldGFpbCcpXG4gICAgICAgICkge1xuICAgICAgICAgIGxlZnQgPSB0aGlzLmdldE91dGVyV2lkdGgocHJldikgKyAocGFyc2VGbG9hdChwcmV2LnN0eWxlLmxlZnQpIHx8IDApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5sZWZ0ID0gbGVmdCAtIDEgKyAncHgnO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ3BvLXRhYmxlLWNvbHVtbi1maXhlZCcpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaWx0ZXJSb3cgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmc7XG5cbiAgICAgIGlmIChmaWx0ZXJSb3cpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmluZGV4KHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIGlmIChmaWx0ZXJSb3cuY2hpbGRyZW4gJiYgZmlsdGVyUm93LmNoaWxkcmVuW2luZGV4XSkge1xuICAgICAgICAgIGZpbHRlclJvdy5jaGlsZHJlbltpbmRleF0uc3R5bGUubGVmdCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5sZWZ0O1xuICAgICAgICAgIGZpbHRlclJvdy5jaGlsZHJlbltpbmRleF0uc3R5bGUucmlnaHQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUucmlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICByZXNpemVDb2x1bW5zKCkge1xuICAgIGNvbnN0IGN1cnJlbnRFbGVtZW50ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICAgIGNvbnN0IHByZXZFbGVtZW50cyA9IFtdO1xuICAgIGxldCBwcmV2RWxlbWVudCA9IGN1cnJlbnRFbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG5cbiAgICAvLyBFbmNvbnRyYSB0b2RvcyBvcyBlbGVtZW50b3MgYW50ZXJpb3JlcyBjb20gYSBjbGFzc2UgJ3BvLXRhYmxlLWNvbHVtbi1maXhlZCdcbiAgICB3aGlsZSAocHJldkVsZW1lbnQgJiYgcHJldkVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwby10YWJsZS1jb2x1bW4tZml4ZWQnKSkge1xuICAgICAgcHJldkVsZW1lbnRzLnB1c2gocHJldkVsZW1lbnQpO1xuICAgICAgcHJldkVsZW1lbnQgPSBwcmV2RWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgIH1cblxuICAgIC8vIFZlcmlmaWNhIHNlIGjDoSBlbGVtZW50b3Mgc3VmaWNpZW50ZXMgcGFyYSBhanVzdGFyIG9zIHdpZHRoc1xuICAgIGlmIChwcmV2RWxlbWVudHMubGVuZ3RoID49IDIpIHtcbiAgICAgIGxldCBsZWZ0QWNjdW11bGF0b3IgPSAwO1xuXG4gICAgICAvLyBDYWxjdWxhIG8gbm92byAnbGVmdCcgcGFyYSBjYWRhIGVsZW1lbnRvIGFudGVyaW9yIGUgYXBsaWNhXG4gICAgICBmb3IgKGxldCBpID0gcHJldkVsZW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIGNvbnN0IHByZXZXaWR0aCA9IHRoaXMuZ2V0T3V0ZXJXaWR0aChwcmV2RWxlbWVudHNbaV0sIHRydWUpO1xuICAgICAgICBwcmV2RWxlbWVudHNbaV0uc3R5bGUubGVmdCA9IGxlZnRBY2N1bXVsYXRvciAtIDEgKyAncHgnO1xuICAgICAgICBsZWZ0QWNjdW11bGF0b3IgKz0gcHJldldpZHRoO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldE91dGVyV2lkdGgoZWwsIG1hcmdpbj8pIHtcbiAgICBsZXQgd2lkdGggPSBlbC5vZmZzZXRXaWR0aDtcblxuICAgIGlmIChtYXJnaW4pIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShlbCk7XG4gICAgICB3aWR0aCArPSBwYXJzZUZsb2F0KHN0eWxlLm1hcmdpbkxlZnQpICsgcGFyc2VGbG9hdChzdHlsZS5tYXJnaW5SaWdodCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHdpZHRoIC0gMTtcbiAgfVxuXG4gIGluZGV4KGVsZW1lbnQ6IGFueSk6IG51bWJlciB7XG4gICAgY29uc3QgY2hpbGRyZW4gPSBlbGVtZW50LnBhcmVudE5vZGUuY2hpbGROb2RlcztcbiAgICBsZXQgbnVtID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY2hpbGRyZW5baV0gPT09IGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG51bTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGlsZHJlbltpXS5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICBudW0rKztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIC0xO1xuICB9XG59XG4iXX0=