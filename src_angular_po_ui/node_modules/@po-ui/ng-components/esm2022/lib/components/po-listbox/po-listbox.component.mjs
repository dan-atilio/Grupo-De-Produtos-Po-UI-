import { Component, ViewChild } from '@angular/core';
import { PoListBoxBaseComponent } from './po-listbox-base.component';
import { isExternalLink, isTypeof, openExternalLink } from '../../utils/util';
import { debounceTime, fromEvent } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "../../services/po-language/po-language.service";
import * as i2 from "@angular/router";
import * as i3 from "@angular/common";
import * as i4 from "../po-loading/po-loading-overlay/po-loading-overlay.component";
import * as i5 from "@angular/cdk/listbox";
import * as i6 from "./po-item-list/po-item-list.component";
import * as i7 from "./po-search-list/po-search-list.component";
const _c0 = ["listbox"];
const _c1 = ["listboxItemList"];
const _c2 = ["searchElement"];
function PoListBoxComponent_po_search_list_3_Template(rf, ctx) { if (rf & 1) {
    const _r8 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-search-list", 6, 7);
    i0.ɵɵlistener("p-change", function PoListBoxComponent_po_search_list_3_Template_po_search_list_p_change_0_listener($event) { i0.ɵɵrestoreView(_r8); const ctx_r7 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r7.callChangeSearch($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-literals", ctx_r1.literalSearch)("p-field-value", ctx_r1.fieldValueSearch)("p-placeholder", ctx_r1.placeholderSearch);
} }
function PoListBoxComponent_ng_container_4_li_3_Template(rf, ctx) { if (rf & 1) {
    const _r13 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "li", 12);
    i0.ɵɵlistener("click", function PoListBoxComponent_ng_container_4_li_3_Template_li_click_0_listener() { i0.ɵɵrestoreView(_r13); const ctx_r12 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r12.changeAll.emit()); })("keydown", function PoListBoxComponent_ng_container_4_li_3_Template_li_keydown_0_listener($event) { i0.ɵɵrestoreView(_r13); const ctx_r14 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r14.changeAllEmit($event)); })("keydown", function PoListBoxComponent_ng_container_4_li_3_Template_li_keydown_0_listener($event) { i0.ɵɵrestoreView(_r13); const ctx_r15 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r15.onSelectAllCheckboxKeyDown($event)); });
    i0.ɵɵelement(1, "po-item-list", 13);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r10 = i0.ɵɵnextContext(2);
    i0.ɵɵattribute("aria-checked", ctx_r10.checkboxAllValue === null ? "mixed" : ctx_r10.checkboxAllValue);
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-selected", ctx_r10.checkboxAllValue)("p-label", ctx_r10.literals.selectAll)("p-checkbox-value", ctx_r10.checkboxAllValue);
} }
function PoListBoxComponent_ng_container_4_li_4_label_1_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "label", 17);
    i0.ɵɵtext(1);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const item_r16 = i0.ɵɵnextContext().$implicit;
    i0.ɵɵadvance();
    i0.ɵɵtextInterpolate1(" ", item_r16.label, " ");
} }
function PoListBoxComponent_ng_container_4_li_4_po_item_list_2_Template(rf, ctx) { if (rf & 1) {
    const _r21 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-item-list", 18);
    i0.ɵɵlistener("p-selectcheckbox-item", function PoListBoxComponent_ng_container_4_li_4_po_item_list_2_Template_po_item_list_p_selectcheckbox_item_0_listener($event) { i0.ɵɵrestoreView(_r21); const ctx_r20 = i0.ɵɵnextContext(3); return i0.ɵɵresetView(ctx_r20.checkboxClicked($event)); })("p-selectcombo-item", function PoListBoxComponent_ng_container_4_li_4_po_item_list_2_Template_po_item_list_p_selectcombo_item_0_listener() { i0.ɵɵrestoreView(_r21); const item_r16 = i0.ɵɵnextContext().$implicit; const ctx_r22 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r22.optionClicked(item_r16)); })("p-emit-item-tabs", function PoListBoxComponent_ng_container_4_li_4_po_item_list_2_Template_po_item_list_p_emit_item_tabs_0_listener($event) { i0.ɵɵrestoreView(_r21); const ctx_r24 = i0.ɵɵnextContext(3); return i0.ɵɵresetView(ctx_r24.onSelectTabs($event)); })("p-activated-tabs", function PoListBoxComponent_ng_container_4_li_4_po_item_list_2_Template_po_item_list_p_activated_tabs_0_listener($event) { i0.ɵɵrestoreView(_r21); const ctx_r25 = i0.ɵɵnextContext(3); return i0.ɵɵresetView(ctx_r25.onActivatedTabs($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const item_r16 = i0.ɵɵnextContext().$implicit;
    const ctx_r18 = i0.ɵɵnextContext(2);
    i0.ɵɵproperty("p-disabled", ctx_r18.returnBooleanValue(item_r16, "disabled"))("p-visible", ctx_r18.returnBooleanValue(item_r16, "visible"))("p-checkbox-value", ctx_r18.isSelectedItem(item_r16))("p-label", item_r16[ctx_r18.fieldLabel])("p-value", item_r16[ctx_r18.fieldValue])("p-selected", ctx_r18.isSelectedItem(item_r16) || item_r16.selected)("p-active-tabs", item_r16.active)("p-separator", item_r16.separator)("p-danger", item_r16.danger || item_r16.type === "danger")("p-icon", item_r16.icon)("p-type", ctx_r18.type)("p-item", item_r16)("p-tab-hide", item_r16.hide)("p-is-tabs", ctx_r18.isTabs)("p-field-value", ctx_r18.fieldValue)("p-field-label", ctx_r18.fieldLabel)("p-template", ctx_r18.template)("p-template-context", item_r16)("p-search-value", ctx_r18.searchValue)("p-filter-mode", ctx_r18.filterMode)("p-filtering", ctx_r18.isFiltering)("p-should-mark-letter", ctx_r18.shouldMarkLetters)("p-compare-cache", ctx_r18.compareCache)("p-combo-service", ctx_r18.comboService);
    i0.ɵɵattribute("data-item-list", ctx_r18.formatItemList(item_r16));
} }
function PoListBoxComponent_ng_container_4_li_4_Template(rf, ctx) { if (rf & 1) {
    const _r28 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "li", 14);
    i0.ɵɵlistener("click", function PoListBoxComponent_ng_container_4_li_4_Template_li_click_0_listener() { const restoredCtx = i0.ɵɵrestoreView(_r28); const item_r16 = restoredCtx.$implicit; const ctx_r27 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r27.onSelectItem(item_r16)); })("keydown", function PoListBoxComponent_ng_container_4_li_4_Template_li_keydown_0_listener($event) { const restoredCtx = i0.ɵɵrestoreView(_r28); const item_r16 = restoredCtx.$implicit; const ctx_r29 = i0.ɵɵnextContext(2); return i0.ɵɵresetView(ctx_r29.onKeyDown(item_r16, $event)); });
    i0.ɵɵtemplate(1, PoListBoxComponent_ng_container_4_li_4_label_1_Template, 2, 1, "label", 15)(2, PoListBoxComponent_ng_container_4_li_4_po_item_list_2_Template, 1, 25, "po-item-list", 16);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const item_r16 = ctx.$implicit;
    const ctx_r11 = i0.ɵɵnextContext(2);
    i0.ɵɵclassProp("po-listbox-item", ctx_r11.visible);
    i0.ɵɵproperty("cdkOption", item_r16[ctx_r11.fieldLabel])("cdkOptionDisabled", ctx_r11.returnBooleanValue(item_r16, "disabled") || ctx_r11.returnBooleanValue(item_r16, "visible") === false || item_r16.options);
    i0.ɵɵattribute("aria-selected", ctx_r11.isSelectedItem(item_r16) || item_r16.selected);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngIf", item_r16.options);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngIf", ctx_r11.returnBooleanValue(item_r16, "visible") !== false && !item_r16.options);
} }
function PoListBoxComponent_ng_container_4_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementContainerStart(0);
    i0.ɵɵelementStart(1, "ul", 8, 9);
    i0.ɵɵtemplate(3, PoListBoxComponent_ng_container_4_li_3_Template, 2, 4, "li", 10)(4, PoListBoxComponent_ng_container_4_li_4_Template, 3, 7, "li", 11);
    i0.ɵɵelementEnd();
    i0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r2 = i0.ɵɵnextContext();
    i0.ɵɵadvance();
    i0.ɵɵproperty("cdkListboxMultiple", ctx_r2.type === "check");
    i0.ɵɵadvance(2);
    i0.ɵɵproperty("ngIf", ctx_r2.type === "check" && ctx_r2.items.length && !(ctx_r2.searchElement == null ? null : ctx_r2.searchElement.inputValue) && !ctx_r2.hideSelectAll);
    i0.ɵɵadvance();
    i0.ɵɵproperty("ngForOf", ctx_r2.items);
} }
function PoListBoxComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div");
    i0.ɵɵelement(1, "po-loading-overlay", 19);
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = i0.ɵɵnextContext();
    i0.ɵɵclassProp("po-listbox-container-loading-default", !ctx_r3.infiniteLoading);
} }
function PoListBoxComponent_ng_template_6_div_0_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵelementStart(0, "div", 21)(1, "span");
    i0.ɵɵtext(2);
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const ctx_r30 = i0.ɵɵnextContext(2);
    i0.ɵɵadvance(2);
    i0.ɵɵtextInterpolate1(" ", ctx_r30.literals.noItems, "");
} }
function PoListBoxComponent_ng_template_6_Template(rf, ctx) { if (rf & 1) {
    i0.ɵɵtemplate(0, PoListBoxComponent_ng_template_6_div_0_Template, 3, 1, "div", 20);
} if (rf & 2) {
    const ctx_r4 = i0.ɵɵnextContext();
    i0.ɵɵproperty("ngIf", !ctx_r4.items.length && !ctx_r4.isServerSearching && ctx_r4.type !== "action");
} }
const _c3 = [[["", "p-popup-header-template", ""]]];
const _c4 = ["[p-popup-header-template]"];
export class PoListBoxComponent extends PoListBoxBaseComponent {
    element;
    renderer;
    router;
    changeDetector;
    listbox;
    listboxItemList;
    searchElement;
    scrollEvent$;
    subscriptionScrollEvent;
    constructor(element, renderer, languageService, router, changeDetector) {
        super(languageService);
        this.element = element;
        this.renderer = renderer;
        this.router = router;
        this.changeDetector = changeDetector;
    }
    ngAfterViewInit() {
        this.setListBoxMaxHeight();
        this.listboxItemList?.nativeElement.focus();
    }
    ngOnChanges(changes) {
        if (changes?.items) {
            this.setListBoxMaxHeight();
        }
        if (this.visible && this.infiniteScroll) {
            this.checkInfiniteScroll();
        }
    }
    ngOnDestroy() {
        if (this.subscriptionScrollEvent && this.subscriptionScrollEvent.unsubscribe) {
            this.subscriptionScrollEvent.unsubscribe();
        }
    }
    onSelectItem(itemListAction) {
        const isDisabled = itemListAction.hasOwnProperty('disabled') &&
            itemListAction.disabled !== null &&
            itemListAction.disabled !== undefined
            ? this.returnBooleanValue(itemListAction, 'disabled')
            : false;
        const isVisible = itemListAction.hasOwnProperty('visible') &&
            itemListAction.visible !== null &&
            itemListAction.visible !== undefined
            ? this.returnBooleanValue(itemListAction, 'visible')
            : true;
        if (this.isTabs && !itemListAction.disabled && !itemListAction.hide) {
            this.onClickTabs(itemListAction);
        }
        if (itemListAction && itemListAction.action && !isDisabled && isVisible) {
            itemListAction.action(this.param || itemListAction);
        }
        if (itemListAction && itemListAction.url && !isDisabled && isVisible) {
            return this.openUrl(itemListAction.url);
        }
    }
    onSelectAllCheckboxKeyDown(event) {
        if (event.code === 'Tab') {
            this.closeEvent.emit();
        }
    }
    onKeyDown(itemListAction, event) {
        event.preventDefault();
        if ((event && event.code === 'Enter') || event.code === 'Space') {
            switch (this.type) {
                case 'check':
                    this.onSelectCheckBoxItem(itemListAction);
                    break;
                case 'option':
                    this.optionClicked(itemListAction);
                    break;
                case 'action':
                    this.onSelectItem(itemListAction);
                    break;
            }
        }
        if ((event && event.code === 'Escape') || event.code === 'Tab') {
            this.closeEvent.emit();
        }
    }
    checkboxClicked({ option, selected }) {
        if (this.type === 'check') {
            this.change.emit({ selected, option });
        }
    }
    optionClicked(option) {
        if (this.type === 'option') {
            this.items.filter(item => item[this.fieldValue] === option[this.fieldValue] ? (item['selected'] = true) : (item['selected'] = false));
            this.selectCombo.emit({ ...option });
        }
    }
    onSelectCheckBoxItem(option) {
        const selected = !this.isSelectedItem(option);
        this.checkboxClicked({ option, selected });
    }
    isSelectedItem(option) {
        return this.selectedOptions.some(selectedItem => selectedItem[this.fieldValue] === option[this.fieldValue]);
    }
    changeAllEmit(event) {
        if ((event && event.code === 'Enter') || event.code === 'Space') {
            this.changeAll.emit();
        }
    }
    onSelectTabs(tab) {
        if (this.isTabs && tab) {
            this.changeStateTabs.emit(tab);
        }
    }
    onActivatedTabs(tab) {
        this.activatedTab.emit(tab);
    }
    callChangeSearch(event) {
        this.changeSearch.emit(event);
    }
    showMoreInfiniteScroll({ target }) {
        const scrollPosition = target.offsetHeight + target.scrollTop;
        if (scrollPosition >= target.scrollHeight * (this.infiniteScrollDistance / 110)) {
            this.UpdateInfiniteScroll.emit();
        }
    }
    scrollListener(componentListner) {
        return fromEvent(componentListner, 'scroll').pipe(debounceTime(100));
    }
    setFocus() {
        this.listboxItemList.nativeElement.focus();
    }
    checkInfiniteScroll() {
        if (this.hasInfiniteScroll()) {
            this.includeInfiniteScroll();
        }
    }
    hasInfiniteScroll() {
        this.changeDetector.detectChanges();
        return this.infiniteScroll && this.listboxItemList?.nativeElement.scrollHeight;
    }
    checkTemplate() {
        if (this.cache || this.infiniteScroll) {
            return this.items.length;
        }
        else {
            return !this.isServerSearching && this.items.length;
        }
    }
    includeInfiniteScroll() {
        this.scrollEvent$ = this.scrollListener(this.listboxItemList?.nativeElement);
        this.subscriptionScrollEvent = this.scrollEvent$.subscribe(event => {
            this.showMoreInfiniteScroll(event);
        });
    }
    returnBooleanValue(itemListAction, property) {
        return isTypeof(itemListAction[property], 'function')
            ? itemListAction[property](this.param || itemListAction)
            : itemListAction[property];
    }
    setListBoxMaxHeight() {
        const itemsLength = this.items.length;
        if (itemsLength > 6) {
            if (this.type === 'check' && !this.hideSearch) {
                this.renderer.setStyle(this.listbox.nativeElement, 'maxHeight', `${44 * 6 - 44 / 3 + 60}px`);
            }
            else {
                this.renderer.setStyle(this.listbox.nativeElement, 'maxHeight', `${44 * 6 - 44 / 3}px`);
            }
        }
    }
    openUrl(url) {
        if (isExternalLink(url)) {
            return openExternalLink(url);
        }
        if (url) {
            return this.router.navigate([url]);
        }
    }
    onClickTabs(tab) {
        if (!tab.disabled) {
            this.clickTab.emit(tab);
        }
    }
    formatItemList(item) {
        if (this.isTabs) {
            return item.id;
        }
        else {
            try {
                return JSON.stringify(item);
            }
            catch (error) {
                return item;
            }
        }
    }
    static ɵfac = function PoListBoxComponent_Factory(t) { return new (t || PoListBoxComponent)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i1.PoLanguageService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoListBoxComponent, selectors: [["po-listbox"]], viewQuery: function PoListBoxComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(_c0, 7);
            i0.ɵɵviewQuery(_c1, 5);
            i0.ɵɵviewQuery(_c2, 5);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.listbox = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.listboxItemList = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.searchElement = _t.first);
        } }, features: [i0.ɵɵInheritDefinitionFeature, i0.ɵɵNgOnChangesFeature], ngContentSelectors: _c4, decls: 8, vars: 8, consts: [[1, "po-listbox", 3, "hidden"], ["listbox", ""], [3, "p-literals", "p-field-value", "p-placeholder", "p-change", 4, "ngIf"], [4, "ngIf", "ngIfElse"], [3, "po-listbox-container-loading-default", 4, "ngIf"], ["noDataTemplate", ""], [3, "p-literals", "p-field-value", "p-placeholder", "p-change"], ["searchElement", ""], ["cdkListbox", "", 1, "po-listbox-list", 3, "cdkListboxMultiple"], ["listboxItemList", ""], ["cdkOption", "selectAll", 3, "click", "keydown", 4, "ngIf"], [3, "po-listbox-item", "cdkOption", "cdkOptionDisabled", "click", "keydown", 4, "ngFor", "ngForOf"], ["cdkOption", "selectAll", 3, "click", "keydown"], ["p-type", "check", "p-value", "selectAll", 3, "p-selected", "p-label", "p-checkbox-value"], [3, "cdkOption", "cdkOptionDisabled", "click", "keydown"], ["class", "po-combo-item-title", 4, "ngIf"], [3, "p-disabled", "p-visible", "p-checkbox-value", "p-label", "p-value", "p-selected", "p-active-tabs", "p-separator", "p-danger", "p-icon", "p-type", "p-item", "p-tab-hide", "p-is-tabs", "p-field-value", "p-field-label", "p-template", "p-template-context", "p-search-value", "p-filter-mode", "p-filtering", "p-should-mark-letter", "p-compare-cache", "p-combo-service", "p-selectcheckbox-item", "p-selectcombo-item", "p-emit-item-tabs", "p-activated-tabs", 4, "ngIf"], [1, "po-combo-item-title"], [3, "p-disabled", "p-visible", "p-checkbox-value", "p-label", "p-value", "p-selected", "p-active-tabs", "p-separator", "p-danger", "p-icon", "p-type", "p-item", "p-tab-hide", "p-is-tabs", "p-field-value", "p-field-label", "p-template", "p-template-context", "p-search-value", "p-filter-mode", "p-filtering", "p-should-mark-letter", "p-compare-cache", "p-combo-service", "p-selectcheckbox-item", "p-selectcombo-item", "p-emit-item-tabs", "p-activated-tabs"], ["p-size", "md"], ["class", "po-listbox-container-no-data po-text-center", 4, "ngIf"], [1, "po-listbox-container-no-data", "po-text-center"]], template: function PoListBoxComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵprojectionDef(_c3);
            i0.ɵɵelementStart(0, "div", 0, 1);
            i0.ɵɵprojection(2);
            i0.ɵɵtemplate(3, PoListBoxComponent_po_search_list_3_Template, 2, 3, "po-search-list", 2)(4, PoListBoxComponent_ng_container_4_Template, 5, 3, "ng-container", 3)(5, PoListBoxComponent_div_5_Template, 2, 2, "div", 4)(6, PoListBoxComponent_ng_template_6_Template, 1, 1, "ng-template", null, 5, i0.ɵɵtemplateRefExtractor);
            i0.ɵɵelementEnd();
        } if (rf & 2) {
            const _r5 = i0.ɵɵreference(7);
            i0.ɵɵclassProp("po-listbox-check", ctx.type === "check" || ctx.type === "option");
            i0.ɵɵproperty("hidden", ctx.visible);
            i0.ɵɵattribute("data-type", ctx.type);
            i0.ɵɵadvance(3);
            i0.ɵɵproperty("ngIf", !ctx.hideSearch && ctx.type === "check");
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.checkTemplate())("ngIfElse", _r5);
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngIf", ctx.isServerSearching && ctx.type !== "action");
        } }, dependencies: [i3.NgForOf, i3.NgIf, i4.PoLoadingOverlayComponent, i5.CdkListbox, i5.CdkOption, i6.PoItemListComponent, i7.PoSearchListComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoListBoxComponent, [{
        type: Component,
        args: [{ selector: 'po-listbox', template: "<div\n  #listbox\n  class=\"po-listbox\"\n  [class.po-listbox-check]=\"type === 'check' || type === 'option'\"\n  [attr.data-type]=\"type\"\n  [hidden]=\"visible\"\n>\n  <ng-content select=\"[p-popup-header-template]\"></ng-content>\n\n  <po-search-list\n    #searchElement\n    *ngIf=\"!hideSearch && type === 'check'\"\n    (p-change)=\"callChangeSearch($event)\"\n    [p-literals]=\"literalSearch\"\n    [p-field-value]=\"fieldValueSearch\"\n    [p-placeholder]=\"placeholderSearch\"\n  ></po-search-list>\n\n  <ng-container *ngIf=\"checkTemplate(); else noDataTemplate\">\n    <ul #listboxItemList cdkListbox [cdkListboxMultiple]=\"type === 'check'\" class=\"po-listbox-list\">\n      <li\n        cdkOption=\"selectAll\"\n        *ngIf=\"type === 'check' && items.length && !searchElement?.inputValue && !hideSelectAll\"\n        [attr.aria-checked]=\"checkboxAllValue === null ? 'mixed' : checkboxAllValue\"\n        (click)=\"changeAll.emit()\"\n        (keydown)=\"changeAllEmit($event)\"\n        (keydown)=\"onSelectAllCheckboxKeyDown($event)\"\n      >\n        <po-item-list\n          [p-selected]=\"checkboxAllValue\"\n          p-type=\"check\"\n          [p-label]=\"literals.selectAll\"\n          p-value=\"selectAll\"\n          [p-checkbox-value]=\"checkboxAllValue\"\n        >\n        </po-item-list>\n      </li>\n      <li\n        [class.po-listbox-item]=\"visible\"\n        *ngFor=\"let item of items\"\n        [cdkOption]=\"item[fieldLabel]\"\n        [cdkOptionDisabled]=\"\n          returnBooleanValue(item, 'disabled') || returnBooleanValue(item, 'visible') === false || item.options\n        \"\n        [attr.aria-selected]=\"isSelectedItem(item) || item.selected\"\n        (click)=\"onSelectItem(item)\"\n        (keydown)=\"onKeyDown(item, $event)\"\n      >\n        <label *ngIf=\"item.options\" class=\"po-combo-item-title\">\n          {{ item.label }}\n        </label>\n        <po-item-list\n          *ngIf=\"returnBooleanValue(item, 'visible') !== false && !item.options\"\n          [p-disabled]=\"returnBooleanValue(item, 'disabled')\"\n          [p-visible]=\"returnBooleanValue(item, 'visible')\"\n          [p-checkbox-value]=\"isSelectedItem(item)\"\n          [attr.data-item-list]=\"formatItemList(item)\"\n          [p-label]=\"item[fieldLabel]\"\n          [p-value]=\"item[fieldValue]\"\n          [p-selected]=\"isSelectedItem(item) || item.selected\"\n          [p-active-tabs]=\"item.active\"\n          [p-separator]=\"item.separator\"\n          [p-danger]=\"item.danger || item.type === 'danger'\"\n          [p-icon]=\"item.icon\"\n          [p-type]=\"type\"\n          [p-item]=\"item\"\n          [p-tab-hide]=\"item.hide\"\n          [p-is-tabs]=\"isTabs\"\n          [p-field-value]=\"fieldValue\"\n          [p-field-label]=\"fieldLabel\"\n          [p-template]=\"template\"\n          [p-template-context]=\"item\"\n          (p-selectcheckbox-item)=\"checkboxClicked($event)\"\n          (p-selectcombo-item)=\"optionClicked(item)\"\n          (p-emit-item-tabs)=\"onSelectTabs($event)\"\n          (p-activated-tabs)=\"onActivatedTabs($event)\"\n          [p-search-value]=\"searchValue\"\n          [p-filter-mode]=\"filterMode\"\n          [p-filtering]=\"isFiltering\"\n          [p-should-mark-letter]=\"shouldMarkLetters\"\n          [p-compare-cache]=\"compareCache\"\n          [p-combo-service]=\"comboService\"\n        ></po-item-list>\n      </li>\n    </ul>\n  </ng-container>\n\n  <div *ngIf=\"isServerSearching && type !== 'action'\" [class.po-listbox-container-loading-default]=\"!infiniteLoading\">\n    <po-loading-overlay p-size=\"md\"></po-loading-overlay>\n  </div>\n\n  <ng-template #noDataTemplate>\n    <div\n      *ngIf=\"!items.length && !isServerSearching && type !== 'action'\"\n      class=\"po-listbox-container-no-data po-text-center\"\n    >\n      <span> {{ literals.noItems }}</span>\n    </div>\n  </ng-template>\n</div>\n" }]
    }], () => [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i1.PoLanguageService }, { type: i2.Router }, { type: i0.ChangeDetectorRef }], { listbox: [{
            type: ViewChild,
            args: ['listbox', { static: true }]
        }], listboxItemList: [{
            type: ViewChild,
            args: ['listboxItemList', { static: false }]
        }], searchElement: [{
            type: ViewChild,
            args: ['searchElement']
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoListBoxComponent, { className: "PoListBoxComponent", filePath: "lib/components/po-listbox/po-listbox.component.ts", lineNumber: 29 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbGlzdGJveC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tbGlzdGJveC9wby1saXN0Ym94LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1saXN0Ym94L3BvLWxpc3Rib3guY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUlMLFNBQVMsRUFNVCxTQUFTLEVBRVYsTUFBTSxlQUFlLENBQUM7QUFHdkIsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFLckUsT0FBTyxFQUFFLGNBQWMsRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUU5RSxPQUFPLEVBQTRCLFlBQVksRUFBRSxTQUFTLEVBQVMsTUFBTSxNQUFNLENBQUM7Ozs7Ozs7Ozs7Ozs7O0lDYjlFLDRDQU9DO0lBSkMsOExBQVksZUFBQSwrQkFBd0IsQ0FBQSxJQUFDO0lBSXRDLGlCQUFpQjs7O0lBSGhCLGlEQUE0QiwwQ0FBQSwyQ0FBQTs7OztJQU8xQiw4QkFPQztJQUhDLDRLQUFTLGVBQUEsd0JBQWdCLENBQUEsSUFBQyx5S0FDZixlQUFBLDZCQUFxQixDQUFBLElBRE4seUtBRWYsZUFBQSwwQ0FBa0MsQ0FBQSxJQUZuQjtJQUkxQixtQ0FPZTtJQUNqQixpQkFBSzs7O0lBYkgsc0dBQTRFO0lBTTFFLGNBQStCO0lBQS9CLHFEQUErQix1Q0FBQSw4Q0FBQTs7O0lBbUJqQyxpQ0FBd0Q7SUFDdEQsWUFDRjtJQUFBLGlCQUFROzs7SUFETixjQUNGO0lBREUsK0NBQ0Y7Ozs7SUFDQSx3Q0ErQkM7SUFWQywyT0FBeUIsZUFBQSwrQkFBdUIsQ0FBQSxJQUFDLGlRQUMzQixlQUFBLCtCQUFtQixDQUFBLElBRFEs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QyxDQUFDO1NBQ3BDO0lBQ0gsQ0FBQztJQUVELFdBQVcsQ0FBQyxHQUFHO1FBQ2IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUU7WUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDekI7SUFDSCxDQUFDO0lBRUQsY0FBYyxDQUFDLElBQVM7UUFDdEIsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2YsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDO1NBQ2hCO2FBQU07WUFDTCxJQUFJO2dCQUNGLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM3QjtZQUFDLE9BQU8sS0FBSyxFQUFFO2dCQUNkLE9BQU8sSUFBSSxDQUFDO2FBQ2I7U0FDRjtJQUNILENBQUM7NEVBL05VLGtCQUFrQjs2REFBbEIsa0JBQWtCOzs7Ozs7Ozs7OztZQzVCL0IsaUNBTUM7WUFDQyxrQkFBNEQ7WUFFNUQseUZBT2tCLHdFQUFBLHNEQUFBLHVHQUFBO1lBbUZwQixpQkFBTTs7O1lBaEdKLGlGQUFnRTtZQUVoRSxvQ0FBa0I7WUFEbEIscUNBQXVCO1lBT3BCLGVBQXFDO1lBQXJDLDhEQUFxQztZQU96QixjQUF1QjtZQUF2QiwwQ0FBdUIsaUJBQUE7WUFxRWhDLGNBQTRDO1lBQTVDLHFFQUE0Qzs7O2lGRDNEdkMsa0JBQWtCO2NBSjlCLFNBQVM7MkJBQ0UsWUFBWTt3SkFJa0IsT0FBTztrQkFBOUMsU0FBUzttQkFBQyxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO1lBQ1csZUFBZTtrQkFBL0QsU0FBUzttQkFBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7WUFDbkIsYUFBYTtrQkFBeEMsU0FBUzttQkFBQyxlQUFlOztrRkFIZixrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIFJlbmRlcmVyMixcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVmlld0NoaWxkLFxuICBmb3J3YXJkUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuaW1wb3J0IHsgUG9MaXN0Qm94QmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tbGlzdGJveC1iYXNlLmNvbXBvbmVudCc7XG5cbmltcG9ydCB7IFBvSXRlbUxpc3RPcHRpb25Hcm91cCB9IGZyb20gJy4vcG8taXRlbS1saXN0L2ludGVyZmFjZXMvcG8taXRlbS1saXN0LW9wdGlvbi1ncm91cC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9JdGVtTGlzdE9wdGlvbiB9IGZyb20gJy4vcG8taXRlbS1saXN0L2ludGVyZmFjZXMvcG8taXRlbS1saXN0LW9wdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5zZXJ2aWNlJztcbmltcG9ydCB7IGlzRXh0ZXJuYWxMaW5rLCBpc1R5cGVvZiwgb3BlbkV4dGVybmFsTGluayB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9TZWFyY2hMaXN0Q29tcG9uZW50IH0gZnJvbSAnLi9wby1zZWFyY2gtbGlzdC9wby1zZWFyY2gtbGlzdC5jb21wb25lbnQnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uLCBkZWJvdW5jZVRpbWUsIGZyb21FdmVudCwgbWVyZ2UgfSBmcm9tICdyeGpzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tbGlzdGJveCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1saXN0Ym94LmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb0xpc3RCb3hDb21wb25lbnQgZXh0ZW5kcyBQb0xpc3RCb3hCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICBAVmlld0NoaWxkKCdsaXN0Ym94JywgeyBzdGF0aWM6IHRydWUgfSkgbGlzdGJveDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnbGlzdGJveEl0ZW1MaXN0JywgeyBzdGF0aWM6IGZhbHNlIH0pIGxpc3Rib3hJdGVtTGlzdDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnc2VhcmNoRWxlbWVudCcpIHNlYXJjaEVsZW1lbnQ6IFBvU2VhcmNoTGlzdENvbXBvbmVudDtcblxuICBwcml2YXRlIHNjcm9sbEV2ZW50JDogT2JzZXJ2YWJsZTxhbnk+O1xuICBwcml2YXRlIHN1YnNjcmlwdGlvblNjcm9sbEV2ZW50OiBTdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIGxhbmd1YWdlU2VydmljZTogUG9MYW5ndWFnZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIGNoYW5nZURldGVjdG9yOiBDaGFuZ2VEZXRlY3RvclJlZlxuICApIHtcbiAgICBzdXBlcihsYW5ndWFnZVNlcnZpY2UpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuc2V0TGlzdEJveE1heEhlaWdodCgpO1xuICAgIHRoaXMubGlzdGJveEl0ZW1MaXN0Py5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzPzogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzPy5pdGVtcykge1xuICAgICAgdGhpcy5zZXRMaXN0Qm94TWF4SGVpZ2h0KCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudmlzaWJsZSAmJiB0aGlzLmluZmluaXRlU2Nyb2xsKSB7XG4gICAgICB0aGlzLmNoZWNrSW5maW5pdGVTY3JvbGwoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25TY3JvbGxFdmVudCAmJiB0aGlzLnN1YnNjcmlwdGlvblNjcm9sbEV2ZW50LnVuc3Vic2NyaWJlKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvblNjcm9sbEV2ZW50LnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgb25TZWxlY3RJdGVtKGl0ZW1MaXN0QWN0aW9uOiBQb0l0ZW1MaXN0T3B0aW9uIHwgUG9JdGVtTGlzdE9wdGlvbkdyb3VwIHwgYW55KSB7XG4gICAgY29uc3QgaXNEaXNhYmxlZCA9XG4gICAgICBpdGVtTGlzdEFjdGlvbi5oYXNPd25Qcm9wZXJ0eSgnZGlzYWJsZWQnKSAmJlxuICAgICAgaXRlbUxpc3RBY3Rpb24uZGlzYWJsZWQgIT09IG51bGwgJiZcbiAgICAgIGl0ZW1MaXN0QWN0aW9uLmRpc2FibGVkICE9PSB1bmRlZmluZWRcbiAgICAgICAgPyB0aGlzLnJldHVybkJvb2xlYW5WYWx1ZShpdGVtTGlzdEFjdGlvbiwgJ2Rpc2FibGVkJylcbiAgICAgICAgOiBmYWxzZTtcbiAgICBjb25zdCBpc1Zpc2libGUgPVxuICAgICAgaXRlbUxpc3RBY3Rpb24uaGFzT3duUHJvcGVydHkoJ3Zpc2libGUnKSAmJlxuICAgICAgaXRlbUxpc3RBY3Rpb24udmlzaWJsZSAhPT0gbnVsbCAmJlxuICAgICAgaXRlbUxpc3RBY3Rpb24udmlzaWJsZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8gdGhpcy5yZXR1cm5Cb29sZWFuVmFsdWUoaXRlbUxpc3RBY3Rpb24sICd2aXNpYmxlJylcbiAgICAgICAgOiB0cnVlO1xuXG4gICAgaWYgKHRoaXMuaXNUYWJzICYmICFpdGVtTGlzdEFjdGlvbi5kaXNhYmxlZCAmJiAhaXRlbUxpc3RBY3Rpb24uaGlkZSkge1xuICAgICAgdGhpcy5vbkNsaWNrVGFicyhpdGVtTGlzdEFjdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKGl0ZW1MaXN0QWN0aW9uICYmIGl0ZW1MaXN0QWN0aW9uLmFjdGlvbiAmJiAhaXNEaXNhYmxlZCAmJiBpc1Zpc2libGUpIHtcbiAgICAgIGl0ZW1MaXN0QWN0aW9uLmFjdGlvbih0aGlzLnBhcmFtIHx8IGl0ZW1MaXN0QWN0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoaXRlbUxpc3RBY3Rpb24gJiYgaXRlbUxpc3RBY3Rpb24udXJsICYmICFpc0Rpc2FibGVkICYmIGlzVmlzaWJsZSkge1xuICAgICAgcmV0dXJuIHRoaXMub3BlblVybChpdGVtTGlzdEFjdGlvbi51cmwpO1xuICAgIH1cbiAgfVxuXG4gIG9uU2VsZWN0QWxsQ2hlY2tib3hLZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LmNvZGUgPT09ICdUYWInKSB7XG4gICAgICB0aGlzLmNsb3NlRXZlbnQuZW1pdCgpO1xuICAgIH1cbiAgfVxuXG4gIG9uS2V5RG93bihpdGVtTGlzdEFjdGlvbjogUG9JdGVtTGlzdE9wdGlvbiB8IFBvSXRlbUxpc3RPcHRpb25Hcm91cCB8IGFueSwgZXZlbnQ/OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIGlmICgoZXZlbnQgJiYgZXZlbnQuY29kZSA9PT0gJ0VudGVyJykgfHwgZXZlbnQuY29kZSA9PT0gJ1NwYWNlJykge1xuICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnY2hlY2snOlxuICAgICAgICAgIHRoaXMub25TZWxlY3RDaGVja0JveEl0ZW0oaXRlbUxpc3RBY3Rpb24pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdvcHRpb24nOlxuICAgICAgICAgIHRoaXMub3B0aW9uQ2xpY2tlZChpdGVtTGlzdEFjdGlvbik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2FjdGlvbic6XG4gICAgICAgICAgdGhpcy5vblNlbGVjdEl0ZW0oaXRlbUxpc3RBY3Rpb24pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICgoZXZlbnQgJiYgZXZlbnQuY29kZSA9PT0gJ0VzY2FwZScpIHx8IGV2ZW50LmNvZGUgPT09ICdUYWInKSB7XG4gICAgICB0aGlzLmNsb3NlRXZlbnQuZW1pdCgpO1xuICAgIH1cbiAgfVxuXG4gIGNoZWNrYm94Q2xpY2tlZCh7IG9wdGlvbiwgc2VsZWN0ZWQgfSkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09ICdjaGVjaycpIHtcbiAgICAgIHRoaXMuY2hhbmdlLmVtaXQoeyBzZWxlY3RlZCwgb3B0aW9uIH0pO1xuICAgIH1cbiAgfVxuXG4gIG9wdGlvbkNsaWNrZWQob3B0aW9uOiBhbnkpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSAnb3B0aW9uJykge1xuICAgICAgdGhpcy5pdGVtcy5maWx0ZXIoaXRlbSA9PlxuICAgICAgICBpdGVtW3RoaXMuZmllbGRWYWx1ZV0gPT09IG9wdGlvblt0aGlzLmZpZWxkVmFsdWVdID8gKGl0ZW1bJ3NlbGVjdGVkJ10gPSB0cnVlKSA6IChpdGVtWydzZWxlY3RlZCddID0gZmFsc2UpXG4gICAgICApO1xuICAgICAgdGhpcy5zZWxlY3RDb21iby5lbWl0KHsgLi4ub3B0aW9uIH0pO1xuICAgIH1cbiAgfVxuXG4gIG9uU2VsZWN0Q2hlY2tCb3hJdGVtKG9wdGlvbikge1xuICAgIGNvbnN0IHNlbGVjdGVkID0gIXRoaXMuaXNTZWxlY3RlZEl0ZW0ob3B0aW9uKTtcbiAgICB0aGlzLmNoZWNrYm94Q2xpY2tlZCh7IG9wdGlvbiwgc2VsZWN0ZWQgfSk7XG4gIH1cblxuICBpc1NlbGVjdGVkSXRlbShvcHRpb24pIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZE9wdGlvbnMuc29tZShzZWxlY3RlZEl0ZW0gPT4gc2VsZWN0ZWRJdGVtW3RoaXMuZmllbGRWYWx1ZV0gPT09IG9wdGlvblt0aGlzLmZpZWxkVmFsdWVdKTtcbiAgfVxuXG4gIGNoYW5nZUFsbEVtaXQoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBpZiAoKGV2ZW50ICYmIGV2ZW50LmNvZGUgPT09ICdFbnRlcicpIHx8IGV2ZW50LmNvZGUgPT09ICdTcGFjZScpIHtcbiAgICAgIHRoaXMuY2hhbmdlQWxsLmVtaXQoKTtcbiAgICB9XG4gIH1cblxuICBvblNlbGVjdFRhYnModGFiKSB7XG4gICAgaWYgKHRoaXMuaXNUYWJzICYmIHRhYikge1xuICAgICAgdGhpcy5jaGFuZ2VTdGF0ZVRhYnMuZW1pdCh0YWIpO1xuICAgIH1cbiAgfVxuXG4gIG9uQWN0aXZhdGVkVGFicyh0YWIpIHtcbiAgICB0aGlzLmFjdGl2YXRlZFRhYi5lbWl0KHRhYik7XG4gIH1cblxuICBjYWxsQ2hhbmdlU2VhcmNoKGV2ZW50KSB7XG4gICAgdGhpcy5jaGFuZ2VTZWFyY2guZW1pdChldmVudCk7XG4gIH1cblxuICBzaG93TW9yZUluZmluaXRlU2Nyb2xsKHsgdGFyZ2V0IH0pOiB2b2lkIHtcbiAgICBjb25zdCBzY3JvbGxQb3NpdGlvbiA9IHRhcmdldC5vZmZzZXRIZWlnaHQgKyB0YXJnZXQuc2Nyb2xsVG9wO1xuICAgIGlmIChzY3JvbGxQb3NpdGlvbiA+PSB0YXJnZXQuc2Nyb2xsSGVpZ2h0ICogKHRoaXMuaW5maW5pdGVTY3JvbGxEaXN0YW5jZSAvIDExMCkpIHtcbiAgICAgIHRoaXMuVXBkYXRlSW5maW5pdGVTY3JvbGwuZW1pdCgpO1xuICAgIH1cbiAgfVxuXG4gIHNjcm9sbExpc3RlbmVyKGNvbXBvbmVudExpc3RuZXI6IEhUTUxFbGVtZW50KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gZnJvbUV2ZW50KGNvbXBvbmVudExpc3RuZXIsICdzY3JvbGwnKS5waXBlKGRlYm91bmNlVGltZSgxMDApKTtcbiAgfVxuXG4gIHNldEZvY3VzKCkge1xuICAgIHRoaXMubGlzdGJveEl0ZW1MaXN0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjaGVja0luZmluaXRlU2Nyb2xsKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmhhc0luZmluaXRlU2Nyb2xsKCkpIHtcbiAgICAgIHRoaXMuaW5jbHVkZUluZmluaXRlU2Nyb2xsKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYXNJbmZpbml0ZVNjcm9sbCgpOiBib29sZWFuIHtcbiAgICB0aGlzLmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgICByZXR1cm4gdGhpcy5pbmZpbml0ZVNjcm9sbCAmJiB0aGlzLmxpc3Rib3hJdGVtTGlzdD8ubmF0aXZlRWxlbWVudC5zY3JvbGxIZWlnaHQ7XG4gIH1cblxuICBjaGVja1RlbXBsYXRlKCkge1xuICAgIGlmICh0aGlzLmNhY2hlIHx8IHRoaXMuaW5maW5pdGVTY3JvbGwpIHtcbiAgICAgIHJldHVybiB0aGlzLml0ZW1zLmxlbmd0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICF0aGlzLmlzU2VydmVyU2VhcmNoaW5nICYmIHRoaXMuaXRlbXMubGVuZ3RoO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5jbHVkZUluZmluaXRlU2Nyb2xsKCk6IHZvaWQge1xuICAgIHRoaXMuc2Nyb2xsRXZlbnQkID0gdGhpcy5zY3JvbGxMaXN0ZW5lcih0aGlzLmxpc3Rib3hJdGVtTGlzdD8ubmF0aXZlRWxlbWVudCk7XG5cbiAgICB0aGlzLnN1YnNjcmlwdGlvblNjcm9sbEV2ZW50ID0gdGhpcy5zY3JvbGxFdmVudCQuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgIHRoaXMuc2hvd01vcmVJbmZpbml0ZVNjcm9sbChldmVudCk7XG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgcmV0dXJuQm9vbGVhblZhbHVlKGl0ZW1MaXN0QWN0aW9uOiBhbnksIHByb3BlcnR5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gaXNUeXBlb2YoaXRlbUxpc3RBY3Rpb25bcHJvcGVydHldLCAnZnVuY3Rpb24nKVxuICAgICAgPyBpdGVtTGlzdEFjdGlvbltwcm9wZXJ0eV0odGhpcy5wYXJhbSB8fCBpdGVtTGlzdEFjdGlvbilcbiAgICAgIDogaXRlbUxpc3RBY3Rpb25bcHJvcGVydHldO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRMaXN0Qm94TWF4SGVpZ2h0KCk6IHZvaWQge1xuICAgIGNvbnN0IGl0ZW1zTGVuZ3RoID0gdGhpcy5pdGVtcy5sZW5ndGg7XG4gICAgaWYgKGl0ZW1zTGVuZ3RoID4gNikge1xuICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ2NoZWNrJyAmJiAhdGhpcy5oaWRlU2VhcmNoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5saXN0Ym94Lm5hdGl2ZUVsZW1lbnQsICdtYXhIZWlnaHQnLCBgJHs0NCAqIDYgLSA0NCAvIDMgKyA2MH1weGApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxpc3Rib3gubmF0aXZlRWxlbWVudCwgJ21heEhlaWdodCcsIGAkezQ0ICogNiAtIDQ0IC8gM31weGApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb3BlblVybCh1cmw6IHN0cmluZykge1xuICAgIGlmIChpc0V4dGVybmFsTGluayh1cmwpKSB7XG4gICAgICByZXR1cm4gb3BlbkV4dGVybmFsTGluayh1cmwpO1xuICAgIH1cblxuICAgIGlmICh1cmwpIHtcbiAgICAgIHJldHVybiB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbdXJsXSk7XG4gICAgfVxuICB9XG5cbiAgb25DbGlja1RhYnModGFiKSB7XG4gICAgaWYgKCF0YWIuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuY2xpY2tUYWIuZW1pdCh0YWIpO1xuICAgIH1cbiAgfVxuXG4gIGZvcm1hdEl0ZW1MaXN0KGl0ZW06IGFueSk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMuaXNUYWJzKSB7XG4gICAgICByZXR1cm4gaXRlbS5pZDtcbiAgICB9IGVsc2Uge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGl0ZW0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iLCI8ZGl2XG4gICNsaXN0Ym94XG4gIGNsYXNzPVwicG8tbGlzdGJveFwiXG4gIFtjbGFzcy5wby1saXN0Ym94LWNoZWNrXT1cInR5cGUgPT09ICdjaGVjaycgfHwgdHlwZSA9PT0gJ29wdGlvbidcIlxuICBbYXR0ci5kYXRhLXR5cGVdPVwidHlwZVwiXG4gIFtoaWRkZW5dPVwidmlzaWJsZVwiXG4+XG4gIDxuZy1jb250ZW50IHNlbGVjdD1cIltwLXBvcHVwLWhlYWRlci10ZW1wbGF0ZV1cIj48L25nLWNvbnRlbnQ+XG5cbiAgPHBvLXNlYXJjaC1saXN0XG4gICAgI3NlYXJjaEVsZW1lbnRcbiAgICAqbmdJZj1cIiFoaWRlU2VhcmNoICYmIHR5cGUgPT09ICdjaGVjaydcIlxuICAgIChwLWNoYW5nZSk9XCJjYWxsQ2hhbmdlU2VhcmNoKCRldmVudClcIlxuICAgIFtwLWxpdGVyYWxzXT1cImxpdGVyYWxTZWFyY2hcIlxuICAgIFtwLWZpZWxkLXZhbHVlXT1cImZpZWxkVmFsdWVTZWFyY2hcIlxuICAgIFtwLXBsYWNlaG9sZGVyXT1cInBsYWNlaG9sZGVyU2VhcmNoXCJcbiAgPjwvcG8tc2VhcmNoLWxpc3Q+XG5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImNoZWNrVGVtcGxhdGUoKTsgZWxzZSBub0RhdGFUZW1wbGF0ZVwiPlxuICAgIDx1bCAjbGlzdGJveEl0ZW1MaXN0IGNka0xpc3Rib3ggW2Nka0xpc3Rib3hNdWx0aXBsZV09XCJ0eXBlID09PSAnY2hlY2snXCIgY2xhc3M9XCJwby1saXN0Ym94LWxpc3RcIj5cbiAgICAgIDxsaVxuICAgICAgICBjZGtPcHRpb249XCJzZWxlY3RBbGxcIlxuICAgICAgICAqbmdJZj1cInR5cGUgPT09ICdjaGVjaycgJiYgaXRlbXMubGVuZ3RoICYmICFzZWFyY2hFbGVtZW50Py5pbnB1dFZhbHVlICYmICFoaWRlU2VsZWN0QWxsXCJcbiAgICAgICAgW2F0dHIuYXJpYS1jaGVja2VkXT1cImNoZWNrYm94QWxsVmFsdWUgPT09IG51bGwgPyAnbWl4ZWQnIDogY2hlY2tib3hBbGxWYWx1ZVwiXG4gICAgICAgIChjbGljayk9XCJjaGFuZ2VBbGwuZW1pdCgpXCJcbiAgICAgICAgKGtleWRvd24pPVwiY2hhbmdlQWxsRW1pdCgkZXZlbnQpXCJcbiAgICAgICAgKGtleWRvd24pPVwib25TZWxlY3RBbGxDaGVja2JveEtleURvd24oJGV2ZW50KVwiXG4gICAgICA+XG4gICAgICAgIDxwby1pdGVtLWxpc3RcbiAgICAgICAgICBbcC1zZWxlY3RlZF09XCJjaGVja2JveEFsbFZhbHVlXCJcbiAgICAgICAgICBwLXR5cGU9XCJjaGVja1wiXG4gICAgICAgICAgW3AtbGFiZWxdPVwibGl0ZXJhbHMuc2VsZWN0QWxsXCJcbiAgICAgICAgICBwLXZhbHVlPVwic2VsZWN0QWxsXCJcbiAgICAgICAgICBbcC1jaGVja2JveC12YWx1ZV09XCJjaGVja2JveEFsbFZhbHVlXCJcbiAgICAgICAgPlxuICAgICAgICA8L3BvLWl0ZW0tbGlzdD5cbiAgICAgIDwvbGk+XG4gICAgICA8bGlcbiAgICAgICAgW2NsYXNzLnBvLWxpc3Rib3gtaXRlbV09XCJ2aXNpYmxlXCJcbiAgICAgICAgKm5nRm9yPVwibGV0IGl0ZW0gb2YgaXRlbXNcIlxuICAgICAgICBbY2RrT3B0aW9uXT1cIml0ZW1bZmllbGRMYWJlbF1cIlxuICAgICAgICBbY2RrT3B0aW9uRGlzYWJsZWRdPVwiXG4gICAgICAgICAgcmV0dXJuQm9vbGVhblZhbHVlKGl0ZW0sICdkaXNhYmxlZCcpIHx8IHJldHVybkJvb2xlYW5WYWx1ZShpdGVtLCAndmlzaWJsZScpID09PSBmYWxzZSB8fCBpdGVtLm9wdGlvbnNcbiAgICAgICAgXCJcbiAgICAgICAgW2F0dHIuYXJpYS1zZWxlY3RlZF09XCJpc1NlbGVjdGVkSXRlbShpdGVtKSB8fCBpdGVtLnNlbGVjdGVkXCJcbiAgICAgICAgKGNsaWNrKT1cIm9uU2VsZWN0SXRlbShpdGVtKVwiXG4gICAgICAgIChrZXlkb3duKT1cIm9uS2V5RG93bihpdGVtLCAkZXZlbnQpXCJcbiAgICAgID5cbiAgICAgICAgPGxhYmVsICpuZ0lmPVwiaXRlbS5vcHRpb25zXCIgY2xhc3M9XCJwby1jb21iby1pdGVtLXRpdGxlXCI+XG4gICAgICAgICAge3sgaXRlbS5sYWJlbCB9fVxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8cG8taXRlbS1saXN0XG4gICAgICAgICAgKm5nSWY9XCJyZXR1cm5Cb29sZWFuVmFsdWUoaXRlbSwgJ3Zpc2libGUnKSAhPT0gZmFsc2UgJiYgIWl0ZW0ub3B0aW9uc1wiXG4gICAgICAgICAgW3AtZGlzYWJsZWRdPVwicmV0dXJuQm9vbGVhblZhbHVlKGl0ZW0sICdkaXNhYmxlZCcpXCJcbiAgICAgICAgICBbcC12aXNpYmxlXT1cInJldHVybkJvb2xlYW5WYWx1ZShpdGVtLCAndmlzaWJsZScpXCJcbiAgICAgICAgICBbcC1jaGVja2JveC12YWx1ZV09XCJpc1NlbGVjdGVkSXRlbShpdGVtKVwiXG4gICAgICAgICAgW2F0dHIuZGF0YS1pdGVtLWxpc3RdPVwiZm9ybWF0SXRlbUxpc3QoaXRlbSlcIlxuICAgICAgICAgIFtwLWxhYmVsXT1cIml0ZW1bZmllbGRMYWJlbF1cIlxuICAgICAgICAgIFtwLXZhbHVlXT1cIml0ZW1bZmllbGRWYWx1ZV1cIlxuICAgICAgICAgIFtwLXNlbGVjdGVkXT1cImlzU2VsZWN0ZWRJdGVtKGl0ZW0pIHx8IGl0ZW0uc2VsZWN0ZWRcIlxuICAgICAgICAgIFtwLWFjdGl2ZS10YWJzXT1cIml0ZW0uYWN0aXZlXCJcbiAgICAgICAgICBbcC1zZXBhcmF0b3JdPVwiaXRlbS5zZXBhcmF0b3JcIlxuICAgICAgICAgIFtwLWRhbmdlcl09XCJpdGVtLmRhbmdlciB8fCBpdGVtLnR5cGUgPT09ICdkYW5nZXInXCJcbiAgICAgICAgICBbcC1pY29uXT1cIml0ZW0uaWNvblwiXG4gICAgICAgICAgW3AtdHlwZV09XCJ0eXBlXCJcbiAgICAgICAgICBbcC1pdGVtXT1cIml0ZW1cIlxuICAgICAgICAgIFtwLXRhYi1oaWRlXT1cIml0ZW0uaGlkZVwiXG4gICAgICAgICAgW3AtaXMtdGFic109XCJpc1RhYnNcIlxuICAgICAgICAgIFtwLWZpZWxkLXZhbHVlXT1cImZpZWxkVmFsdWVcIlxuICAgICAgICAgIFtwLWZpZWxkLWxhYmVsXT1cImZpZWxkTGFiZWxcIlxuICAgICAgICAgIFtwLXRlbXBsYXRlXT1cInRlbXBsYXRlXCJcbiAgICAgICAgICBbcC10ZW1wbGF0ZS1jb250ZXh0XT1cIml0ZW1cIlxuICAgICAgICAgIChwLXNlbGVjdGNoZWNrYm94LWl0ZW0pPVwiY2hlY2tib3hDbGlja2VkKCRldmVudClcIlxuICAgICAgICAgIChwLXNlbGVjdGNvbWJvLWl0ZW0pPVwib3B0aW9uQ2xpY2tlZChpdGVtKVwiXG4gICAgICAgICAgKHAtZW1pdC1pdGVtLXRhYnMpPVwib25TZWxlY3RUYWJzKCRldmVudClcIlxuICAgICAgICAgIChwLWFjdGl2YXRlZC10YWJzKT1cIm9uQWN0aXZhdGVkVGFicygkZXZlbnQpXCJcbiAgICAgICAgICBbcC1zZWFyY2gtdmFsdWVdPVwic2VhcmNoVmFsdWVcIlxuICAgICAgICAgIFtwLWZpbHRlci1tb2RlXT1cImZpbHRlck1vZGVcIlxuICAgICAgICAgIFtwLWZpbHRlcmluZ109XCJpc0ZpbHRlcmluZ1wiXG4gICAgICAgICAgW3Atc2hvdWxkLW1hcmstbGV0dGVyXT1cInNob3VsZE1hcmtMZXR0ZXJzXCJcbiAgICAgICAgICBbcC1jb21wYXJlLWNhY2hlXT1cImNvbXBhcmVDYWNoZVwiXG4gICAgICAgICAgW3AtY29tYm8tc2VydmljZV09XCJjb21ib1NlcnZpY2VcIlxuICAgICAgICA+PC9wby1pdGVtLWxpc3Q+XG4gICAgICA8L2xpPlxuICAgIDwvdWw+XG4gIDwvbmctY29udGFpbmVyPlxuXG4gIDxkaXYgKm5nSWY9XCJpc1NlcnZlclNlYXJjaGluZyAmJiB0eXBlICE9PSAnYWN0aW9uJ1wiIFtjbGFzcy5wby1saXN0Ym94LWNvbnRhaW5lci1sb2FkaW5nLWRlZmF1bHRdPVwiIWluZmluaXRlTG9hZGluZ1wiPlxuICAgIDxwby1sb2FkaW5nLW92ZXJsYXkgcC1zaXplPVwibWRcIj48L3BvLWxvYWRpbmctb3ZlcmxheT5cbiAgPC9kaXY+XG5cbiAgPG5nLXRlbXBsYXRlICNub0RhdGFUZW1wbGF0ZT5cbiAgICA8ZGl2XG4gICAgICAqbmdJZj1cIiFpdGVtcy5sZW5ndGggJiYgIWlzU2VydmVyU2VhcmNoaW5nICYmIHR5cGUgIT09ICdhY3Rpb24nXCJcbiAgICAgIGNsYXNzPVwicG8tbGlzdGJveC1jb250YWluZXItbm8tZGF0YSBwby10ZXh0LWNlbnRlclwiXG4gICAgPlxuICAgICAgPHNwYW4+IHt7IGxpdGVyYWxzLm5vSXRlbXMgfX08L3NwYW4+XG4gICAgPC9kaXY+XG4gIDwvbmctdGVtcGxhdGU+XG48L2Rpdj5cbiJdfQ==