import { Component, EventEmitter, Input, Output } from '@angular/core';
import { PoChartGridLines, PoChartPadding, PoChartPlotAreaPaddingTop } from '../../helpers/po-chart-default-values.constant';
import { PoChartType } from '../../enums/po-chart-type.enum';
import * as i0 from "@angular/core";
import * as i1 from "../../services/po-chart-maths.service";
import * as i2 from "./po-chart-axis-path/po-chart-axis-path.component";
import * as i3 from "./po-chart-axis-label/po-chart-axis-label.component";
const _c0 = ["po-chart-axis", ""];
export class PoChartAxisComponent {
    mathsService;
    alignByTheCorners = false;
    type;
    range;
    categoriesCoordinates = new EventEmitter();
    axisXCoordinates;
    axisXLabelCoordinates;
    axisYCoordinates;
    axisYLabelCoordinates;
    axisXLabels = [];
    axisYLabels = [];
    gridLines = PoChartGridLines;
    seriesLength = 0;
    _axisOptions;
    _categories = [];
    _containerSize = {};
    _series = [];
    set series(seriesList) {
        const seriesDataArrayFilter = seriesList.filter(serie => Array.isArray(serie.data));
        if (seriesDataArrayFilter.length) {
            this._series = seriesDataArrayFilter;
            this.seriesLength = this.mathsService.seriesGreaterLength(this.series);
            this.checkAxisOptions(this.axisOptions);
            this.setAxisXCoordinates(this.gridLines, this.seriesLength, this.containerSize, this.range, this.type);
            this.setAxisYCoordinates(this.gridLines, this.seriesLength, this.containerSize, this.range, this.type);
        }
        else {
            this._series = [];
            this.cleanUpCoordinates();
        }
    }
    get series() {
        return this._series;
    }
    set categories(value) {
        this._categories = value;
        if (this.type === PoChartType.Bar) {
            this.setAxisXCoordinates(this.gridLines, this.seriesLength, this.containerSize, this.range, this.type);
        }
        else {
            this.setAxisYCoordinates(this.gridLines, this.seriesLength, this.containerSize, this.range, this.type);
        }
    }
    get categories() {
        return this._categories;
    }
    set containerSize(value) {
        this._containerSize = value;
        this.checkAxisOptions(this.axisOptions);
        this.setAxisXCoordinates(this.gridLines, this.seriesLength, this._containerSize, this.range, this.type);
        this.setAxisYCoordinates(this.gridLines, this.seriesLength, this._containerSize, this.range, this.type);
    }
    get containerSize() {
        return this._containerSize;
    }
    set axisOptions(value) {
        this._axisOptions = value;
        this.checkAxisOptions(this._axisOptions);
        if (this.type === PoChartType.Bar) {
            this.setAxisYCoordinates(this.gridLines, this.seriesLength, this.containerSize, this.range, this.type);
        }
        else {
            this.setAxisXCoordinates(this.gridLines, this.seriesLength, this.containerSize, this.range, this.type);
        }
    }
    get axisOptions() {
        return this._axisOptions;
    }
    constructor(mathsService) {
        this.mathsService = mathsService;
    }
    setAxisXCoordinates(gridLines, seriesLength, containerSize, minMaxAxisValues, type) {
        if (seriesLength) {
            const amountOfAxisLabels = type === PoChartType.Bar ? seriesLength : gridLines;
            this.calculateAxisXLabelCoordinates(amountOfAxisLabels, containerSize, minMaxAxisValues, type);
        }
        const amountOfAxisXLines = this.amountOfAxisXLines(seriesLength, gridLines, type);
        this.calculateAxisXCoordinates(amountOfAxisXLines, containerSize, minMaxAxisValues);
    }
    amountOfAxisXLines(seriesLength, gridLines, type) {
        if (type === PoChartType.Bar) {
            return seriesLength <= 1 ? 2 : seriesLength + 1;
        }
        return gridLines === 0 ? 1 : gridLines;
    }
    setAxisYCoordinates(gridLines, seriesLength, containerSize, minMaxAxisValues, type) {
        const amountOfAxisY = type === PoChartType.Bar ? gridLines : seriesLength;
        if (seriesLength) {
            this.calculateAxisYLabelCoordinates(amountOfAxisY, containerSize, minMaxAxisValues, type);
        }
        if (type === PoChartType.Area) {
            this.getCategoriesRangeForMouseMove(amountOfAxisY, containerSize);
        }
        this.calculateAxisYCoordinates(amountOfAxisY, containerSize, type, minMaxAxisValues);
    }
    calculateAxisXCoordinates(amountOfAxisX, containerSize, range) {
        const startX = containerSize.axisXLabelWidth;
        const endX = containerSize.svgWidth;
        let coordinatesReferedToZero;
        let coordinatesList = [...Array(amountOfAxisX)].map((_, index) => {
            const yCoordinate = this.calculateAxisXCoordinateY(amountOfAxisX, containerSize, index);
            const coordinates = `M${startX} ${yCoordinate} L${endX}, ${yCoordinate}`;
            return { coordinates };
        });
        // Avalia a necessidade de adicionar a linha referente ao valor zero em gráficos do tipo `column`, `area` e `line`.
        if (this.type !== PoChartType.Bar && range.minValue < 0 && !this.axisXLabels.includes('0')) {
            coordinatesReferedToZero = this.getCoordinatesRelatedToZero(containerSize, range, startX, endX);
            coordinatesList = [...coordinatesList, coordinatesReferedToZero];
        }
        this.axisXCoordinates = coordinatesList;
    }
    getCoordinatesRelatedToZero(containerSize, range, start, end, isAxisY = false) {
        const type = isAxisY ? PoChartType.Bar : PoChartType.Column;
        const basePosition = this.axisCoordinatesForValueZero(range, 0, containerSize, isAxisY);
        const coordinates = {
            column: {
                startX: start,
                endX: end,
                startY: basePosition,
                endY: basePosition
            },
            bar: {
                startX: basePosition,
                endX: basePosition,
                startY: start,
                endY: end
            }
        };
        return {
            coordinates: `M${coordinates[type].startX} ${coordinates[type].startY} L${coordinates[type].endX} ${coordinates[type].endY}`
        };
    }
    axisCoordinatesForValueZero(range, data, containerSize, isAxisY) {
        const { axisXLabelWidth, svgWidth, svgPlottingAreaHeight } = containerSize;
        const ratio = this.mathsService.getSeriePercentage(range, data);
        return Math.floor(isAxisY
            ? axisXLabelWidth + (svgWidth - axisXLabelWidth) * ratio
            : svgPlottingAreaHeight - svgPlottingAreaHeight * ratio + PoChartPlotAreaPaddingTop);
    }
    calculateAxisXLabelCoordinates(amountOfAxisX, containerSize, minMaxAxisValues, type) {
        this.axisXLabels = this.getAxisXLabels(type, minMaxAxisValues, amountOfAxisX);
        this.axisXLabelCoordinates = [...Array(amountOfAxisX)].map((_, index) => {
            const label = this.axisXLabels[index];
            const xCoordinate = this.calculateAxisXLabelXCoordinate(containerSize.axisXLabelWidth);
            const yCoordinate = this.calculateAxisXLabelYCoordinate(amountOfAxisX, containerSize, type, index);
            return { label, xCoordinate, yCoordinate };
        });
    }
    calculateAxisYCoordinates(amountOfAxisY, containerSize, type, range) {
        const startY = PoChartPlotAreaPaddingTop;
        const endY = containerSize.svgPlottingAreaHeight + PoChartPlotAreaPaddingTop;
        // tratamento necessário para criar uma linha a mais para fechar o gráfico
        const length = amountOfAxisY === 0 || type === PoChartType.Bar ? amountOfAxisY : amountOfAxisY + 1;
        let coordinatesReferedToZero;
        let coordinatesList = [...Array(length)].map((_, index) => {
            const xCoordinate = this.calculateAxisYCoordinateX(containerSize, amountOfAxisY, index);
            const coordinates = `M${xCoordinate} ${startY} L${xCoordinate}, ${endY}`;
            return { coordinates };
        });
        // Avalia a necessidade de adicionar a linha referente ao valor zero em gráficos do tipo `bar`.
        if (type === PoChartType.Bar && range.minValue < 0 && !this.axisYLabels.includes('0')) {
            coordinatesReferedToZero = this.getCoordinatesRelatedToZero(containerSize, range, startY, endY, true);
            coordinatesList = [...coordinatesList, coordinatesReferedToZero];
        }
        this.axisYCoordinates = [...coordinatesList];
    }
    calculateAxisYLabelCoordinates(amountOfAxisY, containerSize, minMaxAxisValues, type) {
        this.axisYLabels = this.getAxisYLabels(type, minMaxAxisValues, amountOfAxisY);
        this.axisYLabelCoordinates = [...Array(amountOfAxisY)].map((_, index) => {
            const label = this.axisYLabels[index];
            const xCoordinate = this.getAxisXCoordinates(containerSize, amountOfAxisY, type, index);
            const yCoordinate = this.calculateAxisYLabelYCoordinate(containerSize);
            return { label, xCoordinate, yCoordinate };
        });
    }
    calculateAxisXLabelXCoordinate(axisXLabelWidth) {
        const labelPoChartPadding = PoChartPadding / 3;
        return axisXLabelWidth - labelPoChartPadding;
    }
    calculateAxisXLabelYCoordinate(amountOfAxisX, containerSize, type, index) {
        const amountOfLines = type === PoChartType.Bar ? amountOfAxisX : amountOfAxisX - 1;
        const yRatio = index / amountOfLines;
        if (type !== PoChartType.Bar) {
            return (containerSize.svgPlottingAreaHeight - containerSize.svgPlottingAreaHeight * yRatio + PoChartPlotAreaPaddingTop);
        }
        const halfCategoryHeight = containerSize.svgPlottingAreaHeight / amountOfAxisX / 2;
        return (containerSize.svgPlottingAreaHeight -
            halfCategoryHeight -
            containerSize.svgPlottingAreaHeight * yRatio +
            PoChartPlotAreaPaddingTop);
    }
    calculateAxisXCoordinateY(amountOfAxisX, containerSize, index) {
        const yRatio = index / (amountOfAxisX - 1);
        return (containerSize.svgPlottingAreaHeight - containerSize.svgPlottingAreaHeight * yRatio + PoChartPlotAreaPaddingTop);
    }
    calculateAxisYLabelYCoordinate(containerSize) {
        const textPoChartPadding = PoChartPadding / 3;
        return containerSize.svgHeight - textPoChartPadding;
    }
    centeredInCategoryArea(containerSize, amountOfAxisY, type, index) {
        const amountOfLines = type === PoChartType.Bar ? amountOfAxisY - 1 : amountOfAxisY;
        const xRatio = index / amountOfLines;
        if (type === PoChartType.Bar) {
            return Math.round(containerSize.axisXLabelWidth + (containerSize.svgWidth - containerSize.axisXLabelWidth) * xRatio);
        }
        const halfCategoryWidth = (containerSize.svgWidth - containerSize.axisXLabelWidth) / amountOfAxisY / 2;
        return Math.round(containerSize.axisXLabelWidth +
            halfCategoryWidth +
            (containerSize.svgWidth - containerSize.axisXLabelWidth) * xRatio);
    }
    calculateAxisYCoordinateX(containerSize, amountOfAxisY, index, subtractCategoryWidth = false) {
        const amountOfLines = this.alignByTheCorners ? amountOfAxisY - 1 : amountOfAxisY;
        const halfCategoryWidth = this.alignByTheCorners && subtractCategoryWidth
            ? (containerSize.svgWidth - containerSize.axisXLabelWidth) / (amountOfAxisY - 1) / 2
            : 0;
        const divideIndexByAmountOfLines = index / amountOfLines;
        const xRatio = divideIndexByAmountOfLines === Infinity ? 0 : divideIndexByAmountOfLines;
        return Math.round(containerSize.axisXLabelWidth +
            (containerSize.svgWidth - containerSize.axisXLabelWidth) * xRatio -
            halfCategoryWidth);
    }
    checkAxisOptions(options = {}) {
        this.gridLines =
            options.gridLines && this.isValidGridLinesLengthOption(options.gridLines) ? options.gridLines : PoChartGridLines;
    }
    cleanUpCoordinates() {
        this.axisXCoordinates = [];
        this.axisYCoordinates = [];
        this.axisXLabelCoordinates = [];
        this.axisYLabelCoordinates = [];
        this.seriesLength = 0;
    }
    getAxisXCoordinates(containerSize, amountOfAxisY, type, index) {
        return this.alignByTheCorners
            ? this.calculateAxisYCoordinateX(containerSize, amountOfAxisY, index)
            : this.centeredInCategoryArea(containerSize, amountOfAxisY, type, index);
    }
    getCategoriesRangeForMouseMove(amountOfAxisY, containerSize) {
        const categoriesCoordinates = [...Array(amountOfAxisY)].map((_, index) => this.calculateAxisYCoordinateX(containerSize, amountOfAxisY, index, true));
        this.categoriesCoordinates.emit(categoriesCoordinates);
    }
    isValidGridLinesLengthOption(gridLines) {
        return gridLines >= 2 && gridLines <= 10;
    }
    getAxisXLabels(type, minMaxAxisValues, amountOfAxisX) {
        if (type === PoChartType.Bar) {
            const axisXLabelsList = this.formatCategoriesLabels(amountOfAxisX, this.categories);
            return axisXLabelsList.reverse();
        }
        return this.generateAverageOfLabels(minMaxAxisValues, amountOfAxisX);
    }
    getAxisYLabels(type, minMaxAxisValues, amountOfAxisX) {
        return type === PoChartType.Bar
            ? this.generateAverageOfLabels(minMaxAxisValues, amountOfAxisX)
            : this.formatCategoriesLabels(amountOfAxisX, this.categories);
    }
    formatCategoriesLabels(amountOfAxisX, categories = []) {
        return [...Array(amountOfAxisX)].map((_, index) => categories[index] ?? '-');
    }
    generateAverageOfLabels(minMaxAxisValues, amountOfAxisLines) {
        const averageLabelsList = this.mathsService.range(minMaxAxisValues, amountOfAxisLines);
        return averageLabelsList.map(label => {
            const formattedDigit = label.toFixed(label % 1 && 2);
            // Remove dígitos com zero.
            // Também trata caso quando o valor retornado era -0, substituindo-o por 0.
            const removeZeroDigits = formattedDigit.replace(/\.00$/, '').replace(/\-0$/, 0);
            return removeZeroDigits.toString();
        });
    }
    static ɵfac = function PoChartAxisComponent_Factory(t) { return new (t || PoChartAxisComponent)(i0.ɵɵdirectiveInject(i1.PoChartMathsService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoChartAxisComponent, selectors: [["", "po-chart-axis", ""]], inputs: { alignByTheCorners: [i0.ɵɵInputFlags.None, "p-align-by-the-corners", "alignByTheCorners"], type: [i0.ɵɵInputFlags.None, "p-type", "type"], range: [i0.ɵɵInputFlags.None, "p-range", "range"], series: [i0.ɵɵInputFlags.None, "p-series", "series"], categories: [i0.ɵɵInputFlags.None, "p-categories", "categories"], containerSize: [i0.ɵɵInputFlags.None, "p-container-size", "containerSize"], axisOptions: [i0.ɵɵInputFlags.None, "p-options", "axisOptions"] }, outputs: { categoriesCoordinates: "p-categories-coordinates" }, attrs: _c0, decls: 2, vars: 6, consts: [["po-chart-axis-path", "", 3, "p-axis-x-coordinates", "p-axis-y-coordinates"], ["po-chart-axis-label", "", 3, "p-align-by-the-corners", "p-axis-x-label-coordinates", "p-axis-y-label-coordinates", "p-type"]], template: function PoChartAxisComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵnamespaceSVG();
            i0.ɵɵelement(0, "g", 0)(1, "g", 1);
        } if (rf & 2) {
            i0.ɵɵproperty("p-axis-x-coordinates", ctx.axisXCoordinates)("p-axis-y-coordinates", ctx.axisYCoordinates);
            i0.ɵɵadvance();
            i0.ɵɵproperty("p-align-by-the-corners", ctx.alignByTheCorners)("p-axis-x-label-coordinates", ctx.axisXLabelCoordinates)("p-axis-y-label-coordinates", ctx.axisYLabelCoordinates)("p-type", ctx.type);
        } }, dependencies: [i2.PoChartAxisPathComponent, i3.PoChartAxisLabelComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoChartAxisComponent, [{
        type: Component,
        args: [{ selector: '[po-chart-axis]', template: "<svg:g po-chart-axis-path [p-axis-x-coordinates]=\"axisXCoordinates\" [p-axis-y-coordinates]=\"axisYCoordinates\"></svg:g>\n\n<svg:g po-chart-axis-label \n  [p-align-by-the-corners]=\"alignByTheCorners\" \n  [p-axis-x-label-coordinates]=\"axisXLabelCoordinates\" \n  [p-axis-y-label-coordinates]=\"axisYLabelCoordinates\" \n  [p-type]=\"type\"\n  >\n</svg:g>" }]
    }], () => [{ type: i1.PoChartMathsService }], { alignByTheCorners: [{
            type: Input,
            args: ['p-align-by-the-corners']
        }], type: [{
            type: Input,
            args: ['p-type']
        }], range: [{
            type: Input,
            args: ['p-range']
        }], categoriesCoordinates: [{
            type: Output,
            args: ['p-categories-coordinates']
        }], series: [{
            type: Input,
            args: ['p-series']
        }], categories: [{
            type: Input,
            args: ['p-categories']
        }], containerSize: [{
            type: Input,
            args: ['p-container-size']
        }], axisOptions: [{
            type: Input,
            args: ['p-options']
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoChartAxisComponent, { className: "PoChartAxisComponent", filePath: "lib/components/po-chart/po-chart-container/po-chart-axis/po-chart-axis.component.ts", lineNumber: 21 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtYXhpcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtY29udGFpbmVyL3BvLWNoYXJ0LWF4aXMvcG8tY2hhcnQtYXhpcy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtY29udGFpbmVyL3BvLWNoYXJ0LWF4aXMvcG8tY2hhcnQtYXhpcy5jb21wb25lbnQuc3ZnIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkUsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixjQUFjLEVBQ2QseUJBQXlCLEVBQzFCLE1BQU0sZ0RBQWdELENBQUM7QUFReEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDOzs7Ozs7QUFNN0QsTUFBTSxPQUFPLG9CQUFvQjtJQXNGWDtJQXJGYSxpQkFBaUIsR0FBWSxLQUFLLENBQUM7SUFFbkQsSUFBSSxDQUFjO0lBRWpCLEtBQUssQ0FBc0I7SUFFVCxxQkFBcUIsR0FBZ0MsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQUU1RyxnQkFBZ0IsQ0FBZ0M7SUFDaEQscUJBQXFCLENBQWlDO0lBQ3RELGdCQUFnQixDQUFnQztJQUNoRCxxQkFBcUIsQ0FBaUM7SUFFOUMsV0FBVyxHQUFrQixFQUFFLENBQUM7SUFDaEMsV0FBVyxHQUFrQixFQUFFLENBQUM7SUFDaEMsU0FBUyxHQUFXLGdCQUFnQixDQUFDO0lBQ3JDLFlBQVksR0FBVyxDQUFDLENBQUM7SUFFekIsWUFBWSxDQUFxQjtJQUNqQyxXQUFXLEdBQWtCLEVBQUUsQ0FBQztJQUNo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eURBQUEseURBQUEsb0JBQUE7OztpRkRpQmpDLG9CQUFvQjtjQUpoQyxTQUFTOzJCQUNFLGlCQUFpQjtvREFJTSxpQkFBaUI7a0JBQWpELEtBQUs7bUJBQUMsd0JBQXdCO1lBRWQsSUFBSTtrQkFBcEIsS0FBSzttQkFBQyxRQUFRO1lBRUcsS0FBSztrQkFBdEIsS0FBSzttQkFBQyxTQUFTO1lBRW9CLHFCQUFxQjtrQkFBeEQsTUFBTTttQkFBQywwQkFBMEI7WUFpQlgsTUFBTTtrQkFBNUIsS0FBSzttQkFBQyxVQUFVO1lBb0JVLFVBQVU7a0JBQXBDLEtBQUs7bUJBQUMsY0FBYztZQWNVLGFBQWE7a0JBQTNDLEtBQUs7bUJBQUMsa0JBQWtCO1lBWUQsV0FBVztrQkFBbEMsS0FBSzttQkFBQyxXQUFXOztrRkF0RVAsb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgUG9DaGFydEdyaWRMaW5lcyxcbiAgUG9DaGFydFBhZGRpbmcsXG4gIFBvQ2hhcnRQbG90QXJlYVBhZGRpbmdUb3Bcbn0gZnJvbSAnLi4vLi4vaGVscGVycy9wby1jaGFydC1kZWZhdWx0LXZhbHVlcy5jb25zdGFudCc7XG5cbmltcG9ydCB7IFBvQ2hhcnRNYXRoc1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wby1jaGFydC1tYXRocy5zZXJ2aWNlJztcbmltcG9ydCB7IFBvQ2hhcnRDb250YWluZXJTaXplIH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9wby1jaGFydC1jb250YWluZXItc2l6ZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydE1pbk1heFZhbHVlcyB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtbWluLW1heC12YWx1ZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hhcnRQYXRoQ29vcmRpbmF0ZXMgfSBmcm9tICcuLi8uLi9pbnRlcmZhY2VzL3BvLWNoYXJ0LXBhdGgtY29vcmRpbmF0ZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hhcnRMYWJlbENvb3JkaW5hdGVzIH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9wby1jaGFydC1sYWJlbC1jb29yZGluYXRlcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydEF4aXNPcHRpb25zIH0gZnJvbSAnLi4vLi4vaW50ZXJmYWNlcy9wby1jaGFydC1heGlzLW9wdGlvbnMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hhcnRUeXBlIH0gZnJvbSAnLi4vLi4vZW51bXMvcG8tY2hhcnQtdHlwZS5lbnVtJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnW3BvLWNoYXJ0LWF4aXNdJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWNoYXJ0LWF4aXMuY29tcG9uZW50LnN2Zydcbn0pXG5leHBvcnQgY2xhc3MgUG9DaGFydEF4aXNDb21wb25lbnQge1xuICBASW5wdXQoJ3AtYWxpZ24tYnktdGhlLWNvcm5lcnMnKSBhbGlnbkJ5VGhlQ29ybmVyczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgncC10eXBlJykgdHlwZTogUG9DaGFydFR5cGU7XG5cbiAgQElucHV0KCdwLXJhbmdlJykgcmFuZ2U6IFBvQ2hhcnRNaW5NYXhWYWx1ZXM7XG5cbiAgQE91dHB1dCgncC1jYXRlZ29yaWVzLWNvb3JkaW5hdGVzJykgY2F0ZWdvcmllc0Nvb3JkaW5hdGVzOiBFdmVudEVtaXR0ZXI8QXJyYXk8bnVtYmVyPj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgYXhpc1hDb29yZGluYXRlczogQXJyYXk8UG9DaGFydFBhdGhDb29yZGluYXRlcz47XG4gIGF4aXNYTGFiZWxDb29yZGluYXRlczogQXJyYXk8UG9DaGFydExhYmVsQ29vcmRpbmF0ZXM+O1xuICBheGlzWUNvb3JkaW5hdGVzOiBBcnJheTxQb0NoYXJ0UGF0aENvb3JkaW5hdGVzPjtcbiAgYXhpc1lMYWJlbENvb3JkaW5hdGVzOiBBcnJheTxQb0NoYXJ0TGFiZWxDb29yZGluYXRlcz47XG5cbiAgcHJpdmF0ZSBheGlzWExhYmVsczogQXJyYXk8c3RyaW5nPiA9IFtdO1xuICBwcml2YXRlIGF4aXNZTGFiZWxzOiBBcnJheTxzdHJpbmc+ID0gW107XG4gIHByaXZhdGUgZ3JpZExpbmVzOiBudW1iZXIgPSBQb0NoYXJ0R3JpZExpbmVzO1xuICBwcml2YXRlIHNlcmllc0xlbmd0aDogbnVtYmVyID0gMDtcblxuICBwcml2YXRlIF9heGlzT3B0aW9uczogUG9DaGFydEF4aXNPcHRpb25zO1xuICBwcml2YXRlIF9jYXRlZ29yaWVzOiBBcnJheTxzdHJpbmc+ID0gW107XG4gIHByaXZhdGUgX2NvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplID0ge307XG4gIHByaXZhdGUgX3NlcmllczogQXJyYXk8YW55PiA9IFtdO1xuXG4gIEBJbnB1dCgncC1zZXJpZXMnKSBzZXQgc2VyaWVzKHNlcmllc0xpc3Q6IEFycmF5PGFueT4pIHtcbiAgICBjb25zdCBzZXJpZXNEYXRhQXJyYXlGaWx0ZXIgPSBzZXJpZXNMaXN0LmZpbHRlcihzZXJpZSA9PiBBcnJheS5pc0FycmF5KHNlcmllLmRhdGEpKTtcblxuICAgIGlmIChzZXJpZXNEYXRhQXJyYXlGaWx0ZXIubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9zZXJpZXMgPSBzZXJpZXNEYXRhQXJyYXlGaWx0ZXI7XG5cbiAgICAgIHRoaXMuc2VyaWVzTGVuZ3RoID0gdGhpcy5tYXRoc1NlcnZpY2Uuc2VyaWVzR3JlYXRlckxlbmd0aCh0aGlzLnNlcmllcyk7XG4gICAgICB0aGlzLmNoZWNrQXhpc09wdGlvbnModGhpcy5heGlzT3B0aW9ucyk7XG4gICAgICB0aGlzLnNldEF4aXNYQ29vcmRpbmF0ZXModGhpcy5ncmlkTGluZXMsIHRoaXMuc2VyaWVzTGVuZ3RoLCB0aGlzLmNvbnRhaW5lclNpemUsIHRoaXMucmFuZ2UsIHRoaXMudHlwZSk7XG4gICAgICB0aGlzLnNldEF4aXNZQ29vcmRpbmF0ZXModGhpcy5ncmlkTGluZXMsIHRoaXMuc2VyaWVzTGVuZ3RoLCB0aGlzLmNvbnRhaW5lclNpemUsIHRoaXMucmFuZ2UsIHRoaXMudHlwZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NlcmllcyA9IFtdO1xuICAgICAgdGhpcy5jbGVhblVwQ29vcmRpbmF0ZXMoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgc2VyaWVzKCkge1xuICAgIHJldHVybiB0aGlzLl9zZXJpZXM7XG4gIH1cblxuICBASW5wdXQoJ3AtY2F0ZWdvcmllcycpIHNldCBjYXRlZ29yaWVzKHZhbHVlOiBBcnJheTxzdHJpbmc+KSB7XG4gICAgdGhpcy5fY2F0ZWdvcmllcyA9IHZhbHVlO1xuXG4gICAgaWYgKHRoaXMudHlwZSA9PT0gUG9DaGFydFR5cGUuQmFyKSB7XG4gICAgICB0aGlzLnNldEF4aXNYQ29vcmRpbmF0ZXModGhpcy5ncmlkTGluZXMsIHRoaXMuc2VyaWVzTGVuZ3RoLCB0aGlzLmNvbnRhaW5lclNpemUsIHRoaXMucmFuZ2UsIHRoaXMudHlwZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0QXhpc1lDb29yZGluYXRlcyh0aGlzLmdyaWRMaW5lcywgdGhpcy5zZXJpZXNMZW5ndGgsIHRoaXMuY29udGFpbmVyU2l6ZSwgdGhpcy5yYW5nZSwgdGhpcy50eXBlKTtcbiAgICB9XG4gIH1cblxuICBnZXQgY2F0ZWdvcmllcygpIHtcbiAgICByZXR1cm4gdGhpcy5fY2F0ZWdvcmllcztcbiAgfVxuXG4gIEBJbnB1dCgncC1jb250YWluZXItc2l6ZScpIHNldCBjb250YWluZXJTaXplKHZhbHVlOiBQb0NoYXJ0Q29udGFpbmVyU2l6ZSkge1xuICAgIHRoaXMuX2NvbnRhaW5lclNpemUgPSB2YWx1ZTtcblxuICAgIHRoaXMuY2hlY2tBeGlzT3B0aW9ucyh0aGlzLmF4aXNPcHRpb25zKTtcbiAgICB0aGlzLnNldEF4aXNYQ29vcmRpbmF0ZXModGhpcy5ncmlkTGluZXMsIHRoaXMuc2VyaWVzTGVuZ3RoLCB0aGlzLl9jb250YWluZXJTaXplLCB0aGlzLnJhbmdlLCB0aGlzLnR5cGUpO1xuICAgIHRoaXMuc2V0QXhpc1lDb29yZGluYXRlcyh0aGlzLmdyaWRMaW5lcywgdGhpcy5zZXJpZXNMZW5ndGgsIHRoaXMuX2NvbnRhaW5lclNpemUsIHRoaXMucmFuZ2UsIHRoaXMudHlwZSk7XG4gIH1cblxuICBnZXQgY29udGFpbmVyU2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyU2l6ZTtcbiAgfVxuXG4gIEBJbnB1dCgncC1vcHRpb25zJykgc2V0IGF4aXNPcHRpb25zKHZhbHVlOiBQb0NoYXJ0QXhpc09wdGlvbnMpIHtcbiAgICB0aGlzLl9heGlzT3B0aW9ucyA9IHZhbHVlO1xuXG4gICAgdGhpcy5jaGVja0F4aXNPcHRpb25zKHRoaXMuX2F4aXNPcHRpb25zKTtcblxuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkJhcikge1xuICAgICAgdGhpcy5zZXRBeGlzWUNvb3JkaW5hdGVzKHRoaXMuZ3JpZExpbmVzLCB0aGlzLnNlcmllc0xlbmd0aCwgdGhpcy5jb250YWluZXJTaXplLCB0aGlzLnJhbmdlLCB0aGlzLnR5cGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldEF4aXNYQ29vcmRpbmF0ZXModGhpcy5ncmlkTGluZXMsIHRoaXMuc2VyaWVzTGVuZ3RoLCB0aGlzLmNvbnRhaW5lclNpemUsIHRoaXMucmFuZ2UsIHRoaXMudHlwZSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGF4aXNPcHRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9heGlzT3B0aW9ucztcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbWF0aHNTZXJ2aWNlOiBQb0NoYXJ0TWF0aHNTZXJ2aWNlKSB7fVxuXG4gIHByaXZhdGUgc2V0QXhpc1hDb29yZGluYXRlcyhcbiAgICBncmlkTGluZXM6IG51bWJlcixcbiAgICBzZXJpZXNMZW5ndGg6IG51bWJlcixcbiAgICBjb250YWluZXJTaXplOiBQb0NoYXJ0Q29udGFpbmVyU2l6ZSxcbiAgICBtaW5NYXhBeGlzVmFsdWVzOiBQb0NoYXJ0TWluTWF4VmFsdWVzLFxuICAgIHR5cGU6IFBvQ2hhcnRUeXBlXG4gICkge1xuICAgIGlmIChzZXJpZXNMZW5ndGgpIHtcbiAgICAgIGNvbnN0IGFtb3VudE9mQXhpc0xhYmVscyA9IHR5cGUgPT09IFBvQ2hhcnRUeXBlLkJhciA/IHNlcmllc0xlbmd0aCA6IGdyaWRMaW5lcztcbiAgICAgIHRoaXMuY2FsY3VsYXRlQXhpc1hMYWJlbENvb3JkaW5hdGVzKGFtb3VudE9mQXhpc0xhYmVscywgY29udGFpbmVyU2l6ZSwgbWluTWF4QXhpc1ZhbHVlcywgdHlwZSk7XG4gICAgfVxuXG4gICAgY29uc3QgYW1vdW50T2ZBeGlzWExpbmVzID0gdGhpcy5hbW91bnRPZkF4aXNYTGluZXMoc2VyaWVzTGVuZ3RoLCBncmlkTGluZXMsIHR5cGUpO1xuICAgIHRoaXMuY2FsY3VsYXRlQXhpc1hDb29yZGluYXRlcyhhbW91bnRPZkF4aXNYTGluZXMsIGNvbnRhaW5lclNpemUsIG1pbk1heEF4aXNWYWx1ZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBhbW91bnRPZkF4aXNYTGluZXMoc2VyaWVzTGVuZ3RoOiBudW1iZXIsIGdyaWRMaW5lczogbnVtYmVyLCB0eXBlOiBQb0NoYXJ0VHlwZSk6IG51bWJlciB7XG4gICAgaWYgKHR5cGUgPT09IFBvQ2hhcnRUeXBlLkJhcikge1xuICAgICAgcmV0dXJuIHNlcmllc0xlbmd0aCA8PSAxID8gMiA6IHNlcmllc0xlbmd0aCArIDE7XG4gICAgfVxuICAgIHJldHVybiBncmlkTGluZXMgPT09IDAgPyAxIDogZ3JpZExpbmVzO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRBeGlzWUNvb3JkaW5hdGVzKFxuICAgIGdyaWRMaW5lczogbnVtYmVyLFxuICAgIHNlcmllc0xlbmd0aDogbnVtYmVyLFxuICAgIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplLFxuICAgIG1pbk1heEF4aXNWYWx1ZXM6IFBvQ2hhcnRNaW5NYXhWYWx1ZXMsXG4gICAgdHlwZTogUG9DaGFydFR5cGVcbiAgKSB7XG4gICAgY29uc3QgYW1vdW50T2ZBeGlzWSA9IHR5cGUgPT09IFBvQ2hhcnRUeXBlLkJhciA/IGdyaWRMaW5lcyA6IHNlcmllc0xlbmd0aDtcblxuICAgIGlmIChzZXJpZXNMZW5ndGgpIHtcbiAgICAgIHRoaXMuY2FsY3VsYXRlQXhpc1lMYWJlbENvb3JkaW5hdGVzKGFtb3VudE9mQXhpc1ksIGNvbnRhaW5lclNpemUsIG1pbk1heEF4aXNWYWx1ZXMsIHR5cGUpO1xuICAgIH1cblxuICAgIGlmICh0eXBlID09PSBQb0NoYXJ0VHlwZS5BcmVhKSB7XG4gICAgICB0aGlzLmdldENhdGVnb3JpZXNSYW5nZUZvck1vdXNlTW92ZShhbW91bnRPZkF4aXNZLCBjb250YWluZXJTaXplKTtcbiAgICB9XG5cbiAgICB0aGlzLmNhbGN1bGF0ZUF4aXNZQ29vcmRpbmF0ZXMoYW1vdW50T2ZBeGlzWSwgY29udGFpbmVyU2l6ZSwgdHlwZSwgbWluTWF4QXhpc1ZhbHVlcyk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUF4aXNYQ29vcmRpbmF0ZXMoXG4gICAgYW1vdW50T2ZBeGlzWDogbnVtYmVyLFxuICAgIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplLFxuICAgIHJhbmdlOiBQb0NoYXJ0TWluTWF4VmFsdWVzXG4gICkge1xuICAgIGNvbnN0IHN0YXJ0WCA9IGNvbnRhaW5lclNpemUuYXhpc1hMYWJlbFdpZHRoO1xuICAgIGNvbnN0IGVuZFggPSBjb250YWluZXJTaXplLnN2Z1dpZHRoO1xuXG4gICAgbGV0IGNvb3JkaW5hdGVzUmVmZXJlZFRvWmVybztcbiAgICBsZXQgY29vcmRpbmF0ZXNMaXN0ID0gWy4uLkFycmF5KGFtb3VudE9mQXhpc1gpXS5tYXAoKF8sIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IHlDb29yZGluYXRlID0gdGhpcy5jYWxjdWxhdGVBeGlzWENvb3JkaW5hdGVZKGFtb3VudE9mQXhpc1gsIGNvbnRhaW5lclNpemUsIGluZGV4KTtcbiAgICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gYE0ke3N0YXJ0WH0gJHt5Q29vcmRpbmF0ZX0gTCR7ZW5kWH0sICR7eUNvb3JkaW5hdGV9YDtcblxuICAgICAgcmV0dXJuIHsgY29vcmRpbmF0ZXMgfTtcbiAgICB9KTtcblxuICAgIC8vIEF2YWxpYSBhIG5lY2Vzc2lkYWRlIGRlIGFkaWNpb25hciBhIGxpbmhhIHJlZmVyZW50ZSBhbyB2YWxvciB6ZXJvIGVtIGdyw6FmaWNvcyBkbyB0aXBvIGBjb2x1bW5gLCBgYXJlYWAgZSBgbGluZWAuXG4gICAgaWYgKHRoaXMudHlwZSAhPT0gUG9DaGFydFR5cGUuQmFyICYmIHJhbmdlLm1pblZhbHVlIDwgMCAmJiAhdGhpcy5heGlzWExhYmVscy5pbmNsdWRlcygnMCcpKSB7XG4gICAgICBjb29yZGluYXRlc1JlZmVyZWRUb1plcm8gPSB0aGlzLmdldENvb3JkaW5hdGVzUmVsYXRlZFRvWmVybyhjb250YWluZXJTaXplLCByYW5nZSwgc3RhcnRYLCBlbmRYKTtcbiAgICAgIGNvb3JkaW5hdGVzTGlzdCA9IFsuLi5jb29yZGluYXRlc0xpc3QsIGNvb3JkaW5hdGVzUmVmZXJlZFRvWmVyb107XG4gICAgfVxuXG4gICAgdGhpcy5heGlzWENvb3JkaW5hdGVzID0gY29vcmRpbmF0ZXNMaXN0O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb29yZGluYXRlc1JlbGF0ZWRUb1plcm8oXG4gICAgY29udGFpbmVyU2l6ZTogUG9DaGFydENvbnRhaW5lclNpemUsXG4gICAgcmFuZ2U6IFBvQ2hhcnRNaW5NYXhWYWx1ZXMsXG4gICAgc3RhcnQ6IG51bWJlcixcbiAgICBlbmQ6IG51bWJlcixcbiAgICBpc0F4aXNZOiBib29sZWFuID0gZmFsc2VcbiAgKSB7XG4gICAgY29uc3QgdHlwZSA9IGlzQXhpc1kgPyBQb0NoYXJ0VHlwZS5CYXIgOiBQb0NoYXJ0VHlwZS5Db2x1bW47XG4gICAgY29uc3QgYmFzZVBvc2l0aW9uID0gdGhpcy5heGlzQ29vcmRpbmF0ZXNGb3JWYWx1ZVplcm8ocmFuZ2UsIDAsIGNvbnRhaW5lclNpemUsIGlzQXhpc1kpO1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0ge1xuICAgICAgY29sdW1uOiB7XG4gICAgICAgIHN0YXJ0WDogc3RhcnQsXG4gICAgICAgIGVuZFg6IGVuZCxcbiAgICAgICAgc3RhcnRZOiBiYXNlUG9zaXRpb24sXG4gICAgICAgIGVuZFk6IGJhc2VQb3NpdGlvblxuICAgICAgfSxcbiAgICAgIGJhcjoge1xuICAgICAgICBzdGFydFg6IGJhc2VQb3NpdGlvbixcbiAgICAgICAgZW5kWDogYmFzZVBvc2l0aW9uLFxuICAgICAgICBzdGFydFk6IHN0YXJ0LFxuICAgICAgICBlbmRZOiBlbmRcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvb3JkaW5hdGVzOiBgTSR7Y29vcmRpbmF0ZXNbdHlwZV0uc3RhcnRYfSAke2Nvb3JkaW5hdGVzW3R5cGVdLnN0YXJ0WX0gTCR7Y29vcmRpbmF0ZXNbdHlwZV0uZW5kWH0gJHtjb29yZGluYXRlc1t0eXBlXS5lbmRZfWBcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBheGlzQ29vcmRpbmF0ZXNGb3JWYWx1ZVplcm8oXG4gICAgcmFuZ2U6IFBvQ2hhcnRNaW5NYXhWYWx1ZXMsXG4gICAgZGF0YTogbnVtYmVyLFxuICAgIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplLFxuICAgIGlzQXhpc1k6IGJvb2xlYW5cbiAgKSB7XG4gICAgY29uc3QgeyBheGlzWExhYmVsV2lkdGgsIHN2Z1dpZHRoLCBzdmdQbG90dGluZ0FyZWFIZWlnaHQgfSA9IGNvbnRhaW5lclNpemU7XG4gICAgY29uc3QgcmF0aW8gPSB0aGlzLm1hdGhzU2VydmljZS5nZXRTZXJpZVBlcmNlbnRhZ2UocmFuZ2UsIGRhdGEpO1xuXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoXG4gICAgICBpc0F4aXNZXG4gICAgICAgID8gYXhpc1hMYWJlbFdpZHRoICsgKHN2Z1dpZHRoIC0gYXhpc1hMYWJlbFdpZHRoKSAqIHJhdGlvXG4gICAgICAgIDogc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0IC0gc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0ICogcmF0aW8gKyBQb0NoYXJ0UGxvdEFyZWFQYWRkaW5nVG9wXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQXhpc1hMYWJlbENvb3JkaW5hdGVzKFxuICAgIGFtb3VudE9mQXhpc1g6IG51bWJlcixcbiAgICBjb250YWluZXJTaXplOiBQb0NoYXJ0Q29udGFpbmVyU2l6ZSxcbiAgICBtaW5NYXhBeGlzVmFsdWVzOiBQb0NoYXJ0TWluTWF4VmFsdWVzLFxuICAgIHR5cGU6IFBvQ2hhcnRUeXBlXG4gICkge1xuICAgIHRoaXMuYXhpc1hMYWJlbHMgPSB0aGlzLmdldEF4aXNYTGFiZWxzKHR5cGUsIG1pbk1heEF4aXNWYWx1ZXMsIGFtb3VudE9mQXhpc1gpO1xuXG4gICAgdGhpcy5heGlzWExhYmVsQ29vcmRpbmF0ZXMgPSBbLi4uQXJyYXkoYW1vdW50T2ZBeGlzWCldLm1hcCgoXywgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmF4aXNYTGFiZWxzW2luZGV4XTtcbiAgICAgIGNvbnN0IHhDb29yZGluYXRlID0gdGhpcy5jYWxjdWxhdGVBeGlzWExhYmVsWENvb3JkaW5hdGUoY29udGFpbmVyU2l6ZS5heGlzWExhYmVsV2lkdGgpO1xuICAgICAgY29uc3QgeUNvb3JkaW5hdGUgPSB0aGlzLmNhbGN1bGF0ZUF4aXNYTGFiZWxZQ29vcmRpbmF0ZShhbW91bnRPZkF4aXNYLCBjb250YWluZXJTaXplLCB0eXBlLCBpbmRleCk7XG5cbiAgICAgIHJldHVybiB7IGxhYmVsLCB4Q29vcmRpbmF0ZSwgeUNvb3JkaW5hdGUgfTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQXhpc1lDb29yZGluYXRlcyhcbiAgICBhbW91bnRPZkF4aXNZOiBudW1iZXIsXG4gICAgY29udGFpbmVyU2l6ZTogUG9DaGFydENvbnRhaW5lclNpemUsXG4gICAgdHlwZTogUG9DaGFydFR5cGUsXG4gICAgcmFuZ2U6IFBvQ2hhcnRNaW5NYXhWYWx1ZXNcbiAgKSB7XG4gICAgY29uc3Qgc3RhcnRZID0gUG9DaGFydFBsb3RBcmVhUGFkZGluZ1RvcDtcbiAgICBjb25zdCBlbmRZID0gY29udGFpbmVyU2l6ZS5zdmdQbG90dGluZ0FyZWFIZWlnaHQgKyBQb0NoYXJ0UGxvdEFyZWFQYWRkaW5nVG9wO1xuXG4gICAgLy8gdHJhdGFtZW50byBuZWNlc3PDoXJpbyBwYXJhIGNyaWFyIHVtYSBsaW5oYSBhIG1haXMgcGFyYSBmZWNoYXIgbyBncsOhZmljb1xuICAgIGNvbnN0IGxlbmd0aCA9IGFtb3VudE9mQXhpc1kgPT09IDAgfHwgdHlwZSA9PT0gUG9DaGFydFR5cGUuQmFyID8gYW1vdW50T2ZBeGlzWSA6IGFtb3VudE9mQXhpc1kgKyAxO1xuXG4gICAgbGV0IGNvb3JkaW5hdGVzUmVmZXJlZFRvWmVybztcbiAgICBsZXQgY29vcmRpbmF0ZXNMaXN0ID0gWy4uLkFycmF5KGxlbmd0aCldLm1hcCgoXywgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgY29uc3QgeENvb3JkaW5hdGUgPSB0aGlzLmNhbGN1bGF0ZUF4aXNZQ29vcmRpbmF0ZVgoY29udGFpbmVyU2l6ZSwgYW1vdW50T2ZBeGlzWSwgaW5kZXgpO1xuICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSBgTSR7eENvb3JkaW5hdGV9ICR7c3RhcnRZfSBMJHt4Q29vcmRpbmF0ZX0sICR7ZW5kWX1gO1xuXG4gICAgICByZXR1cm4geyBjb29yZGluYXRlcyB9O1xuICAgIH0pO1xuXG4gICAgLy8gQXZhbGlhIGEgbmVjZXNzaWRhZGUgZGUgYWRpY2lvbmFyIGEgbGluaGEgcmVmZXJlbnRlIGFvIHZhbG9yIHplcm8gZW0gZ3LDoWZpY29zIGRvIHRpcG8gYGJhcmAuXG4gICAgaWYgKHR5cGUgPT09IFBvQ2hhcnRUeXBlLkJhciAmJiByYW5nZS5taW5WYWx1ZSA8IDAgJiYgIXRoaXMuYXhpc1lMYWJlbHMuaW5jbHVkZXMoJzAnKSkge1xuICAgICAgY29vcmRpbmF0ZXNSZWZlcmVkVG9aZXJvID0gdGhpcy5nZXRDb29yZGluYXRlc1JlbGF0ZWRUb1plcm8oY29udGFpbmVyU2l6ZSwgcmFuZ2UsIHN0YXJ0WSwgZW5kWSwgdHJ1ZSk7XG4gICAgICBjb29yZGluYXRlc0xpc3QgPSBbLi4uY29vcmRpbmF0ZXNMaXN0LCBjb29yZGluYXRlc1JlZmVyZWRUb1plcm9dO1xuICAgIH1cblxuICAgIHRoaXMuYXhpc1lDb29yZGluYXRlcyA9IFsuLi5jb29yZGluYXRlc0xpc3RdO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVBeGlzWUxhYmVsQ29vcmRpbmF0ZXMoXG4gICAgYW1vdW50T2ZBeGlzWTogbnVtYmVyLFxuICAgIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplLFxuICAgIG1pbk1heEF4aXNWYWx1ZXM6IFBvQ2hhcnRNaW5NYXhWYWx1ZXMsXG4gICAgdHlwZTogUG9DaGFydFR5cGVcbiAgKSB7XG4gICAgdGhpcy5heGlzWUxhYmVscyA9IHRoaXMuZ2V0QXhpc1lMYWJlbHModHlwZSwgbWluTWF4QXhpc1ZhbHVlcywgYW1vdW50T2ZBeGlzWSk7XG5cbiAgICB0aGlzLmF4aXNZTGFiZWxDb29yZGluYXRlcyA9IFsuLi5BcnJheShhbW91bnRPZkF4aXNZKV0ubWFwKChfLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBsYWJlbCA9IHRoaXMuYXhpc1lMYWJlbHNbaW5kZXhdO1xuXG4gICAgICBjb25zdCB4Q29vcmRpbmF0ZSA9IHRoaXMuZ2V0QXhpc1hDb29yZGluYXRlcyhjb250YWluZXJTaXplLCBhbW91bnRPZkF4aXNZLCB0eXBlLCBpbmRleCk7XG4gICAgICBjb25zdCB5Q29vcmRpbmF0ZSA9IHRoaXMuY2FsY3VsYXRlQXhpc1lMYWJlbFlDb29yZGluYXRlKGNvbnRhaW5lclNpemUpO1xuXG4gICAgICByZXR1cm4geyBsYWJlbCwgeENvb3JkaW5hdGUsIHlDb29yZGluYXRlIH07XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUF4aXNYTGFiZWxYQ29vcmRpbmF0ZShheGlzWExhYmVsV2lkdGg6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgbGFiZWxQb0NoYXJ0UGFkZGluZyA9IFBvQ2hhcnRQYWRkaW5nIC8gMztcblxuICAgIHJldHVybiBheGlzWExhYmVsV2lkdGggLSBsYWJlbFBvQ2hhcnRQYWRkaW5nO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVBeGlzWExhYmVsWUNvb3JkaW5hdGUoXG4gICAgYW1vdW50T2ZBeGlzWDogbnVtYmVyLFxuICAgIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplLFxuICAgIHR5cGU6IFBvQ2hhcnRUeXBlLFxuICAgIGluZGV4OiBudW1iZXJcbiAgKTogbnVtYmVyIHtcbiAgICBjb25zdCBhbW91bnRPZkxpbmVzID0gdHlwZSA9PT0gUG9DaGFydFR5cGUuQmFyID8gYW1vdW50T2ZBeGlzWCA6IGFtb3VudE9mQXhpc1ggLSAxO1xuICAgIGNvbnN0IHlSYXRpbyA9IGluZGV4IC8gYW1vdW50T2ZMaW5lcztcblxuICAgIGlmICh0eXBlICE9PSBQb0NoYXJ0VHlwZS5CYXIpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGNvbnRhaW5lclNpemUuc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0IC0gY29udGFpbmVyU2l6ZS5zdmdQbG90dGluZ0FyZWFIZWlnaHQgKiB5UmF0aW8gKyBQb0NoYXJ0UGxvdEFyZWFQYWRkaW5nVG9wXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGhhbGZDYXRlZ29yeUhlaWdodCA9IGNvbnRhaW5lclNpemUuc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0IC8gYW1vdW50T2ZBeGlzWCAvIDI7XG4gICAgcmV0dXJuIChcbiAgICAgIGNvbnRhaW5lclNpemUuc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0IC1cbiAgICAgIGhhbGZDYXRlZ29yeUhlaWdodCAtXG4gICAgICBjb250YWluZXJTaXplLnN2Z1Bsb3R0aW5nQXJlYUhlaWdodCAqIHlSYXRpbyArXG4gICAgICBQb0NoYXJ0UGxvdEFyZWFQYWRkaW5nVG9wXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQXhpc1hDb29yZGluYXRlWShhbW91bnRPZkF4aXNYOiBudW1iZXIsIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplLCBpbmRleDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCB5UmF0aW8gPSBpbmRleCAvIChhbW91bnRPZkF4aXNYIC0gMSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgY29udGFpbmVyU2l6ZS5zdmdQbG90dGluZ0FyZWFIZWlnaHQgLSBjb250YWluZXJTaXplLnN2Z1Bsb3R0aW5nQXJlYUhlaWdodCAqIHlSYXRpbyArIFBvQ2hhcnRQbG90QXJlYVBhZGRpbmdUb3BcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVBeGlzWUxhYmVsWUNvb3JkaW5hdGUoY29udGFpbmVyU2l6ZTogUG9DaGFydENvbnRhaW5lclNpemUpOiBudW1iZXIge1xuICAgIGNvbnN0IHRleHRQb0NoYXJ0UGFkZGluZyA9IFBvQ2hhcnRQYWRkaW5nIC8gMztcblxuICAgIHJldHVybiBjb250YWluZXJTaXplLnN2Z0hlaWdodCAtIHRleHRQb0NoYXJ0UGFkZGluZztcbiAgfVxuXG4gIHByaXZhdGUgY2VudGVyZWRJbkNhdGVnb3J5QXJlYShcbiAgICBjb250YWluZXJTaXplOiBQb0NoYXJ0Q29udGFpbmVyU2l6ZSxcbiAgICBhbW91bnRPZkF4aXNZOiBudW1iZXIsXG4gICAgdHlwZTogUG9DaGFydFR5cGUsXG4gICAgaW5kZXg6IG51bWJlclxuICApOiBudW1iZXIge1xuICAgIGNvbnN0IGFtb3VudE9mTGluZXMgPSB0eXBlID09PSBQb0NoYXJ0VHlwZS5CYXIgPyBhbW91bnRPZkF4aXNZIC0gMSA6IGFtb3VudE9mQXhpc1k7XG4gICAgY29uc3QgeFJhdGlvID0gaW5kZXggLyBhbW91bnRPZkxpbmVzO1xuXG4gICAgaWYgKHR5cGUgPT09IFBvQ2hhcnRUeXBlLkJhcikge1xuICAgICAgcmV0dXJuIE1hdGgucm91bmQoXG4gICAgICAgIGNvbnRhaW5lclNpemUuYXhpc1hMYWJlbFdpZHRoICsgKGNvbnRhaW5lclNpemUuc3ZnV2lkdGggLSBjb250YWluZXJTaXplLmF4aXNYTGFiZWxXaWR0aCkgKiB4UmF0aW9cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgaGFsZkNhdGVnb3J5V2lkdGggPSAoY29udGFpbmVyU2l6ZS5zdmdXaWR0aCAtIGNvbnRhaW5lclNpemUuYXhpc1hMYWJlbFdpZHRoKSAvIGFtb3VudE9mQXhpc1kgLyAyO1xuICAgIHJldHVybiBNYXRoLnJvdW5kKFxuICAgICAgY29udGFpbmVyU2l6ZS5heGlzWExhYmVsV2lkdGggK1xuICAgICAgICBoYWxmQ2F0ZWdvcnlXaWR0aCArXG4gICAgICAgIChjb250YWluZXJTaXplLnN2Z1dpZHRoIC0gY29udGFpbmVyU2l6ZS5heGlzWExhYmVsV2lkdGgpICogeFJhdGlvXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQXhpc1lDb29yZGluYXRlWChcbiAgICBjb250YWluZXJTaXplOiBQb0NoYXJ0Q29udGFpbmVyU2l6ZSxcbiAgICBhbW91bnRPZkF4aXNZOiBudW1iZXIsXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICBzdWJ0cmFjdENhdGVnb3J5V2lkdGg6IGJvb2xlYW4gPSBmYWxzZVxuICApOiBudW1iZXIge1xuICAgIGNvbnN0IGFtb3VudE9mTGluZXMgPSB0aGlzLmFsaWduQnlUaGVDb3JuZXJzID8gYW1vdW50T2ZBeGlzWSAtIDEgOiBhbW91bnRPZkF4aXNZO1xuICAgIGNvbnN0IGhhbGZDYXRlZ29yeVdpZHRoID1cbiAgICAgIHRoaXMuYWxpZ25CeVRoZUNvcm5lcnMgJiYgc3VidHJhY3RDYXRlZ29yeVdpZHRoXG4gICAgICAgID8gKGNvbnRhaW5lclNpemUuc3ZnV2lkdGggLSBjb250YWluZXJTaXplLmF4aXNYTGFiZWxXaWR0aCkgLyAoYW1vdW50T2ZBeGlzWSAtIDEpIC8gMlxuICAgICAgICA6IDA7XG4gICAgY29uc3QgZGl2aWRlSW5kZXhCeUFtb3VudE9mTGluZXMgPSBpbmRleCAvIGFtb3VudE9mTGluZXM7XG4gICAgY29uc3QgeFJhdGlvID0gZGl2aWRlSW5kZXhCeUFtb3VudE9mTGluZXMgPT09IEluZmluaXR5ID8gMCA6IGRpdmlkZUluZGV4QnlBbW91bnRPZkxpbmVzO1xuXG4gICAgcmV0dXJuIE1hdGgucm91bmQoXG4gICAgICBjb250YWluZXJTaXplLmF4aXNYTGFiZWxXaWR0aCArXG4gICAgICAgIChjb250YWluZXJTaXplLnN2Z1dpZHRoIC0gY29udGFpbmVyU2l6ZS5heGlzWExhYmVsV2lkdGgpICogeFJhdGlvIC1cbiAgICAgICAgaGFsZkNhdGVnb3J5V2lkdGhcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0F4aXNPcHRpb25zKG9wdGlvbnM6IFBvQ2hhcnRBeGlzT3B0aW9ucyA9IHt9KTogdm9pZCB7XG4gICAgdGhpcy5ncmlkTGluZXMgPVxuICAgICAgb3B0aW9ucy5ncmlkTGluZXMgJiYgdGhpcy5pc1ZhbGlkR3JpZExpbmVzTGVuZ3RoT3B0aW9uKG9wdGlvbnMuZ3JpZExpbmVzKSA/IG9wdGlvbnMuZ3JpZExpbmVzIDogUG9DaGFydEdyaWRMaW5lcztcbiAgfVxuXG4gIHByaXZhdGUgY2xlYW5VcENvb3JkaW5hdGVzKCkge1xuICAgIHRoaXMuYXhpc1hDb29yZGluYXRlcyA9IFtdO1xuICAgIHRoaXMuYXhpc1lDb29yZGluYXRlcyA9IFtdO1xuICAgIHRoaXMuYXhpc1hMYWJlbENvb3JkaW5hdGVzID0gW107XG4gICAgdGhpcy5heGlzWUxhYmVsQ29vcmRpbmF0ZXMgPSBbXTtcbiAgICB0aGlzLnNlcmllc0xlbmd0aCA9IDA7XG4gIH1cblxuICBwcml2YXRlIGdldEF4aXNYQ29vcmRpbmF0ZXMoXG4gICAgY29udGFpbmVyU2l6ZTogUG9DaGFydENvbnRhaW5lclNpemUsXG4gICAgYW1vdW50T2ZBeGlzWTogbnVtYmVyLFxuICAgIHR5cGU6IFBvQ2hhcnRUeXBlLFxuICAgIGluZGV4OiBudW1iZXJcbiAgKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5hbGlnbkJ5VGhlQ29ybmVyc1xuICAgICAgPyB0aGlzLmNhbGN1bGF0ZUF4aXNZQ29vcmRpbmF0ZVgoY29udGFpbmVyU2l6ZSwgYW1vdW50T2ZBeGlzWSwgaW5kZXgpXG4gICAgICA6IHRoaXMuY2VudGVyZWRJbkNhdGVnb3J5QXJlYShjb250YWluZXJTaXplLCBhbW91bnRPZkF4aXNZLCB0eXBlLCBpbmRleCk7XG4gIH1cblxuICBwcml2YXRlIGdldENhdGVnb3JpZXNSYW5nZUZvck1vdXNlTW92ZShhbW91bnRPZkF4aXNZOiBudW1iZXIsIGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplKSB7XG4gICAgY29uc3QgY2F0ZWdvcmllc0Nvb3JkaW5hdGVzID0gWy4uLkFycmF5KGFtb3VudE9mQXhpc1kpXS5tYXAoKF8sIGluZGV4OiBudW1iZXIpID0+XG4gICAgICB0aGlzLmNhbGN1bGF0ZUF4aXNZQ29vcmRpbmF0ZVgoY29udGFpbmVyU2l6ZSwgYW1vdW50T2ZBeGlzWSwgaW5kZXgsIHRydWUpXG4gICAgKTtcblxuICAgIHRoaXMuY2F0ZWdvcmllc0Nvb3JkaW5hdGVzLmVtaXQoY2F0ZWdvcmllc0Nvb3JkaW5hdGVzKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNWYWxpZEdyaWRMaW5lc0xlbmd0aE9wdGlvbihncmlkTGluZXM6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBncmlkTGluZXMgPj0gMiAmJiBncmlkTGluZXMgPD0gMTA7XG4gIH1cblxuICBwcml2YXRlIGdldEF4aXNYTGFiZWxzKHR5cGU6IFBvQ2hhcnRUeXBlLCBtaW5NYXhBeGlzVmFsdWVzOiBQb0NoYXJ0TWluTWF4VmFsdWVzLCBhbW91bnRPZkF4aXNYOiBudW1iZXIpIHtcbiAgICBpZiAodHlwZSA9PT0gUG9DaGFydFR5cGUuQmFyKSB7XG4gICAgICBjb25zdCBheGlzWExhYmVsc0xpc3QgPSB0aGlzLmZvcm1hdENhdGVnb3JpZXNMYWJlbHMoYW1vdW50T2ZBeGlzWCwgdGhpcy5jYXRlZ29yaWVzKTtcbiAgICAgIHJldHVybiBheGlzWExhYmVsc0xpc3QucmV2ZXJzZSgpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmdlbmVyYXRlQXZlcmFnZU9mTGFiZWxzKG1pbk1heEF4aXNWYWx1ZXMsIGFtb3VudE9mQXhpc1gpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRBeGlzWUxhYmVscyh0eXBlOiBQb0NoYXJ0VHlwZSwgbWluTWF4QXhpc1ZhbHVlczogUG9DaGFydE1pbk1heFZhbHVlcywgYW1vdW50T2ZBeGlzWDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHR5cGUgPT09IFBvQ2hhcnRUeXBlLkJhclxuICAgICAgPyB0aGlzLmdlbmVyYXRlQXZlcmFnZU9mTGFiZWxzKG1pbk1heEF4aXNWYWx1ZXMsIGFtb3VudE9mQXhpc1gpXG4gICAgICA6IHRoaXMuZm9ybWF0Q2F0ZWdvcmllc0xhYmVscyhhbW91bnRPZkF4aXNYLCB0aGlzLmNhdGVnb3JpZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRDYXRlZ29yaWVzTGFiZWxzKGFtb3VudE9mQXhpc1g6IG51bWJlciwgY2F0ZWdvcmllczogQXJyYXk8c3RyaW5nPiA9IFtdKSB7XG4gICAgcmV0dXJuIFsuLi5BcnJheShhbW91bnRPZkF4aXNYKV0ubWFwKChfLCBpbmRleDogbnVtYmVyKSA9PiBjYXRlZ29yaWVzW2luZGV4XSA/PyAnLScpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUF2ZXJhZ2VPZkxhYmVscyhtaW5NYXhBeGlzVmFsdWVzOiBQb0NoYXJ0TWluTWF4VmFsdWVzLCBhbW91bnRPZkF4aXNMaW5lczogbnVtYmVyKSB7XG4gICAgY29uc3QgYXZlcmFnZUxhYmVsc0xpc3QgPSB0aGlzLm1hdGhzU2VydmljZS5yYW5nZShtaW5NYXhBeGlzVmFsdWVzLCBhbW91bnRPZkF4aXNMaW5lcyk7XG5cbiAgICByZXR1cm4gYXZlcmFnZUxhYmVsc0xpc3QubWFwKGxhYmVsID0+IHtcbiAgICAgIGNvbnN0IGZvcm1hdHRlZERpZ2l0ID0gbGFiZWwudG9GaXhlZChsYWJlbCAlIDEgJiYgMik7XG4gICAgICAvLyBSZW1vdmUgZMOtZ2l0b3MgY29tIHplcm8uXG4gICAgICAvLyBUYW1iw6ltIHRyYXRhIGNhc28gcXVhbmRvIG8gdmFsb3IgcmV0b3JuYWRvIGVyYSAtMCwgc3Vic3RpdHVpbmRvLW8gcG9yIDAuXG4gICAgICBjb25zdCByZW1vdmVaZXJvRGlnaXRzID0gZm9ybWF0dGVkRGlnaXQucmVwbGFjZSgvXFwuMDAkLywgJycpLnJlcGxhY2UoL1xcLTAkLywgMCk7XG5cbiAgICAgIHJldHVybiByZW1vdmVaZXJvRGlnaXRzLnRvU3RyaW5nKCk7XG4gICAgfSk7XG4gIH1cbn1cbiIsIjxzdmc6ZyBwby1jaGFydC1heGlzLXBhdGggW3AtYXhpcy14LWNvb3JkaW5hdGVzXT1cImF4aXNYQ29vcmRpbmF0ZXNcIiBbcC1heGlzLXktY29vcmRpbmF0ZXNdPVwiYXhpc1lDb29yZGluYXRlc1wiPjwvc3ZnOmc+XG5cbjxzdmc6ZyBwby1jaGFydC1heGlzLWxhYmVsIFxuICBbcC1hbGlnbi1ieS10aGUtY29ybmVyc109XCJhbGlnbkJ5VGhlQ29ybmVyc1wiIFxuICBbcC1heGlzLXgtbGFiZWwtY29vcmRpbmF0ZXNdPVwiYXhpc1hMYWJlbENvb3JkaW5hdGVzXCIgXG4gIFtwLWF4aXMteS1sYWJlbC1jb29yZGluYXRlc109XCJheGlzWUxhYmVsQ29vcmRpbmF0ZXNcIiBcbiAgW3AtdHlwZV09XCJ0eXBlXCJcbiAgPlxuPC9zdmc6Zz4iXX0=