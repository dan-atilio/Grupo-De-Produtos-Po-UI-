import { Component } from '@angular/core';
import { fromEvent, of } from 'rxjs';
import { debounceTime, switchMap, tap } from 'rxjs/operators';
import { PoChartLineBaseComponent } from '../po-chart-line-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../../services/po-chart-maths.service";
import * as i2 from "@angular/common";
import * as i3 from "../po-chart-path/po-chart-path.component";
import * as i4 from "../po-chart-series-point/po-chart-series-point.component";
const _c0 = ["po-chart-area", ""];
function PoChartAreaComponent__svg_g_2_Template(rf, ctx) { if (rf & 1) {
    const _r5 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g", 2);
    i0.ɵɵlistener("mouseenter", function PoChartAreaComponent__svg_g_2_Template__svg_g_mouseenter_0_listener() { const restoredCtx = i0.ɵɵrestoreView(_r5); const i_r3 = restoredCtx.index; const ctx_r4 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r4.onEnter(i_r3)); })("mouseleave", function PoChartAreaComponent__svg_g_2_Template__svg_g_mouseleave_0_listener() { const restoredCtx = i0.ɵɵrestoreView(_r5); const i_r3 = restoredCtx.index; const ctx_r6 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r6.onLeave(i_r3)); });
    i0.ɵɵelement(1, "g", 3);
    i0.ɵɵelementStart(2, "g", 4);
    i0.ɵɵlistener("p-point-click", function PoChartAreaComponent__svg_g_2_Template__svg_g_p_point_click_2_listener($event) { i0.ɵɵrestoreView(_r5); const ctx_r7 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r7.onSeriePointClick($event)); })("p-point-hover", function PoChartAreaComponent__svg_g_2_Template__svg_g_p_point_hover_2_listener($event) { i0.ɵɵrestoreView(_r5); const ctx_r8 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r8.onSeriePointHover($event)); });
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const item_r2 = ctx.$implicit;
    const i_r3 = ctx.index;
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵclassMap("po-chart-line-path-group-" + i_r3);
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-chart-line", ctx_r1.chartType === "line")("p-animate", ctx_r1.animate)("p-color", item_r2.color)("p-coordinates", item_r2 == null ? null : item_r2.coordinates)("p-is-active", item_r2.isActive);
    i0.ɵɵattribute("key", "po-chart-line-path-" + i_r3);
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-animate", ctx_r1.animate)("p-chart-line", ctx_r1.chartType === "line")("p-color", item_r2.color)("p-coordinates", ctx_r1.seriesPointsCoordinates[i_r3])("p-is-active", ctx_r1.activeTooltip)("p-relative-to", "po-chart-line-path-group-" + i_r3);
    i0.ɵɵattribute("key", "po-chart-line-path-points-group-" + i_r3);
} }
export class PoChartAreaComponent extends PoChartLineBaseComponent {
    mathsService;
    renderer;
    elementRef;
    currentActiveSerieIndex;
    mouseMoveSubscription$;
    previousActiveSerieIndex;
    constructor(mathsService, renderer, elementRef) {
        super(mathsService, renderer, elementRef);
        this.mathsService = mathsService;
        this.renderer = renderer;
        this.elementRef = elementRef;
    }
    onEnter(serieIndex) {
        this.applyActiveItem(this.seriesPathsCoordinates, serieIndex);
        this.initializeListener(serieIndex);
        this.activeTooltip = true;
    }
    onLeave(serieIndex) {
        this.removeListener();
        this.applyActiveItem(this.seriesPathsCoordinates);
        this.applyActiveItem(this.seriesPointsCoordinates[serieIndex], null);
    }
    onSeriePointHover(selectedItem) {
        const { relativeTo, ...item } = selectedItem;
        this.pointHover.emit(item);
    }
    applyActiveItem(list, index) {
        list.forEach((serie, seriesIndex) => {
            serie['isActive'] = index === undefined ? true : index === seriesIndex;
        });
    }
    getMouseCoordinates(event) {
        event.preventDefault();
        const { svgDomMatrix, svgPoint } = this.svgSpace;
        svgPoint.x = event.clientX;
        svgPoint.y = event.clientY;
        // Retorna as coordenadas do mouse em relação ao container svg.
        return svgPoint.matrixTransform(svgDomMatrix);
    }
    initializeListener(serieIndex) {
        let pointPosition;
        this.previousActiveSerieIndex = undefined;
        this.mouseMoveSubscription$ = fromEvent(this.elementRef.nativeElement, 'mousemove')
            .pipe(debounceTime(10), tap((event) => (pointPosition = this.getMouseCoordinates(event))), switchMap(() => of(this.verifyActiveArea(pointPosition))))
            .subscribe(activeObjIndex => {
            if (activeObjIndex !== undefined) {
                this.applyActiveItem(this.seriesPointsCoordinates[serieIndex], activeObjIndex);
            }
        });
    }
    removeListener() {
        this.mouseMoveSubscription$.unsubscribe();
    }
    verifyActiveArea(pointPosition) {
        const { x } = pointPosition;
        this.currentActiveSerieIndex = this.categoriesCoordinates.findIndex((category, index) => (x >= category && index === this.categoriesCoordinates.length - 1) ||
            (x >= category && x <= this.categoriesCoordinates[index + 1]));
        if (this.currentActiveSerieIndex >= 0 && this.currentActiveSerieIndex !== this.previousActiveSerieIndex) {
            this.previousActiveSerieIndex = this.currentActiveSerieIndex;
            return this.currentActiveSerieIndex;
        }
        return undefined;
    }
    static ɵfac = function PoChartAreaComponent_Factory(t) { return new (t || PoChartAreaComponent)(i0.ɵɵdirectiveInject(i1.PoChartMathsService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ElementRef)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoChartAreaComponent, selectors: [["", "po-chart-area", ""]], features: [i0.ɵɵInheritDefinitionFeature], attrs: _c0, decls: 3, vars: 2, consts: [["chartLine", ""], [3, "class", "mouseenter", "mouseleave", 4, "ngFor", "ngForOf", "ngForTrackBy"], [3, "mouseenter", "mouseleave"], ["po-chart-path", "", 3, "p-chart-line", "p-animate", "p-color", "p-coordinates", "p-is-active"], ["po-chart-series-point", "", 3, "p-animate", "p-chart-line", "p-color", "p-coordinates", "p-is-active", "p-relative-to", "p-point-click", "p-point-hover"]], template: function PoChartAreaComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵnamespaceSVG();
            i0.ɵɵelementStart(0, "g", null, 0);
            i0.ɵɵtemplate(2, PoChartAreaComponent__svg_g_2_Template, 3, 15, "g", 1);
            i0.ɵɵelementEnd();
        } if (rf & 2) {
            i0.ɵɵadvance(2);
            i0.ɵɵproperty("ngForOf", ctx.seriesPathsCoordinates)("ngForTrackBy", ctx.trackBy);
        } }, dependencies: [i2.NgForOf, i3.PoChartPathComponent, i4.PoChartSeriesPointComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoChartAreaComponent, [{
        type: Component,
        args: [{ selector: '[po-chart-area]', template: "<svg:g #chartLine>\n\n  <svg:g *ngFor=\"let item of seriesPathsCoordinates; let i = index; trackBy: trackBy\"\n    [class]=\"'po-chart-line-path-group-' + i\"\n    (mouseenter)=\"onEnter(i)\"\n    (mouseleave)=\"onLeave(i)\"\n  >\n    <!-- SERIES PATHS -->\n    <svg:g po-chart-path\n      [p-chart-line]=\"chartType === 'line'\"\n      [attr.key]=\"'po-chart-line-path-' + i\"\n      [p-animate]=\"animate\"\n      [p-color]=\"item.color\" \n      [p-coordinates]=\"item?.coordinates\"\n      [p-is-active]=\"item.isActive\"\n      >\n      </svg:g>\n\n    <!-- SERIES POINTS -->\n    <svg:g po-chart-series-point\n      [p-animate]=\"animate\"\n      [p-chart-line]=\"chartType === 'line'\"\n      [p-color]=\"item.color\"\n      [p-coordinates]=\"seriesPointsCoordinates[i]\"\n      [p-is-active]=\"activeTooltip\"\n      [p-relative-to]=\"'po-chart-line-path-group-' + i\" \n      [attr.key]=\"'po-chart-line-path-points-group-' + i\"\n      (p-point-click)=\"onSeriePointClick($event)\"\n      (p-point-hover)=\"onSeriePointHover($event)\"\n      ></svg:g>\n  </svg:g>\n\n</svg:g>" }]
    }], () => [{ type: i1.PoChartMathsService }, { type: i0.Renderer2 }, { type: i0.ElementRef }], null); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoChartAreaComponent, { className: "PoChartAreaComponent", filePath: "lib/components/po-chart/po-chart-container/po-chart-line/po-chart-area/po-chart-area.component.ts", lineNumber: 15 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtYXJlYS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtY29udGFpbmVyL3BvLWNoYXJ0LWxpbmUvcG8tY2hhcnQtYXJlYS9wby1jaGFydC1hcmVhLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC1jb250YWluZXIvcG8tY2hhcnQtbGluZS9wby1jaGFydC1saW5lLmNvbXBvbmVudC5zdmciXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBeUIsTUFBTSxlQUFlLENBQUM7QUFFakUsT0FBTyxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTlELE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDOzs7Ozs7Ozs7O0lDSHpFLDRCQUlDO0lBRkMsa09BQWMsZUFBQSxvQkFBVSxDQUFBLElBQUMscU5BQ1gsZUFBQSxvQkFBVSxDQUFBLElBREM7SUFJekIsdUJBUVU7SUFHViw0QkFVRztJQUZELDBMQUFpQixlQUFBLGdDQUF5QixDQUFBLElBQUMsNktBQzFCLGVBQUEsZ0NBQXlCLENBQUEsSUFEQztJQUUxQyxpQkFBUSxFQUFBOzs7OztJQTFCWCxpREFBeUM7SUFNdkMsY0FBcUM7SUFBckMsMERBQXFDLDZCQUFBLDBCQUFBLCtEQUFBLGlDQUFBO0lBQ3JDLG1EQUFzQztJQVV0QyxjQUFxQjtJQUFyQiwwQ0FBcUIsNkNBQUEsMEJBQUEsdURBQUEscUNBQUEscURBQUE7SUFNckIsZ0VB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b20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBmcm9tRXZlbnQsIG9mLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgc3dpdGNoTWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IFBvQ2hhcnRMaW5lQmFzZUNvbXBvbmVudCB9IGZyb20gJy4uL3BvLWNoYXJ0LWxpbmUtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9DaGFydE1hdGhzU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLWNoYXJ0LW1hdGhzLnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9DaGFydFBhdGhDb29yZGluYXRlcyB9IGZyb20gJy4uLy4uLy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtcGF0aC1jb29yZGluYXRlcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9DaGFydFBvaW50c0Nvb3JkaW5hdGVzIH0gZnJvbSAnLi4vLi4vLi4vaW50ZXJmYWNlcy9wby1jaGFydC1wb2ludHMtY29vcmRpbmF0ZXMuaW50ZXJmYWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnW3BvLWNoYXJ0LWFyZWFdJyxcbiAgdGVtcGxhdGVVcmw6ICcuLi9wby1jaGFydC1saW5lLmNvbXBvbmVudC5zdmcnXG59KVxuZXhwb3J0IGNsYXNzIFBvQ2hhcnRBcmVhQ29tcG9uZW50IGV4dGVuZHMgUG9DaGFydExpbmVCYXNlQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBjdXJyZW50QWN0aXZlU2VyaWVJbmRleDogbnVtYmVyO1xuICBwcml2YXRlIG1vdXNlTW92ZVN1YnNjcmlwdGlvbiQ6IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBwcmV2aW91c0FjdGl2ZVNlcmllSW5kZXg6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgbWF0aHNTZXJ2aWNlOiBQb0NoYXJ0TWF0aHNTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByb3RlY3RlZCBlbGVtZW50UmVmOiBFbGVtZW50UmVmXG4gICkge1xuICAgIHN1cGVyKG1hdGhzU2VydmljZSwgcmVuZGVyZXIsIGVsZW1lbnRSZWYpO1xuICB9XG5cbiAgb25FbnRlcihzZXJpZUluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmFwcGx5QWN0aXZlSXRlbTxQb0NoYXJ0UGF0aENvb3JkaW5hdGVzPih0aGlzLnNlcmllc1BhdGhzQ29vcmRpbmF0ZXMsIHNlcmllSW5kZXgpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZUxpc3RlbmVyKHNlcmllSW5kZXgpO1xuICAgIHRoaXMuYWN0aXZlVG9vbHRpcCA9IHRydWU7XG4gIH1cblxuICBvbkxlYXZlKHNlcmllSW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIoKTtcbiAgICB0aGlzLmFwcGx5QWN0aXZlSXRlbTxQb0NoYXJ0UGF0aENvb3JkaW5hdGVzPih0aGlzLnNlcmllc1BhdGhzQ29vcmRpbmF0ZXMpO1xuICAgIHRoaXMuYXBwbHlBY3RpdmVJdGVtPFBvQ2hhcnRQb2ludHNDb29yZGluYXRlcz4odGhpcy5zZXJpZXNQb2ludHNDb29yZGluYXRlc1tzZXJpZUluZGV4XSwgbnVsbCk7XG4gIH1cblxuICBvblNlcmllUG9pbnRIb3ZlcihzZWxlY3RlZEl0ZW06IGFueSkge1xuICAgIGNvbnN0IHsgcmVsYXRpdmVUbywgLi4uaXRlbSB9ID0gc2VsZWN0ZWRJdGVtO1xuXG4gICAgdGhpcy5wb2ludEhvdmVyLmVtaXQoaXRlbSk7XG4gIH1cblxuICBwcml2YXRlIGFwcGx5QWN0aXZlSXRlbTxUPihsaXN0OiBBcnJheTxUPiwgaW5kZXg/OiBudW1iZXIpOiB2b2lkIHtcbiAgICBsaXN0LmZvckVhY2goKHNlcmllLCBzZXJpZXNJbmRleCkgPT4ge1xuICAgICAgc2VyaWVbJ2lzQWN0aXZlJ10gPSBpbmRleCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGluZGV4ID09PSBzZXJpZXNJbmRleDtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TW91c2VDb29yZGluYXRlcyhldmVudDogTW91c2VFdmVudCk6IFNWR1BvaW50IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHsgc3ZnRG9tTWF0cml4LCBzdmdQb2ludCB9ID0gdGhpcy5zdmdTcGFjZTtcblxuICAgIHN2Z1BvaW50LnggPSBldmVudC5jbGllbnRYO1xuICAgIHN2Z1BvaW50LnkgPSBldmVudC5jbGllbnRZO1xuXG4gICAgLy8gUmV0b3JuYSBhcyBjb29yZGVuYWRhcyBkbyBtb3VzZSBlbSByZWxhw6fDo28gYW8gY29udGFpbmVyIHN2Zy5cbiAgICByZXR1cm4gc3ZnUG9pbnQubWF0cml4VHJhbnNmb3JtKHN2Z0RvbU1hdHJpeCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVMaXN0ZW5lcihzZXJpZUluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICBsZXQgcG9pbnRQb3NpdGlvbjogU1ZHUG9pbnQ7XG4gICAgdGhpcy5wcmV2aW91c0FjdGl2ZVNlcmllSW5kZXggPSB1bmRlZmluZWQ7XG5cbiAgICB0aGlzLm1vdXNlTW92ZVN1YnNjcmlwdGlvbiQgPSBmcm9tRXZlbnQodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdtb3VzZW1vdmUnKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGRlYm91bmNlVGltZSgxMCksXG4gICAgICAgIHRhcCgoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IChwb2ludFBvc2l0aW9uID0gdGhpcy5nZXRNb3VzZUNvb3JkaW5hdGVzKGV2ZW50KSkpLFxuICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gb2YodGhpcy52ZXJpZnlBY3RpdmVBcmVhKHBvaW50UG9zaXRpb24pKSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoYWN0aXZlT2JqSW5kZXggPT4ge1xuICAgICAgICBpZiAoYWN0aXZlT2JqSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRoaXMuYXBwbHlBY3RpdmVJdGVtPFBvQ2hhcnRQb2ludHNDb29yZGluYXRlcz4odGhpcy5zZXJpZXNQb2ludHNDb29yZGluYXRlc1tzZXJpZUluZGV4XSwgYWN0aXZlT2JqSW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlTGlzdGVuZXIoKTogdm9pZCB7XG4gICAgdGhpcy5tb3VzZU1vdmVTdWJzY3JpcHRpb24kLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIHZlcmlmeUFjdGl2ZUFyZWEocG9pbnRQb3NpdGlvbjogU1ZHUG9pbnQpOiBudW1iZXIge1xuICAgIGNvbnN0IHsgeCB9ID0gcG9pbnRQb3NpdGlvbjtcblxuICAgIHRoaXMuY3VycmVudEFjdGl2ZVNlcmllSW5kZXggPSB0aGlzLmNhdGVnb3JpZXNDb29yZGluYXRlcy5maW5kSW5kZXgoXG4gICAgICAoY2F0ZWdvcnksIGluZGV4KSA9PlxuICAgICAgICAoeCA+PSBjYXRlZ29yeSAmJiBpbmRleCA9PT0gdGhpcy5jYXRlZ29yaWVzQ29vcmRpbmF0ZXMubGVuZ3RoIC0gMSkgfHxcbiAgICAgICAgKHggPj0gY2F0ZWdvcnkgJiYgeCA8PSB0aGlzLmNhdGVnb3JpZXNDb29yZGluYXRlc1tpbmRleCArIDFdKVxuICAgICk7XG5cbiAgICBpZiAodGhpcy5jdXJyZW50QWN0aXZlU2VyaWVJbmRleCA+PSAwICYmIHRoaXMuY3VycmVudEFjdGl2ZVNlcmllSW5kZXggIT09IHRoaXMucHJldmlvdXNBY3RpdmVTZXJpZUluZGV4KSB7XG4gICAgICB0aGlzLnByZXZpb3VzQWN0aXZlU2VyaWVJbmRleCA9IHRoaXMuY3VycmVudEFjdGl2ZVNlcmllSW5kZXg7XG4gICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWN0aXZlU2VyaWVJbmRleDtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG59XG4iLCI8c3ZnOmcgI2NoYXJ0TGluZT5cblxuICA8c3ZnOmcgKm5nRm9yPVwibGV0IGl0ZW0gb2Ygc2VyaWVzUGF0aHNDb29yZGluYXRlczsgbGV0IGkgPSBpbmRleDsgdHJhY2tCeTogdHJhY2tCeVwiXG4gICAgW2NsYXNzXT1cIidwby1jaGFydC1saW5lLXBhdGgtZ3JvdXAtJyArIGlcIlxuICAgIChtb3VzZWVudGVyKT1cIm9uRW50ZXIoaSlcIlxuICAgIChtb3VzZWxlYXZlKT1cIm9uTGVhdmUoaSlcIlxuICA+XG4gICAgPCEtLSBTRVJJRVMgUEFUSFMgLS0+XG4gICAgPHN2ZzpnIHBvLWNoYXJ0LXBhdGhcbiAgICAgIFtwLWNoYXJ0LWxpbmVdPVwiY2hhcnRUeXBlID09PSAnbGluZSdcIlxuICAgICAgW2F0dHIua2V5XT1cIidwby1jaGFydC1saW5lLXBhdGgtJyArIGlcIlxuICAgICAgW3AtYW5pbWF0ZV09XCJhbmltYXRlXCJcbiAgICAgIFtwLWNvbG9yXT1cIml0ZW0uY29sb3JcIiBcbiAgICAgIFtwLWNvb3JkaW5hdGVzXT1cIml0ZW0/LmNvb3JkaW5hdGVzXCJcbiAgICAgIFtwLWlzLWFjdGl2ZV09XCJpdGVtLmlzQWN0aXZlXCJcbiAgICAgID5cbiAgICAgIDwvc3ZnOmc+XG5cbiAgICA8IS0tIFNFUklFUyBQT0lOVFMgLS0+XG4gICAgPHN2ZzpnIHBvLWNoYXJ0LXNlcmllcy1wb2ludFxuICAgICAgW3AtYW5pbWF0ZV09XCJhbmltYXRlXCJcbiAgICAgIFtwLWNoYXJ0LWxpbmVdPVwiY2hhcnRUeXBlID09PSAnbGluZSdcIlxuICAgICAgW3AtY29sb3JdPVwiaXRlbS5jb2xvclwiXG4gICAgICBbcC1jb29yZGluYXRlc109XCJzZXJpZXNQb2ludHNDb29yZGluYXRlc1tpXVwiXG4gICAgICBbcC1pcy1hY3RpdmVdPVwiYWN0aXZlVG9vbHRpcFwiXG4gICAgICBbcC1yZWxhdGl2ZS10b109XCIncG8tY2hhcnQtbGluZS1wYXRoLWdyb3VwLScgKyBpXCIgXG4gICAgICBbYXR0ci5rZXldPVwiJ3BvLWNoYXJ0LWxpbmUtcGF0aC1wb2ludHMtZ3JvdXAtJyArIGlcIlxuICAgICAgKHAtcG9pbnQtY2xpY2spPVwib25TZXJpZVBvaW50Q2xpY2soJGV2ZW50KVwiXG4gICAgICAocC1wb2ludC1ob3Zlcik9XCJvblNlcmllUG9pbnRIb3ZlcigkZXZlbnQpXCJcbiAgICAgID48L3N2ZzpnPlxuICA8L3N2ZzpnPlxuXG48L3N2ZzpnPiJdfQ==