import { Component } from '@angular/core';
import { PoChartPlotAreaPaddingTop } from './../../helpers/po-chart-default-values.constant';
import { PoChartBarBaseComponent } from './po-chart-bar-base.component';
import * as i0 from "@angular/core";
import * as i1 from "./../../services/po-chart-maths.service";
import * as i2 from "@angular/common";
import * as i3 from "./po-chart-bar-path/po-chart-bar-path.component";
const _c0 = ["po-chart-bar", ""];
function PoChartBarComponent__svg_g_1_Template(rf, ctx) { if (rf & 1) {
    const _r4 = i0.ɵɵgetCurrentView();
    i0.ɵɵnamespaceSVG();
    i0.ɵɵelementStart(0, "g")(1, "g", 1);
    i0.ɵɵlistener("p-bar-click", function PoChartBarComponent__svg_g_1_Template__svg_g_p_bar_click_1_listener($event) { i0.ɵɵrestoreView(_r4); const ctx_r3 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r3.onSerieBarClick($event)); })("p-bar-hover", function PoChartBarComponent__svg_g_1_Template__svg_g_p_bar_hover_1_listener($event) { i0.ɵɵrestoreView(_r4); const ctx_r5 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r5.onSerieBarHover($event)); });
    i0.ɵɵelementEnd()();
} if (rf & 2) {
    const item_r1 = ctx.$implicit;
    const i_r2 = ctx.index;
    const ctx_r0 = i0.ɵɵnextContext();
    i0.ɵɵclassMap("po-chart-bar-group-" + i_r2);
    i0.ɵɵadvance();
    i0.ɵɵproperty("p-color", item_r1[0] == null ? null : item_r1[0].color)("p-coordinates", item_r1)("p-tooltip-position", ctx_r0.tooltipPosition);
    i0.ɵɵattribute("key", "po-chart-bar-path-" + i_r2);
} }
export class PoChartBarComponent extends PoChartBarBaseComponent {
    mathsService;
    tooltipPosition = 'right';
    constructor(mathsService) {
        super(mathsService);
        this.mathsService = mathsService;
    }
    barCoordinates(seriesIndex, serieItemDataIndex, containerSize, minMaxSeriesValues, serieValue) {
        const { svgPlottingAreaWidth, barHeight, spaceBetweenBars } = this.calculateElementsMeasurements(containerSize);
        const { x1, x2 } = this.xCoordinates(minMaxSeriesValues, svgPlottingAreaWidth, containerSize.axisXLabelWidth, containerSize.svgWidth, serieValue);
        const { y1, y2 } = this.yCoordinates(seriesIndex, serieItemDataIndex, containerSize.svgPlottingAreaHeight, barHeight, spaceBetweenBars);
        return ['M', x1, y2, 'L', x2, y2, 'L', x2, y1, 'L', x1, y1, 'z'].join(' ');
    }
    calculateElementsMeasurements(containerSize) {
        const { svgWidth, svgPlottingAreaHeight, axisXLabelWidth } = containerSize;
        // Fração das séries em relação à largura da categoria. Incrementa + 2 na extensão das séries pois se trata da área de margem entre as categorias.
        const svgPlottingAreaWidth = svgWidth - axisXLabelWidth;
        const categoryHeight = svgPlottingAreaHeight / this.seriesGreaterLength;
        const columnFraction = categoryHeight / (this.series.length + 2);
        // Área entre as colunas: retorna zero se houver apenas uma série.
        const spaceBetweenBars = this.series.length > 1 ? columnFraction / (this.series.length + 2) : 0;
        // Subtrai a fração das séries pelo espaço entre as colunas.
        const barHeight = columnFraction - (spaceBetweenBars * (this.series.length - 1)) / (this.series.length + 2);
        return { svgPlottingAreaWidth, barHeight, spaceBetweenBars };
    }
    xCoordinates(minMaxSeriesValues, svgPlottingAreaWidth, axisXLabelWidth, svgWidth, serieValue) {
        const { minValue } = minMaxSeriesValues;
        const valueZeroPercentage = this.mathsService.getSeriePercentage(minMaxSeriesValues, minValue < 0 ? 0 : minValue);
        const x1 = axisXLabelWidth + (svgWidth - axisXLabelWidth) * valueZeroPercentage;
        const xRatio = this.mathsService.getSeriePercentage(minMaxSeriesValues, serieValue);
        const x2 = Math.round(svgPlottingAreaWidth * xRatio + axisXLabelWidth);
        return { x1, x2 };
    }
    yCoordinates(seriesIndex, serieItemDataIndex, svgPlottingAreaHeight, barHeight, spaceBetweenBars) {
        const spaceBetweenAxisAndBars = barHeight;
        const yRatio = serieItemDataIndex / this.seriesGreaterLength;
        const y1 = Math.round(PoChartPlotAreaPaddingTop +
            svgPlottingAreaHeight * yRatio +
            spaceBetweenAxisAndBars +
            barHeight * seriesIndex +
            spaceBetweenBars * seriesIndex);
        const y2 = Math.round(y1 + barHeight);
        return { y1, y2 };
    }
    static ɵfac = function PoChartBarComponent_Factory(t) { return new (t || PoChartBarComponent)(i0.ɵɵdirectiveInject(i1.PoChartMathsService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoChartBarComponent, selectors: [["", "po-chart-bar", ""]], features: [i0.ɵɵInheritDefinitionFeature], attrs: _c0, decls: 2, vars: 2, consts: [[3, "class", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["po-chart-bar-path", "", 3, "p-color", "p-coordinates", "p-tooltip-position", "p-bar-click", "p-bar-hover"]], template: function PoChartBarComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵnamespaceSVG();
            i0.ɵɵelementStart(0, "g");
            i0.ɵɵtemplate(1, PoChartBarComponent__svg_g_1_Template, 2, 6, "g", 0);
            i0.ɵɵelementEnd();
        } if (rf & 2) {
            i0.ɵɵadvance();
            i0.ɵɵproperty("ngForOf", ctx.seriesPathsCoordinates)("ngForTrackBy", ctx.trackBy);
        } }, dependencies: [i2.NgForOf, i3.PoChartBarPathComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoChartBarComponent, [{
        type: Component,
        args: [{ selector: '[po-chart-bar]', template: "<svg:g>\n  <svg:g *ngFor=\"let item of seriesPathsCoordinates; let i = index; trackBy: trackBy\"\n    [class]=\"'po-chart-bar-group-' + i\"\n  >\n    <!-- SERIES PATHS -->\n    <svg:g po-chart-bar-path\n      [attr.key]=\"'po-chart-bar-path-' + i\"\n      [p-color]=\"item[0]?.color\" \n      [p-coordinates]=\"item\"\n      [p-tooltip-position]=\"tooltipPosition\"\n      (p-bar-click)=\"onSerieBarClick($event)\"\n      (p-bar-hover)=\"onSerieBarHover($event)\"\n      >\n      </svg:g>\n  </svg:g>\n</svg:g>" }]
    }], () => [{ type: i1.PoChartMathsService }], null); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoChartBarComponent, { className: "PoChartBarComponent", filePath: "lib/components/po-chart/po-chart-container/po-chart-bar/po-chart-bar.component.ts", lineNumber: 15 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtYmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC1jb250YWluZXIvcG8tY2hhcnQtYmFyL3BvLWNoYXJ0LWJhci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtY29udGFpbmVyL3BvLWNoYXJ0LWJhci9wby1jaGFydC1iYXIuY29tcG9uZW50LnN2ZyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTFDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGtEQUFrRCxDQUFDO0FBRTdGLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLCtCQUErQixDQUFDOzs7Ozs7Ozs7SUNIdEUseUJBRUMsV0FBQTtJQU9HLHFMQUFlLGVBQUEsOEJBQXVCLENBQUEsSUFBQyx3S0FDeEIsZUFBQSw4QkFBdUIsQ0FBQSxJQURDO0lBR3ZDLGlCQUFRLEVBQUE7Ozs7O0lBWFYsMkNBQW1DO0lBS2pDLGNBQTBCO0lBQTFCLHNFQUEwQiwwQkFBQSw4Q0FBQTtJQUQxQixrREFBcUM7O0FEUTNDLE1BQU0sT0FBTyxtQkFBb0IsU0FBUSx1QkFBdUI7SUFHeEM7SUFGYixlQUFlLEdBQUcsT0FBTyxDQUFDO0lBRW5DLFlBQXNCLFlBQWlDO1FBQ3JELEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztRQURBLGlCQUFZLEdBQVosWUFBWSxDQUFxQjtJQUV2RCxDQUFDO0lBRVMsY0FBYyxDQUN0QixXQUFtQixFQUNuQixrQkFBMEIsRUFDMUIsYUFBbUMsRUFDbkMsa0JBQXVDLEVBQ3ZDLFVBQWtCO1FBRWxCLE1BQU0sRUFBRSxvQkFBb0IsRUFB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Q2pCLGdCQUF3QjtRQUV4QixNQUFNLHVCQUF1QixHQUFHLFNBQVMsQ0FBQztRQUMxQyxNQUFNLE1BQU0sR0FBRyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUM7UUFFN0QsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FDbkIseUJBQXlCO1lBQ3ZCLHFCQUFxQixHQUFHLE1BQU07WUFDOUIsdUJBQXVCO1lBQ3ZCLFNBQVMsR0FBRyxXQUFXO1lBQ3ZCLGdCQUFnQixHQUFHLFdBQVcsQ0FDakMsQ0FBQztRQUVGLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDcEIsQ0FBQzs2RUF4RlUsbUJBQW1COzZEQUFuQixtQkFBbUI7WUNkaEMsbUJBQU87WUFBUCx5QkFBTztZQUNMLHFFQWFRO1lBQ1YsaUJBQVE7O1lBZGtCLGNBQTJCO1lBQTNCLG9EQUEyQiw2QkFBQTs7O2lGRGF4QyxtQkFBbUI7Y0FKL0IsU0FBUzsyQkFDRSxnQkFBZ0I7O2tGQUdmLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBQb0NoYXJ0UGxvdEFyZWFQYWRkaW5nVG9wIH0gZnJvbSAnLi8uLi8uLi9oZWxwZXJzL3BvLWNoYXJ0LWRlZmF1bHQtdmFsdWVzLmNvbnN0YW50JztcblxuaW1wb3J0IHsgUG9DaGFydEJhckJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLWNoYXJ0LWJhci1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0TWF0aHNTZXJ2aWNlIH0gZnJvbSAnLi8uLi8uLi9zZXJ2aWNlcy9wby1jaGFydC1tYXRocy5zZXJ2aWNlJztcblxuaW1wb3J0IHsgUG9DaGFydENvbnRhaW5lclNpemUgfSBmcm9tICcuLy4uLy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtY29udGFpbmVyLXNpemUuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hhcnRNaW5NYXhWYWx1ZXMgfSBmcm9tICcuLy4uLy4uL2ludGVyZmFjZXMvcG8tY2hhcnQtbWluLW1heC12YWx1ZXMuaW50ZXJmYWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnW3BvLWNoYXJ0LWJhcl0nLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tY2hhcnQtYmFyLmNvbXBvbmVudC5zdmcnXG59KVxuZXhwb3J0IGNsYXNzIFBvQ2hhcnRCYXJDb21wb25lbnQgZXh0ZW5kcyBQb0NoYXJ0QmFyQmFzZUNvbXBvbmVudCB7XG4gIHJlYWRvbmx5IHRvb2x0aXBQb3NpdGlvbiA9ICdyaWdodCc7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIG1hdGhzU2VydmljZTogUG9DaGFydE1hdGhzU2VydmljZSkge1xuICAgIHN1cGVyKG1hdGhzU2VydmljZSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYmFyQ29vcmRpbmF0ZXMoXG4gICAgc2VyaWVzSW5kZXg6IG51bWJlcixcbiAgICBzZXJpZUl0ZW1EYXRhSW5kZXg6IG51bWJlcixcbiAgICBjb250YWluZXJTaXplOiBQb0NoYXJ0Q29udGFpbmVyU2l6ZSxcbiAgICBtaW5NYXhTZXJpZXNWYWx1ZXM6IFBvQ2hhcnRNaW5NYXhWYWx1ZXMsXG4gICAgc2VyaWVWYWx1ZTogbnVtYmVyXG4gICkge1xuICAgIGNvbnN0IHsgc3ZnUGxvdHRpbmdBcmVhV2lkdGgsIGJhckhlaWdodCwgc3BhY2VCZXR3ZWVuQmFycyB9ID0gdGhpcy5jYWxjdWxhdGVFbGVtZW50c01lYXN1cmVtZW50cyhjb250YWluZXJTaXplKTtcblxuICAgIGNvbnN0IHsgeDEsIHgyIH0gPSB0aGlzLnhDb29yZGluYXRlcyhcbiAgICAgIG1pbk1heFNlcmllc1ZhbHVlcyxcbiAgICAgIHN2Z1Bsb3R0aW5nQXJlYVdpZHRoLFxuICAgICAgY29udGFpbmVyU2l6ZS5heGlzWExhYmVsV2lkdGgsXG4gICAgICBjb250YWluZXJTaXplLnN2Z1dpZHRoLFxuICAgICAgc2VyaWVWYWx1ZVxuICAgICk7XG4gICAgY29uc3QgeyB5MSwgeTIgfSA9IHRoaXMueUNvb3JkaW5hdGVzKFxuICAgICAgc2VyaWVzSW5kZXgsXG4gICAgICBzZXJpZUl0ZW1EYXRhSW5kZXgsXG4gICAgICBjb250YWluZXJTaXplLnN2Z1Bsb3R0aW5nQXJlYUhlaWdodCxcbiAgICAgIGJhckhlaWdodCxcbiAgICAgIHNwYWNlQmV0d2VlbkJhcnNcbiAgICApO1xuXG4gICAgcmV0dXJuIFsnTScsIHgxLCB5MiwgJ0wnLCB4MiwgeTIsICdMJywgeDIsIHkxLCAnTCcsIHgxLCB5MSwgJ3onXS5qb2luKCcgJyk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUVsZW1lbnRzTWVhc3VyZW1lbnRzKGNvbnRhaW5lclNpemU6IFBvQ2hhcnRDb250YWluZXJTaXplKSB7XG4gICAgY29uc3QgeyBzdmdXaWR0aCwgc3ZnUGxvdHRpbmdBcmVhSGVpZ2h0LCBheGlzWExhYmVsV2lkdGggfSA9IGNvbnRhaW5lclNpemU7XG5cbiAgICAvLyBGcmHDp8OjbyBkYXMgc8OpcmllcyBlbSByZWxhw6fDo28gw6AgbGFyZ3VyYSBkYSBjYXRlZ29yaWEuIEluY3JlbWVudGEgKyAyIG5hIGV4dGVuc8OjbyBkYXMgc8OpcmllcyBwb2lzIHNlIHRyYXRhIGRhIMOhcmVhIGRlIG1hcmdlbSBlbnRyZSBhcyBjYXRlZ29yaWFzLlxuICAgIGNvbnN0IHN2Z1Bsb3R0aW5nQXJlYVdpZHRoID0gc3ZnV2lkdGggLSBheGlzWExhYmVsV2lkdGg7XG4gICAgY29uc3QgY2F0ZWdvcnlIZWlnaHQgPSBzdmdQbG90dGluZ0FyZWFIZWlnaHQgLyB0aGlzLnNlcmllc0dyZWF0ZXJMZW5ndGg7XG4gICAgY29uc3QgY29sdW1uRnJhY3Rpb24gPSBjYXRlZ29yeUhlaWdodCAvICh0aGlzLnNlcmllcy5sZW5ndGggKyAyKTtcblxuICAgIC8vIMOBcmVhIGVudHJlIGFzIGNvbHVuYXM6IHJldG9ybmEgemVybyBzZSBob3V2ZXIgYXBlbmFzIHVtYSBzw6lyaWUuXG4gICAgY29uc3Qgc3BhY2VCZXR3ZWVuQmFycyA9IHRoaXMuc2VyaWVzLmxlbmd0aCA+IDEgPyBjb2x1bW5GcmFjdGlvbiAvICh0aGlzLnNlcmllcy5sZW5ndGggKyAyKSA6IDA7XG5cbiAgICAvLyBTdWJ0cmFpIGEgZnJhw6fDo28gZGFzIHPDqXJpZXMgcGVsbyBlc3Bhw6dvIGVudHJlIGFzIGNvbHVuYXMuXG4gICAgY29uc3QgYmFySGVpZ2h0ID0gY29sdW1uRnJhY3Rpb24gLSAoc3BhY2VCZXR3ZWVuQmFycyAqICh0aGlzLnNlcmllcy5sZW5ndGggLSAxKSkgLyAodGhpcy5zZXJpZXMubGVuZ3RoICsgMik7XG5cbiAgICByZXR1cm4geyBzdmdQbG90dGluZ0FyZWFXaWR0aCwgYmFySGVpZ2h0LCBzcGFjZUJldHdlZW5CYXJzIH07XG4gIH1cblxuICBwcml2YXRlIHhDb29yZGluYXRlcyhcbiAgICBtaW5NYXhTZXJpZXNWYWx1ZXM6IFBvQ2hhcnRNaW5NYXhWYWx1ZXMsXG4gICAgc3ZnUGxvdHRpbmdBcmVhV2lkdGg6IG51bWJlcixcbiAgICBheGlzWExhYmVsV2lkdGg6IFBvQ2hhcnRDb250YWluZXJTaXplWydheGlzWExhYmVsV2lkdGgnXSxcbiAgICBzdmdXaWR0aDogUG9DaGFydENvbnRhaW5lclNpemVbJ3N2Z1dpZHRoJ10sXG4gICAgc2VyaWVWYWx1ZTogbnVtYmVyXG4gICkge1xuICAgIGNvbnN0IHsgbWluVmFsdWUgfSA9IG1pbk1heFNlcmllc1ZhbHVlcztcbiAgICBjb25zdCB2YWx1ZVplcm9QZXJjZW50YWdlID0gdGhpcy5tYXRoc1NlcnZpY2UuZ2V0U2VyaWVQZXJjZW50YWdlKG1pbk1heFNlcmllc1ZhbHVlcywgbWluVmFsdWUgPCAwID8gMCA6IG1pblZhbHVlKTtcbiAgICBjb25zdCB4MSA9IGF4aXNYTGFiZWxXaWR0aCArIChzdmdXaWR0aCAtIGF4aXNYTGFiZWxXaWR0aCkgKiB2YWx1ZVplcm9QZXJjZW50YWdlO1xuXG4gICAgY29uc3QgeFJhdGlvID0gdGhpcy5tYXRoc1NlcnZpY2UuZ2V0U2VyaWVQZXJjZW50YWdlKG1pbk1heFNlcmllc1ZhbHVlcywgc2VyaWVWYWx1ZSk7XG4gICAgY29uc3QgeDIgPSBNYXRoLnJvdW5kKHN2Z1Bsb3R0aW5nQXJlYVdpZHRoICogeFJhdGlvICsgYXhpc1hMYWJlbFdpZHRoKTtcblxuICAgIHJldHVybiB7IHgxLCB4MiB9O1xuICB9XG5cbiAgcHJpdmF0ZSB5Q29vcmRpbmF0ZXMoXG4gICAgc2VyaWVzSW5kZXg6IG51bWJlcixcbiAgICBzZXJpZUl0ZW1EYXRhSW5kZXg6IG51bWJlcixcbiAgICBzdmdQbG90dGluZ0FyZWFIZWlnaHQ6IG51bWJlcixcbiAgICBiYXJIZWlnaHQ6IG51bWJlcixcbiAgICBzcGFjZUJldHdlZW5CYXJzOiBudW1iZXJcbiAgKSB7XG4gICAgY29uc3Qgc3BhY2VCZXR3ZWVuQXhpc0FuZEJhcnMgPSBiYXJIZWlnaHQ7XG4gICAgY29uc3QgeVJhdGlvID0gc2VyaWVJdGVtRGF0YUluZGV4IC8gdGhpcy5zZXJpZXNHcmVhdGVyTGVuZ3RoO1xuXG4gICAgY29uc3QgeTEgPSBNYXRoLnJvdW5kKFxuICAgICAgUG9DaGFydFBsb3RBcmVhUGFkZGluZ1RvcCArXG4gICAgICAgIHN2Z1Bsb3R0aW5nQXJlYUhlaWdodCAqIHlSYXRpbyArXG4gICAgICAgIHNwYWNlQmV0d2VlbkF4aXNBbmRCYXJzICtcbiAgICAgICAgYmFySGVpZ2h0ICogc2VyaWVzSW5kZXggK1xuICAgICAgICBzcGFjZUJldHdlZW5CYXJzICogc2VyaWVzSW5kZXhcbiAgICApO1xuXG4gICAgY29uc3QgeTIgPSBNYXRoLnJvdW5kKHkxICsgYmFySGVpZ2h0KTtcbiAgICByZXR1cm4geyB5MSwgeTIgfTtcbiAgfVxufVxuIiwiPHN2ZzpnPlxuICA8c3ZnOmcgKm5nRm9yPVwibGV0IGl0ZW0gb2Ygc2VyaWVzUGF0aHNDb29yZGluYXRlczsgbGV0IGkgPSBpbmRleDsgdHJhY2tCeTogdHJhY2tCeVwiXG4gICAgW2NsYXNzXT1cIidwby1jaGFydC1iYXItZ3JvdXAtJyArIGlcIlxuICA+XG4gICAgPCEtLSBTRVJJRVMgUEFUSFMgLS0+XG4gICAgPHN2ZzpnIHBvLWNoYXJ0LWJhci1wYXRoXG4gICAgICBbYXR0ci5rZXldPVwiJ3BvLWNoYXJ0LWJhci1wYXRoLScgKyBpXCJcbiAgICAgIFtwLWNvbG9yXT1cIml0ZW1bMF0/LmNvbG9yXCIgXG4gICAgICBbcC1jb29yZGluYXRlc109XCJpdGVtXCJcbiAgICAgIFtwLXRvb2x0aXAtcG9zaXRpb25dPVwidG9vbHRpcFBvc2l0aW9uXCJcbiAgICAgIChwLWJhci1jbGljayk9XCJvblNlcmllQmFyQ2xpY2soJGV2ZW50KVwiXG4gICAgICAocC1iYXItaG92ZXIpPVwib25TZXJpZUJhckhvdmVyKCRldmVudClcIlxuICAgICAgPlxuICAgICAgPC9zdmc6Zz5cbiAgPC9zdmc6Zz5cbjwvc3ZnOmc+Il19