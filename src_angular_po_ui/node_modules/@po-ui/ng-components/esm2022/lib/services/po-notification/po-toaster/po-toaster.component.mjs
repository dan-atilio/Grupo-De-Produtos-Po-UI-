import { Component, ViewChild } from '@angular/core';
import { Subject } from 'rxjs';
import { poToasterLiterals } from './po-toaster.literals';
import { PoToasterBaseComponent } from './po-toaster-base.component';
import { PoToasterType } from './po-toaster-type.enum';
import { PoToasterOrientation } from './po-toaster-orientation.enum';
import * as i0 from "@angular/core";
import * as i1 from "../../po-language/po-language.service";
import * as i2 from "@angular/common";
import * as i3 from "../../../components/po-button/po-button.component";
import * as i4 from "../../../components/po-icon/po-icon.component";
const _c0 = ["toaster"];
const _c1 = ["buttonClose"];
function PoToasterComponent_po_button_8_Template(rf, ctx) { if (rf & 1) {
    const _r4 = i0.ɵɵgetCurrentView();
    i0.ɵɵelementStart(0, "po-button", 11);
    i0.ɵɵlistener("p-click", function PoToasterComponent_po_button_8_Template_po_button_p_click_0_listener($event) { i0.ɵɵrestoreView(_r4); const ctx_r3 = i0.ɵɵnextContext(); return i0.ɵɵresetView(ctx_r3.poToasterAction($event)); });
    i0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = i0.ɵɵnextContext();
    i0.ɵɵproperty("p-label", ctx_r1.actionLabel);
} }
const SPACE_BETWEEN_TOASTERS = 8;
/**
 * @docsPrivate
 *
 * @docsExtends PoToasterBaseComponent
 */
export class PoToasterComponent extends PoToasterBaseComponent {
    changeDetector;
    renderer;
    /* Componente toaster */
    toaster;
    buttonClose;
    alive = true;
    language;
    literals;
    /* Ícone do Toaster */
    icon;
    /* Margem do Toaster referênte à sua orientação e posição*/
    margin = 0;
    /* Observable para monitorar o Close to Toaster */
    observableOnClose = new Subject();
    /* Posição do Toaster*/
    toasterPosition = 'po-toaster-bottom';
    /* Tipo do Toaster */
    toasterType;
    constructor(poLanguageService, changeDetector, renderer) {
        super();
        this.changeDetector = changeDetector;
        this.renderer = renderer;
        this.language = poLanguageService.getShortLanguage();
        this.literals = {
            ...poToasterLiterals[this.language]
        };
    }
    ngOnDestroy() {
        this.alive = false;
    }
    ngAfterViewInit() {
        setTimeout(() => this.renderer.addClass(this.toaster.nativeElement, 'po-toaster-visible'));
    }
    /* Muda a posição do Toaster na tela*/
    changePosition(position) {
        setTimeout(() => {
            this.margin = SPACE_BETWEEN_TOASTERS;
            for (let i = 0; i < position; i++) {
                this.margin += this.returnHeightToaster(i) + SPACE_BETWEEN_TOASTERS;
            }
            if (this.orientation === PoToasterOrientation.Top) {
                this.toaster.nativeElement.style.top = this.margin + 'px';
            }
            else {
                this.toaster.nativeElement.style.bottom = this.margin + 'px';
            }
        });
    }
    /* Fecha o componente Toaster */
    close() {
        this.observableOnClose.next(true);
    }
    setFadeOut() {
        this.renderer.removeClass(this.toaster.nativeElement, 'po-toaster-visible');
        this.renderer.addClass(this.toaster.nativeElement, 'po-toaster-invisible');
    }
    /* Configura o Toaster com os atributos passados para ele */
    configToaster(poToaster) {
        this.type = poToaster.type;
        this.message = poToaster.message;
        this.orientation = poToaster.orientation;
        this.position = poToaster.position;
        this.action = poToaster.action;
        this.actionLabel = poToaster.actionLabel;
        this.componentRef = poToaster.componentRef;
        /* Muda a orientação do Toaster */
        if (this.orientation === PoToasterOrientation.Top) {
            this.toasterPosition = 'po-toaster-top';
        }
        /* Muda a posição do Toaster */
        this.changePosition(this.position);
        if (this.type === PoToasterType.Error) {
            this.toaster.nativeElement.setAttribute('role', 'alert');
        }
        else if (this.action && this.actionLabel) {
            this.toaster.nativeElement.setAttribute('role', 'alertdialog');
        }
        else {
            this.toaster.nativeElement.setAttribute('role', 'status');
        }
        /* Switch para o tipo de Toaster */
        switch (this.type) {
            case PoToasterType.Error: {
                this.toasterType = 'po-toaster-error';
                this.icon = 'ICON_WARNING';
                break;
            }
            case PoToasterType.Information: {
                this.toasterType = 'po-toaster-info';
                this.icon = 'ICON_INFO';
                break;
            }
            case PoToasterType.Success: {
                this.toasterType = 'po-toaster-success';
                this.icon = 'ICON_OK';
                break;
            }
            case PoToasterType.Warning: {
                this.toasterType = 'po-toaster-warning';
                this.icon = 'ICON_WARNING';
                break;
            }
        }
        this.buttonClose.buttonElement.nativeElement.setAttribute('aria-label', this.literals.close);
        this.changeDetector.detectChanges();
    }
    getIcon() {
        return this.icon;
    }
    getToasterPosition() {
        return this.toasterPosition;
    }
    getToasterType() {
        return this.toasterType;
    }
    onButtonClose(event) {
        if (this.action && !this.actionLabel) {
            this.poToasterAction(event);
        }
        else {
            this.close();
        }
    }
    /* Chama a função passada pelo atributo `action` */
    poToasterAction(event) {
        this.action(this);
    }
    returnHeightToaster(position) {
        if (this.orientation === PoToasterOrientation.Top) {
            return document.querySelectorAll('.po-toaster-top')[position].offsetHeight;
        }
        return document.querySelectorAll('.po-toaster-bottom')[position].offsetHeight;
    }
    static ɵfac = function PoToasterComponent_Factory(t) { return new (t || PoToasterComponent)(i0.ɵɵdirectiveInject(i1.PoLanguageService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i0.Renderer2)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoToasterComponent, selectors: [["po-toaster"]], viewQuery: function PoToasterComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(_c0, 5);
            i0.ɵɵviewQuery(_c1, 5);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.toaster = _t.first);
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.buttonClose = _t.first);
        } }, features: [i0.ɵɵInheritDefinitionFeature], decls: 13, vars: 7, consts: [["toaster", ""], [1, "po-toaster-icon"], [3, "p-icon"], [1, "po-toaster-actions"], [1, "po-toaster-message"], [1, "po-toaster-action"], ["p-kind", "tertiary", 3, "p-label", "p-click", 4, "ngIf"], [1, "po-toaster-close"], [1, "po-toaster-divider"], ["p-icon", "ICON_CLOSE", "p-kind", "tertiary", 1, "po-toaster-button-close", 3, "p-click"], ["buttonClose", ""], ["p-kind", "tertiary", 3, "p-label", "p-click"]], template: function PoToasterComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵelementStart(0, "div", null, 0)(2, "div", 1);
            i0.ɵɵelement(3, "po-icon", 2);
            i0.ɵɵelementEnd();
            i0.ɵɵelementStart(4, "div", 3)(5, "div", 4);
            i0.ɵɵtext(6);
            i0.ɵɵelementEnd();
            i0.ɵɵelementStart(7, "div", 5);
            i0.ɵɵtemplate(8, PoToasterComponent_po_button_8_Template, 1, 1, "po-button", 6);
            i0.ɵɵelementEnd()();
            i0.ɵɵelementStart(9, "div", 7);
            i0.ɵɵelement(10, "div", 8);
            i0.ɵɵelementStart(11, "po-button", 9, 10);
            i0.ɵɵlistener("p-click", function PoToasterComponent_Template_po_button_p_click_11_listener($event) { return ctx.onButtonClose($event); });
            i0.ɵɵelementEnd()()();
        } if (rf & 2) {
            i0.ɵɵclassMapInterpolate2("po-toaster ", ctx.getToasterType(), " ", ctx.getToasterPosition(), "");
            i0.ɵɵadvance(3);
            i0.ɵɵproperty("p-icon", ctx.getIcon());
            i0.ɵɵadvance(3);
            i0.ɵɵtextInterpolate(ctx.message);
            i0.ɵɵadvance(2);
            i0.ɵɵproperty("ngIf", ctx.action && ctx.actionLabel);
        } }, dependencies: [i2.NgIf, i3.PoButtonComponent, i4.PoIconComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoToasterComponent, [{
        type: Component,
        args: [{ selector: 'po-toaster', template: "<div #toaster class=\"po-toaster {{ getToasterType() }} {{ getToasterPosition() }}\">\n  <div class=\"po-toaster-icon\">\n    <po-icon [p-icon]=\"getIcon()\"></po-icon>\n  </div>\n\n  <div class=\"po-toaster-actions\">\n    <div class=\"po-toaster-message\">{{ message }}</div>\n    <div class=\"po-toaster-action\">\n      <po-button\n        *ngIf=\"action && actionLabel\"\n        (p-click)=\"poToasterAction($event)\"\n        [p-label]=\"actionLabel\"\n        p-kind=\"tertiary\"\n      ></po-button>\n    </div>\n  </div>\n\n  <div class=\"po-toaster-close\">\n    <div class=\"po-toaster-divider\"></div>\n    <po-button\n      #buttonClose\n      class=\"po-toaster-button-close\"\n      (p-click)=\"onButtonClose($event)\"\n      p-icon=\"ICON_CLOSE\"\n      p-kind=\"tertiary\"\n    ></po-button>\n  </div>\n</div>\n" }]
    }], () => [{ type: i1.PoLanguageService }, { type: i0.ChangeDetectorRef }, { type: i0.Renderer2 }], { toaster: [{
            type: ViewChild,
            args: ['toaster']
        }], buttonClose: [{
            type: ViewChild,
            args: ['buttonClose']
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoToasterComponent, { className: "PoToasterComponent", filePath: "lib/services/po-notification/po-toaster/po-toaster.component.ts", lineNumber: 33 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdG9hc3Rlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL3NlcnZpY2VzL3BvLW5vdGlmaWNhdGlvbi9wby10b2FzdGVyL3BvLXRvYXN0ZXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9zZXJ2aWNlcy9wby1ub3RpZmljYXRpb24vcG8tdG9hc3Rlci9wby10b2FzdGVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCxTQUFTLEVBSVQsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFHL0IsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFMUQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFckUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLCtCQUErQixDQUFDOzs7Ozs7Ozs7O0lDVi9ELHFDQUtDO0lBSEMsa0xBQVcsZUFBQSw4QkFBdUIsQ0FBQSxJQUFDO0lBR3BDLGlCQUFZOzs7SUFGWCw0Q0FBdUI7O0FEVS9CLE1BQU0sc0JBQXNCLEdBQUcsQ0FBQyxDQUFDO0FBRWpDOzs7O0dBSUc7QUFLSCxNQUFNLE9BQU8sa0JBQW1CLFNBQVEsc0JBQXNCO0lBc0JuRDtJQUNDO0lBdEJWLHdCQUF3QjtJQUNGLE9BQU8sQ0FBYTtJQUNoQixXQUFXLENBQW9CO0lBRXpELEtBQUssR0FBWSxJQUFJLENBQUM7SUFDdEIsUUFBUSxDQUFTO0lBQ2pCLFFBQVEsQ0FBTTtJQUVkLHNCQUFzQjtJQUNkLElBQUksQ0FBUztJQUNyQiwyREFBMkQ7SUFDbkQsTUFB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QUFDO0lBQ2pHLENBQUM7NEVBdkpVLGtCQUFrQjs2REFBbEIsa0JBQWtCOzs7Ozs7OztZQ2hDL0Isb0NBQW1GLGFBQUE7WUFFL0UsNkJBQXdDO1lBQzFDLGlCQUFNO1lBRU4sOEJBQWdDLGFBQUE7WUFDRSxZQUFhO1lBQUEsaUJBQU07WUFDbkQsOEJBQStCO1lBQzdCLCtFQUthO1lBQ2YsaUJBQU0sRUFBQTtZQUdSLDhCQUE4QjtZQUM1QiwwQkFBc0M7WUFDdEMseUNBTUM7WUFIQyw2R0FBVyx5QkFBcUIsSUFBQztZQUdsQyxpQkFBWSxFQUFBLEVBQUE7O1lBekJILGlHQUFvRTtZQUVyRSxlQUFvQjtZQUFwQixzQ0FBb0I7WUFJRyxlQUFhO1lBQWIsaUNBQWE7WUFHeEMsZUFBMkI7WUFBM0Isb0RBQTJCOzs7aUZEdUJ2QixrQkFBa0I7Y0FKOUIsU0FBUzsyQkFDRSxZQUFZOzBHQUtBLE9BQU87a0JBQTVCLFNBQVM7bUJBQUMsU0FBUztZQUNNLFdBQVc7a0JBQXBDLFNBQVM7bUJBQUMsYUFBYTs7a0ZBSGIsa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgT25EZXN0cm95LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uLy4uL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgcG9Ub2FzdGVyTGl0ZXJhbHMgfSBmcm9tICcuL3BvLXRvYXN0ZXIubGl0ZXJhbHMnO1xuXG5pbXBvcnQgeyBQb1RvYXN0ZXJCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby10b2FzdGVyLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFBvVG9hc3RlciB9IGZyb20gJy4vcG8tdG9hc3Rlci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9Ub2FzdGVyVHlwZSB9IGZyb20gJy4vcG8tdG9hc3Rlci10eXBlLmVudW0nO1xuaW1wb3J0IHsgUG9Ub2FzdGVyT3JpZW50YXRpb24gfSBmcm9tICcuL3BvLXRvYXN0ZXItb3JpZW50YXRpb24uZW51bSc7XG5pbXBvcnQgeyBQb0J1dHRvbkNvbXBvbmVudCB9IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvcG8tYnV0dG9uL3BvLWJ1dHRvbi5jb21wb25lbnQnO1xuXG5jb25zdCBTUEFDRV9CRVRXRUVOX1RPQVNURVJTID0gODtcblxuLyoqXG4gKiBAZG9jc1ByaXZhdGVcbiAqXG4gKiBAZG9jc0V4dGVuZHMgUG9Ub2FzdGVyQmFzZUNvbXBvbmVudFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby10b2FzdGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLXRvYXN0ZXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvVG9hc3RlckNvbXBvbmVudCBleHRlbmRzIFBvVG9hc3RlckJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICAvKiBDb21wb25lbnRlIHRvYXN0ZXIgKi9cbiAgQFZpZXdDaGlsZCgndG9hc3RlcicpIHRvYXN0ZXI6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2J1dHRvbkNsb3NlJykgYnV0dG9uQ2xvc2U6IFBvQnV0dG9uQ29tcG9uZW50O1xuXG4gIGFsaXZlOiBib29sZWFuID0gdHJ1ZTtcbiAgbGFuZ3VhZ2U6IHN0cmluZztcbiAgbGl0ZXJhbHM6IGFueTtcblxuICAvKiDDjWNvbmUgZG8gVG9hc3RlciAqL1xuICBwcml2YXRlIGljb246IHN0cmluZztcbiAgLyogTWFyZ2VtIGRvIFRvYXN0ZXIgcmVmZXLDqm50ZSDDoCBzdWEgb3JpZW50YcOnw6NvIGUgcG9zacOnw6NvKi9cbiAgcHJpdmF0ZSBtYXJnaW46IG51bWJlciA9IDA7XG4gIC8qIE9ic2VydmFibGUgcGFyYSBtb25pdG9yYXIgbyBDbG9zZSB0byBUb2FzdGVyICovXG4gIHByaXZhdGUgb2JzZXJ2YWJsZU9uQ2xvc2UgPSBuZXcgU3ViamVjdDxhbnk+KCk7XG4gIC8qIFBvc2nDp8OjbyBkbyBUb2FzdGVyKi9cbiAgcHJpdmF0ZSB0b2FzdGVyUG9zaXRpb246IHN0cmluZyA9ICdwby10b2FzdGVyLWJvdHRvbSc7XG4gIC8qIFRpcG8gZG8gVG9hc3RlciAqL1xuICBwcml2YXRlIHRvYXN0ZXJUeXBlOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcG9MYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlLFxuICAgIHB1YmxpYyBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSByZW5kZXJlcj86IFJlbmRlcmVyMlxuICApIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMubGFuZ3VhZ2UgPSBwb0xhbmd1YWdlU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCk7XG4gICAgdGhpcy5saXRlcmFscyA9IHtcbiAgICAgIC4uLnBvVG9hc3RlckxpdGVyYWxzW3RoaXMubGFuZ3VhZ2VdXG4gICAgfTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuYWxpdmUgPSBmYWxzZTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy50b2FzdGVyLm5hdGl2ZUVsZW1lbnQsICdwby10b2FzdGVyLXZpc2libGUnKSk7XG4gIH1cblxuICAvKiBNdWRhIGEgcG9zacOnw6NvIGRvIFRvYXN0ZXIgbmEgdGVsYSovXG4gIGNoYW5nZVBvc2l0aW9uKHBvc2l0aW9uOiBudW1iZXIpOiB2b2lkIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMubWFyZ2luID0gU1BBQ0VfQkVUV0VFTl9UT0FTVEVSUztcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb3NpdGlvbjsgaSsrKSB7XG4gICAgICAgIHRoaXMubWFyZ2luICs9IHRoaXMucmV0dXJuSGVpZ2h0VG9hc3RlcihpKSArIFNQQUNFX0JFVFdFRU5fVE9BU1RFUlM7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9yaWVudGF0aW9uID09PSBQb1RvYXN0ZXJPcmllbnRhdGlvbi5Ub3ApIHtcbiAgICAgICAgdGhpcy50b2FzdGVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUudG9wID0gdGhpcy5tYXJnaW4gKyAncHgnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50b2FzdGVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUuYm90dG9tID0gdGhpcy5tYXJnaW4gKyAncHgnO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyogRmVjaGEgbyBjb21wb25lbnRlIFRvYXN0ZXIgKi9cbiAgY2xvc2UoKTogdm9pZCB7XG4gICAgdGhpcy5vYnNlcnZhYmxlT25DbG9zZS5uZXh0KHRydWUpO1xuICB9XG5cbiAgc2V0RmFkZU91dCgpIHtcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMudG9hc3Rlci5uYXRpdmVFbGVtZW50LCAncG8tdG9hc3Rlci12aXNpYmxlJyk7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLnRvYXN0ZXIubmF0aXZlRWxlbWVudCwgJ3BvLXRvYXN0ZXItaW52aXNpYmxlJyk7XG4gIH1cblxuICAvKiBDb25maWd1cmEgbyBUb2FzdGVyIGNvbSBvcyBhdHJpYnV0b3MgcGFzc2Fkb3MgcGFyYSBlbGUgKi9cbiAgY29uZmlnVG9hc3Rlcihwb1RvYXN0ZXI6IFBvVG9hc3Rlcikge1xuICAgIHRoaXMudHlwZSA9IHBvVG9hc3Rlci50eXBlO1xuICAgIHRoaXMubWVzc2FnZSA9IHBvVG9hc3Rlci5tZXNzYWdlO1xuICAgIHRoaXMub3JpZW50YXRpb24gPSBwb1RvYXN0ZXIub3JpZW50YXRpb247XG4gICAgdGhpcy5wb3NpdGlvbiA9IHBvVG9hc3Rlci5wb3NpdGlvbjtcbiAgICB0aGlzLmFjdGlvbiA9IHBvVG9hc3Rlci5hY3Rpb247XG4gICAgdGhpcy5hY3Rpb25MYWJlbCA9IHBvVG9hc3Rlci5hY3Rpb25MYWJlbDtcbiAgICB0aGlzLmNvbXBvbmVudFJlZiA9IHBvVG9hc3Rlci5jb21wb25lbnRSZWY7XG5cbiAgICAvKiBNdWRhIGEgb3JpZW50YcOnw6NvIGRvIFRvYXN0ZXIgKi9cbiAgICBpZiAodGhpcy5vcmllbnRhdGlvbiA9PT0gUG9Ub2FzdGVyT3JpZW50YXRpb24uVG9wKSB7XG4gICAgICB0aGlzLnRvYXN0ZXJQb3NpdGlvbiA9ICdwby10b2FzdGVyLXRvcCc7XG4gICAgfVxuXG4gICAgLyogTXVkYSBhIHBvc2nDp8OjbyBkbyBUb2FzdGVyICovXG4gICAgdGhpcy5jaGFuZ2VQb3NpdGlvbih0aGlzLnBvc2l0aW9uKTtcblxuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvVG9hc3RlclR5cGUuRXJyb3IpIHtcbiAgICAgIHRoaXMudG9hc3Rlci5uYXRpdmVFbGVtZW50LnNldEF0dHJpYnV0ZSgncm9sZScsICdhbGVydCcpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5hY3Rpb24gJiYgdGhpcy5hY3Rpb25MYWJlbCkge1xuICAgICAgdGhpcy50b2FzdGVyLm5hdGl2ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2FsZXJ0ZGlhbG9nJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudG9hc3Rlci5uYXRpdmVFbGVtZW50LnNldEF0dHJpYnV0ZSgncm9sZScsICdzdGF0dXMnKTtcbiAgICB9XG5cbiAgICAvKiBTd2l0Y2ggcGFyYSBvIHRpcG8gZGUgVG9hc3RlciAqL1xuICAgIHN3aXRjaCAodGhpcy50eXBlKSB7XG4gICAgICBjYXNlIFBvVG9hc3RlclR5cGUuRXJyb3I6IHtcbiAgICAgICAgdGhpcy50b2FzdGVyVHlwZSA9ICdwby10b2FzdGVyLWVycm9yJztcbiAgICAgICAgdGhpcy5pY29uID0gJ0lDT05fV0FSTklORyc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBQb1RvYXN0ZXJUeXBlLkluZm9ybWF0aW9uOiB7XG4gICAgICAgIHRoaXMudG9hc3RlclR5cGUgPSAncG8tdG9hc3Rlci1pbmZvJztcbiAgICAgICAgdGhpcy5pY29uID0gJ0lDT05fSU5GTyc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBQb1RvYXN0ZXJUeXBlLlN1Y2Nlc3M6IHtcbiAgICAgICAgdGhpcy50b2FzdGVyVHlwZSA9ICdwby10b2FzdGVyLXN1Y2Nlc3MnO1xuICAgICAgICB0aGlzLmljb24gPSAnSUNPTl9PSyc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBQb1RvYXN0ZXJUeXBlLldhcm5pbmc6IHtcbiAgICAgICAgdGhpcy50b2FzdGVyVHlwZSA9ICdwby10b2FzdGVyLXdhcm5pbmcnO1xuICAgICAgICB0aGlzLmljb24gPSAnSUNPTl9XQVJOSU5HJztcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5idXR0b25DbG9zZS5idXR0b25FbGVtZW50Lm5hdGl2ZUVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgdGhpcy5saXRlcmFscy5jbG9zZSk7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBnZXRJY29uKCkge1xuICAgIHJldHVybiB0aGlzLmljb247XG4gIH1cblxuICBnZXRUb2FzdGVyUG9zaXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMudG9hc3RlclBvc2l0aW9uO1xuICB9XG5cbiAgZ2V0VG9hc3RlclR5cGUoKSB7XG4gICAgcmV0dXJuIHRoaXMudG9hc3RlclR5cGU7XG4gIH1cblxuICBvbkJ1dHRvbkNsb3NlKGV2ZW50KSB7XG4gICAgaWYgKHRoaXMuYWN0aW9uICYmICF0aGlzLmFjdGlvbkxhYmVsKSB7XG4gICAgICB0aGlzLnBvVG9hc3RlckFjdGlvbihldmVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICAvKiBDaGFtYSBhIGZ1bsOnw6NvIHBhc3NhZGEgcGVsbyBhdHJpYnV0byBgYWN0aW9uYCAqL1xuICBwb1RvYXN0ZXJBY3Rpb24oZXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLmFjdGlvbih0aGlzKTtcbiAgfVxuXG4gIHByaXZhdGUgcmV0dXJuSGVpZ2h0VG9hc3Rlcihwb3NpdGlvbikge1xuICAgIGlmICh0aGlzLm9yaWVudGF0aW9uID09PSBQb1RvYXN0ZXJPcmllbnRhdGlvbi5Ub3ApIHtcbiAgICAgIHJldHVybiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvLXRvYXN0ZXItdG9wJylbcG9zaXRpb25dIGFzIEhUTUxFbGVtZW50KS5vZmZzZXRIZWlnaHQ7XG4gICAgfVxuICAgIHJldHVybiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvLXRvYXN0ZXItYm90dG9tJylbcG9zaXRpb25dIGFzIEhUTUxFbGVtZW50KS5vZmZzZXRIZWlnaHQ7XG4gIH1cbn1cbiIsIjxkaXYgI3RvYXN0ZXIgY2xhc3M9XCJwby10b2FzdGVyIHt7IGdldFRvYXN0ZXJUeXBlKCkgfX0ge3sgZ2V0VG9hc3RlclBvc2l0aW9uKCkgfX1cIj5cbiAgPGRpdiBjbGFzcz1cInBvLXRvYXN0ZXItaWNvblwiPlxuICAgIDxwby1pY29uIFtwLWljb25dPVwiZ2V0SWNvbigpXCI+PC9wby1pY29uPlxuICA8L2Rpdj5cblxuICA8ZGl2IGNsYXNzPVwicG8tdG9hc3Rlci1hY3Rpb25zXCI+XG4gICAgPGRpdiBjbGFzcz1cInBvLXRvYXN0ZXItbWVzc2FnZVwiPnt7IG1lc3NhZ2UgfX08L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwicG8tdG9hc3Rlci1hY3Rpb25cIj5cbiAgICAgIDxwby1idXR0b25cbiAgICAgICAgKm5nSWY9XCJhY3Rpb24gJiYgYWN0aW9uTGFiZWxcIlxuICAgICAgICAocC1jbGljayk9XCJwb1RvYXN0ZXJBY3Rpb24oJGV2ZW50KVwiXG4gICAgICAgIFtwLWxhYmVsXT1cImFjdGlvbkxhYmVsXCJcbiAgICAgICAgcC1raW5kPVwidGVydGlhcnlcIlxuICAgICAgPjwvcG8tYnV0dG9uPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cblxuICA8ZGl2IGNsYXNzPVwicG8tdG9hc3Rlci1jbG9zZVwiPlxuICAgIDxkaXYgY2xhc3M9XCJwby10b2FzdGVyLWRpdmlkZXJcIj48L2Rpdj5cbiAgICA8cG8tYnV0dG9uXG4gICAgICAjYnV0dG9uQ2xvc2VcbiAgICAgIGNsYXNzPVwicG8tdG9hc3Rlci1idXR0b24tY2xvc2VcIlxuICAgICAgKHAtY2xpY2spPVwib25CdXR0b25DbG9zZSgkZXZlbnQpXCJcbiAgICAgIHAtaWNvbj1cIklDT05fQ0xPU0VcIlxuICAgICAgcC1raW5kPVwidGVydGlhcnlcIlxuICAgID48L3BvLWJ1dHRvbj5cbiAgPC9kaXY+XG48L2Rpdj5cbiJdfQ==