import { Component, ViewChild } from '@angular/core';
import { poLocaleDefault } from '../po-language/po-language.constant';
import { PoDialogType } from './po-dialog.enum';
import { PoModalComponent } from '../../components/po-modal/po-modal.component';
import * as i0 from "@angular/core";
import * as i1 from "../po-language/po-language.service";
import * as i2 from "../../components/po-modal/po-modal.component";
export const poDialogAlertLiteralsDefault = {
    en: { ok: 'Ok' },
    es: { ok: 'Ok' },
    pt: { ok: 'Ok' },
    ru: { ok: 'Ок' }
};
export const poDialogConfirmLiteralsDefault = {
    en: { cancel: 'Cancel', confirm: 'Confirm' },
    es: { cancel: 'Cancelar', confirm: 'Confirmar' },
    pt: { cancel: 'Cancelar', confirm: 'Confirmar' },
    ru: { cancel: 'отменить', confirm: 'подтвердить' }
};
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente que serve como container do po-dialog.service
 */
export class PoDialogComponent {
    // ViewChild para o uso do po-modal.component
    poModal;
    // Title do poModal
    title;
    // Message do poModal
    message;
    // Objeto primary do poModal
    primaryAction = { label: 'ok', action: () => { } };
    // Objeto secondary do poModal
    secondaryAction;
    // Callback executado ao fechar o poModal
    closeAction;
    // Literais usadas nos botão de alerta do poModal
    literalsAlert;
    // Literais usadas nos botões de confirmação do poModal
    literalsConfirm;
    // Atributo para armazenar a referencia do componente criado via serviço.
    componentRef;
    closeSubscription;
    language;
    constructor(languageService) {
        this.language = languageService.getShortLanguage();
    }
    ngOnDestroy() {
        this.closeSubscription.unsubscribe();
    }
    ngOnInit() {
        this.closeSubscription = this.poModal.onXClosed.subscribe(close => this.close(true));
    }
    // Fecha o poModal
    close(xClosed = false) {
        if (xClosed && this.closeAction) {
            this.closeAction();
        }
        this.poModal.close();
        this.destroy();
    }
    destroy() {
        if (this.componentRef) {
            this.componentRef.destroy();
        }
    }
    // Insere os valores recebidos de this.open para o poModal
    configDialog(primaryLabel, primaryAction, secondaryLabel, secondaryAction, closeAction) {
        this.primaryAction = {
            label: primaryLabel,
            action: () => {
                if (primaryAction) {
                    primaryAction();
                }
                this.close();
            }
        };
        if (secondaryLabel) {
            this.secondaryAction = {
                label: secondaryLabel,
                action: () => {
                    if (secondaryAction) {
                        secondaryAction();
                    }
                    this.close();
                }
            };
        }
        this.closeAction = closeAction;
    }
    // Insere os valores recebidos de po-dialog.service de acordo com o tipo de diálago solicitado
    open(dialogOptions, dialogType, componentRef) {
        this.title = dialogOptions.title;
        this.message = dialogOptions.message;
        this.componentRef = componentRef;
        this.setDialogLiterals(dialogOptions, dialogType);
        switch (dialogType) {
            case PoDialogType.Confirm: {
                this.configDialog(this.literalsConfirm.confirm, dialogOptions.confirm, this.literalsConfirm.cancel, dialogOptions.cancel, dialogOptions.close);
                break;
            }
            case PoDialogType.Alert: {
                this.configDialog(this.literalsAlert.ok, dialogOptions.ok);
                break;
            }
        }
        this.poModal.open();
    }
    setDialogLiterals(dialogOptions, dialogType) {
        const alertLiterals = poDialogAlertLiteralsDefault;
        const confirmLiterals = poDialogConfirmLiteralsDefault;
        const literals = dialogOptions.literals;
        if (dialogType === PoDialogType.Alert) {
            this.literalsAlert = { ...alertLiterals[poLocaleDefault], ...alertLiterals[this.language], ...literals };
        }
        else {
            this.literalsConfirm = {
                ...confirmLiterals[poLocaleDefault],
                ...confirmLiterals[this.language],
                ...literals
            };
        }
    }
    static ɵfac = function PoDialogComponent_Factory(t) { return new (t || PoDialogComponent)(i0.ɵɵdirectiveInject(i1.PoLanguageService)); };
    static ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: PoDialogComponent, selectors: [["ng-component"]], viewQuery: function PoDialogComponent_Query(rf, ctx) { if (rf & 1) {
            i0.ɵɵviewQuery(PoModalComponent, 7);
        } if (rf & 2) {
            let _t;
            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.poModal = _t.first);
        } }, decls: 2, vars: 4, consts: [[3, "p-title", "p-primary-action", "p-secondary-action"], [3, "innerHtml"]], template: function PoDialogComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵelementStart(0, "po-modal", 0);
            i0.ɵɵelement(1, "div", 1);
            i0.ɵɵelementEnd();
        } if (rf & 2) {
            i0.ɵɵproperty("p-title", ctx.title)("p-primary-action", ctx.primaryAction)("p-secondary-action", ctx.secondaryAction);
            i0.ɵɵadvance();
            i0.ɵɵproperty("innerHtml", ctx.message, i0.ɵɵsanitizeHtml);
        } }, dependencies: [i2.PoModalComponent], encapsulation: 2 });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoDialogComponent, [{
        type: Component,
        args: [{ template: "<po-modal [p-title]=\"title\" [p-primary-action]=\"primaryAction\" [p-secondary-action]=\"secondaryAction\">\n  <div [innerHtml]=\"message\"></div>\n</po-modal>\n" }]
    }], () => [{ type: i1.PoLanguageService }], { poModal: [{
            type: ViewChild,
            args: [PoModalComponent, { static: true }]
        }] }); })();
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassDebugInfo(PoDialogComponent, { className: "PoDialogComponent", filePath: "lib/services/po-dialog/po-dialog.component.ts", lineNumber: 41 }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvc2VydmljZXMvcG8tZGlhbG9nL3BvLWRpYWxvZy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL3NlcnZpY2VzL3BvLWRpYWxvZy9wby1kaWFsb2cuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBbUMsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSXRGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQU90RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFaEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOENBQThDLENBQUM7Ozs7QUFFaEYsTUFBTSxDQUFDLE1BQU0sNEJBQTRCLEdBQUc7SUFDMUMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7Q0FDeEMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLDhCQUE4QixHQUFHO0lBQzVDLEVBQUUsRUFBMkIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUU7SUFDckUsRUFBRSxFQUEyQixFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRTtJQUN6RSxFQUFFLEVBQTJCLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFO0lBQ3pFLEVBQUUsRUFBMkIsRUFBRSxN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MUM3QixtQ0FBc0c7WUFDcEcseUJBQWlDO1lBQ25DLGlCQUFXOztZQUZELG1DQUFpQix1Q0FBQSwyQ0FBQTtZQUNwQixjQUFxQjtZQUFyQiwwREFBcUI7OztpRkR1Q2YsaUJBQWlCO2NBSDdCLFNBQVM7O2tEQUt1QyxPQUFPO2tCQUFyRCxTQUFTO21CQUFDLGdCQUFnQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTs7a0ZBRmxDLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29tcG9uZW50UmVmLCBPbkRlc3Ryb3ksIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBwb0xvY2FsZURlZmF1bHQgfSBmcm9tICcuLi9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5jb25zdGFudCc7XG5cbmltcG9ydCB7IFBvTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2Uuc2VydmljZSc7XG5cbmltcG9ydCB7IFBvRGlhbG9nQWxlcnRMaXRlcmFscyB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1kaWFsb2ctYWxlcnQtbGl0ZXJhbHMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvRGlhbG9nQWxlcnRPcHRpb25zLCBQb0RpYWxvZ0NvbmZpcm1PcHRpb25zIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWRpYWxvZy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9EaWFsb2dDb25maXJtTGl0ZXJhbHMgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tZGlhbG9nLWNvbmZpcm0tbGl0ZXJhbHMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvRGlhbG9nVHlwZSB9IGZyb20gJy4vcG8tZGlhbG9nLmVudW0nO1xuaW1wb3J0IHsgUG9Nb2RhbEFjdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvcG8tbW9kYWwvcG8tbW9kYWwtYWN0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb01vZGFsQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vY29tcG9uZW50cy9wby1tb2RhbC9wby1tb2RhbC5jb21wb25lbnQnO1xuXG5leHBvcnQgY29uc3QgcG9EaWFsb2dBbGVydExpdGVyYWxzRGVmYXVsdCA9IHtcbiAgZW46IDxQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM+eyBvazogJ09rJyB9LFxuICBlczogPFBvRGlhbG9nQWxlcnRMaXRlcmFscz57IG9rOiAnT2snIH0sXG4gIHB0OiA8UG9EaWFsb2dBbGVydExpdGVyYWxzPnsgb2s6ICdPaycgfSxcbiAgcnU6IDxQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM+eyBvazogJ9Ce0LonIH1cbn07XG5cbmV4cG9ydCBjb25zdCBwb0RpYWxvZ0NvbmZpcm1MaXRlcmFsc0RlZmF1bHQgPSB7XG4gIGVuOiA8UG9EaWFsb2dDb25maXJtTGl0ZXJhbHM+eyBjYW5jZWw6ICdDYW5jZWwnLCBjb25maXJtOiAnQ29uZmlybScgfSxcbiAgZXM6IDxQb0RpYWxvZ0NvbmZpcm1MaXRlcmFscz57IGNhbmNlbDogJ0NhbmNlbGFyJywgY29uZmlybTogJ0NvbmZpcm1hcicgfSxcbiAgcHQ6IDxQb0RpYWxvZ0NvbmZpcm1MaXRlcmFscz57IGNhbmNlbDogJ0NhbmNlbGFyJywgY29uZmlybTogJ0NvbmZpcm1hcicgfSxcbiAgcnU6IDxQb0RpYWxvZ0NvbmZpcm1MaXRlcmFscz57IGNhbmNlbDogJ9C+0YLQvNC10L3QuNGC0YwnLCBjb25maXJtOiAn0L/QvtC00YLQstC10YDQtNC40YLRjCcgfVxufTtcblxuLyoqXG4gKiBAZG9jc1ByaXZhdGVcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBDb21wb25lbnRlIHF1ZSBzZXJ2ZSBjb21vIGNvbnRhaW5lciBkbyBwby1kaWFsb2cuc2VydmljZVxuICovXG5cbkBDb21wb25lbnQoe1xuICB0ZW1wbGF0ZVVybDogJy4vcG8tZGlhbG9nLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb0RpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0IHtcbiAgLy8gVmlld0NoaWxkIHBhcmEgbyB1c28gZG8gcG8tbW9kYWwuY29tcG9uZW50XG4gIEBWaWV3Q2hpbGQoUG9Nb2RhbENvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgcG9Nb2RhbDogUG9Nb2RhbENvbXBvbmVudDtcblxuICAvLyBUaXRsZSBkbyBwb01vZGFsXG4gIHRpdGxlOiBzdHJpbmc7XG5cbiAgLy8gTWVzc2FnZSBkbyBwb01vZGFsXG4gIG1lc3NhZ2U6IHN0cmluZztcblxuICAvLyBPYmpldG8gcHJpbWFyeSBkbyBwb01vZGFsXG4gIHByaW1hcnlBY3Rpb246IFBvTW9kYWxBY3Rpb24gPSB7IGxhYmVsOiAnb2snLCBhY3Rpb246ICgpID0+IHt9IH07XG5cbiAgLy8gT2JqZXRvIHNlY29uZGFyeSBkbyBwb01vZGFsXG4gIHNlY29uZGFyeUFjdGlvbjogUG9Nb2RhbEFjdGlvbjtcblxuICAvLyBDYWxsYmFjayBleGVjdXRhZG8gYW8gZmVjaGFyIG8gcG9Nb2RhbFxuICBjbG9zZUFjdGlvbjogRnVuY3Rpb247XG5cbiAgLy8gTGl0ZXJhaXMgdXNhZGFzIG5vcyBib3TDo28gZGUgYWxlcnRhIGRvIHBvTW9kYWxcbiAgbGl0ZXJhbHNBbGVydDogUG9EaWFsb2dBbGVydExpdGVyYWxzO1xuXG4gIC8vIExpdGVyYWlzIHVzYWRhcyBub3MgYm90w7VlcyBkZSBjb25maXJtYcOnw6NvIGRvIHBvTW9kYWxcbiAgbGl0ZXJhbHNDb25maXJtOiBQb0RpYWxvZ0NvbmZpcm1MaXRlcmFscztcblxuICAvLyBBdHJpYnV0byBwYXJhIGFybWF6ZW5hciBhIHJlZmVyZW5jaWEgZG8gY29tcG9uZW50ZSBjcmlhZG8gdmlhIHNlcnZpw6dvLlxuICBwcml2YXRlIGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPFBvRGlhbG9nQ29tcG9uZW50PjtcbiAgcHJpdmF0ZSBjbG9zZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIGxhbmd1YWdlOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IobGFuZ3VhZ2VTZXJ2aWNlOiBQb0xhbmd1YWdlU2VydmljZSkge1xuICAgIHRoaXMubGFuZ3VhZ2UgPSBsYW5ndWFnZVNlcnZpY2UuZ2V0U2hvcnRMYW5ndWFnZSgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5jbG9zZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jbG9zZVN1YnNjcmlwdGlvbiA9IHRoaXMucG9Nb2RhbC5vblhDbG9zZWQuc3Vic2NyaWJlKGNsb3NlID0+IHRoaXMuY2xvc2UodHJ1ZSkpO1xuICB9XG5cbiAgLy8gRmVjaGEgbyBwb01vZGFsXG4gIGNsb3NlKHhDbG9zZWQgPSBmYWxzZSk6IHZvaWQge1xuICAgIGlmICh4Q2xvc2VkICYmIHRoaXMuY2xvc2VBY3Rpb24pIHtcbiAgICAgIHRoaXMuY2xvc2VBY3Rpb24oKTtcbiAgICB9XG5cbiAgICB0aGlzLnBvTW9kYWwuY2xvc2UoKTtcbiAgICB0aGlzLmRlc3Ryb3koKTtcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmKSB7XG4gICAgICB0aGlzLmNvbXBvbmVudFJlZi5kZXN0cm95KCk7XG4gICAgfVxuICB9XG5cbiAgLy8gSW5zZXJlIG9zIHZhbG9yZXMgcmVjZWJpZG9zIGRlIHRoaXMub3BlbiBwYXJhIG8gcG9Nb2RhbFxuICBjb25maWdEaWFsb2cocHJpbWFyeUxhYmVsPywgcHJpbWFyeUFjdGlvbj8sIHNlY29uZGFyeUxhYmVsPywgc2Vjb25kYXJ5QWN0aW9uPywgY2xvc2VBY3Rpb24/KSB7XG4gICAgdGhpcy5wcmltYXJ5QWN0aW9uID0ge1xuICAgICAgbGFiZWw6IHByaW1hcnlMYWJlbCxcbiAgICAgIGFjdGlvbjogKCkgPT4ge1xuICAgICAgICBpZiAocHJpbWFyeUFjdGlvbikge1xuICAgICAgICAgIHByaW1hcnlBY3Rpb24oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmIChzZWNvbmRhcnlMYWJlbCkge1xuICAgICAgdGhpcy5zZWNvbmRhcnlBY3Rpb24gPSB7XG4gICAgICAgIGxhYmVsOiBzZWNvbmRhcnlMYWJlbCxcbiAgICAgICAgYWN0aW9uOiAoKSA9PiB7XG4gICAgICAgICAgaWYgKHNlY29uZGFyeUFjdGlvbikge1xuICAgICAgICAgICAgc2Vjb25kYXJ5QWN0aW9uKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0aGlzLmNsb3NlQWN0aW9uID0gY2xvc2VBY3Rpb247XG4gIH1cblxuICAvLyBJbnNlcmUgb3MgdmFsb3JlcyByZWNlYmlkb3MgZGUgcG8tZGlhbG9nLnNlcnZpY2UgZGUgYWNvcmRvIGNvbSBvIHRpcG8gZGUgZGnDoWxhZ28gc29saWNpdGFkb1xuICBvcGVuKFxuICAgIGRpYWxvZ09wdGlvbnM6IFBvRGlhbG9nQ29uZmlybU9wdGlvbnMgfCBQb0RpYWxvZ0FsZXJ0T3B0aW9ucyxcbiAgICBkaWFsb2dUeXBlOiBQb0RpYWxvZ1R5cGUsXG4gICAgY29tcG9uZW50UmVmPzogQ29tcG9uZW50UmVmPFBvRGlhbG9nQ29tcG9uZW50PlxuICApOiB2b2lkIHtcbiAgICB0aGlzLnRpdGxlID0gZGlhbG9nT3B0aW9ucy50aXRsZTtcbiAgICB0aGlzLm1lc3NhZ2UgPSBkaWFsb2dPcHRpb25zLm1lc3NhZ2U7XG5cbiAgICB0aGlzLmNvbXBvbmVudFJlZiA9IGNvbXBvbmVudFJlZjtcblxuICAgIHRoaXMuc2V0RGlhbG9nTGl0ZXJhbHMoZGlhbG9nT3B0aW9ucywgZGlhbG9nVHlwZSk7XG5cbiAgICBzd2l0Y2ggKGRpYWxvZ1R5cGUpIHtcbiAgICAgIGNhc2UgUG9EaWFsb2dUeXBlLkNvbmZpcm06IHtcbiAgICAgICAgdGhpcy5jb25maWdEaWFsb2coXG4gICAgICAgICAgdGhpcy5saXRlcmFsc0NvbmZpcm0uY29uZmlybSxcbiAgICAgICAgICAoPFBvRGlhbG9nQ29uZmlybU9wdGlvbnM+ZGlhbG9nT3B0aW9ucykuY29uZmlybSxcbiAgICAgICAgICB0aGlzLmxpdGVyYWxzQ29uZmlybS5jYW5jZWwsXG4gICAgICAgICAgKDxQb0RpYWxvZ0NvbmZpcm1PcHRpb25zPmRpYWxvZ09wdGlvbnMpLmNhbmNlbCxcbiAgICAgICAgICAoPFBvRGlhbG9nQ29uZmlybU9wdGlvbnM+ZGlhbG9nT3B0aW9ucykuY2xvc2VcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFBvRGlhbG9nVHlwZS5BbGVydDoge1xuICAgICAgICB0aGlzLmNvbmZpZ0RpYWxvZyh0aGlzLmxpdGVyYWxzQWxlcnQub2ssICg8UG9EaWFsb2dBbGVydE9wdGlvbnM+ZGlhbG9nT3B0aW9ucykub2spO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnBvTW9kYWwub3BlbigpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXREaWFsb2dMaXRlcmFscyhkaWFsb2dPcHRpb25zOiBQb0RpYWxvZ0NvbmZpcm1PcHRpb25zIHwgUG9EaWFsb2dBbGVydE9wdGlvbnMsIGRpYWxvZ1R5cGU6IFBvRGlhbG9nVHlwZSkge1xuICAgIGNvbnN0IGFsZXJ0TGl0ZXJhbHMgPSBwb0RpYWxvZ0FsZXJ0TGl0ZXJhbHNEZWZhdWx0O1xuICAgIGNvbnN0IGNvbmZpcm1MaXRlcmFscyA9IHBvRGlhbG9nQ29uZmlybUxpdGVyYWxzRGVmYXVsdDtcbiAgICBjb25zdCBsaXRlcmFscyA9IGRpYWxvZ09wdGlvbnMubGl0ZXJhbHM7XG5cbiAgICBpZiAoZGlhbG9nVHlwZSA9PT0gUG9EaWFsb2dUeXBlLkFsZXJ0KSB7XG4gICAgICB0aGlzLmxpdGVyYWxzQWxlcnQgPSB7IC4uLmFsZXJ0TGl0ZXJhbHNbcG9Mb2NhbGVEZWZhdWx0XSwgLi4uYWxlcnRMaXRlcmFsc1t0aGlzLmxhbmd1YWdlXSwgLi4ubGl0ZXJhbHMgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5saXRlcmFsc0NvbmZpcm0gPSB7XG4gICAgICAgIC4uLmNvbmZpcm1MaXRlcmFsc1twb0xvY2FsZURlZmF1bHRdLFxuICAgICAgICAuLi5jb25maXJtTGl0ZXJhbHNbdGhpcy5sYW5ndWFnZV0sXG4gICAgICAgIC4uLmxpdGVyYWxzXG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuIiwiPHBvLW1vZGFsIFtwLXRpdGxlXT1cInRpdGxlXCIgW3AtcHJpbWFyeS1hY3Rpb25dPVwicHJpbWFyeUFjdGlvblwiIFtwLXNlY29uZGFyeS1hY3Rpb25dPVwic2Vjb25kYXJ5QWN0aW9uXCI+XG4gIDxkaXYgW2lubmVySHRtbF09XCJtZXNzYWdlXCI+PC9kaXY+XG48L3BvLW1vZGFsPlxuIl19