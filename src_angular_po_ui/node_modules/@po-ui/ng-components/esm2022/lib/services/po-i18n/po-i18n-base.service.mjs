import { HttpClient } from '@angular/common/http';
import { Directive, Inject } from '@angular/core';
import { Observable } from 'rxjs';
import { isLanguage, reloadCurrentPage } from '../../utils/util';
import { I18N_CONFIG } from './po-i18n-config-injection-token';
import * as i0 from "@angular/core";
import * as i1 from "../po-language/po-language.service";
import * as i2 from "@angular/common/http";
/**
 * @description
 *
 * O serviço `PoI18nService` possibilita utilizar múltiplos idiomas e contextos na aplicação.
 *
 * > Antes da utilização do serviço, é necessário realizar a
 * [importação e configuração do módulo `PoI18nModule`](/documentation/po-i18n#i18n-config).
 *
 * **Utilização do serviço `PoI18nService`:**
 *
 * Para utilizar o serviço basta importá-lo nos componentes que necessitarem de literais e fazer a injeção de
 * dependência no construtor:
 * ```
 *  import { PoI18nService } from '@po-ui/ng-components';
 *  ...
 *  constructor(private poI18nService: PoI18nService) { }
 *  ...
 * ```
 *
 * Por fim realizar a busca pelas literais, inscrevendo-se no [Observable](https://angular.io/guide/observables) pelo
 * método `getLiterals()`.
 *
 * > O método `getLiterals()` pode receber um objeto do tipo da interface `PoI18nLiterals` como parâmetro,
 * porém, nenhuma das propriedades são obrigatórias. Caso nenhum parâmetro seja passado, serão buscadas
 * todas as literais do contexto definido com padrão, no idioma definido como padrão.
 *
 * Exemplos de requisição:
 * ```
 * literals = {};
 * literalsEn = {};
 * literalsCrm = {};
 *
 * constructor(private poI18nService: PoI18nService) {
 *   poI18nService.getLiterals()
 *     .subscribe((literals) => {
 *       this.literals = literals;
 *     });
 *
 *   poI18nService.getLiterals({context: 'crm', literals: ['add', 'remove']})
 *     .subscribe((literals) => {
 *       this.literalsCrm = literals;
 *     });
 *
 *   poI18nService.getLiterals({language: 'en-us'})
 *     .subscribe((literals) => {
 *       this.literalsEn = literals;
 *     });
 * }
 * ```
 *
 * Para apresentar as literais capturadas acima no HTML do componente, deve-se utilizar o
 * seguinte código:
 *
 * <pre ngNonBindable>
 * {{ literals?.add }}
 * {{ literals?.remove }}
 * </pre>
 *
 * Caso as literais contenham variáveis que precisem ser substituídas, pode-se utilizar o *pipe* `poI18n`.
 * É possível informar propriedades do componente como `name` e `nickname` ou
 * informar o valor diretamente com "" ou número, conforme o exemplo abaixo:
 *
 * <pre ngNonBindable>
 * {{ literals?.people | poI18n:[120] }}
 * {{ literals?.greeting | poI18n:[name, nickname] }}
 * {{ literals?.greeting | poI18n:["Brad", "Green"] }}
 * </pre>
 *
 * > É importante o uso do operador `?` (Elvis) para evitar erros enquanto as literais não forem carregadas.
 *
 * ### Teste unitário
 *
 * Abaixo segue um exemplo de *setup* inicial de teste unitário do *AppComponent* que utiliza o `PoI18nService`:
 *
 * > Atenção: não declarar o `PoI18nService` no providers do TestBed pois a biblioteca realiza a injeção de dependência de forma dinâmica.
 * > Se o serviço for declarado o teste não fará a injeção e o teste apresentará erros.
 *
 * ```
 * import { async, TestBed } from '@angular/core/testing';
 * import { HttpClientTestingModule } from '@angular/common/http/testing';
 *
 * import { PoI18nModule } from '@po-ui/ng-components';
 *
 * import { AppComponent } from './app.component';
 *
 * describe('AppComponent', () => {
 *   const anotherPT = {
 *     text: 'texto',
 *     add: 'adicionar',
 *     remove: 'remover'
 *   };
 *
 *   const generalPT = {
 *     text: 'texto',
 *     add: 'adicionar',
 *     remove: 'remover'
 *   };
 *
 *   const config = {
 *     default: {
 *       language: 'pt-BR',
 *       context: 'general',
 *       cache: false
 *     },
 *     contexts: {
 *       general: {
 *         'pt-br': generalPT
 *       },
 *       another: {
 *         'pt-br': anotherPT
 *       }
 *     }
 *   };
 *
 *   beforeEach(async(() => {
 *     TestBed.configureTestingModule({
 *       declarations: [
 *         AppComponent
 *       ],
 *       imports: [
 *         HttpClientTestingModule,
 *         PoI18nModule.config(config)
 *       ]
 *     }).compileComponents();
 *   }));
 *
 *   it('should create the app', async(() => {
 *     const fixture = TestBed.createComponent(AppComponent);
 *     const app = fixture.debugElement.componentInstance;
 *
 *     expect(app).toBeTruthy();
 *   }));
 *
 * });
 * ```
 */
export class PoI18nBaseService {
    config;
    http;
    languageService;
    varI18n = {};
    contextDefault;
    useCache = false;
    servicesContext = {};
    constructor(config, http, languageService) {
        this.config = config;
        this.http = http;
        this.languageService = languageService;
        this.setConfig(config);
    }
    /**
     * <a id="get-language"></a>
     * Método que retorna o idioma padrão ativo.
     *
     * A busca deste idioma pelo método será feita na seguinte ordem:
     *
     *   1 - o idioma que foi armazenado no *localStorage*, através do método [`setLanguage()`](documentation/po-i18n#setLanguage).
     *
     *   2 - o valor inserido no módulo do i18n através do parâmetro `config`, sendo o idioma inserido na propriedade
     * `language` da interface [`PoI18nConfigDefault`](documentation/po-i18n#poI18nConfigDefault).
     *
     *   3 - o idioma do navegador utilizado.
     *
     * > Caso o idioma do navegador não seja suportado pelo PO (`pt`, `en`, `es` ou `ru`), será retornado valor `pt`.
     *
     * @returns {string} sigla do idioma padrão.
     */
    getLanguage() {
        return this.languageService.getLanguage();
    }
    getLiterals(options = {}) {
        const language = options['language'] ? options['language'].toLowerCase() : this.getLanguage();
        const context = options['context'] ? options['context'] : this.contextDefault;
        const literals = options['literals'] ? options['literals'] : [];
        return new Observable(observer => {
            if (this.servicesContext[context]) {
                // Faz o processo de busca de um contexto que contém serviço
                this.getLiteralsFromContextService(language, context, literals, observer);
            }
            else {
                // Faz o processo de busca de um contexto que utiliza constante
                this.getLiteralsFromContextConstant(language, context, literals, observer);
            }
        });
    }
    /**
     * Método que retorna o idioma padrão ativo, com somente a abreviação do idioma (duas primeiras letras).
     * Por exemplo: "pt" ou "es".
     *
     * A busca deste idioma é baseada no método [**getLanguage()**](/documentation/po-i18n#get-language).
     *
     * @returns {string} sigla do idioma padrão.
     */
    getShortLanguage() {
        return this.languageService.getShortLanguage();
    }
    /**
     * <a id="setLanguage"></a>
     * Método para alterar o idioma padrão do módulo do i18n.
     *
     * Ao utilizar este método, o idioma ficará gravado no armazenamento local do navegador, que será utilizado pelo
     * serviço do `i18n` para buscar as literais no idioma padrão.
     *
     * @param {string} language Sigla do idioma.
     *
     * Esta sigla deve ser composta por duas letras representando o idioma,
     * podendo ser adicionado outras duas letras representando o país, por exemplo: `pt`, `pt-BR`, `pt-br`, `en` ou `en-US`.
     *
     * > Caso seja informado um valor diferente deste padrão, o mesmo será ignorado.
     *
     * @param {boolean} reload Indica se a página atual poderá ser recarregada após a alteração do idioma.
     *
     * Este recurso pode ser útil para os usuários que utilizam o método `getLiterals()` do serviço do i18n para poder
     * buscar novamente as literais no novo idioma configurado.
     */
    setLanguage(language, reload = false) {
        if (!isLanguage(language)) {
            return;
        }
        this.languageService.setLanguage(language);
        if (reload) {
            reloadCurrentPage();
        }
    }
    setConfig(config) {
        // Seta as configurações padrões definidas no importação do módulo
        if (config['default']) {
            this.languageService.setLanguageDefault(config['default']['language']);
            this.contextDefault = config['default']['context'] ? config['default']['context'] : '';
            this.useCache = config['default']['cache'] ? config['default']['cache'] : false;
        }
        // Carrega a lista dos contextos e as contantes informadas
        if (config['contexts']) {
            this.setVarI18n(config['contexts']);
            // Se nenhum contexto foi definido como padrão,
            // então define o primeiro contexto
            if (!this.contextDefault) {
                for (const context in config['contexts']) {
                    if (this.config['contexts'].hasOwnProperty(context)) {
                        this.contextDefault = context;
                        break;
                    }
                }
            }
        }
    }
    // Processo de busca de um contexto que contém serviço.
    //    1 - Procura na variável I18n deste serviço
    //    2 - Procura no local storage (Se o cache estiver definido como true na configuração do módulo)
    //    3 - Dispara o serviço, mesmo que já tenha encontrado no local storage, para garantir a atualização
    //    4 - Se nenhuma literal for encontrada, então busca em pt-br
    getLiteralsFromContextService(language, context, literals, observer, translations = {}, languageAlternative = null) {
        // Idioma usado para tentar buscar as literais faltantes
        const languageSearch = languageAlternative ? languageAlternative : language;
        translations = this.mergeObject(translations, this.searchInVarI18n(languageSearch, context, literals));
        if (this.countObject(translations) > 0) {
            observer.next(translations);
        }
        // realiza a busca no localStorage e em seguida no serviço
        this.getLiteralsLocalStorageAndCache(languageSearch, context, literals, observer, translations, languageAlternative);
    }
    // Procura no local storage e em seguida no serviço
    // Caso não encontre nem no serviço, recomeça a busca em pt-br
    getLiteralsLocalStorageAndCache(language, context, literals, observer, translations, languageAlternative = null) {
        const languageSearch = languageAlternative ? languageAlternative : language;
        let translationTemp;
        // Verifica se usa cache
        if (this.useCache) {
            translationTemp = this.searchInLocalStorage(languageSearch, context, literals);
            if (this.countObject(translationTemp) > 0) {
                this.updateVarI18n(language, context, translationTemp);
                translations = this.mergeObject(translationTemp, translations);
                observer.next(translations);
            }
        }
        // Busca do Serviço
        this.getHttpService(this.servicesContext[context], languageSearch, literals).subscribe(response => {
            if (response) {
                this.updateLocalStorage(language, context, response);
                this.updateVarI18n(language, context, response);
                translationTemp = this.searchInVarI18n(language, context, literals);
                translations = this.mergeObject(translationTemp, translations);
                observer.next(translations);
            }
            // Se não encontrou todas as literais pesquisadas no idioma
            // Então refaz o processo procurando em português
            if (literals.length > this.countObject(translations)) {
                if (languageAlternative === 'pt-br') {
                    // Se não encontrou nem em português, então retorna o nome das literais
                    translations = this.completeFaultLiterals(language, context, literals, translations);
                    this.updateLocalStorage(language, context, translations);
                    this.updateVarI18n(language, context, translations);
                    observer.next(translations);
                }
                else {
                    this.getLiteralsFromContextService(language, context, literals, observer, translations, 'pt-br');
                }
            }
        });
    }
    // Procura pela lista de literais
    // Se não encontrar todas, procura em pt-br
    getLiteralsFromContextConstant(language, context, literals, observer, translations = {}) {
        translations = this.mergeObject(translations, this.searchInVarI18n(language, context, literals));
        if (this.countObject(translations) > 0) {
            observer.next(translations);
        }
        // Se foi pesquisado por literais
        if (literals.length > 0) {
            // Se não encontrou todas as literais pesquisadas no idioma, procura em português
            if (literals.length > this.countObject(translations)) {
                if (language === 'pt-br') {
                    // Se não encontrou nem em português, então retorna o nome das literais
                    translations = this.completeFaultLiterals(language, context, literals, translations);
                    observer.next(translations);
                }
                else {
                    this.getLiteralsFromContextConstant('pt-br', context, literals, observer, translations);
                }
            }
        }
        else {
            // Se não encontrar nenhuma literal, procura em português
            if (this.countObject(translations) === 0 && language !== 'pt-br') {
                this.getLiteralsFromContextConstant('pt-br', context, literals, observer, translations);
            }
            // caso não informar literais e não houver tradução
            observer.next(translations);
            observer.complete();
        }
    }
    // Busca pelas literais no local storage
    searchInLocalStorage(language, context, literals) {
        const translations = {};
        if (literals.length > 0) {
            for (let i = 0; i < literals.length; i++) {
                const literal = literals[i];
                const translation = localStorage.getItem(language + '-' + context + '-' + literal);
                if (translation) {
                    translations[literal] = translation;
                }
            }
        }
        return translations;
    }
    // Busca pelas literais na variável do serviço
    searchInVarI18n(language, context, literals) {
        let translations = {};
        if (this.varI18n[language] && this.varI18n[language][context]) {
            const content = this.varI18n[language][context];
            if (literals.length > 0) {
                // Busca as literais desejadas
                for (let i = 0; i < literals.length; i++) {
                    const literal = literals[i];
                    if (content.hasOwnProperty(literal)) {
                        translations[literal] = content[literal];
                    }
                }
            }
            else {
                // Atribui todas as literais
                translations = { ...content };
            }
        }
        return translations;
    }
    // Atualiza o local storage
    updateLocalStorage(language, context, data) {
        if (this.useCache) {
            for (const literal of Object.keys(data)) {
                localStorage.setItem(language + '-' + context + '-' + literal, data[literal]);
            }
        }
    }
    // Atualiza a variável local com as literais com os objetos passados na configuração
    setVarI18n(contexts) {
        // Percorre os contextos
        for (const context of Object.keys(contexts)) {
            const contextContent = contexts[context];
            // Percorre os idiomas dentro do contexto
            for (const language of Object.keys(contextContent)) {
                const languageContent = contextContent[language];
                if (language === 'url') {
                    this.servicesContext[context] = languageContent;
                }
                else {
                    this.updateVarI18n(language, context, languageContent);
                }
            }
        }
    }
    // Atualiza a variável local com as literais idioma e contexto
    updateVarI18n(language, context, data) {
        language = language.toLowerCase();
        if (!this.varI18n[language]) {
            this.varI18n[language] = { [context]: {} };
        }
        if (!this.varI18n[language][context]) {
            this.varI18n[language][context] = {};
        }
        // Cria ou atualiza o contexto dentro do storage
        this.varI18n[language][context] = this.mergeObject(data, this.varI18n[language][context]);
    }
    getHttpService(url, language, literals) {
        let param = '?language=' + language;
        if (literals.length > 0) {
            param += '&literals=' + literals.join();
        }
        // Remove a barra final do endereço
        url = url.replace(/\/$/, '');
        return this.http.get(`${url}${param}`);
    }
    // Completa com o nome da literais, as que não foram encontradas
    completeFaultLiterals(language, context, literals, translations) {
        for (let i = 0; i < literals.length; i++) {
            const literal = literals[i];
            if (!translations[literal]) {
                translations[literal] = literal;
            }
        }
        return translations;
    }
    // Conta os atributos do objeto
    countObject(obj) {
        return Object.keys(obj).length;
    }
    // Faz o merge dos objetos, sempre dando preferência para o primeiro objeto de parâmetro
    mergeObject(objPermanent, obj) {
        return { ...obj, ...objPermanent };
    }
    static ɵfac = function PoI18nBaseService_Factory(t) { return new (t || PoI18nBaseService)(i0.ɵɵdirectiveInject(I18N_CONFIG), i0.ɵɵdirectiveInject(HttpClient), i0.ɵɵdirectiveInject(i1.PoLanguageService)); };
    static ɵdir = /*@__PURE__*/ i0.ɵɵdefineDirective({ type: PoI18nBaseService });
}
(() => { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(PoI18nBaseService, [{
        type: Directive
    }], () => [{ type: undefined, decorators: [{
                type: Inject,
                args: [I18N_CONFIG]
            }] }, { type: i2.HttpClient, decorators: [{
                type: Inject,
                args: [HttpClient]
            }] }, { type: i1.PoLanguageService }], null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8taTE4bi1iYXNlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL3NlcnZpY2VzL3BvLWkxOG4vcG8taTE4bi1iYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWxELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFbEMsT0FBTyxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBS2pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQzs7OztBQUUvRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUlHO0FBR0gsTUFBTSxPQUFPLGlCQUFpQjtJQVVHO0lBQ0Q7SUFDcEI7SUFYRixPQUFPLEdBQVEsRUFBRSxDQUFDO0lBRWxCLGNBQWMsQ0FBUztJQUV2QixRQUFRLEdBQVksS0FBSyxDQUFDO0lBRTFCLGVBQWUsR0FBUSxFQUFFLENBQUM7SUFFbEMsWUFDK0IsTUFBcUIsRUFDdEIsSUFBaUIsRUFDckMsZUFBbUM7UUFGZCxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3RCLFNBQUksR0FBSixJQUFJLENBQWE7UUFDckMsb0JBQWUsR0FBZixlQUFlLENBQW9CO1FBRTNDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVEOzs7Ozs7Ozs7Ozs7Ozs7O09BZ0JHO0lBQ0gsV0FBVztR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QUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNqQyxDQUFDO0lBRUQsd0ZBQXdGO0lBQ2hGLFdBQVcsQ0FBQyxZQUFpQixFQUFFLEdBQVE7UUFDN0MsT0FBTyxFQUFFLEdBQUcsR0FBRyxFQUFFLEdBQUcsWUFBWSxFQUFFLENBQUM7SUFDckMsQ0FBQzsyRUFqV1UsaUJBQWlCLHVCQVVsQixXQUFXLHdCQUNYLFVBQVU7NkRBWFQsaUJBQWlCOztpRkFBakIsaUJBQWlCO2NBRDdCLFNBQVM7O3NCQVdMLE1BQU07dUJBQUMsV0FBVzs7c0JBQ2xCLE1BQU07dUJBQUMsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBEaXJlY3RpdmUsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IGlzTGFuZ3VhZ2UsIHJlbG9hZEN1cnJlbnRQYWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBQb0kxOG5Db25maWcgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8taTE4bi1jb25maWcuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvSTE4bkxpdGVyYWxzIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWkxOG4tbGl0ZXJhbHMuaW50ZXJmYWNlJztcbmltcG9ydCB7IEkxOE5fQ09ORklHIH0gZnJvbSAnLi9wby1pMThuLWNvbmZpZy1pbmplY3Rpb24tdG9rZW4nO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIE8gc2VydmnDp28gYFBvSTE4blNlcnZpY2VgIHBvc3NpYmlsaXRhIHV0aWxpemFyIG3Dumx0aXBsb3MgaWRpb21hcyBlIGNvbnRleHRvcyBuYSBhcGxpY2HDp8Ojby5cbiAqXG4gKiA+IEFudGVzIGRhIHV0aWxpemHDp8OjbyBkbyBzZXJ2acOnbywgw6kgbmVjZXNzw6FyaW8gcmVhbGl6YXIgYVxuICogW2ltcG9ydGHDp8OjbyBlIGNvbmZpZ3VyYcOnw6NvIGRvIG3Ds2R1bG8gYFBvSTE4bk1vZHVsZWBdKC9kb2N1bWVudGF0aW9uL3BvLWkxOG4jaTE4bi1jb25maWcpLlxuICpcbiAqICoqVXRpbGl6YcOnw6NvIGRvIHNlcnZpw6dvIGBQb0kxOG5TZXJ2aWNlYDoqKlxuICpcbiAqIFBhcmEgdXRpbGl6YXIgbyBzZXJ2acOnbyBiYXN0YSBpbXBvcnTDoS1sbyBub3MgY29tcG9uZW50ZXMgcXVlIG5lY2Vzc2l0YXJlbSBkZSBsaXRlcmFpcyBlIGZhemVyIGEgaW5qZcOnw6NvIGRlXG4gKiBkZXBlbmTDqm5jaWEgbm8gY29uc3RydXRvcjpcbiAqIGBgYFxuICogIGltcG9ydCB7IFBvSTE4blNlcnZpY2UgfSBmcm9tICdAcG8tdWkvbmctY29tcG9uZW50cyc7XG4gKiAgLi4uXG4gKiAgY29uc3RydWN0b3IocHJpdmF0ZSBwb0kxOG5TZXJ2aWNlOiBQb0kxOG5TZXJ2aWNlKSB7IH1cbiAqICAuLi5cbiAqIGBgYFxuICpcbiAqIFBvciBmaW0gcmVhbGl6YXIgYSBidXNjYSBwZWxhcyBsaXRlcmFpcywgaW5zY3JldmVuZG8tc2Ugbm8gW09ic2VydmFibGVdKGh0dHBzOi8vYW5ndWxhci5pby9ndWlkZS9vYnNlcnZhYmxlcykgcGVsb1xuICogbcOpdG9kbyBgZ2V0TGl0ZXJhbHMoKWAuXG4gKlxuICogPiBPIG3DqXRvZG8gYGdldExpdGVyYWxzKClgIHBvZGUgcmVjZWJlciB1bSBvYmpldG8gZG8gdGlwbyBkYSBpbnRlcmZhY2UgYFBvSTE4bkxpdGVyYWxzYCBjb21vIHBhcsOibWV0cm8sXG4gKiBwb3LDqW0sIG5lbmh1bWEgZGFzIHByb3ByaWVkYWRlcyBzw6NvIG9icmlnYXTDs3JpYXMuIENhc28gbmVuaHVtIHBhcsOibWV0cm8gc2VqYSBwYXNzYWRvLCBzZXLDo28gYnVzY2FkYXNcbiAqIHRvZGFzIGFzIGxpdGVyYWlzIGRvIGNvbnRleHRvIGRlZmluaWRvIGNvbSBwYWRyw6NvLCBubyBpZGlvbWEgZGVmaW5pZG8gY29tbyBwYWRyw6NvLlxuICpcbiAqIEV4ZW1wbG9zIGRlIHJlcXVpc2nDp8OjbzpcbiAqIGBgYFxuICogbGl0ZXJhbHMgPSB7fTtcbiAqIGxpdGVyYWxzRW4gPSB7fTtcbiAqIGxpdGVyYWxzQ3JtID0ge307XG4gKlxuICogY29uc3RydWN0b3IocHJpdmF0ZSBwb0kxOG5TZXJ2aWNlOiBQb0kxOG5TZXJ2aWNlKSB7XG4gKiAgIHBvSTE4blNlcnZpY2UuZ2V0TGl0ZXJhbHMoKVxuICogICAgIC5zdWJzY3JpYmUoKGxpdGVyYWxzKSA9PiB7XG4gKiAgICAgICB0aGlzLmxpdGVyYWxzID0gbGl0ZXJhbHM7XG4gKiAgICAgfSk7XG4gKlxuICogICBwb0kxOG5TZXJ2aWNlLmdldExpdGVyYWxzKHtjb250ZXh0OiAnY3JtJywgbGl0ZXJhbHM6IFsnYWRkJywgJ3JlbW92ZSddfSlcbiAqICAgICAuc3Vic2NyaWJlKChsaXRlcmFscykgPT4ge1xuICogICAgICAgdGhpcy5saXRlcmFsc0NybSA9IGxpdGVyYWxzO1xuICogICAgIH0pO1xuICpcbiAqICAgcG9JMThuU2VydmljZS5nZXRMaXRlcmFscyh7bGFuZ3VhZ2U6ICdlbi11cyd9KVxuICogICAgIC5zdWJzY3JpYmUoKGxpdGVyYWxzKSA9PiB7XG4gKiAgICAgICB0aGlzLmxpdGVyYWxzRW4gPSBsaXRlcmFscztcbiAqICAgICB9KTtcbiAqIH1cbiAqIGBgYFxuICpcbiAqIFBhcmEgYXByZXNlbnRhciBhcyBsaXRlcmFpcyBjYXB0dXJhZGFzIGFjaW1hIG5vIEhUTUwgZG8gY29tcG9uZW50ZSwgZGV2ZS1zZSB1dGlsaXphciBvXG4gKiBzZWd1aW50ZSBjw7NkaWdvOlxuICpcbiAqIDxwcmUgbmdOb25CaW5kYWJsZT5cbiAqIHt7IGxpdGVyYWxzPy5hZGQgfX1cbiAqIHt7IGxpdGVyYWxzPy5yZW1vdmUgfX1cbiAqIDwvcHJlPlxuICpcbiAqIENhc28gYXMgbGl0ZXJhaXMgY29udGVuaGFtIHZhcmnDoXZlaXMgcXVlIHByZWNpc2VtIHNlciBzdWJzdGl0dcOtZGFzLCBwb2RlLXNlIHV0aWxpemFyIG8gKnBpcGUqIGBwb0kxOG5gLlxuICogw4kgcG9zc8OtdmVsIGluZm9ybWFyIHByb3ByaWVkYWRlcyBkbyBjb21wb25lbnRlIGNvbW8gYG5hbWVgIGUgYG5pY2tuYW1lYCBvdVxuICogaW5mb3JtYXIgbyB2YWxvciBkaXJldGFtZW50ZSBjb20gXCJcIiBvdSBuw7ptZXJvLCBjb25mb3JtZSBvIGV4ZW1wbG8gYWJhaXhvOlxuICpcbiAqIDxwcmUgbmdOb25CaW5kYWJsZT5cbiAqIHt7IGxpdGVyYWxzPy5wZW9wbGUgfCBwb0kxOG46WzEyMF0gfX1cbiAqIHt7IGxpdGVyYWxzPy5ncmVldGluZyB8IHBvSTE4bjpbbmFtZSwgbmlja25hbWVdIH19XG4gKiB7eyBsaXRlcmFscz8uZ3JlZXRpbmcgfCBwb0kxOG46W1wiQnJhZFwiLCBcIkdyZWVuXCJdIH19XG4gKiA8L3ByZT5cbiAqXG4gKiA+IMOJIGltcG9ydGFudGUgbyB1c28gZG8gb3BlcmFkb3IgYD9gIChFbHZpcykgcGFyYSBldml0YXIgZXJyb3MgZW5xdWFudG8gYXMgbGl0ZXJhaXMgbsOjbyBmb3JlbSBjYXJyZWdhZGFzLlxuICpcbiAqICMjIyBUZXN0ZSB1bml0w6FyaW9cbiAqXG4gKiBBYmFpeG8gc2VndWUgdW0gZXhlbXBsbyBkZSAqc2V0dXAqIGluaWNpYWwgZGUgdGVzdGUgdW5pdMOhcmlvIGRvICpBcHBDb21wb25lbnQqIHF1ZSB1dGlsaXphIG8gYFBvSTE4blNlcnZpY2VgOlxuICpcbiAqID4gQXRlbsOnw6NvOiBuw6NvIGRlY2xhcmFyIG8gYFBvSTE4blNlcnZpY2VgIG5vIHByb3ZpZGVycyBkbyBUZXN0QmVkIHBvaXMgYSBiaWJsaW90ZWNhIHJlYWxpemEgYSBpbmplw6fDo28gZGUgZGVwZW5kw6puY2lhIGRlIGZvcm1hIGRpbsOibWljYS5cbiAqID4gU2UgbyBzZXJ2acOnbyBmb3IgZGVjbGFyYWRvIG8gdGVzdGUgbsOjbyBmYXLDoSBhIGluamXDp8OjbyBlIG8gdGVzdGUgYXByZXNlbnRhcsOhIGVycm9zLlxuICpcbiAqIGBgYFxuICogaW1wb3J0IHsgYXN5bmMsIFRlc3RCZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuICogaW1wb3J0IHsgSHR0cENsaWVudFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cC90ZXN0aW5nJztcbiAqXG4gKiBpbXBvcnQgeyBQb0kxOG5Nb2R1bGUgfSBmcm9tICdAcG8tdWkvbmctY29tcG9uZW50cyc7XG4gKlxuICogaW1wb3J0IHsgQXBwQ29tcG9uZW50IH0gZnJvbSAnLi9hcHAuY29tcG9uZW50JztcbiAqXG4gKiBkZXNjcmliZSgnQXBwQ29tcG9uZW50JywgKCkgPT4ge1xuICogICBjb25zdCBhbm90aGVyUFQgPSB7XG4gKiAgICAgdGV4dDogJ3RleHRvJyxcbiAqICAgICBhZGQ6ICdhZGljaW9uYXInLFxuICogICAgIHJlbW92ZTogJ3JlbW92ZXInXG4gKiAgIH07XG4gKlxuICogICBjb25zdCBnZW5lcmFsUFQgPSB7XG4gKiAgICAgdGV4dDogJ3RleHRvJyxcbiAqICAgICBhZGQ6ICdhZGljaW9uYXInLFxuICogICAgIHJlbW92ZTogJ3JlbW92ZXInXG4gKiAgIH07XG4gKlxuICogICBjb25zdCBjb25maWcgPSB7XG4gKiAgICAgZGVmYXVsdDoge1xuICogICAgICAgbGFuZ3VhZ2U6ICdwdC1CUicsXG4gKiAgICAgICBjb250ZXh0OiAnZ2VuZXJhbCcsXG4gKiAgICAgICBjYWNoZTogZmFsc2VcbiAqICAgICB9LFxuICogICAgIGNvbnRleHRzOiB7XG4gKiAgICAgICBnZW5lcmFsOiB7XG4gKiAgICAgICAgICdwdC1icic6IGdlbmVyYWxQVFxuICogICAgICAgfSxcbiAqICAgICAgIGFub3RoZXI6IHtcbiAqICAgICAgICAgJ3B0LWJyJzogYW5vdGhlclBUXG4gKiAgICAgICB9XG4gKiAgICAgfVxuICogICB9O1xuICpcbiAqICAgYmVmb3JlRWFjaChhc3luYygoKSA9PiB7XG4gKiAgICAgVGVzdEJlZC5jb25maWd1cmVUZXN0aW5nTW9kdWxlKHtcbiAqICAgICAgIGRlY2xhcmF0aW9uczogW1xuICogICAgICAgICBBcHBDb21wb25lbnRcbiAqICAgICAgIF0sXG4gKiAgICAgICBpbXBvcnRzOiBbXG4gKiAgICAgICAgIEh0dHBDbGllbnRUZXN0aW5nTW9kdWxlLFxuICogICAgICAgICBQb0kxOG5Nb2R1bGUuY29uZmlnKGNvbmZpZylcbiAqICAgICAgIF1cbiAqICAgICB9KS5jb21waWxlQ29tcG9uZW50cygpO1xuICogICB9KSk7XG4gKlxuICogICBpdCgnc2hvdWxkIGNyZWF0ZSB0aGUgYXBwJywgYXN5bmMoKCkgPT4ge1xuICogICAgIGNvbnN0IGZpeHR1cmUgPSBUZXN0QmVkLmNyZWF0ZUNvbXBvbmVudChBcHBDb21wb25lbnQpO1xuICogICAgIGNvbnN0IGFwcCA9IGZpeHR1cmUuZGVidWdFbGVtZW50LmNvbXBvbmVudEluc3RhbmNlO1xuICpcbiAqICAgICBleHBlY3QoYXBwKS50b0JlVHJ1dGh5KCk7XG4gKiAgIH0pKTtcbiAqXG4gKiB9KTtcbiAqIGBgYFxuICovXG5cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGNsYXNzIFBvSTE4bkJhc2VTZXJ2aWNlIHtcbiAgcHJpdmF0ZSB2YXJJMThuOiBhbnkgPSB7fTtcblxuICBwcml2YXRlIGNvbnRleHREZWZhdWx0OiBzdHJpbmc7XG5cbiAgcHJpdmF0ZSB1c2VDYWNoZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgc2VydmljZXNDb250ZXh0OiBhbnkgPSB7fTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0KEkxOE5fQ09ORklHKSBwcml2YXRlIGNvbmZpZz86IFBvSTE4bkNvbmZpZyxcbiAgICBASW5qZWN0KEh0dHBDbGllbnQpIHByaXZhdGUgaHR0cD86IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBsYW5ndWFnZVNlcnZpY2U/OiBQb0xhbmd1YWdlU2VydmljZVxuICApIHtcbiAgICB0aGlzLnNldENvbmZpZyhjb25maWcpO1xuICB9XG5cbiAgLyoqXG4gICAqIDxhIGlkPVwiZ2V0LWxhbmd1YWdlXCI+PC9hPlxuICAgKiBNw6l0b2RvIHF1ZSByZXRvcm5hIG8gaWRpb21hIHBhZHLDo28gYXRpdm8uXG4gICAqXG4gICAqIEEgYnVzY2EgZGVzdGUgaWRpb21hIHBlbG8gbcOpdG9kbyBzZXLDoSBmZWl0YSBuYSBzZWd1aW50ZSBvcmRlbTpcbiAgICpcbiAgICogICAxIC0gbyBpZGlvbWEgcXVlIGZvaSBhcm1hemVuYWRvIG5vICpsb2NhbFN0b3JhZ2UqLCBhdHJhdsOpcyBkbyBtw6l0b2RvIFtgc2V0TGFuZ3VhZ2UoKWBdKGRvY3VtZW50YXRpb24vcG8taTE4biNzZXRMYW5ndWFnZSkuXG4gICAqXG4gICAqICAgMiAtIG8gdmFsb3IgaW5zZXJpZG8gbm8gbcOzZHVsbyBkbyBpMThuIGF0cmF2w6lzIGRvIHBhcsOibWV0cm8gYGNvbmZpZ2AsIHNlbmRvIG8gaWRpb21hIGluc2VyaWRvIG5hIHByb3ByaWVkYWRlXG4gICAqIGBsYW5ndWFnZWAgZGEgaW50ZXJmYWNlIFtgUG9JMThuQ29uZmlnRGVmYXVsdGBdKGRvY3VtZW50YXRpb24vcG8taTE4biNwb0kxOG5Db25maWdEZWZhdWx0KS5cbiAgICpcbiAgICogICAzIC0gbyBpZGlvbWEgZG8gbmF2ZWdhZG9yIHV0aWxpemFkby5cbiAgICpcbiAgICogPiBDYXNvIG8gaWRpb21hIGRvIG5hdmVnYWRvciBuw6NvIHNlamEgc3Vwb3J0YWRvIHBlbG8gUE8gKGBwdGAsIGBlbmAsIGBlc2Agb3UgYHJ1YCksIHNlcsOhIHJldG9ybmFkbyB2YWxvciBgcHRgLlxuICAgKlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBzaWdsYSBkbyBpZGlvbWEgcGFkcsOjby5cbiAgICovXG4gIGdldExhbmd1YWdlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmdldExhbmd1YWdlKCk7XG4gIH1cblxuICBnZXRMaXRlcmFscyhvcHRpb25zOiBQb0kxOG5MaXRlcmFscyA9IHt9KTogT2JzZXJ2YWJsZTxvYmplY3Q+IHtcbiAgICBjb25zdCBsYW5ndWFnZSA9IG9wdGlvbnNbJ2xhbmd1YWdlJ10gPyBvcHRpb25zWydsYW5ndWFnZSddLnRvTG93ZXJDYXNlKCkgOiB0aGlzLmdldExhbmd1YWdlKCk7XG4gICAgY29uc3QgY29udGV4dCA9IG9wdGlvbnNbJ2NvbnRleHQnXSA/IG9wdGlvbnNbJ2NvbnRleHQnXSA6IHRoaXMuY29udGV4dERlZmF1bHQ7XG4gICAgY29uc3QgbGl0ZXJhbHM6IEFycmF5PHN0cmluZz4gPSBvcHRpb25zWydsaXRlcmFscyddID8gb3B0aW9uc1snbGl0ZXJhbHMnXSA6IFtdO1xuXG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcbiAgICAgIGlmICh0aGlzLnNlcnZpY2VzQ29udGV4dFtjb250ZXh0XSkge1xuICAgICAgICAvLyBGYXogbyBwcm9jZXNzbyBkZSBidXNjYSBkZSB1bSBjb250ZXh0byBxdWUgY29udMOpbSBzZXJ2acOnb1xuICAgICAgICB0aGlzLmdldExpdGVyYWxzRnJvbUNvbnRleHRTZXJ2aWNlKGxhbmd1YWdlLCBjb250ZXh0LCBsaXRlcmFscywgb2JzZXJ2ZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmF6IG8gcHJvY2Vzc28gZGUgYnVzY2EgZGUgdW0gY29udGV4dG8gcXVlIHV0aWxpemEgY29uc3RhbnRlXG4gICAgICAgIHRoaXMuZ2V0TGl0ZXJhbHNGcm9tQ29udGV4dENvbnN0YW50KGxhbmd1YWdlLCBjb250ZXh0LCBsaXRlcmFscywgb2JzZXJ2ZXIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE3DqXRvZG8gcXVlIHJldG9ybmEgbyBpZGlvbWEgcGFkcsOjbyBhdGl2bywgY29tIHNvbWVudGUgYSBhYnJldmlhw6fDo28gZG8gaWRpb21hIChkdWFzIHByaW1laXJhcyBsZXRyYXMpLlxuICAgKiBQb3IgZXhlbXBsbzogXCJwdFwiIG91IFwiZXNcIi5cbiAgICpcbiAgICogQSBidXNjYSBkZXN0ZSBpZGlvbWEgw6kgYmFzZWFkYSBubyBtw6l0b2RvIFsqKmdldExhbmd1YWdlKCkqKl0oL2RvY3VtZW50YXRpb24vcG8taTE4biNnZXQtbGFuZ3VhZ2UpLlxuICAgKlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBzaWdsYSBkbyBpZGlvbWEgcGFkcsOjby5cbiAgICovXG4gIGdldFNob3J0TGFuZ3VhZ2UoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5sYW5ndWFnZVNlcnZpY2UuZ2V0U2hvcnRMYW5ndWFnZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIDxhIGlkPVwic2V0TGFuZ3VhZ2VcIj48L2E+XG4gICAqIE3DqXRvZG8gcGFyYSBhbHRlcmFyIG8gaWRpb21hIHBhZHLDo28gZG8gbcOzZHVsbyBkbyBpMThuLlxuICAgKlxuICAgKiBBbyB1dGlsaXphciBlc3RlIG3DqXRvZG8sIG8gaWRpb21hIGZpY2Fyw6EgZ3JhdmFkbyBubyBhcm1hemVuYW1lbnRvIGxvY2FsIGRvIG5hdmVnYWRvciwgcXVlIHNlcsOhIHV0aWxpemFkbyBwZWxvXG4gICAqIHNlcnZpw6dvIGRvIGBpMThuYCBwYXJhIGJ1c2NhciBhcyBsaXRlcmFpcyBubyBpZGlvbWEgcGFkcsOjby5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIFNpZ2xhIGRvIGlkaW9tYS5cbiAgICpcbiAgICogRXN0YSBzaWdsYSBkZXZlIHNlciBjb21wb3N0YSBwb3IgZHVhcyBsZXRyYXMgcmVwcmVzZW50YW5kbyBvIGlkaW9tYSxcbiAgICogcG9kZW5kbyBzZXIgYWRpY2lvbmFkbyBvdXRyYXMgZHVhcyBsZXRyYXMgcmVwcmVzZW50YW5kbyBvIHBhw61zLCBwb3IgZXhlbXBsbzogYHB0YCwgYHB0LUJSYCwgYHB0LWJyYCwgYGVuYCBvdSBgZW4tVVNgLlxuICAgKlxuICAgKiA+IENhc28gc2VqYSBpbmZvcm1hZG8gdW0gdmFsb3IgZGlmZXJlbnRlIGRlc3RlIHBhZHLDo28sIG8gbWVzbW8gc2Vyw6EgaWdub3JhZG8uXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVsb2FkIEluZGljYSBzZSBhIHDDoWdpbmEgYXR1YWwgcG9kZXLDoSBzZXIgcmVjYXJyZWdhZGEgYXDDs3MgYSBhbHRlcmHDp8OjbyBkbyBpZGlvbWEuXG4gICAqXG4gICAqIEVzdGUgcmVjdXJzbyBwb2RlIHNlciDDunRpbCBwYXJhIG9zIHVzdcOhcmlvcyBxdWUgdXRpbGl6YW0gbyBtw6l0b2RvIGBnZXRMaXRlcmFscygpYCBkbyBzZXJ2acOnbyBkbyBpMThuIHBhcmEgcG9kZXJcbiAgICogYnVzY2FyIG5vdmFtZW50ZSBhcyBsaXRlcmFpcyBubyBub3ZvIGlkaW9tYSBjb25maWd1cmFkby5cbiAgICovXG4gIHNldExhbmd1YWdlKGxhbmd1YWdlOiBzdHJpbmcsIHJlbG9hZDogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XG4gICAgaWYgKCFpc0xhbmd1YWdlKGxhbmd1YWdlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnNldExhbmd1YWdlKGxhbmd1YWdlKTtcblxuICAgIGlmIChyZWxvYWQpIHtcbiAgICAgIHJlbG9hZEN1cnJlbnRQYWdlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRDb25maWcoY29uZmlnOiBQb0kxOG5Db25maWcpIHtcbiAgICAvLyBTZXRhIGFzIGNvbmZpZ3VyYcOnw7VlcyBwYWRyw7VlcyBkZWZpbmlkYXMgbm8gaW1wb3J0YcOnw6NvIGRvIG3Ds2R1bG9cbiAgICBpZiAoY29uZmlnWydkZWZhdWx0J10pIHtcbiAgICAgIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLnNldExhbmd1YWdlRGVmYXVsdChjb25maWdbJ2RlZmF1bHQnXVsnbGFuZ3VhZ2UnXSk7XG5cbiAgICAgIHRoaXMuY29udGV4dERlZmF1bHQgPSBjb25maWdbJ2RlZmF1bHQnXVsnY29udGV4dCddID8gY29uZmlnWydkZWZhdWx0J11bJ2NvbnRleHQnXSA6ICcnO1xuICAgICAgdGhpcy51c2VDYWNoZSA9IGNvbmZpZ1snZGVmYXVsdCddWydjYWNoZSddID8gY29uZmlnWydkZWZhdWx0J11bJ2NhY2hlJ10gOiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBDYXJyZWdhIGEgbGlzdGEgZG9zIGNvbnRleHRvcyBlIGFzIGNvbnRhbnRlcyBpbmZvcm1hZGFzXG4gICAgaWYgKGNvbmZpZ1snY29udGV4dHMnXSkge1xuICAgICAgdGhpcy5zZXRWYXJJMThuKGNvbmZpZ1snY29udGV4dHMnXSk7XG5cbiAgICAgIC8vIFNlIG5lbmh1bSBjb250ZXh0byBmb2kgZGVmaW5pZG8gY29tbyBwYWRyw6NvLFxuICAgICAgLy8gZW50w6NvIGRlZmluZSBvIHByaW1laXJvIGNvbnRleHRvXG4gICAgICBpZiAoIXRoaXMuY29udGV4dERlZmF1bHQpIHtcbiAgICAgICAgZm9yIChjb25zdCBjb250ZXh0IGluIGNvbmZpZ1snY29udGV4dHMnXSkge1xuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZ1snY29udGV4dHMnXS5oYXNPd25Qcm9wZXJ0eShjb250ZXh0KSkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0RGVmYXVsdCA9IGNvbnRleHQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBQcm9jZXNzbyBkZSBidXNjYSBkZSB1bSBjb250ZXh0byBxdWUgY29udMOpbSBzZXJ2acOnby5cbiAgLy8gICAgMSAtIFByb2N1cmEgbmEgdmFyacOhdmVsIEkxOG4gZGVzdGUgc2VydmnDp29cbiAgLy8gICAgMiAtIFByb2N1cmEgbm8gbG9jYWwgc3RvcmFnZSAoU2UgbyBjYWNoZSBlc3RpdmVyIGRlZmluaWRvIGNvbW8gdHJ1ZSBuYSBjb25maWd1cmHDp8OjbyBkbyBtw7NkdWxvKVxuICAvLyAgICAzIC0gRGlzcGFyYSBvIHNlcnZpw6dvLCBtZXNtbyBxdWUgasOhIHRlbmhhIGVuY29udHJhZG8gbm8gbG9jYWwgc3RvcmFnZSwgcGFyYSBnYXJhbnRpciBhIGF0dWFsaXphw6fDo29cbiAgLy8gICAgNCAtIFNlIG5lbmh1bWEgbGl0ZXJhbCBmb3IgZW5jb250cmFkYSwgZW50w6NvIGJ1c2NhIGVtIHB0LWJyXG4gIHByaXZhdGUgZ2V0TGl0ZXJhbHNGcm9tQ29udGV4dFNlcnZpY2UoXG4gICAgbGFuZ3VhZ2U6IHN0cmluZyxcbiAgICBjb250ZXh0OiBzdHJpbmcsXG4gICAgbGl0ZXJhbHM6IEFycmF5PHN0cmluZz4sXG4gICAgb2JzZXJ2ZXI6IGFueSxcbiAgICB0cmFuc2xhdGlvbnM6IGFueSA9IHt9LFxuICAgIGxhbmd1YWdlQWx0ZXJuYXRpdmU6IHN0cmluZyA9IG51bGxcbiAgKSB7XG4gICAgLy8gSWRpb21hIHVzYWRvIHBhcmEgdGVudGFyIGJ1c2NhciBhcyBsaXRlcmFpcyBmYWx0YW50ZXNcbiAgICBjb25zdCBsYW5ndWFnZVNlYXJjaCA9IGxhbmd1YWdlQWx0ZXJuYXRpdmUgPyBsYW5ndWFnZUFsdGVybmF0aXZlIDogbGFuZ3VhZ2U7XG5cbiAgICB0cmFuc2xhdGlvbnMgPSB0aGlzLm1lcmdlT2JqZWN0KHRyYW5zbGF0aW9ucywgdGhpcy5zZWFyY2hJblZhckkxOG4obGFuZ3VhZ2VTZWFyY2gsIGNvbnRleHQsIGxpdGVyYWxzKSk7XG5cbiAgICBpZiAodGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvbnMpID4gMCkge1xuICAgICAgb2JzZXJ2ZXIubmV4dCh0cmFuc2xhdGlvbnMpO1xuICAgIH1cblxuICAgIC8vIHJlYWxpemEgYSBidXNjYSBubyBsb2NhbFN0b3JhZ2UgZSBlbSBzZWd1aWRhIG5vIHNlcnZpw6dvXG4gICAgdGhpcy5nZXRMaXRlcmFsc0xvY2FsU3RvcmFnZUFuZENhY2hlKFxuICAgICAgbGFuZ3VhZ2VTZWFyY2gsXG4gICAgICBjb250ZXh0LFxuICAgICAgbGl0ZXJhbHMsXG4gICAgICBvYnNlcnZlcixcbiAgICAgIHRyYW5zbGF0aW9ucyxcbiAgICAgIGxhbmd1YWdlQWx0ZXJuYXRpdmVcbiAgICApO1xuICB9XG5cbiAgLy8gUHJvY3VyYSBubyBsb2NhbCBzdG9yYWdlIGUgZW0gc2VndWlkYSBubyBzZXJ2acOnb1xuICAvLyBDYXNvIG7Do28gZW5jb250cmUgbmVtIG5vIHNlcnZpw6dvLCByZWNvbWXDp2EgYSBidXNjYSBlbSBwdC1iclxuICBwcml2YXRlIGdldExpdGVyYWxzTG9jYWxTdG9yYWdlQW5kQ2FjaGUoXG4gICAgbGFuZ3VhZ2U6IHN0cmluZyxcbiAgICBjb250ZXh0OiBzdHJpbmcsXG4gICAgbGl0ZXJhbHM6IEFycmF5PHN0cmluZz4sXG4gICAgb2JzZXJ2ZXI6IGFueSxcbiAgICB0cmFuc2xhdGlvbnM6IGFueSxcbiAgICBsYW5ndWFnZUFsdGVybmF0aXZlOiBzdHJpbmcgPSBudWxsXG4gICkge1xuICAgIGNvbnN0IGxhbmd1YWdlU2VhcmNoID0gbGFuZ3VhZ2VBbHRlcm5hdGl2ZSA/IGxhbmd1YWdlQWx0ZXJuYXRpdmUgOiBsYW5ndWFnZTtcbiAgICBsZXQgdHJhbnNsYXRpb25UZW1wO1xuICAgIC8vIFZlcmlmaWNhIHNlIHVzYSBjYWNoZVxuICAgIGlmICh0aGlzLnVzZUNhY2hlKSB7XG4gICAgICB0cmFuc2xhdGlvblRlbXAgPSB0aGlzLnNlYXJjaEluTG9jYWxTdG9yYWdlKGxhbmd1YWdlU2VhcmNoLCBjb250ZXh0LCBsaXRlcmFscyk7XG4gICAgICBpZiAodGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvblRlbXApID4gMCkge1xuICAgICAgICB0aGlzLnVwZGF0ZVZhckkxOG4obGFuZ3VhZ2UsIGNvbnRleHQsIHRyYW5zbGF0aW9uVGVtcCk7XG4gICAgICAgIHRyYW5zbGF0aW9ucyA9IHRoaXMubWVyZ2VPYmplY3QodHJhbnNsYXRpb25UZW1wLCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICBvYnNlcnZlci5uZXh0KHRyYW5zbGF0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQnVzY2EgZG8gU2VydmnDp29cbiAgICB0aGlzLmdldEh0dHBTZXJ2aWNlKHRoaXMuc2VydmljZXNDb250ZXh0W2NvbnRleHRdLCBsYW5ndWFnZVNlYXJjaCwgbGl0ZXJhbHMpLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICBpZiAocmVzcG9uc2UpIHtcbiAgICAgICAgdGhpcy51cGRhdGVMb2NhbFN0b3JhZ2UobGFuZ3VhZ2UsIGNvbnRleHQsIHJlc3BvbnNlKTtcbiAgICAgICAgdGhpcy51cGRhdGVWYXJJMThuKGxhbmd1YWdlLCBjb250ZXh0LCByZXNwb25zZSk7XG4gICAgICAgIHRyYW5zbGF0aW9uVGVtcCA9IHRoaXMuc2VhcmNoSW5WYXJJMThuKGxhbmd1YWdlLCBjb250ZXh0LCBsaXRlcmFscyk7XG4gICAgICAgIHRyYW5zbGF0aW9ucyA9IHRoaXMubWVyZ2VPYmplY3QodHJhbnNsYXRpb25UZW1wLCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICBvYnNlcnZlci5uZXh0KHRyYW5zbGF0aW9ucyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNlIG7Do28gZW5jb250cm91IHRvZGFzIGFzIGxpdGVyYWlzIHBlc3F1aXNhZGFzIG5vIGlkaW9tYVxuICAgICAgLy8gRW50w6NvIHJlZmF6IG8gcHJvY2Vzc28gcHJvY3VyYW5kbyBlbSBwb3J0dWd1w6pzXG4gICAgICBpZiAobGl0ZXJhbHMubGVuZ3RoID4gdGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvbnMpKSB7XG4gICAgICAgIGlmIChsYW5ndWFnZUFsdGVybmF0aXZlID09PSAncHQtYnInKSB7XG4gICAgICAgICAgLy8gU2UgbsOjbyBlbmNvbnRyb3UgbmVtIGVtIHBvcnR1Z3XDqnMsIGVudMOjbyByZXRvcm5hIG8gbm9tZSBkYXMgbGl0ZXJhaXNcbiAgICAgICAgICB0cmFuc2xhdGlvbnMgPSB0aGlzLmNvbXBsZXRlRmF1bHRMaXRlcmFscyhsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMsIHRyYW5zbGF0aW9ucyk7XG4gICAgICAgICAgdGhpcy51cGRhdGVMb2NhbFN0b3JhZ2UobGFuZ3VhZ2UsIGNvbnRleHQsIHRyYW5zbGF0aW9ucyk7XG4gICAgICAgICAgdGhpcy51cGRhdGVWYXJJMThuKGxhbmd1YWdlLCBjb250ZXh0LCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICAgIG9ic2VydmVyLm5leHQodHJhbnNsYXRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmdldExpdGVyYWxzRnJvbUNvbnRleHRTZXJ2aWNlKGxhbmd1YWdlLCBjb250ZXh0LCBsaXRlcmFscywgb2JzZXJ2ZXIsIHRyYW5zbGF0aW9ucywgJ3B0LWJyJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIFByb2N1cmEgcGVsYSBsaXN0YSBkZSBsaXRlcmFpc1xuICAvLyBTZSBuw6NvIGVuY29udHJhciB0b2RhcywgcHJvY3VyYSBlbSBwdC1iclxuICBwcml2YXRlIGdldExpdGVyYWxzRnJvbUNvbnRleHRDb25zdGFudChcbiAgICBsYW5ndWFnZTogc3RyaW5nLFxuICAgIGNvbnRleHQ6IHN0cmluZyxcbiAgICBsaXRlcmFsczogQXJyYXk8c3RyaW5nPixcbiAgICBvYnNlcnZlcjogYW55LFxuICAgIHRyYW5zbGF0aW9uczogYW55ID0ge31cbiAgKSB7XG4gICAgdHJhbnNsYXRpb25zID0gdGhpcy5tZXJnZU9iamVjdCh0cmFuc2xhdGlvbnMsIHRoaXMuc2VhcmNoSW5WYXJJMThuKGxhbmd1YWdlLCBjb250ZXh0LCBsaXRlcmFscykpO1xuICAgIGlmICh0aGlzLmNvdW50T2JqZWN0KHRyYW5zbGF0aW9ucykgPiAwKSB7XG4gICAgICBvYnNlcnZlci5uZXh0KHRyYW5zbGF0aW9ucyk7XG4gICAgfVxuXG4gICAgLy8gU2UgZm9pIHBlc3F1aXNhZG8gcG9yIGxpdGVyYWlzXG4gICAgaWYgKGxpdGVyYWxzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIFNlIG7Do28gZW5jb250cm91IHRvZGFzIGFzIGxpdGVyYWlzIHBlc3F1aXNhZGFzIG5vIGlkaW9tYSwgcHJvY3VyYSBlbSBwb3J0dWd1w6pzXG4gICAgICBpZiAobGl0ZXJhbHMubGVuZ3RoID4gdGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvbnMpKSB7XG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gJ3B0LWJyJykge1xuICAgICAgICAgIC8vIFNlIG7Do28gZW5jb250cm91IG5lbSBlbSBwb3J0dWd1w6pzLCBlbnTDo28gcmV0b3JuYSBvIG5vbWUgZGFzIGxpdGVyYWlzXG4gICAgICAgICAgdHJhbnNsYXRpb25zID0gdGhpcy5jb21wbGV0ZUZhdWx0TGl0ZXJhbHMobGFuZ3VhZ2UsIGNvbnRleHQsIGxpdGVyYWxzLCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICAgIG9ic2VydmVyLm5leHQodHJhbnNsYXRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmdldExpdGVyYWxzRnJvbUNvbnRleHRDb25zdGFudCgncHQtYnInLCBjb250ZXh0LCBsaXRlcmFscywgb2JzZXJ2ZXIsIHRyYW5zbGF0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gU2UgbsOjbyBlbmNvbnRyYXIgbmVuaHVtYSBsaXRlcmFsLCBwcm9jdXJhIGVtIHBvcnR1Z3XDqnNcbiAgICAgIGlmICh0aGlzLmNvdW50T2JqZWN0KHRyYW5zbGF0aW9ucykgPT09IDAgJiYgbGFuZ3VhZ2UgIT09ICdwdC1icicpIHtcbiAgICAgICAgdGhpcy5nZXRMaXRlcmFsc0Zyb21Db250ZXh0Q29uc3RhbnQoJ3B0LWJyJywgY29udGV4dCwgbGl0ZXJhbHMsIG9ic2VydmVyLCB0cmFuc2xhdGlvbnMpO1xuICAgICAgfVxuXG4gICAgICAvLyBjYXNvIG7Do28gaW5mb3JtYXIgbGl0ZXJhaXMgZSBuw6NvIGhvdXZlciB0cmFkdcOnw6NvXG4gICAgICBvYnNlcnZlci5uZXh0KHRyYW5zbGF0aW9ucyk7XG4gICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEJ1c2NhIHBlbGFzIGxpdGVyYWlzIG5vIGxvY2FsIHN0b3JhZ2VcbiAgcHJpdmF0ZSBzZWFyY2hJbkxvY2FsU3RvcmFnZShsYW5ndWFnZTogc3RyaW5nLCBjb250ZXh0OiBzdHJpbmcsIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+KTogYW55IHtcbiAgICBjb25zdCB0cmFuc2xhdGlvbnM6IGFueSA9IHt9O1xuXG4gICAgaWYgKGxpdGVyYWxzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGl0ZXJhbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgbGl0ZXJhbCA9IGxpdGVyYWxzW2ldO1xuICAgICAgICBjb25zdCB0cmFuc2xhdGlvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGxhbmd1YWdlICsgJy0nICsgY29udGV4dCArICctJyArIGxpdGVyYWwpO1xuICAgICAgICBpZiAodHJhbnNsYXRpb24pIHtcbiAgICAgICAgICB0cmFuc2xhdGlvbnNbbGl0ZXJhbF0gPSB0cmFuc2xhdGlvbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJhbnNsYXRpb25zO1xuICB9XG5cbiAgLy8gQnVzY2EgcGVsYXMgbGl0ZXJhaXMgbmEgdmFyacOhdmVsIGRvIHNlcnZpw6dvXG4gIHByaXZhdGUgc2VhcmNoSW5WYXJJMThuKGxhbmd1YWdlOiBzdHJpbmcsIGNvbnRleHQ6IHN0cmluZywgbGl0ZXJhbHM6IEFycmF5PHN0cmluZz4pOiBhbnkge1xuICAgIGxldCB0cmFuc2xhdGlvbnM6IGFueSA9IHt9O1xuXG4gICAgaWYgKHRoaXMudmFySTE4bltsYW5ndWFnZV0gJiYgdGhpcy52YXJJMThuW2xhbmd1YWdlXVtjb250ZXh0XSkge1xuICAgICAgY29uc3QgY29udGVudCA9IHRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF07XG5cbiAgICAgIGlmIChsaXRlcmFscy5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIEJ1c2NhIGFzIGxpdGVyYWlzIGRlc2VqYWRhc1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpdGVyYWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgbGl0ZXJhbCA9IGxpdGVyYWxzW2ldO1xuICAgICAgICAgIGlmIChjb250ZW50Lmhhc093blByb3BlcnR5KGxpdGVyYWwpKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGlvbnNbbGl0ZXJhbF0gPSBjb250ZW50W2xpdGVyYWxdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQXRyaWJ1aSB0b2RhcyBhcyBsaXRlcmFpc1xuICAgICAgICB0cmFuc2xhdGlvbnMgPSB7IC4uLmNvbnRlbnQgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zbGF0aW9ucztcbiAgfVxuXG4gIC8vIEF0dWFsaXphIG8gbG9jYWwgc3RvcmFnZVxuICBwcml2YXRlIHVwZGF0ZUxvY2FsU3RvcmFnZShsYW5ndWFnZTogc3RyaW5nLCBjb250ZXh0OiBzdHJpbmcsIGRhdGE6IGFueSkge1xuICAgIGlmICh0aGlzLnVzZUNhY2hlKSB7XG4gICAgICBmb3IgKGNvbnN0IGxpdGVyYWwgb2YgT2JqZWN0LmtleXMoZGF0YSkpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0obGFuZ3VhZ2UgKyAnLScgKyBjb250ZXh0ICsgJy0nICsgbGl0ZXJhbCwgZGF0YVtsaXRlcmFsXSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gQXR1YWxpemEgYSB2YXJpw6F2ZWwgbG9jYWwgY29tIGFzIGxpdGVyYWlzIGNvbSBvcyBvYmpldG9zIHBhc3NhZG9zIG5hIGNvbmZpZ3VyYcOnw6NvXG4gIHByaXZhdGUgc2V0VmFySTE4bihjb250ZXh0czogT2JqZWN0KSB7XG4gICAgLy8gUGVyY29ycmUgb3MgY29udGV4dG9zXG4gICAgZm9yIChjb25zdCBjb250ZXh0IG9mIE9iamVjdC5rZXlzKGNvbnRleHRzKSkge1xuICAgICAgY29uc3QgY29udGV4dENvbnRlbnQgPSBjb250ZXh0c1tjb250ZXh0XTtcbiAgICAgIC8vIFBlcmNvcnJlIG9zIGlkaW9tYXMgZGVudHJvIGRvIGNvbnRleHRvXG4gICAgICBmb3IgKGNvbnN0IGxhbmd1YWdlIG9mIE9iamVjdC5rZXlzKGNvbnRleHRDb250ZW50KSkge1xuICAgICAgICBjb25zdCBsYW5ndWFnZUNvbnRlbnQgPSBjb250ZXh0Q29udGVudFtsYW5ndWFnZV07XG4gICAgICAgIGlmIChsYW5ndWFnZSA9PT0gJ3VybCcpIHtcbiAgICAgICAgICB0aGlzLnNlcnZpY2VzQ29udGV4dFtjb250ZXh0XSA9IGxhbmd1YWdlQ29udGVudDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVZhckkxOG4obGFuZ3VhZ2UsIGNvbnRleHQsIGxhbmd1YWdlQ29udGVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBBdHVhbGl6YSBhIHZhcmnDoXZlbCBsb2NhbCBjb20gYXMgbGl0ZXJhaXMgaWRpb21hIGUgY29udGV4dG9cbiAgcHJpdmF0ZSB1cGRhdGVWYXJJMThuKGxhbmd1YWdlOiBzdHJpbmcsIGNvbnRleHQ6IHN0cmluZywgZGF0YTogYW55KSB7XG4gICAgbGFuZ3VhZ2UgPSBsYW5ndWFnZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgaWYgKCF0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdKSB7XG4gICAgICB0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdID0geyBbY29udGV4dF06IHt9IH07XG4gICAgfVxuICAgIGlmICghdGhpcy52YXJJMThuW2xhbmd1YWdlXVtjb250ZXh0XSkge1xuICAgICAgdGhpcy52YXJJMThuW2xhbmd1YWdlXVtjb250ZXh0XSA9IHt9O1xuICAgIH1cblxuICAgIC8vIENyaWEgb3UgYXR1YWxpemEgbyBjb250ZXh0byBkZW50cm8gZG8gc3RvcmFnZVxuICAgIHRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF0gPSB0aGlzLm1lcmdlT2JqZWN0KGRhdGEsIHRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRIdHRwU2VydmljZSh1cmw6IHN0cmluZywgbGFuZ3VhZ2U6IHN0cmluZywgbGl0ZXJhbHM6IEFycmF5PHN0cmluZz4pIHtcbiAgICBsZXQgcGFyYW0gPSAnP2xhbmd1YWdlPScgKyBsYW5ndWFnZTtcbiAgICBpZiAobGl0ZXJhbHMubGVuZ3RoID4gMCkge1xuICAgICAgcGFyYW0gKz0gJyZsaXRlcmFscz0nICsgbGl0ZXJhbHMuam9pbigpO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBhIGJhcnJhIGZpbmFsIGRvIGVuZGVyZcOnb1xuICAgIHVybCA9IHVybC5yZXBsYWNlKC9cXC8kLywgJycpO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoYCR7dXJsfSR7cGFyYW19YCk7XG4gIH1cblxuICAvLyBDb21wbGV0YSBjb20gbyBub21lIGRhIGxpdGVyYWlzLCBhcyBxdWUgbsOjbyBmb3JhbSBlbmNvbnRyYWRhc1xuICBwcml2YXRlIGNvbXBsZXRlRmF1bHRMaXRlcmFscyhsYW5ndWFnZTogc3RyaW5nLCBjb250ZXh0OiBzdHJpbmcsIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+LCB0cmFuc2xhdGlvbnM6IGFueSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGl0ZXJhbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGxpdGVyYWwgPSBsaXRlcmFsc1tpXTtcbiAgICAgIGlmICghdHJhbnNsYXRpb25zW2xpdGVyYWxdKSB7XG4gICAgICAgIHRyYW5zbGF0aW9uc1tsaXRlcmFsXSA9IGxpdGVyYWw7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cmFuc2xhdGlvbnM7XG4gIH1cblxuICAvLyBDb250YSBvcyBhdHJpYnV0b3MgZG8gb2JqZXRvXG4gIHByaXZhdGUgY291bnRPYmplY3Qob2JqOiBvYmplY3QpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7XG4gIH1cblxuICAvLyBGYXogbyBtZXJnZSBkb3Mgb2JqZXRvcywgc2VtcHJlIGRhbmRvIHByZWZlcsOqbmNpYSBwYXJhIG8gcHJpbWVpcm8gb2JqZXRvIGRlIHBhcsOibWV0cm9cbiAgcHJpdmF0ZSBtZXJnZU9iamVjdChvYmpQZXJtYW5lbnQ6IGFueSwgb2JqOiBhbnkpIHtcbiAgICByZXR1cm4geyAuLi5vYmosIC4uLm9ialBlcm1hbmVudCB9O1xuICB9XG59XG4iXX0=